<!DOCTYPE html>
<html>
<head>
        
        

        <title>Authorship attribution: Part 2 | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js"></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/tomorrow-night.css" />
        <script src="/highlight/highlight.pack.js"></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" />
        <script src="/custom.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://jpverkamp.github.io"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="http://jpverkamp.github.io/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://jpverkamp.github.io/category/archives/2004">2004</a></li><li><a href="http://jpverkamp.github.io/category/archives/2005">2005</a></li><li><a href="http://jpverkamp.github.io/category/archives/2006">2006</a></li><li><a href="http://jpverkamp.github.io/category/archives/2007">2007</a></li><li><a href="http://jpverkamp.github.io/category/archives/2008">2008</a></li><li><a href="http://jpverkamp.github.io/category/archives/2009">2009</a></li><li><a href="http://jpverkamp.github.io/category/archives/2010">2010</a></li><li><a href="http://jpverkamp.github.io/category/archives/2011">2011</a></li><li><a href="http://jpverkamp.github.io/category/archives/2012">2012</a></li><li><a href="http://jpverkamp.github.io/category/archives/2013">2013</a></li><li><a href="http://jpverkamp.github.io/category/archives/2014">2014</a></li></ul></li><li class="dropdown"><a href="http://jpverkamp.github.io/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://jpverkamp.github.io/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="http://jpverkamp.github.io/category/other/cooking">Cooking</a></li><li><a href="http://jpverkamp.github.io/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="http://jpverkamp.github.io/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://jpverkamp.github.io/category/photography/dp-challenge">DP Challenge</a></li><li><a href="http://jpverkamp.github.io/category/photography/photosets">Photosets</a></li><li><a href="http://jpverkamp.github.io/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="http://jpverkamp.github.io/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://jpverkamp.github.io/category/programming/by-language">By Language</a></li><li><a href="http://jpverkamp.github.io/category/programming/by-project">By Project</a></li><li><a href="http://jpverkamp.github.io/category/programming/by-source">By Source</a></li><li><a href="http://jpverkamp.github.io/category/programming/by-topic">By Topic</a></li><li><a href="http://jpverkamp.github.io/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="http://jpverkamp.github.io/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://jpverkamp.github.io/category/research/by-topic">By Topic</a></li><li><a href="http://jpverkamp.github.io/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="http://jpverkamp.github.io/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://jpverkamp.github.io/category/writing/by-genre">By Genre</a></li><li><a href="http://jpverkamp.github.io/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="http://jpverkamp.github.io/category/writing/novels">Novels</a></li><li><a href="http://jpverkamp.github.io/category/writing/other">Other</a></li><li><a href="http://jpverkamp.github.io/category/writing/short-stories">Short Stories</a></li></ul></li></ul>

      <!--
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
      </form>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Authorship attribution: Part 2</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2013-08-02"><span class="year">2013</span> <span class="month">Aug</span> <span class="day">2</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="http://jpverkamp.github.io/category/programming/by-topic/mathematics">Mathematics</a></li><li><a href="http://jpverkamp.github.io/category/programming">Programming</a></li><li><a href="http://jpverkamp.github.io/category/research">Research</a></li><li><a href="http://jpverkamp.github.io/category/programming/by-topic/data-structures/vectors">Vectors</a></li><li><a href="http://jpverkamp.github.io/category/programming/by-language/scheme">Scheme</a></li><li><a href="http://jpverkamp.github.io/category/programming/by-language/racket">Racket</a></li><li><a href="http://jpverkamp.github.io/category/research/by-topic/computational-linguistics">Computational Linguistics</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <p><a href="http://jpverkamp.github.io/2013/07/30/authorship-attribution-part-1">Last time</a>, we used word rank to try to figure out who could possibly have written Cuckoo's calling. It didn't work out so well, but we at least have a nice framework in place. So perhaps we can try a few more ways of turning entire novels into a few numbers. <!--more--></p>
<p>Rather than word rank, how about <a href="https://en.wikipedia.org/wiki/stop_word">stop word</a> frequency. Essentially, stop words are small words such as articles and prepositions that don't always carry much weight for a sentence's meaning. On the other hand though, those are exactly the same words that appear most commonly, so perhaps the frequencies will tell us something more.</p>
<p>The code is actually rather similar. To start out with, we want to load in a set of stop words. There are dozens of lists out there; any of them will work.</p>
<pre class="scheme"><code>; Load the stop words
(define stop-words
  (with-input-from-file "stop-words.txt"
    (lambda ()
      (for/set ([line (in-lines)]) (fix-word line)))))</code></pre>
<p>With that, we just need to count the occurances of each word and then normalize. This will help when some books have more or less stop words overall.</p>
<pre class="scheme"><code>; Calculate the relative frequencies of stop words in a text
(define (stop-word-frequency [in (current-input-port)])
  ; Store the frequency and word count
  (define counts (make-hash))
  (define total (make-parameter 0.0))

  ; Loop across the input text
  (for* ([line (in-lines in)]
         [word (in-list (string-split line))])
    (define fixed (fix-word word))

    (when (set-member? stop-words fixed)
      (total (+ (total) 1))
      (hash-set! counts word (add1 (hash-ref counts word 0)))))

  ; Normalize and return frequencies
  ; Use the order in the stop words file
  (for/vector ([word (in-set stop-words)])
    (/ (hash-ref counts word 0)
       (total))))</code></pre>
<p>Using Cuckoo's Calling and a particular list with 50 words, we have:</p>
<pre class="scheme"><code>&gt; (with-input-from-file "../target.txt" stop-word-frequency)
'#(0.043 0.003 0.000 0.002 0.026
   ...
   0.001 0.000 0.000 0.000 0.000)</code></pre>
<p>Well that doesn't mean much to us. Hopefully it means more to the computer. :)</p>
<p>So how similar does this one say Cuckoo's Calling and the Deathly Hallows are?</p>
<pre class="scheme"><code>&gt; (let ([a (with-input-from-file "Cuckoo's Calling.txt" stop-word-frequency)]
        [b (with-input-from-file "Deathly Hallows.txt" stop-word-frequency)])
    (cosine-similarity a b))
0.877</code></pre>
<p>That's a lot higher! Unfortunately, that doesn't really mean that they're more similar than the other test. For all we know, everything could be more similar. So let's try the entire library again:</p>
<table class="table table-striped">
<tr><td>1</td><td>0.896</td><td>Stephen, King</td><td>Wizard and Glass</td></tr>
<tr><td>2</td><td>0.896</td><td>Rowling, J.K.</td><td>Harry Potter and the Order of the Phoenix</td></tr>
<tr><td>3</td><td>0.895</td><td>Riordan, Rick</td><td>The Mark of Athena</td></tr>
<tr><td>4</td><td>0.891</td><td>Jordan, Robert</td><td>Knife of Dreams</td></tr>
<tr><td>5</td><td>0.891</td><td>Riordan, Rick</td><td>The Lost Hero</td></tr>
<tr><td>6</td><td>0.888</td><td>Jordan, Robert</td><td>A Crown of Swords</td></tr>
<tr><td>7</td><td>0.888</td><td>Riordan, Rick</td><td>The Son of Neptune</td></tr>
<tr><td>8</td><td>0.887</td><td>Croggon, Alison</td><td>The Singing</td></tr>
<tr><td>9</td><td>0.887</td><td>Stephen, King</td><td>The Drawing of the Three</td></tr>
<tr><td>10</td><td>0.884</td><td>Jordan, Robert</td><td>Crossroads of Twilight</td></tr>
</table>
<p>Well, that's good and bad. It's unfortunate that it's not first, but we actually have a Harry Potter book in the top 10! The rest aren't that low down either, mostly appearing in the top 25. That should help with the author averages:</p>
<table class="table table-striped">
<tr><td>1</td><td>0.876</td><td>Jordan, Robert</td></tr>
<tr><td>2</td><td>0.876</td><td>Rowling, J.K.</td></tr>
<tr><td>3</td><td>0.873</td><td>Stephen, King</td></tr>
<tr><td>4</td><td>0.865</td><td>Martin, George R. R.</td></tr>
<tr><td>5</td><td>0.851</td><td>Riordan, Rick</td></tr>
</table>
<p>None too shabby! It's a bit surprising that Robert Jordan is up at the top, but if we only consider authors that were actually around to write Cuckoo's Calling, JK Rowling is actually at the top of the list.</p>
<p>Still, can we do better?</p>
<p>Here's another idea (that I used in my <a href="blog.jverkamp.com/category/programming/anngram/">previous work</a>): <a href="https://en.wikipedia.org/wiki/n-grams">n-grams</a>. Essentially, take constant sized slices of text, completely ignoring the content. So if you were dealing with the text 'THE DUCK QUACKS' and 4-grams, you would have these:</p>
<pre>'THE '  'HE D'  'E DU'  ' DUC'  'DUCK'
'UCK '  'CK Q'  'K QU'  ' QUA'  'QUAC'
'UACK'</pre>
<p>How does this help us? Well, in addition to keeping track of the most common words, n-grams will capture the relationships between words. Theoretically, this extra information might help out. So how do we measure it?</p>
<pre class="scheme"><code>; Calculate n gram frequencies
(define (n-gram-frequency [in (current-input-port)] #:n [n 4] #:limit [limit 100])

  ; Store counts and total to do frequency later
  (define counts (make-hash))

  ; Keep a circular buffer of text, read char by char
  (define n-gram (make-string 4 #\nul))
  (for ([c (in-port read-char in)])
    (set! n-gram (substring (string-append n-gram (string c)) 1))
    (hash-set! counts n-gram (add1 (hash-ref counts n-gram 0))))

  ; Find the top limit many values
  (define top-n
    (take
     (sort
      (for/list ([(key val) (in-hash counts)])
        (list val key))
      (lambda (a b) (&gt; (car a) (car b))))
     limit))

  ; Cacluate the frequency of just those
  (define total (* 1.0 (for/sum ([vk (in-list top-n)]) (car vk))))
  (for/hash ([vk (in-list top-n)])
    (values (cadr vk) (/ (car vk) total))))</code></pre>
<p>It's pretty much the same as the previous code. The only difference is the code to read the n-grams rather than the words, but that should be pretty straight forward. It's certainly not the most efficient, but it's fast enough. It can churn through a few hundred books in a few minutes. Good enough for me.</p>
<p>How does it perform though?</p>
<table class="table table-striped">
<tr><td>1</td><td>0.777</td><td>Stephen, </td><td>Wizard and Glass</td></tr>
<tr><td>2</td><td>0.764</td><td>Jordan, Robert</td><td>The Gathering Storm</td></tr>
<tr><td>3</td><td>0.757</td><td>Card, Orson Scott</td><td>Heart Fire</td></tr>
<tr><td>4</td><td>0.757</td><td>Card, Orson Scott</td><td>Children of the Mind</td></tr>
<tr><td>5</td><td>0.756</td><td>Stephen, </td><td>Song of Susannah</td></tr>
<tr><td>6</td><td>0.756</td><td>Stephen, </td><td>The Dark Tower</td></tr>
<tr><td>7</td><td>0.753</td><td>Butcher, Jim</td><td>White Night</td></tr>
<tr><td>8</td><td>0.751</td><td>Butcher, Jim</td><td>Turn Coat</td></tr>
<tr><td>9</td><td>0.746</td><td>Butcher, Jim</td><td>Captain's Fury</td></tr>
<tr><td>10</td><td>0.746</td><td>Butcher, Jim</td><td>Side Jobs</td></tr>
</table>
<p>That's not so good. How about the averages?</p>
<table class="table table-striped">
<tr><td>1</td><td>0.731</td><td>Stephen, King,</td></tr>
<tr><td>2</td><td>0.724</td><td>Martin, George R. R.</td></tr>
<tr><td>3</td><td>0.715</td><td>Jordan, Robert</td></tr>
<tr><td>4</td><td>0.708</td><td>Butcher, Jim</td></tr>
<tr><td>5</td><td>0.698</td><td>Robinson, Kim Stanley</td></tr>
</table>
<p>It turns out that JK Rowling is actually second from the bottom. Honestly, I'm not sure what this says. Did I mess up the algorithm? Well then why are Steven King, Robert Jordan, and Jim Butcher still so high up?</p>
<p>I still have a few more ideas though. Next week it is!</p>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Authorship attribution: Part 2";
var disqus_url = "http://blog.jverkamp.com/2013/08/02/authorship-attribution-part-2/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="http://jpverkamp.github.io/2013/07/30/authorship-attribution-part-1">← Authorship attribution: Part 1</a></li><li><a href="http://jpverkamp.github.io/category/archives">Archives</a></li><li><a href="http://jpverkamp.github.io/2013/08/06/authorship-attribution-part-3">Authorship attribution: Part 3 →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="http://jpverkamp.github.io/2013/07/30/authorship-attribution-part-1">← Authorship attribution: Part 1</a></li><li><a href="http://jpverkamp.github.io/category/programming">Programming</a></li><li><a href="http://jpverkamp.github.io/2013/08/06/authorship-attribution-part-3">Authorship attribution: Part 3 →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="http://jpverkamp.github.io/2013/07/30/authorship-attribution-part-1">← Authorship attribution: Part 1</a></li><li><a href="http://jpverkamp.github.io/category/research">Research</a></li><li><a href="http://jpverkamp.github.io/2013/08/06/authorship-attribution-part-3">Authorship attribution: Part 3 →</a></li></ul></nav>

                <div class="legal">
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="http://directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>
</body>
</html>