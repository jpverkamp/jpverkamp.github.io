<!DOCTYPE html>
<html>
<head>
        
        

        <title>Cyclic equality | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" defer></script>
        <script src="//code.jquery.com/ui/1.11.1/jquery-ui.min.js" defer></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" defer />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" defer />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" defer></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" defer />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js" defer></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js" defer></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/obsidian.css" defer />
        <script src="/highlight/highlight.pack.js" defer></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" defer />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js" defer ></script>

        <!-- Pretty pretty fonts -->
        <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Calligraffitti" defer />

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" defer />
        <script src="/custom.js" defer></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/" />
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="//blog.jverkamp.com"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="//blog.jverkamp.com/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/archives/2004">2004</a></li><li><a href="//blog.jverkamp.com/category/archives/2005">2005</a></li><li><a href="//blog.jverkamp.com/category/archives/2006">2006</a></li><li><a href="//blog.jverkamp.com/category/archives/2007">2007</a></li><li><a href="//blog.jverkamp.com/category/archives/2008">2008</a></li><li><a href="//blog.jverkamp.com/category/archives/2009">2009</a></li><li><a href="//blog.jverkamp.com/category/archives/2010">2010</a></li><li><a href="//blog.jverkamp.com/category/archives/2011">2011</a></li><li><a href="//blog.jverkamp.com/category/archives/2012">2012</a></li><li><a href="//blog.jverkamp.com/category/archives/2013">2013</a></li><li><a href="//blog.jverkamp.com/category/archives/2014">2014</a></li><li><a href="//blog.jverkamp.com/category/archives/2015">2015</a></li><li><a href="//blog.jverkamp.com/category/archives/2016">2016</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="//blog.jverkamp.com/category/other/book-reviews">Book Reviews</a></li><li><a href="//blog.jverkamp.com/category/other/cooking">Cooking</a></li><li><a href="//blog.jverkamp.com/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/photography/dp-challenge">DP Challenge</a></li><li><a href="//blog.jverkamp.com/category/photography/photosets">Photosets</a></li><li><a href="//blog.jverkamp.com/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/programming/by-language">By Language</a></li><li><a href="//blog.jverkamp.com/category/programming/by-project">By Project</a></li><li><a href="//blog.jverkamp.com/category/programming/by-source">By Source</a></li><li><a href="//blog.jverkamp.com/category/programming/by-topic">By Topic</a></li><li><a href="//blog.jverkamp.com/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/research/by-topic">By Topic</a></li><li><a href="//blog.jverkamp.com/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/writing/by-genre">By Genre</a></li><li><a href="//blog.jverkamp.com/category/writing/ideas">Ideas</a></li><li><a href="//blog.jverkamp.com/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="//blog.jverkamp.com/category/writing/novels">Novels</a></li><li><a href="//blog.jverkamp.com/category/writing/other">Other</a></li><li><a href="//blog.jverkamp.com/category/writing/short-stories">Short Stories</a></li><li><a href="//blog.jverkamp.com/category/writing/writing-excuses">Writing Excuses</a></li></ul></li></ul>

      <form action="//www.google.com/search" method="get" onSubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input name="q" type="hidden" />
          <input name="qfront" type="text" class="form-control" placeholder="Search" />
          <button type="submit" class="btn btn-default" value="Search">Search</button>
        </p>
      </form>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Cyclic equality</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2013-04-09"><span class="year">2013</span> <span class="month">Apr</span> <span class="day">9</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="//blog.jverkamp.com/category/programming/by-topic/data-structures">Data Structures</a></li><li><a href="//blog.jverkamp.com/category/programming">Programming</a></li><li><a href="//blog.jverkamp.com/category/programming/by-source/programming-praxis">Programming Praxis</a></li><li><a href="//blog.jverkamp.com/category/programming/by-language/racket">Racket</a></li><li><a href="//blog.jverkamp.com/category/programming/by-language/scheme">Scheme</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <p>In <a title="Cyclic equality on Programming Praxis" href="http://programmingpraxis.com/2013/04/09/cyclic-equality/">today's post</a> from Programming Praxis, the goal is to check if two cyclic lists are equal. So if you have the cycles <code>↻(1 2 3 4 5)</code> and <code>↻(3 4 5 1 2)</code>, they're equal. Likewise, <code>↻(1 2 2 1)</code> and <code>↻(2 1 1 2)</code> are equal. But <code>↻(1 2 3 4)</code> and <code>↻(1 2 3 5)</code> are not since they have different elements while <code>↻(1 1 1)</code> and <code>↻(1 1 1 1)</code> aren't since they have different elements.</p>
<!--more-->
<p>Basically, there are two ways that you can solve this problem. First, you actually use the cyclic structure and recursively check each start in one list for a matching cycle in the other. Alternatively, so long as the lengths are equal you can just double one list and search for the other as a subset. We'll go ahead and code up both.</p>
<p>First, we want to write a semi-straight forward comparison. The function will take two lists. It will recur across each in both for a start and loop in the second until either a match is confirmed or not. One thing that I want to do is make a cycle structure. We could use mutation to set the last <code>cdr</code>/<code>tail</code> of the list to the head, but instead I'll make the following structure:</p>
<pre class="scheme"><code>; Store a cycle as the current head and original (reset) head
(define-struct cycle (current original))

; Convert a list to a cycle
(define (list-&gt;cycle ls)
  (make-cycle ls ls))

; Convert a cycle to a list
(define (cycle-&gt;list c)
  (cycle-take (cycle-length c) c))

; Return the first item of a cycle
(define (cycle-head c)
  (if (null? (cycle-current c))
      (car (cycle-original c))
      (car (cycle-current c))))

; Return all but the first item of a cycle
(define (cycle-tail c)
  (if (null? (cycle-current c))
      (make-cycle (cdr (cycle-original c)) (cycle-original c))
      (make-cycle (cdr (cycle-current c)) (cycle-original c))))

; Get the length of a cycle
(define (cycle-length c)
  (length (cycle-original c)))

; Take the first n items from a cycle
(define (cycle-take n c)
  (let loop ([i 0] [c c])
    (if (= i n)
        '()
        (cons (cycle-head c) (loop (+ i 1) (cycle-tail c))))))

; Test if a cycle is about to reset
(define (cycle-reset? c)
  (null? (cycle-current c)))</code></pre>
<p>Essentially, we'll keep a pointer to the original list and reset when the current pointer runs out. All of this is of course transparent to anyone using the API, so we could switch it out for another (using a vector and a current pointer for example) if we wanted. The most useful function yet potentially non-standard function is <code>cycle-reset?</code>. Essentially, it fills what would have been <code>cycle-null?</code>, except a cycle will never be null. This tests when we're about to reset to the beginning of the cycle.</p>
<p>There are a bunch of unit tests in the <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/cycle-equality.rkt" title="cycle equality source on GitHub">source on GitHub</a>, but reset assured it works.</p>
<p>Now that we have that, the function it relatively straight forward:</p>
<pre class="scheme"><code>; Test if two cycles are equal
(define (cycle-equal? c1 c2)
  ; Check the lengths first
  (define len (cycle-length c1))
  (and (= len (cycle-length c2))
       (let loop ([ci1 c1] [ci2 c2])
         (cond
           ; No matches found
           [(cycle-reset? ci1)
            #f]
           ; No match found for this start in c1
           ; Advance c1, reset c2
           [(cycle-reset? ci2)
            (loop (cycle-tail ci1) c2)]
           ; Match found at the current element!
           [(equal? (cycle-take len ci1)
                    (cycle-take len ci2))
            #t]
           ; Otherwise, no match, advance c2
           [else
            (loop ci1 (cycle-tail ci2))]))))</code></pre>
<p>Theoretically, the comments should be pretty straight forward. For each starting pair, test if we have matching cycles using <code>cycle-take</code>. That could bail out early to make the code more efficient, but at the cost of being rather less clean. Really, if you wanted to make this code efficient you'd most likely use a vector and a head pointer anyways.</p>
<p>And here we have a few tests:</p>
<pre class="scheme"><code>&gt; (cycle-equal? (list-&gt;cycle '(1 2 3 4 5)) (list-&gt;cycle '(1 2 3 4 5)))
#t
&gt; (cycle-equal? (list-&gt;cycle '(1 2 3 4 5)) (list-&gt;cycle '(3 4 5 1 2)))
#t
&gt; (cycle-equal? (list-&gt;cycle '(1 2 2 1)) (list-&gt;cycle '(2 1 1 2)))
#t
&gt; (cycle-equal? (list-&gt;cycle '(1 1)) (list-&gt;cycle '(1 1 1 1)))
#f
&gt; (cycle-equal? (list-&gt;cycle '(1 2 3 4)) (list-&gt;cycle '(1 2 3 5)))
#f</code></pre>
<p>The next solution is a bit more straight forward if not quite as efficient. Essentially, double one of the lists and then check if the other is in it. For equal cycles, this will be equal but not others. You do have to check the length first though.</p>
<p>First, we need to write code to check if one given list is a subset anywhere in another. Here's one way to do that:</p>
<pre class="scheme"><code>; Check if p is a prefix of ls
(define (prefix? ls p)
  (or (null? p)
      (and (equal? (car ls) (car p))
           (prefix? (cdr ls) (cdr p)))))

; Check if a list needle is in the list haystack
(define (contains? haystack needle)
  (and (not (null? haystack))
       (or (prefix? haystack needle)
           (contains? (cdr haystack) needle))))</code></pre>
<p>And with that, checking for equal is a rather minimal function (we're taking the cycles as lists this time):</p>
<pre class="scheme"><code>; Check if two cycles (as lists) are equal by doubling one
(define (list-cycle-equal? lsc1 lsc2)
  (and (= (length lsc1) (length lsc2))
       (contains? (append lsc1 lsc1) lsc2)))</code></pre>
<p>And to check that we can use the same tests. We just don't convert to cycles first:</p>
<pre class="scheme"><code>&gt; (list-cycle-equal? '(1 2 3 4 5) '(1 2 3 4 5))
#t
&gt; (list-cycle-equal? '(1 2 3 4 5) '(3 4 5 1 2))
#t
&gt; (list-cycle-equal? '(1 2 2 1) '(2 1 1 2))
#t
&gt; (list-cycle-equal? '(1 1) '(1 1 1 1))
#f
&gt; (list-cycle-equal? '(1 2 3 4) '(1 2 3 5))
#f</code></pre>
<p>And that's it. If you'd like, you can see the entire code on GitHub (<a href="https://github.com/jpverkamp/small-projects/blob/master/blog/cycle-equality.rkt" title="cycle equality source on GitHub">cycle equality source</a>). All of the functions are already in this post, but there are a bunch of unit tests that might be of interest.</p>
<p><b>Edit 9 April 2013</b>: A comment from Maurits on the Programming Praxis post got me wondering if it could be done in <em>O(m + n)</em><span class="footnote"><sup><a href="#footnote-1">[1]</a></sup></span>. Basically, their idea was to lexically order both cycles and then check if they are equal as lists.</p>
<p>To lexically order them, we want to advance the cycle so that the smallest element in the cycle is first. If there is a tie, break it with the element right after each smallest and so on. Something like this:</p>
<pre class="scheme"><code>; Advance a cycle to the lexically minimum position
(define (cycle-lexical-min c [&lt; &lt;] [= =])
  ; Check if one cycle is less than another
  (define (cycle-&lt; c1 c2)
    (let loop ([c1 c1] [c1-cnt (cycle-length c1)]
               [c2 c2] [c2-cnt (cycle-length c2)])
      (and (&gt; c1-cnt 0)
           (&gt; c2-cnt 0)
           (or (&lt; (cycle-head c1) (cycle-head c2))
               (and (= (cycle-head c1) (cycle-head c2))
                    (loop (cycle-tail c1) (- c1-cnt 1)
                          (cycle-tail c2) (- c2-cnt 1)))))))

  ; Lexically sort by storing minimum
  (let loop ([min c] [c (cycle-tail c)])
    (cond
      [(cycle-reset? c) min]
      [(cycle-&lt; c min) (loop c (cycle-tail c))]
      [else (loop min (cycle-tail c))])))</code></pre>
<p>Note: This code uses an updated version of <code>cycle-length</code> that is <a href="https://en.wikipedia.org/wiki/amortized">amortized</a> <em>O(1)</em> (it caches the length). You can see the code for that on <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/cycle-equality.rkt" title="cycle equality source on GitHub">GitHub</a>.</p>
<p>One you have the sort, the actual comparison is easy:</p>
<pre class="scheme"><code>; Compare cycles by lexical comparison
(define (lexical-cycle-equal? c1 c2 [&lt; &lt;] [= =])
  (equal? (cycle-take (cycle-length c1) (cycle-lexical-min c1 &lt; =))
          (cycle-take (cycle-length c2) (cycle-lexical-min c2 &lt; =))))</code></pre>
<p>I’m not completely sure about the runtime of finding the lexical minimum. In the general case (with few duplicates), it’ll be <em>O(n)</em> though. Then there’s another <em>O(n + n)</em> for the cycle-length and cycle-take, plus a final additional <em>O(max(m, n))</em> for the equal?. So overall it would be <em>O(3m + 3n + max(m, n))</em> which is <em>O(m + n)</em>. The constant could be improved with a better abstraction, but not the big-O time.</p>
<p>And of course all of the previous tests still work:</p>
<pre class="scheme"><code>&gt; (lexical-cycle-equal? (list-&gt;cycle '(1 2 3 4 5)) (list-&gt;cycle '(1 2 3 4 5)) &lt; =)
#t
&gt; (lexical-cycle-equal? (list-&gt;cycle '(1 2 3 4 5)) (list-&gt;cycle '(3 4 5 1 2)) &lt; =)
#t
&gt; (lexical-cycle-equal? (list-&gt;cycle '(1 2 2 1)) (list-&gt;cycle '(2 1 1 2)) &lt; =)
#t
&gt; (lexical-cycle-equal? (list-&gt;cycle '(1 1)) (list-&gt;cycle '(1 1 1 1)) &lt; =)
#f
&gt; (lexical-cycle-equal? (list-&gt;cycle '(1 2 3 4)) (list-&gt;cycle '(1 2 3 5)) &lt; =)
#f</code></pre>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol><li><a name="footnote-1"></a>The previous two solutions are <em>O(mn)</em> because they have to compare each starting point pairwise</li></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Cyclic equality";
var disqus_url = "http://blog.jverkamp.com/2013/04/09/cyclic-equality/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="//blog.jverkamp.com/2013/04/09/the-croods">← The Croods</a></li><li><a href="//blog.jverkamp.com/category/archives">Archives</a></li><li><a href="//blog.jverkamp.com/2013/04/11/perlin-and-simplex-noise-in-racket">Perlin and simplex noise in Racket →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="//blog.jverkamp.com/2013/04/04/racket-roguelike-1-a-gui-screens-io-and-you">← Racket Roguelike 1: A GUI, screens, I/O, and you!</a></li><li><a href="//blog.jverkamp.com/category/programming">Programming</a></li><li><a href="//blog.jverkamp.com/2013/04/11/perlin-and-simplex-noise-in-racket">Perlin and simplex noise in Racket →</a></li></ul></nav>

                <div class="legal">
                        <a href="//blog.jverkamp.com/feed/atom.xml">feed <img style="border: 0;" src="//blog.jverkamp.com/rss.png" /></a><br />
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.defer=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53688146-1', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>