<!doctype html><html><head><title>Racket Roguelike 1: A GUI, screens, I/O, and you! â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/auto-render_2152414756166376840.min.45ae2f6b03d0c7b867df0a6cb7d43215ec78369998685a5748c5b12f502321f2.js integrity="sha256-Ra4vawPQx7hn3wpst9QyFex4NpmYaFpXSMWxL1AjIfI=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.7a29c6e86e28b6da48d6e8a526f4fa597dfba1464ca3f975ea9e0fb8c00052b7.css integrity="sha256-einG6G4ottpI1uilJvT6WX37oUZMo/l16p4PuMAAUrc="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Racket Roguelike 1: A GUI, screens, I/O, and you!</h1><div class=entry-meta><span class=entry-date>2013-04-04</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2013/04/09/cyclic-equality/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/7drl>7DRL</a><a href=https://blog.jverkamp.com/2013/04/11/racket-roguelike-2-infinite-caves/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/games>Games</a><a href=https://blog.jverkamp.com/2013/04/11/perlin-and-simplex-noise-in-racket/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/roguelikes>Roguelikes</a><a href=https://blog.jverkamp.com/2013/04/11/racket-roguelike-2-infinite-caves/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/series/racket-roguelike>Racket Roguelike</a><a href=https://blog.jverkamp.com/2013/04/11/racket-roguelike-2-infinite-caves/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2013/04/09/cyclic-equality/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2013/04/04/g.i.-joe-retaliation/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2013/04/09/the-croods/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p><a href=https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/>Last time</a>, we started with writing the ascii canvas we&rsquo;ll use as our GUI. Now we get to start the tutorial itself. Toady we have a four part goal:</p><ul><li>Create the initial <a href=https://en.wikipedia.org/wiki/Graphical%20user%20interface>GUI</a>, including an <a href=https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/>ascii-canvas</a></li><li>Create a &lsquo;screen&rsquo; abstraction to handle the current game state (menus, inventory, and the game itself)</li><li>Deal with input from the user and changing between screens</li><li>Draw an @ on the screen that can move around (the Roguelike equivalent of <a href=https://en.wikipedia.org/wiki/hello%20world>hello world</a>)</li></ul><p>So let&rsquo;s get to it!</p><p>(If you&rsquo;d like to follow along, you can can see the full source code here: <a href=https://github.com/jpverkamp/racket-roguelike/tree/day-1 title="Racket Roguelike on GitHub">just day 1</a>, <a href=https://github.com/jpverkamp/racket-roguelike title="Racket Roguelike on GitHub">everything so far</a>)</p><h3 id=creating-the-gui>Creating the GUI</h3><p>The first thing that we want to do is create a barebones GUI. The earlier we can get things up and visible, the easier it will be to debug. Theoretically (since we&rsquo;re writing a roguelike) we could write this to run directly in a terminal, but since I already have a custom <a href=https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/>ascii canvas</a>, I might as well use it.</p><p>So the first thing to do is create a frame:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; gui.rkt</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>require</span>
</span></span><span style=display:flex><span> racket/gui
</span></span><span style=display:flex><span> racket/draw)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Create a new GUI.</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>gui%
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>class</span> object%
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>init-field</span> width-in-chars
</span></span><span style=display:flex><span>                height-in-chars)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Create the frame.</span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>frame
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>new</span> frame%
</span></span><span style=display:flex><span>           [label <span style=color:#e6db74>&#34;Racket Roguelike&#34;</span>]
</span></span><span style=display:flex><span>           [style <span style=color:#f92672>&#39;</span>(no-resize-border)]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Make everything visible</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>send</span> frame show <span style=color:#66d9ef>#t</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Finish initilization.</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>super-new</span>)))
</span></span></code></pre></div><p>Which you can then create by running this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>new</span> gui%
</span></span><span style=display:flex><span>     [width-in-chars <span style=color:#ae81ff>40</span>]
</span></span><span style=display:flex><span>     [height-in-chars <span style=color:#ae81ff>24</span>])
</span></span></code></pre></div><p>Well, where is it? So&mldr; we didn&rsquo;t actually set a default width or height, so it&rsquo;s hiding somewhere. Likely it&rsquo;s just a one pixel square. We could fix that by passing more parameters to the <code>(super-new)</code> call, but instead, why don&rsquo;t we go ahead and add the canvas? (It automatically sizes the frame containing it).</p><h3 id=adding-an-ascii-canvas>Adding an ascii-canvas</h3><p>All we need to do is add the code to create the canvas right after we define <code>frame</code>. By passing <code>frame</code> as the <code>ascii-canvas'</code> <code>parent</code> parameter everything gets linked up nicely. Something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Create the ascii canvas</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>canvas
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>new</span> ascii-canvas%
</span></span><span style=display:flex><span>       [parent frame]
</span></span><span style=display:flex><span>       [width-in-characters width-in-chars]
</span></span><span style=display:flex><span>       [height-in-characters height-in-chars]))
</span></span></code></pre></div><p>Run it now and this is what we get:</p><figure><img src=/embeds/2013/blank-black-screen.png></figure><p>That&rsquo;s actually not bad at all. At least it looks like a real program now.</p><h3 id=creating-the-screens>Creating the screens</h3><p>Next, we&rsquo;re going to take a bit of a break to set up a nice abstraction for a foundation. We want to be able to keep the game logic for different phases of the game seperate, so to do that, we&rsquo;re going to use the concept of <em>screens</em>. Each <code>screen%</code> will have two methods that the main GUI will call:</p><ul><li><code>(update <code><a href="http://docs.racket-lang.org/search/index.html?q=key-event">key-event</a></code>
)</code> - update the screen when user input is received, return the next screen</li><li><code>(draw [ascii-canvas](https://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/))</code> - draw the screen when the GUI needs to refresh, given an ascii-canvas</li></ul><p>In terms of code, we want this class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; screen.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; An abstraction for a single in game interface</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;   inventory, menus, game screen, etc.</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>screen%
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>class</span> object%
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Called when the user pressed a key</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Should return the screen to use for the next tick (often &#39;this&#39;)</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>define/public</span> (<span style=color:#a6e22e>update</span> key-event)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#39;screen%</span> <span style=color:#e6db74>&#34;override this method&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Called when the GUI needs to draw this screen</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Passed an ascii-canvas to draw to</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>define/public</span> (<span style=color:#a6e22e>draw</span> canvas)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>error</span> <span style=color:#e6db74>&#39;screen%</span> <span style=color:#e6db74>&#34;override this method&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>super-new</span>)))
</span></span></code></pre></div><h3 id=the-main-menu-screen>The main menu screen</h3><p>To make use of this, the first thing that we want to implement is a main menu. We&rsquo;re just going to go with something really simple:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; main-menu-screen.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>require</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;screen.rkt&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>main-menu-screen%
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>class</span> screen%
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Always turn control over the game screen</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>define/override</span> (<span style=color:#a6e22e>update</span> key-event)
</span></span><span style=display:flex><span>      <span style=color:#75715e>; TODO: (new game-screen%)</span>
</span></span><span style=display:flex><span>      this)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Just draw a basic menu</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>define/override</span> (<span style=color:#a6e22e>draw</span> canvas)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>send</span> canvas clear)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>send</span> canvas write-center <span style=color:#e6db74>&#34;Racket Roguelike&#34;</span> <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>send</span> canvas write-center <span style=color:#e6db74>&#34;Press any key to continue&#34;</span> <span style=color:#ae81ff>12</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>super-new</span>)))
</span></span></code></pre></div><p>Easy enough. And now we have enough that we can start attaching this to the main GUI. First, we&rsquo;ll need to add the active screen as a private field to the GUI.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; gui.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; The active screen</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>active-screen (<span style=color:#a6e22e>new</span> main-menu-screen%))
</span></span></code></pre></div><p>I put it right after I defined <code>canvas</code>. Next, we want to do the initial draw. Since each frame is response for clearing itself, all we need is this (I put it right before the <code>super-new</code> call):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; gui.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Do the initial drawing</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>send</span> active-screen draw canvas)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>send</span> frame refresh)
</span></span></code></pre></div><p>And with that, we have the initial GUI:</p><figure><img src=/embeds/2013/main-menu.png></figure><p>Pretty good. Although it says that we can press any key to continue&mldr; So we should probably actually implement that.</p><h3 id=dealing-with-user-input>Dealing with user input</h3><p>This is actually one of the more complicated bits. By default, the <code>ascii-canvas</code> doesn&rsquo;t actually handle any input. So what we need is a new class with all of the properties of an <code>ascii-canvas</code> but with added keyboard support. Even better, we want it to share scope with the <code>active-screen</code> variable so we can implicitly use that.</p><p>What we need is an anonymous super class for <code>ascii-canvas</code> that overrides the <code>on-char</code> method from <code>canvas%</code>. Something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; gui.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Create the ascii canvas</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>canvas
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>new</span> (<span style=color:#a6e22e>class</span> ascii-canvas%
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>inherit-field</span>
</span></span><span style=display:flex><span>          width-in-characters
</span></span><span style=display:flex><span>          height-in-characters)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#75715e>; Process keyboard events</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>define/override</span> (<span style=color:#a6e22e>on-char</span> key-event)
</span></span><span style=display:flex><span>           (<span style=color:#66d9ef>case </span>(<span style=color:#a6e22e>send</span> key-event get-key-code)
</span></span><span style=display:flex><span>             <span style=color:#75715e>; Exit the program</span>
</span></span><span style=display:flex><span>             [(<span style=color:#a6e22e>escape</span>) (<span style=color:#a6e22e>exit</span>)]
</span></span><span style=display:flex><span>             <span style=color:#75715e>; Ignore key release events and pressing alt</span>
</span></span><span style=display:flex><span>             [(<span style=color:#a6e22e>release</span> menu) (<span style=color:#a6e22e>void</span>)]
</span></span><span style=display:flex><span>             <span style=color:#75715e>; Pass everything along to the screen</span>
</span></span><span style=display:flex><span>             <span style=color:#75715e>; Update the screen to whatever it returns</span>
</span></span><span style=display:flex><span>             [else
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>set! </span>active-screen (<span style=color:#a6e22e>send</span> active-screen update key-event))
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>; If it&#39;s still a valid screen, redraw it</span>
</span></span><span style=display:flex><span>                [(<span style=color:#a6e22e>is-a?</span> active-screen screen%)
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>send</span> active-screen draw this)
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>send</span> frame refresh)]
</span></span><span style=display:flex><span>                <span style=color:#75715e>; Otherwise, exit the program</span>
</span></span><span style=display:flex><span>                [else
</span></span><span style=display:flex><span>                 (<span style=color:#a6e22e>exit</span>)])]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#75715e>; Initialize the ascii-canvas fields</span>
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>super-new</span>
</span></span><span style=display:flex><span>          [parent frame]
</span></span><span style=display:flex><span>          [width-in-characters width-in-chars]
</span></span><span style=display:flex><span>          [height-in-characters height-in-chars]))))
</span></span></code></pre></div><p>It looks a little strange, but it works great. Theoretically, I could also use something like <code><a href="http://docs.racket-lang.org/search/index.html?q=mixins">mixins</a></code>
, but I&rsquo;m not familiar enough with them at the moment. Alternatively, I could set up ascii canvas so that it takes a keyboard input function as a parameter. Hmm. Perhaps another day.</p><p>If we run it again, we get something that looks exactly the same. And it <em>still</em> doesn&rsquo;t do anything (since the <code>main-menu-screen%</code> code doesn&rsquo;t actually do anything yet&mldr;). So we need another screen to change to.</p><h3 id=the-main-game-screen>The main game screen</h3><p>Well, it&rsquo;s time. Let&rsquo;s make the player. First, we want an abstraction for locations. I saw this in another blog series, although unfortunately I don&rsquo;t remember where at the moment. Basically, why make a struct for points when imaginary numbers work just fine? All you need is a few simple re-definitions (technically you can do without, but it makes it easier):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; game-screen.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; API to use imaginary numbers as points</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>pt make-rectangular)
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>pt-x real-part)
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>pt-y imag-part)
</span></span></code></pre></div><p>Why would we want to do this when a simple struct (<code>(define-struct pt (x y))</code>) would give us the same three methods for a single line? Well with the struct, you can do either of these:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>pt-x</span> (+ (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>0</span>)))
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>&gt; (<span style=color:#a6e22e>pt-x</span> (* <span style=color:#ae81ff>5</span> (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>0</span>)))
</span></span><span style=display:flex><span><span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p>I&rsquo;m sure that there are all sorts of useful things I&rsquo;ll be able to do with that. At the very least, it will make this method nice to write:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; game-screen.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Convert real coordinates to canvas coordinates</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>recenter</span> canvas orig)
</span></span><span style=display:flex><span>  (+ orig (<span style=color:#a6e22e>pt</span> (quotient (<span style=color:#a6e22e>send</span> canvas get-width-in-characters) <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>              (quotient (<span style=color:#a6e22e>send</span> canvas get-height-in-characters) <span style=color:#ae81ff>2</span>))))
</span></span></code></pre></div><p>Basically, this lets us recenter points so that (0, 0) is the center of the canvas rather than whatever the actual midpoint is. This should make things much easier if/when we get to scrolling maps!</p><p>So with that, what does it take to create the game screen? Not much at all!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; game-screen.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>game-screen%
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>class</span> screen%
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Store the player&#39;s state</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Use an imaginary number for a point</span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define </span>player (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Process keyboard events</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>define/override</span> (<span style=color:#a6e22e>update</span> key-event)
</span></span><span style=display:flex><span>      <span style=color:#75715e>; TODO: Handle keypresses</span>
</span></span><span style=display:flex><span>      this)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Draw the game itself.</span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>define/override</span> (<span style=color:#a6e22e>draw</span> canvas)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>send</span> canvas clear)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; Draw the player</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; 0x0 is the center point of the canvas</span>
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>let </span>([player (<span style=color:#a6e22e>recenter</span> canvas player)])
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>send</span> canvas write <span style=color:#e6db74>#\@</span> (<span style=color:#a6e22e>pt-x</span> player) (<span style=color:#a6e22e>pt-y</span> player))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>super-new</span>)))
</span></span></code></pre></div><p>And we also need to change the main menu screen so that it switches to the game screen when you press a key. All you have to do is replace the <code>update</code> method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; main-menu-screen.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Always turn control over the game screen</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>define/override</span> (<span style=color:#a6e22e>update</span> key-event)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>new</span> game-screen%))
</span></span></code></pre></div><p>And if we run it (and hit any key on the main menu), we now have a little <code>@</code>. Basically, it&rsquo;s the roguelike version of a hello world.</p><figure><img src=/embeds/2013/roguelike-hello-world.png></figure><p>Last but certainly not least, we want to be able to make the <code>@</code> move around. Luckily, we already have everything we need. I&rsquo;m going to go ahead and add support for the arrow keys, numpad, and WASD. This could just as easily be loaded from a configuration file, perhaps I&rsquo;ll do that in a later post.</p><p>In order to get this working, we need to replace the <code>update</code> method in <code>game-screen%</code> with something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; game-screen.rkt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Process keyboard events</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>define/override</span> (<span style=color:#a6e22e>update</span> key-event)
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Move the player</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; NOTE: Y axis is top down, X axis is left to right</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>case </span>(<span style=color:#a6e22e>send</span> key-event get-key-code)
</span></span><span style=display:flex><span>    [(<span style=color:#a6e22e>numpad8</span> <span style=color:#e6db74>#\w</span> up)    (<span style=color:#66d9ef>set! </span>player (+ (<span style=color:#a6e22e>pt</span>  <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>-1</span>) player))]
</span></span><span style=display:flex><span>    [(<span style=color:#a6e22e>numpad4</span> <span style=color:#e6db74>#\a</span> left)  (<span style=color:#66d9ef>set! </span>player (+ (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>-1</span>  <span style=color:#ae81ff>0</span>) player))]
</span></span><span style=display:flex><span>    [(<span style=color:#a6e22e>numpad6</span> <span style=color:#e6db74>#\s</span> down)  (<span style=color:#66d9ef>set! </span>player (+ (<span style=color:#a6e22e>pt</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>1</span>) player))]
</span></span><span style=display:flex><span>    [(<span style=color:#a6e22e>numpad2</span> <span style=color:#e6db74>#\d</span> right) (<span style=color:#66d9ef>set! </span>player (+ (<span style=color:#a6e22e>pt</span>  <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>0</span>) player))])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Keep the state</span>
</span></span><span style=display:flex><span>  this)
</span></span></code></pre></div><p>And it works great:</p><figure><img src=/embeds/2013/runaway.png></figure><p>Unfortunately, it breaks (rightfully so) if we walk off the screen with this lovely error message:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>write: contract violation
</span></span><span style=display:flex><span>  expected: y in the range [<span style=color:#ae81ff>0</span><span style=color:#f92672>,</span> <span style=color:#ae81ff>24</span>)
</span></span><span style=display:flex><span>  given: <span style=color:#ae81ff>-1</span>
</span></span></code></pre></div><p>Oops. We&rsquo;ll fix that in a later post when we also add in scrolling.</p><p>And that&rsquo;s everything for today. So far, we &lsquo;only&rsquo; have a trivial main menu and a moving <code>@</code>, but it turns out that&rsquo;s a fair chunk out of the way. It&rsquo;s actually only 164 lines of code (498 counting ascii-canvas.rkt) and that includes comments and whitespace. If you cut out those, it&rsquo;s only 109. I wonder how that compares to other languages?</p><p>Now that we&rsquo;re done, if you&rsquo;d like to see all of the code for this project, you can do so on GitHub:</p><ul><li><a href=https://github.com/jpverkamp/racket-roguelike/tree/day-1 title="Racket Roguelike on GitHub">Racket Roguelike - Day 1</a></li><li><a href=https://github.com/jpverkamp/racket-roguelike title="Racket Roguelike on GitHub">Racket Roguelike - Up to date</a></li></ul><p>If you&rsquo;d like to try it yourself, you&rsquo;ll need to have both <a href=http://git-scm.com/>Git</a> and <a href=http://racket-lang.org/>Racket</a> and run the following series of commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git://github.com/jpverkamp/racket-roguelike.git
</span></span><span style=display:flex><span>cd racket-roguelike
</span></span><span style=display:flex><span>git checkout day-1
</span></span><span style=display:flex><span>git submodule init
</span></span><span style=display:flex><span>git submodule update
</span></span><span style=display:flex><span>racket main.rkt
</span></span></code></pre></div><p><strong>Edit:</strong></p><p>It seems that the submodules wondered off at some point. Instead, you can install the three libraries this uses directly using <code><a href="http://docs.racket-lang.org/search/index.html?q=pkg">pkg</a></code>
, and then run the code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>raco pkg install github://github.com:jpverkamp/ascii-canvas/master
</span></span><span style=display:flex><span>raco pkg install github://github.com:jpverkamp/noise/master
</span></span><span style=display:flex><span>raco pkg install github://github.com:jpverkamp/thing/master
</span></span><span style=display:flex><span>git clone git://github.com/jpverkamp/racket-roguelike.git
</span></span><span style=display:flex><span>cd racket-roguelike
</span></span><span style=display:flex><span>git checkout day-1
</span></span><span style=display:flex><span>racket main.rkt
</span></span></code></pre></div><p>If you want the most up to date code instead of just today&rsquo;s, just remove the third line. Eventually I&rsquo;ll include pre-compiled binaries, but they just wouldn&rsquo;t be that interesting as of yet.</p><p>For part 2, click here: <a href=https://blog.jverkamp.com/2013/04/11/racket-roguelike-2-infinite-caves/>Racket Roguelike 2: Infinite caves!</a></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>