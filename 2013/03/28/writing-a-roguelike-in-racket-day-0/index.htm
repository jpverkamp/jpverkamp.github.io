<!DOCTYPE html>
<html>
<head>
        
        

        <title>Writing a roguelike -- in Racket! (Day 0) | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js"></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/tomorrow-night.css" />
        <script src="/highlight/highlight.pack.js"></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" />
        <script src="/custom.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://blog.jverkamp.com"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="http://blog.jverkamp.com/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/archives/2004">2004</a></li><li><a href="http://blog.jverkamp.com/category/archives/2005">2005</a></li><li><a href="http://blog.jverkamp.com/category/archives/2006">2006</a></li><li><a href="http://blog.jverkamp.com/category/archives/2007">2007</a></li><li><a href="http://blog.jverkamp.com/category/archives/2008">2008</a></li><li><a href="http://blog.jverkamp.com/category/archives/2009">2009</a></li><li><a href="http://blog.jverkamp.com/category/archives/2010">2010</a></li><li><a href="http://blog.jverkamp.com/category/archives/2011">2011</a></li><li><a href="http://blog.jverkamp.com/category/archives/2012">2012</a></li><li><a href="http://blog.jverkamp.com/category/archives/2013">2013</a></li><li><a href="http://blog.jverkamp.com/category/archives/2014">2014</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="http://blog.jverkamp.com/category/other/cooking">Cooking</a></li><li><a href="http://blog.jverkamp.com/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/photography/dp-challenge">DP Challenge</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosets">Photosets</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/programming/by-language">By Language</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-project">By Project</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-source">By Source</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/research/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/writing/by-genre">By Genre</a></li><li><a href="http://blog.jverkamp.com/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="http://blog.jverkamp.com/category/writing/novels">Novels</a></li><li><a href="http://blog.jverkamp.com/category/writing/other">Other</a></li><li><a href="http://blog.jverkamp.com/category/writing/short-stories">Short Stories</a></li></ul></li></ul>

      <!--
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
      </form>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Writing a roguelike -- in Racket! (Day 0)</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2013-03-28"><span class="year">2013</span> <span class="month">Mar</span> <span class="day">28</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="http://blog.jverkamp.com/category/programming/by-source/7drl">7DRL</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/games">Games</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/games/roguelikes">Roguelikes</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/racket">Racket</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-project/games/racket-roguelike">Racket Roguelike</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <p>Back when I finished <a href="http://blog.jverkamp.com/2013/03/17/the-house-on-the-hill-postmortem">my 7DRL</a>, I said that I was going to try to write a full tutorial series on writing a Roguelike in Racket, modeled somewhat on Trystan's excellent series in Java: <a title="roguelike tutorial 01: Java, Eclipse, AsciiPanel, application, applet" href="http://trystans.blogspot.com/2011/08/roguelike-tutorial-01-java-eclipse.html">roguelike tutorial 01: Java, Eclipse, AsciiPanel, application, applet</a>.</p>
<!--more-->
<p>Well, it's about that time. Technically, I'll be starting next week. But to get that far, I wanted to make the ascii-canvas that I was working on finished and really solid so that I could actually have nice pictures throughout and not worry about working on both the framework and the tutorial at the same time.</p>
<p>So to that end, I present <a title="ascii canvas source on GitHub" href="https://github.com/jpverkamp/ascii-canvas">ascii-canvas</a>:</p>
<p><a data-toggle="lightbox" href="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/random-tiles.png"><img src="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/random-tiles.png" /></a></p>
<p>Basically, I gave up for the moment on using fonts directly and fell back to a more traditional sprite sheet as a code page. This will also allow for a sort of tile graphics, albeit with a hard limit (at the moment) at 256 characters ((I haven't actually tried a larger image...)). Here's the image that I'm using for testing:</p>
<p><a data-toggle="lightbox" href="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/cp437_16x16.png"><img src="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/cp437_16x16.png" /></a></p>
<p>Anything in white will be drawing in the foreground color, anything in magenta will use the background color. My goal is to support grayscale images eventually with appropriate tinting, but that's not currently supported.</p>
<p>The API is actually identical <a href="http://blog.jverkamp.com/2013/02/01/1gam-chesslike-1-0-did-it">ChessLike</a>, so I'm already familiar with it. Plus, it's really straight forward to write. All you have to deal with is clear, write for single characters, write-string for strings, and write-center for centered strings. There's no automatic line feeds like some libraries have, but that would be entirely possible to add in the future.</p>
<p>To show off a bit of what it can do, here are a few examples:</p>
<p>First, we just write out all of the currently possible characters:</p>
<pre class="scheme"><code>(for* ([xi (in-range 16)]
       [yi (in-range 16)])
  (define c (integer-&gt;char (+ xi (* yi 16))))
  (send test-ac write c xi yi))</code></pre>
<p><a data-toggle="lightbox" href="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/all-chars.png"><img src="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/all-chars.png" /></a></p>
<hr />
<p>Next, let's color them. You can add either just the foreground or the foreground and background colors. Any color can be specified either as a color string (see the <code><a href="http://docs.racket-lang.org/search/index.html?q=color database">color database</a></code> for a full list) or using <code>make-color</code> with <code>RGB</code>. Here's a nice gradient example:</p>
<pre class="scheme"><code>(for* ([xi (in-range 16)]
       [yi (in-range 16)])
  (define c (integer-&gt;char (+ xi (* yi 16))))
  (send test-ac write c xi yi (make-color (* xi 16) (* yi 16) 0)))</code></pre>
<p><a data-toggle="lightbox" href="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/all-chars-colored.png"><img src="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/all-chars-colored.png" /></a></p>
<hr />
<p>After that, we can play a moment with simple centered strings (with foreground and/or background colors):</p>
<pre class="scheme"><code>(send test-ac write-center "this is a test" 10)
(send test-ac write-center "this is a test in blue" 11 "blue")
(send test-ac write-center "this is a test in blue on yellow" 12 "blue" "yellow")</code></pre>
<p><a data-toggle="lightbox" href="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/first-test.png"><img src="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/first-test.png" /></a></p>
<hr />
<p>And finally, we have some nice screen corruption with randomly placed and colored characters appearing around the screen:</p>
<pre class="scheme"><code>(thread
 (lambda ()
   (let loop ()
     (send test-ac write
           (integer-&gt;char (random 256))
           (random 40) (random 20)
           (make-color (random 256) (random 256) (random 256))
           (make-color (random 256) (random 256) (random 256)))
     (sleep 0.1)
     (loop))))

(thread
 (lambda ()
   (let loop ()
     (send test-frame refresh)
     (sleep 0.5)
     (loop))))</code></pre>
<p><a data-toggle="lightbox" href="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/random-tiles.png"><img src="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/random-tiles.png" /></a></p>
<hr />
<p>Or you could just run them all at once:</p>
<p><a data-toggle="lightbox" href="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/all-tests-later.png"><img src="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/all-tests-later.png" /></a></p>
<hr />
<p>I think the most impressive example was taking the code and converting <a href="https://github.com/jpverkamp/house-on-the-hill" title="House on the Hill source on GitHub">House on the Hill</a> to use it (click the image to embiggen):</p>
<p><a data-toggle="lightbox" href="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/hoth-new-canvas.png"><img src="http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/hoth-new-canvas.png" /></a></p>
<p>It took about 20 minutes to convert everything (and I got to learn about Git submodules in the process!), most of which consisted of flipping the arguments to the draw/write functions so the character/string was first. Here's a diff if you're curious: <a href="https://github.com/jpverkamp/house-on-the-hill/commit/2f6f71479963fbc3714ebe2f093dadcd742b6ae0" title="Diff when converting House on the Hill to the new ascii-canvas">commit 2f6f7147</a>. And dang does it look nicer. You can actually sort of see what's going on, as opposed to some of the old images when half the characters were larger than the tiles.</p>
<p>If you decide to download the <a href="https://github.com/jpverkamp/house-on-the-hill" title="House on the Hill source on GitHub">House on the Hill source</a>, make sure you run <code>git submodule update</code>. For whatever reason, Git doesn't pull down submodules by default (which will do a pretty good job of breaking things).</p>
<p>That's all I have today, but now that's out of the way--full speed ahead!</p>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Writing a roguelike -- in Racket! (Day 0)";
var disqus_url = "http://blog.jverkamp.com/2013/03/28/writing-a-roguelike-in-racket-day-0/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2013/03/28/path-to-philosophy">← Path to philosophy</a></li><li><a href="http://blog.jverkamp.com/category/archives">Archives</a></li><li><a href="http://blog.jverkamp.com/2013/04/01/spring-nanowrimo-so-close">Spring NaNoWriMo – So close... →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2013/03/28/path-to-philosophy">← Path to philosophy</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/2013/04/04/racket-roguelike-1-a-gui-screens-io-and-you">Racket Roguelike 1: A GUI, screens, I/O, and you! →</a></li></ul></nav>

                <div class="legal">
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="http://directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>
</body>
</html>