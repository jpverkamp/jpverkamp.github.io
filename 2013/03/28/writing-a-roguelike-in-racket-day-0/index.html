<!doctype html><html><head><title>Writing a roguelike - in Racket! (Day 0) – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Writing a roguelike - in Racket! (Day 0)</h1><div class=entry-meta><span class=entry-date>2013-03-28</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/03/28/path-to-philosophy/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2013/04/04/racket-roguelike-1-a-gui-screens-i/o-and-you/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/02/01/%231gam-chesslike-1.0-did-it/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/7drl>7DRL</a><a href=https://blog.jverkamp.com/2013/04/04/racket-roguelike-1-a-gui-screens-i/o-and-you/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/03/17/the-house-on-the-hill-postmortem/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/games>Games</a><a href=https://blog.jverkamp.com/2013/04/04/racket-roguelike-1-a-gui-screens-i/o-and-you/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2013/03/17/the-house-on-the-hill-postmortem/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/roguelikes>Roguelikes</a><a href=https://blog.jverkamp.com/2013/04/04/racket-roguelike-1-a-gui-screens-i/o-and-you/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2013/03/28/path-to-philosophy/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2013/04/04/racket-roguelike-1-a-gui-screens-i/o-and-you/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2013/03/28/path-to-philosophy/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2013/04/01/spring-nanowrimo-so-close.../ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Back when I finished <a href=https://blog.jverkamp.com/2013/03/17/the-house-on-the-hill-postmortem/>my 7DRL</a>, I said that I was going to try to write a full tutorial series on writing a Roguelike in Racket, modeled somewhat on Trystan&rsquo;s excellent series in Java: <a title="roguelike tutorial 01: Java, Eclipse, AsciiPanel, application, applet" href=http://trystans.blogspot.com/2011/08/roguelike-tutorial-01-java-eclipse.html>roguelike tutorial 01: Java, Eclipse, AsciiPanel, application, applet</a>.</p><p>Well, it&rsquo;s about that time. Technically, I&rsquo;ll be starting next week. But to get that far, I wanted to make the ascii-canvas that I was working on finished and really solid so that I could actually have nice pictures throughout and not worry about working on both the framework and the tutorial at the same time.</p><p>So to that end, I present <a title="ascii canvas source on GitHub" href=https://github.com/jpverkamp/ascii-canvas>ascii-canvas</a>:</p><figure><img src=/embeds/2013/random-tiles.png></figure><p>Basically, I gave up for the moment on using fonts directly and fell back to a more traditional sprite sheet as a code page. This will also allow for a sort of tile graphics, albeit with a hard limit (at the moment) at 256 characters ((I haven&rsquo;t actually tried a larger image&mldr;)). Here&rsquo;s the image that I&rsquo;m using for testing:</p><figure><img src=/embeds/2013/cp437_16x16.png></figure><p>Anything in white will be drawing in the foreground color, anything in magenta will use the background color. My goal is to support grayscale images eventually with appropriate tinting, but that&rsquo;s not currently supported.</p><p>The API is actually identical <a href=https://blog.jverkamp.com/2013/02/01/%231gam-chesslike-1.0-did-it/>ChessLike</a>, so I&rsquo;m already familiar with it. Plus, it&rsquo;s really straight forward to write. All you have to deal with is clear, write for single characters, write-string for strings, and write-center for centered strings. There&rsquo;s no automatic line feeds like some libraries have, but that would be entirely possible to add in the future.</p><p>To show off a bit of what it can do, here are a few examples:</p><p>First, we just write out all of the currently possible characters:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>for*</span> ([xi (<span style=color:#a6e22e>in-range</span> <span style=color:#ae81ff>16</span>)]
</span></span><span style=display:flex><span>       [yi (<span style=color:#a6e22e>in-range</span> <span style=color:#ae81ff>16</span>)])
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>c (integer-&gt;char (+ xi (* yi <span style=color:#ae81ff>16</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>send</span> test-ac write c xi yi))
</span></span></code></pre></div><figure><img src=/embeds/2013/all-chars.png></figure><hr><p>Next, let&rsquo;s color them. You can add either just the foreground or the foreground and background colors. Any color can be specified either as a color string (see the <code><a href="http://docs.racket-lang.org/search/index.html?q=color%20database">color database</a></code>
for a full list) or using <code>make-color</code> with <code>RGB</code>. Here&rsquo;s a nice gradient example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>for*</span> ([xi (<span style=color:#a6e22e>in-range</span> <span style=color:#ae81ff>16</span>)]
</span></span><span style=display:flex><span>       [yi (<span style=color:#a6e22e>in-range</span> <span style=color:#ae81ff>16</span>)])
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>c (integer-&gt;char (+ xi (* yi <span style=color:#ae81ff>16</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>send</span> test-ac write c xi yi (<span style=color:#a6e22e>make-color</span> (* xi <span style=color:#ae81ff>16</span>) (* yi <span style=color:#ae81ff>16</span>) <span style=color:#ae81ff>0</span>)))
</span></span></code></pre></div><figure><img src=/embeds/2013/all-chars-colored.png></figure><hr><p>After that, we can play a moment with simple centered strings (with foreground and/or background colors):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>send</span> test-ac write-center <span style=color:#e6db74>&#34;this is a test&#34;</span> <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>send</span> test-ac write-center <span style=color:#e6db74>&#34;this is a test in blue&#34;</span> <span style=color:#ae81ff>11</span> <span style=color:#e6db74>&#34;blue&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>send</span> test-ac write-center <span style=color:#e6db74>&#34;this is a test in blue on yellow&#34;</span> <span style=color:#ae81ff>12</span> <span style=color:#e6db74>&#34;blue&#34;</span> <span style=color:#e6db74>&#34;yellow&#34;</span>)
</span></span></code></pre></div><figure><img src=/embeds/2013/first-test.png></figure><hr><p>And finally, we have some nice screen corruption with randomly placed and colored characters appearing around the screen:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>thread</span>
</span></span><span style=display:flex><span> (<span style=color:#66d9ef>lambda </span>()
</span></span><span style=display:flex><span>   (<span style=color:#66d9ef>let </span>loop ()
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>send</span> test-ac write 
</span></span><span style=display:flex><span>           (integer-&gt;char (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>256</span>)) 
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>40</span>) (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>20</span>) 
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>make-color</span> (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>256</span>) (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>256</span>) (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>256</span>))
</span></span><span style=display:flex><span>           (<span style=color:#a6e22e>make-color</span> (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>256</span>) (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>256</span>) (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>256</span>)))
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>sleep</span> <span style=color:#ae81ff>0.1</span>)
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>loop</span>))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>thread</span>
</span></span><span style=display:flex><span> (<span style=color:#66d9ef>lambda </span>()
</span></span><span style=display:flex><span>   (<span style=color:#66d9ef>let </span>loop ()
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>send</span> test-frame refresh)
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>sleep</span> <span style=color:#ae81ff>0.5</span>)
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>loop</span>))))
</span></span></code></pre></div><figure><img src=/embeds/2013/random-tiles.png></figure><hr><p>Or you could just run them all at once:</p><figure><img src=/embeds/2013/all-tests-later.png></figure><hr><p>I think the most impressive example was taking the code and converting <a href=https://github.com/jpverkamp/house-on-the-hill title="House on the Hill source on GitHub">House on the Hill</a> to use it (click the image to embiggen):</p><figure><img src=/embeds/2013/hoth-new-canvas.png></figure><p>It took about 20 minutes to convert everything (and I got to learn about Git submodules in the process!), most of which consisted of flipping the arguments to the draw/write functions so the character/string was first. Here&rsquo;s a diff if you&rsquo;re curious: <a href=https://github.com/jpverkamp/house-on-the-hill/commit/2f6f71479963fbc3714ebe2f093dadcd742b6ae0 title="Diff when converting House on the Hill to the new ascii-canvas">commit 2f6f7147</a>. And dang does it look nicer. You can actually sort of see what&rsquo;s going on, as opposed to some of the old images when half the characters were larger than the tiles.</p><p>If you decide to download the <a href=https://github.com/jpverkamp/house-on-the-hill title="House on the Hill source on GitHub">House on the Hill source</a>, make sure you run <code>git submodule update</code>. For whatever reason, Git doesn&rsquo;t pull down submodules by default (which will do a pretty good job of breaking things).</p><p>That&rsquo;s all I have today, but now that&rsquo;s out of the way&ndash;full speed ahead!</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>