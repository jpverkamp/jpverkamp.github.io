<!DOCTYPE html>
<html>
<head>
        
        

        <title>Functions as lists | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js"></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/tomorrow-night.css" />
        <script src="/highlight/highlight.pack.js"></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" />
        <script src="/custom.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://blog.jverkamp.com"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="http://blog.jverkamp.com/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/archives/2004">2004</a></li><li><a href="http://blog.jverkamp.com/category/archives/2005">2005</a></li><li><a href="http://blog.jverkamp.com/category/archives/2006">2006</a></li><li><a href="http://blog.jverkamp.com/category/archives/2007">2007</a></li><li><a href="http://blog.jverkamp.com/category/archives/2008">2008</a></li><li><a href="http://blog.jverkamp.com/category/archives/2009">2009</a></li><li><a href="http://blog.jverkamp.com/category/archives/2010">2010</a></li><li><a href="http://blog.jverkamp.com/category/archives/2011">2011</a></li><li><a href="http://blog.jverkamp.com/category/archives/2012">2012</a></li><li><a href="http://blog.jverkamp.com/category/archives/2013">2013</a></li><li><a href="http://blog.jverkamp.com/category/archives/2014">2014</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="http://blog.jverkamp.com/category/other/cooking">Cooking</a></li><li><a href="http://blog.jverkamp.com/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/photography/dp-challenge">DP Challenge</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosets">Photosets</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/programming/by-language">By Language</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-project">By Project</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-source">By Source</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/research/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/writing/by-genre">By Genre</a></li><li><a href="http://blog.jverkamp.com/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="http://blog.jverkamp.com/category/writing/novels">Novels</a></li><li><a href="http://blog.jverkamp.com/category/writing/other">Other</a></li><li><a href="http://blog.jverkamp.com/category/writing/short-stories">Short Stories</a></li></ul></li></ul>

      <form action="http://www.google.com/search" method="get" onSubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input name="q" type="hidden" />
          <input name="qfront" type="text" class="form-control" placeholder="Search" />
          <button type="submit" class="btn btn-default" value="Search">Search</button>
        </p>
      </form>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Functions as lists</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2013-10-09"><span class="year">2013</span> <span class="month">Oct</span> <span class="day">9</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="http://blog.jverkamp.com/category/programming/by-topic/data-structures/lists">Lists</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/data-structures">Data Structures</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/programming-languages">Programming Languages</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/lambda-calculus">Lambda Calculus</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/functional-programming">Functional Programming</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/scheme">Scheme</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/racket">Racket</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <p><a href="http://programmingpraxis.com/2013/10/08/functional-style-linked-lists/">Yesterday's challenge</a> from Programming Praxis challenges us to rebuild a data structure near and dear to any Lisper's/Schemer's/Racketer's<span class="footnote"><sup><a href="#footnote-1">[1]</a></sup></span>/functional programmer's heart: lists. The idea presented in <a href="http://programmingpraxis.com/2013/10/08/functional-style-linked-lists/2/">their sample solution</a> uses two element vectors, directly mimicking the general internal structure of Scheme's lists. How about we do something a bit stranger? :)</p>
<!--more-->
<p>If you'd like to follow along with the code, I've pushed it as a GitHub Gist here: <a href="https://gist.github.com/jpverkamp/6896457">jpverkamp/6896457</a>.</p>
<p>The idea is one that was first presented to me in a second year undergraduate programming languages course and really shows the strengths of <a href="https://en.wikipedia.org/wiki/lambda_calculus">lambda calculus</a><span class="footnote"><sup><a href="#footnote-2">[2]</a></sup></span>. You don't need vectors to build lists--all you need are functions.</p>
<p>To get started, the basic functions that we want are equivalents to <code>car</code>/<code>first</code>, <code>cdr</code>/<code>rest</code>, and <code>cons</code>/<code>pair</code>. If we can build those, the rest will follow. The main obstacle is reversing how we think of lists. Rather than <code>cons</code> building lists and <code>car</code> and <code>cdr</code> taking them apart, <code>cons</code> will create a function which knows how to do either. All <code>car</code> and <code>cdr</code> have to do is tell it which to do. That may sound like black magic, but lets take a look:</p>
<pre class="scheme"><code>; Build and take apart lists
&gt;(define pair (λ (a d) (λ (l) (l a d))))
(define first (λ (l) (l (λ (a d) a))))
(define rest (λ (l) (l (λ (a d) d))))</code></pre>
<p>So when we have a list, it's actually a function (<code>l</code>) expecting another function in turn (of the form <code>(λ (a d) ...)</code>. Let's try it out:</p>
<pre class="scheme"><code>&gt; (pair 'a 'b)
#&lt;procedure&gt;
&gt; (first (pair 1 2))
1
&gt; (rest (pair 3 4))
4
&gt; (first (rest (pair 5 (pair 6 7))))
6</code></pre>
<p>This works just like you would expect it to. Let's do something I generally don't and hand trace that last example. With this many functions flying about, things can get a bit complicated((Not that the trace is terribly better...)):</p>
<pre class="scheme"><code>(first (rest (pair 5 (pair 6 7))))
(first (rest (pair 5 ((λ (a d) (λ (l) (l a d))) 6 7))))
(first (rest (pair 5 (λ (l) (l 6 7)))))
(first (rest ((λ (a d) (λ (l) (l a d))) 5 (λ (l) (l 6 7)))))
(first (rest (λ (l) (l 5 (λ (l) (l 6 7))))))
(first ((λ (l) (l (λ (a d) d))) (λ (l) (l 5 (λ (l) (l 6 7))))))
(first ((λ (l) (l 5 (λ (l) (l 6 7)))) (λ (a d) d)))
(first ((λ (a d) d) 5 (λ (l) (l 6 7))))
(first (λ (l) (l 6 7)))
((λ (l) (l (λ (a d) a))) (λ (l) (l 6 7)))
((λ (l) (l 6 7)) (λ (a d) a))
((λ (a d) a) 6 7)
6</code></pre>
<p>So it seems to work as planned. What's next?</p>
<p>Well, we want to be able to represent empty lists. One way we could do it is just using some random value as the 'empty list':</p>
<pre class="scheme"><code>; Empty list
(define empty   (gensym))
(define empty?  (λ (l)   (eq? l empty)))</code></pre>
<p>This works well enough, but one problem we get is that the empty list (in this case) doesn't look the same as a list. In one case, it's a symbol; in the other, it's a function:</p>
<pre class="scheme"><code>&gt; empty
'g30678
&gt; (pair 1 2)
#&lt;procedure&gt;</code></pre>
<p>But that's okay. We can actually still do this. All we have to do is add a third value to the list functions. In addition to the first and rest values, we'll insert a flag telling us if the list is empty. Instead of <code>(λ (a d) ...)</code>, we'll have <code>(λ (a d e) ...)</code>. Something like this:</p>
<pre class="scheme"><code>; Empty list
(define empty   (λ (l)   (l 'error 'error #t)))
(define empty?  (λ (l)   (l (λ (a d e) e))))

; Build and take apart lists
(define pair    (λ (a d) (λ (l) (l a d #f))))
(define first   (λ (l)   (l (λ (a d e) a))))
(define rest    (λ (l)   (l (λ (a d e) d))))</code></pre>
<p>We could actually raise an error, but at the moment, simply returning the symbol <code>error</code> will suffice. Now we can build 'real' lists rather than just pairs:</p>
<pre class="scheme"><code>&gt; empty
#&lt;procedure:empty&gt;
&gt; (empty? empty)
#t
&gt; (first empty)
'error
&gt; (pair 1 (pair 2 (pair 3 empty)))
#&lt;procedure&gt;
&gt; (first (rest (pair 1 (pair 2 (pair 3 empty)))))
2</code></pre>
<p>And that's actually all we need. Technically, the project wants us to to add functions equivalent to Scheme's <code>list-ref</code>, <code>length</code>, <code>reverse</code>, and <code>append</code>. With the four functions we have though, these definitions aren't any different than they would be writing them by hand in Scheme:</p>
<pre class="scheme"><code>; Get the nth item of a list
(define nth
  (λ (l i)
    (if (zero? i)
        (first l)
        (nth (rest l) (- i 1)))))

; Calculate the length of a list
(define length
  (λ (l)
    (if (empty? l)
        0
        (+ 1 (length (rest l))))))

; Reverse a list
(define reverse
  (λ (l)
    (let loop ([l l] [acc empty])
      (if (empty? l)
          acc
          (loop (rest l)
                (pair (first l) acc))))))

; Append two lists
(define append
  (λ (l r)
    (if (empty? l)
        r
        (pair (first l) (append (rest l) r)))))</code></pre>
<p>You can do a few tests to make sure that everything works as you would expect, but it's not particularly pleasant given that the structures we're building are rather opaque. So instead, we'll create functions to convert between traditional lists and these functional lists:</p>
<pre class="scheme"><code>; Helpers to convert with traditional lists
(define list-&gt;flist
  (λ (l)
    (foldl pair empty l)))

(define flist-&gt;list
  (λ (l)
    (if (empty? l)
        '()
        (cons (first l) (flist-&gt;list (rest l))))))</code></pre>
<p>Now we can tests a few things:</p>
<pre class="scheme"><code>&gt; (flist-&gt;list
   (append
    (pair 1 (pair 2 empty))
    (pair 3 (pair 4 (pair 5 empty)))))
'(1 2 3 4 5)
&gt; (flist-&gt;list
   (reverse
    (pair 6 (pair 7 (pair 8 empty)))))
'(8 7 6)
&gt; (length
   (pair 9 (pair 10 (pair 11 (pair 12 empty)))))
4
&gt; (nth
   (pair 13 (pair 14 (pair 15 (pair 16 empty))))
   2)
15</code></pre>
<p>Seems to be working well enough. In practice, you'd likely want to test somewhat more thoroughly, but that's good enough for the time being.</p>
<p>What I really love about this is just how much you can build with just functions. Technically, we don't even need <code>#f</code> or numbers in the examples above. Either can be built with just functions in much the same reason. As a bit of a mental exercise, try to implement <code>if</code>, <code>true</code>, and <code>false</code> using only functions<span class="footnote"><sup><a href="#footnote-3">[3]</a></sup></span></p>
<p>If you'd like to see the entire code at once, you can see it here: <a href="https://gist.github.com/jpverkamp/6896457">jpverkamp/6896457</a>.</p>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol><li><a name="footnote-1"></a>Is there a better term?</li><li><a name="footnote-2"></a>I've never understood why most people refer to it as <em>the </em>lambda calculus. Especially when there are so many variations...</li><li><a name="footnote-3"></a>Hint: There are only so many ways to arrange functions. :)</li></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Functions as lists";
var disqus_url = "http://blog.jverkamp.com/2013/10/09/functions-as-lists/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2013/09/27/large-scale-asynchronous-dns-scans">← Large scale asynchronous DNS scans</a></li><li><a href="http://blog.jverkamp.com/category/archives">Archives</a></li><li><a href="http://blog.jverkamp.com/2013/10/12/don-jon">Don Jon →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2013/09/27/large-scale-asynchronous-dns-scans">← Large scale asynchronous DNS scans</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/2013/10/29/making-music-part-1-reading-abc-notation">Making music, part 1: Reading ABC notation →</a></li></ul></nav>

                <div class="legal">
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="http://directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53688146-1', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>