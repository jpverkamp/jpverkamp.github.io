<!doctype html><html><head><title>Gregorian/Mayan conversion â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.982c2d7bb434b4cf8b19c2cf38ef7e7f7162ddbed610e5bdddbb937001e26574.js integrity="sha256-mCwte7Q0tM+LGcLPOO9+f3Fi3b7WEOW93buTcAHiZXQ=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.1a5fbab1ecff843d4ee6e936243fb06066197cd8c9357883d791333ce6001f3b.css integrity="sha256-Gl+6sez/hD1O5uk2JD+wYGYZfNjJNXiD15EzPOYAHzs="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>Gregorian/Mayan conversion</h1><div class=entry-meta><span class=entry-date>2013-01-25</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/01/24/splay-heaps-redux-imperative-model/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2013/01/24/splay-heaps-redux-imperative-model/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/sources/daily-programmer>Daily Programmer</a><a href=https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2013/01/24/splay-heaps-redux-imperative-model/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2013/01/24/splay-heaps-redux-imperative-model/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>It may be 1 uinal, 15 kin too late for the new baktun, but I&rsquo;ve got some neat code to convert back and forth between the <a href=https://en.wikipedia.org/wiki/Gregorian%20calendar>Gregorian calendar</a> and the <a href=https://en.wikipedia.org/wiki/Mayan%20calendar>Mayan calendar</a>. It&rsquo;s based on a challenge on a post on the <a title="Daily Programmer Challenge #117 [Intermediate] Mayan Long Count" href=http://www.reddit.com/r/dailyprogrammer/comments/16obmx/011613_challenge_117_intermediate_mayan_long_count/>/r/dailyprogrammer subreddit</a>. As one might expect, the goal is to be able to take a year, month, and day in the Gregorian calendar and return the equivalent Mayan Long Count corresponding to that date. As a bonus (which of course I had to do ðŸ˜„), do the opposite and do it without using built in date functions.</p><p>To start out, we want a structure for each (if you&rsquo;d like, you can follow along <a href=https://github.com/jpverkamp/small-projects/blob/master/blog/mayan-conversion.rkt title="Mayan conversion on GitHub">here</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; date structures</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>define-struct</span> gregorian (<span style=color:#a6e22e>year</span> month day) <span style=color:#f92672>#</span>:transparent)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>define-struct</span> mayan (<span style=color:#a6e22e>baktun</span> katun tun uinal kin) <span style=color:#f92672>#</span>:transparent)
</span></span></code></pre></div><p>Then, we&rsquo;ll need a few helpers. Particularly, we want a function that can calculate leap years and a list of days per month (ignoring any 29 day February for the time being).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; test if a year is a leap year</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>leap-year?</span> year)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>or </span>(<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>divisible?</span> year <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>           (not (<span style=color:#a6e22e>divisible?</span> year <span style=color:#ae81ff>100</span>)))
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>divisible?</span> year <span style=color:#ae81ff>400</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; days per month</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>days/month <span style=color:#f92672>&#39;#</span>(<span style=color:#ae81ff>31</span> <span style=color:#ae81ff>28</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>31</span>))
</span></span></code></pre></div><p>Now we&rsquo;re ready to go. Eventually, we want to write the functions <code>gregorian->mayan</code> and <code>mayan->gregorian</code>, but it would be a bit of a pain to convert directly. So instead, we&rsquo;ll convert via the number of days since 1 January 1970. That will give us the functions <code>gregorian->days</code>, <code>days->gregorian</code>, <code>mayan->days</code>, and <code>days->mayan</code>. The <code>gregorian</code> functions are a bit more complicated, so we&rsquo;ll start with those.</p><p>First, <code>gregorian->days</code>. It&rsquo;s a bit sneaky, but it&rsquo;s a closed form solution. Basically, we need to know if we&rsquo;re before or after 0-day and if we&rsquo;re before or after February (for the leap years). After that, it&rsquo;s mostly a matter of mathy goodness.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; convert from gregorian to days since 1 jan 1970</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>gregorian-&gt;days</span> date)
</span></span><span style=display:flex><span>  <span style=color:#75715e>; a date after 1 jan 1970?</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>go-&gt; (&gt;= (<span style=color:#a6e22e>gregorian-year</span> date) <span style=color:#ae81ff>1970</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; are we after February?</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>feb+ (&gt; (<span style=color:#a6e22e>gregorian-month</span> date) <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; range for leap years to test</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>leap-range
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>list</span>
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>if </span>go-&gt; <span style=color:#ae81ff>1970</span> (+ (<span style=color:#a6e22e>gregorian-year</span> date) (<span style=color:#66d9ef>if </span>feb+ <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>if </span>go-&gt; (+ (<span style=color:#a6e22e>gregorian-year</span> date) (<span style=color:#66d9ef>if </span>feb+ <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>)) <span style=color:#ae81ff>1971</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (+ <span style=color:#75715e>; add year</span>
</span></span><span style=display:flex><span>     (* <span style=color:#ae81ff>365</span> (- (<span style=color:#a6e22e>gregorian-year</span> date) (<span style=color:#66d9ef>if </span>go-&gt; <span style=color:#ae81ff>1970</span> <span style=color:#ae81ff>1969</span>)))
</span></span><span style=display:flex><span>     <span style=color:#75715e>; add month</span>
</span></span><span style=display:flex><span>     (* (<span style=color:#66d9ef>if </span>go-&gt; <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>-1</span>) 
</span></span><span style=display:flex><span>        (apply + ((<span style=color:#66d9ef>if </span>go-&gt; take drop) days/month (- (<span style=color:#a6e22e>gregorian-month</span> date) <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>     <span style=color:#75715e>; add day</span>
</span></span><span style=display:flex><span>     (- (<span style=color:#a6e22e>gregorian-day</span> date) <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>     <span style=color:#75715e>; deal with leap years</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>for/sum</span> ([year (apply in-range leap-range)])
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leap-year?</span> year) (<span style=color:#66d9ef>if </span>go-&gt; <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>-1</span>) <span style=color:#ae81ff>0</span>))))
</span></span></code></pre></div><p>The <code>for/sum</code> is the most potentially problematic point I think. I feel like there should be a non-looped solution to that, but this worked well enough (and it took long enough to get some of the other details working). In yet another tiny error that nevertheless took forever to track down, I originally had the second <code>(if feb+ ...)</code> the same as the first. Needless to say, that sent a few things sideways.</p><p>Next, we want to be able to invert that function. I couldn&rsquo;t work out a clean closed form for this one, so I just loop, first setting the year, then the month, then the day. It&rsquo;s a bit longer and I couldn&rsquo;t combine the forwards and backwards code, but it works well enough.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; convert from days since 1 jan 1970 to gregorian date</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>days-&gt;gregorian</span> days)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; work forward from 1 jan 1970</span>
</span></span><span style=display:flex><span>    [(&gt; days <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>let </span>loop ([days days] [year <span style=color:#ae81ff>1970</span>] [month <span style=color:#ae81ff>1</span>] [day <span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>define </span>d/y (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leap-year?</span> year) <span style=color:#ae81ff>366</span> <span style=color:#ae81ff>365</span>))
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>define </span>d/m (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>leap-year?</span> year) (= month <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>                       <span style=color:#ae81ff>29</span>
</span></span><span style=display:flex><span>                       (list-ref days/month (- month <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>       (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>         [(&gt;= days d/y)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>loop</span> (- days d/y) (+ year <span style=color:#ae81ff>1</span>) month day)]
</span></span><span style=display:flex><span>         [(&gt;= days d/m)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>loop</span> (- days d/m) year (+ month <span style=color:#ae81ff>1</span>) day)]
</span></span><span style=display:flex><span>         [else
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-gregorian</span> year month (+ day days))]))]
</span></span><span style=display:flex><span>    <span style=color:#75715e>; work backwards from 1 jan 1970</span>
</span></span><span style=display:flex><span>    [(&lt; days <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>let </span>loop ([days (- (abs days) <span style=color:#ae81ff>1</span>)] [year <span style=color:#ae81ff>1969</span>] [month <span style=color:#ae81ff>12</span>] [day <span style=color:#ae81ff>31</span>])
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>define </span>d/y (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>leap-year?</span> year) <span style=color:#ae81ff>366</span> <span style=color:#ae81ff>365</span>))
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>define </span>d/m (<span style=color:#66d9ef>if </span>(<span style=color:#66d9ef>and </span>(<span style=color:#a6e22e>leap-year?</span> year) (= month <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>                       <span style=color:#ae81ff>29</span>
</span></span><span style=display:flex><span>                       (list-ref days/month (- month <span style=color:#ae81ff>1</span>))))
</span></span><span style=display:flex><span>       (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>         [(&gt;= days d/y)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>loop</span> (- days d/y) (- year <span style=color:#ae81ff>1</span>) month day)]
</span></span><span style=display:flex><span>         [(&gt;= days d/m)
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>loop</span> (- days d/m) year (- month <span style=color:#ae81ff>1</span>) (list-ref days/month (- month <span style=color:#ae81ff>2</span>)))]
</span></span><span style=display:flex><span>         [else
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>make-gregorian</span> year month (- d/m days))]))]
</span></span><span style=display:flex><span>    <span style=color:#75715e>; that was easy</span>
</span></span><span style=display:flex><span>    [else
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>make-gregorian</span> <span style=color:#ae81ff>1970</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>)]))
</span></span></code></pre></div><p>Now that the two hard functions are out of the way, we get the easy ones. <code>mayan->days</code> is almost trivial, just a matter of multiplying each value by the correct multiple. Likewise, <code>days->mayan</code> works by repeated division (with remainder). I&rsquo;d never before used the <code>define-values</code> / <code>quotient/remainder</code> pattern before, but it works really well.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; convert from mayan to days since 1 jan 1970</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mayan-&gt;days</span> date)
</span></span><span style=display:flex><span>  (+ <span style=color:#ae81ff>-1856305</span>
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>mayan-kin</span> date)
</span></span><span style=display:flex><span>     (* <span style=color:#ae81ff>20</span> (<span style=color:#a6e22e>mayan-uinal</span> date))
</span></span><span style=display:flex><span>     (* <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>18</span> (<span style=color:#a6e22e>mayan-tun</span> date))
</span></span><span style=display:flex><span>     (* <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>20</span> (<span style=color:#a6e22e>mayan-katun</span> date))
</span></span><span style=display:flex><span>     (* <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>20</span> (<span style=color:#a6e22e>mayan-baktun</span> date))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; convert from days since 1 jan 1970 to a mayan date</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>days-&gt;mayan</span> days)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>define-values</span> (<span style=color:#a6e22e>baktun</span> baktun-days) (<span style=color:#a6e22e>quotient/remainder</span> (+ days <span style=color:#ae81ff>1856305</span>) (* <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>20</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>define-values</span> (<span style=color:#a6e22e>katun</span> katun-days) (<span style=color:#a6e22e>quotient/remainder</span> baktun-days (* <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>20</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>define-values</span> (<span style=color:#a6e22e>tun</span> tun-days) (<span style=color:#a6e22e>quotient/remainder</span> katun-days (* <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>18</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>define-values</span> (<span style=color:#a6e22e>uinal</span> kin) (<span style=color:#a6e22e>quotient/remainder</span> tun-days <span style=color:#ae81ff>20</span>))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>make-mayan</span> baktun katun tun uinal kin))
</span></span></code></pre></div><p>After that, it&rsquo;s just a matter of wiring them together:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; convert from gregorian to mayan</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>gregorian-&gt;mayan</span> date)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>days-&gt;mayan</span> (<span style=color:#a6e22e>gregorian-&gt;days</span> date)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; convert from mayan to gregorian </span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>mayan-&gt;gregorian</span> date)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>days-&gt;gregorian</span> (<span style=color:#a6e22e>mayan-&gt;days</span> date)))
</span></span></code></pre></div><p>I love it when everything comes together like that. ðŸ˜„</p><p>Of course, we want to make sure to do some testing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; do some testing</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>require</span> rackunit)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>for</span> ([test (<span style=color:#a6e22e>in-list</span> <span style=color:#f92672>&#39;</span>((( <span style=color:#ae81ff>741</span>  <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>28</span>)  <span style=color:#ae81ff>-448705</span> ( <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>10</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>                       ((<span style=color:#ae81ff>1900</span>  <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>1</span>)  <span style=color:#ae81ff>-25567</span>  (<span style=color:#ae81ff>12</span> <span style=color:#ae81ff>14</span>  <span style=color:#ae81ff>5</span>  <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>18</span>))
</span></span><span style=display:flex><span>                       ((<span style=color:#ae81ff>1969</span>  <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>17</span>)  <span style=color:#ae81ff>-229</span>    (<span style=color:#ae81ff>12</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>16</span>))
</span></span><span style=display:flex><span>                       ((<span style=color:#ae81ff>1970</span>  <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>1</span>)   <span style=color:#ae81ff>0</span>      (<span style=color:#ae81ff>12</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>16</span>  <span style=color:#ae81ff>7</span>  <span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>                       ((<span style=color:#ae81ff>1970</span> <span style=color:#ae81ff>10</span>  <span style=color:#ae81ff>1</span>)   <span style=color:#ae81ff>273</span>    (<span style=color:#ae81ff>12</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>17</span>  <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>18</span>))
</span></span><span style=display:flex><span>                       ((<span style=color:#ae81ff>1987</span> <span style=color:#ae81ff>10</span>  <span style=color:#ae81ff>1</span>)   <span style=color:#ae81ff>6482</span>   (<span style=color:#ae81ff>12</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>14</span>  <span style=color:#ae81ff>7</span>  <span style=color:#ae81ff>7</span>))
</span></span><span style=display:flex><span>                       ((<span style=color:#ae81ff>1989</span>  <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>17</span>)   <span style=color:#ae81ff>6956</span>   (<span style=color:#ae81ff>12</span> <span style=color:#ae81ff>18</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>                       ((<span style=color:#ae81ff>2012</span> <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>21</span>)   <span style=color:#ae81ff>15695</span>  (<span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>                       ((<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>25</span>)   <span style=color:#ae81ff>15730</span>  (<span style=color:#ae81ff>13</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>15</span>))))])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>g (apply make-gregorian (car test)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>d (cadr test))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>m (apply make-mayan (caddr test)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>check-equal?</span> (<span style=color:#a6e22e>gregorian-&gt;days</span> g) d)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>check-equal?</span> (<span style=color:#a6e22e>days-&gt;gregorian</span> d) g)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>check-equal?</span> (<span style=color:#a6e22e>days-&gt;gregorian</span> (<span style=color:#a6e22e>gregorian-&gt;days</span> g)) g)  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>check-equal?</span> (<span style=color:#a6e22e>mayan-&gt;days</span> m) d)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>check-equal?</span> (<span style=color:#a6e22e>days-&gt;mayan</span> d) m)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>check-equal?</span> (<span style=color:#a6e22e>days-&gt;mayan</span> (<span style=color:#a6e22e>mayan-&gt;days</span> m)) m)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>check-equal?</span> (<span style=color:#a6e22e>gregorian-&gt;mayan</span> g) m)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>check-equal?</span> (<span style=color:#a6e22e>mayan-&gt;gregorian</span> m) g))
</span></span></code></pre></div><p>Interestingly, it was 21 December 2012 that was the only case broken before I fixed the error in <code>days->gregorian</code>. So much for the end of the world&mldr;</p><p>This was actually a really neat program to work through. I&rsquo;m glad that I stumbled across the <a title="Daily Programmer Challenge #117 [Intermediate] Mayan Long Count" href=http://www.reddit.com/r/dailyprogrammer/comments/16obmx/011613_challenge_117_intermediate_mayan_long_count/>Daily Programmer</a> challenges. With an easy problem each Monday, an intermediate one each Wednesday (like this one), and a hard one each Friday, there are more than enough interesting problems to keep me busy for quite a while.</p><p>As always, if you&rsquo;d like to download the entire code, you can do so here:
<a href=https://github.com/jpverkamp/small-projects/blob/master/blog/mayan-conversion.rkt title="Mayan conversion on GitHub">Mayan conversion source</a></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>