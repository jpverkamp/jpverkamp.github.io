<!DOCTYPE html>
<html>
<head>
    <title>
    Gregorian/Mayan conversion â€“ jverkamp.com
</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css">

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />


    
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper">
        <header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
        
            
        
            
            <li><a href="https://blog.jverkamp.com/photography/">Photography</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/programming/">Programming</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/research/">Research</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/writing/">Writing</a></li>
            
        
            <li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>


        <div id="page-content-wrapper">
            <div id="page-content">
            
<article>
	<header>
		<h1 class="entry-title">Gregorian/Mayan conversion</h1>

        <div class="entry-meta">
            
            <span class="entry-date">2013-01-25</span>
            
            
        </div>

        <div class="entry-tags">
    
    

    <ul class="taxonomy-keys">
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2013/01/24/splay-heaps-redux-imperative-model/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/racket">Racket</a>
                        <a href="https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2013/01/24/splay-heaps-redux-imperative-model/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a>
                        <a href="https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    

                    
                    

                    <li>
                        
                        <a class="taxonomy-value" href="/programming/sources/daily-programmer">Daily Programmer</a>
                        <a href="https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    

    
        
        <li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2013/01/24/splay-heaps-redux-imperative-model/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/" class="next-link">Next</a>
                
            </ul>
        </li>
        

        
        <li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2013/01/24/splay-heaps-redux-imperative-model/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2013/01/25/an-optimal-alphabetizing-cipher/" class="next-link">Next</a>
                
            </ul>
        </li>
        
    
    </ul>
</div>

    </header>

	<div class="entry-content">
		<p>It may be 1 uinal, 15 kin too late for the new baktun, but I&rsquo;ve got some neat code to convert back and forth between the <a href="https://en.wikipedia.org/wiki/Gregorian%20calendar">Gregorian calendar</a> and the <a href="https://en.wikipedia.org/wiki/Mayan%20calendar">Mayan calendar</a>. It&rsquo;s based on a challenge on a post on the <a title="Daily Programmer Challenge #117 [Intermediate] Mayan Long Count" href="http://www.reddit.com/r/dailyprogrammer/comments/16obmx/011613_challenge_117_intermediate_mayan_long_count/">/r/dailyprogrammer subreddit</a>. As one might expect, the goal is to be able to take a year, month, and day in the Gregorian calendar and return the equivalent Mayan Long Count corresponding to that date. As a bonus (which of course I had to do ðŸ˜„), do the opposite and do it without using built in date functions.</p>

<p></p>

<p>To start out, we want a structure for each (if you&rsquo;d like, you can follow along <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/mayan-conversion.rkt" title="Mayan conversion on GitHub">here</a>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; date structures</span>
(define-struct gregorian (year month day) <span style="color:#f92672">#</span>:transparent)
(define-struct mayan (baktun katun tun uinal kin) <span style="color:#f92672">#</span>:transparent)</code></pre></div>
<p>Then, we&rsquo;ll need a few helpers. Particularly, we want a function that can calculate leap years and a list of days per month (ignoring any 29 day February for the time being).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; test if a year is a leap year</span>
(<span style="color:#66d9ef">define </span>(leap-year? year)
  (<span style="color:#66d9ef">or </span>(<span style="color:#66d9ef">and </span>(divisible? year <span style="color:#ae81ff">4</span>)
           (not (divisible? year <span style="color:#ae81ff">100</span>)))
      (divisible? year <span style="color:#ae81ff">400</span>)))

<span style="color:#75715e">; days per month</span>
(<span style="color:#66d9ef">define </span>days/month <span style="color:#f92672">&#39;#</span>(<span style="color:#ae81ff">31</span> <span style="color:#ae81ff">28</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">31</span>))</code></pre></div>
<p>Now we&rsquo;re ready to go. Eventually, we want to write the functions <code>gregorian-&gt;mayan</code> and <code>mayan-&gt;gregorian</code>, but it would be a bit of a pain to convert directly. So instead, we&rsquo;ll convert via the number of days since 1 January 1970. That will give us the functions <code>gregorian-&gt;days</code>, <code>days-&gt;gregorian</code>, <code>mayan-&gt;days</code>, and <code>days-&gt;mayan</code>. The <code>gregorian</code> functions are a bit more complicated, so we&rsquo;ll start with those.</p>

<p>First, <code>gregorian-&gt;days</code>. It&rsquo;s a bit sneaky, but it&rsquo;s a closed form solution. Basically, we need to know if we&rsquo;re before or after 0-day and if we&rsquo;re before or after February (for the leap years). After that, it&rsquo;s mostly a matter of mathy goodness.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; convert from gregorian to days since 1 jan 1970</span>
(<span style="color:#66d9ef">define </span>(gregorian-&gt;days date)
  <span style="color:#75715e">; a date after 1 jan 1970?</span>
  (<span style="color:#66d9ef">define </span>go-&gt; (&gt;= (gregorian-year date) <span style="color:#ae81ff">1970</span>))

  <span style="color:#75715e">; are we after February?</span>
  (<span style="color:#66d9ef">define </span>feb+ (&gt; (gregorian-month date) <span style="color:#ae81ff">2</span>))

  <span style="color:#75715e">; range for leap years to test</span>
  (<span style="color:#66d9ef">define </span>leap-range
    (list
     (<span style="color:#66d9ef">if </span>go-&gt; <span style="color:#ae81ff">1970</span> (+ (gregorian-year date) (<span style="color:#66d9ef">if </span>feb+ <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>)))
     (<span style="color:#66d9ef">if </span>go-&gt; (+ (gregorian-year date) (<span style="color:#66d9ef">if </span>feb+ <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>)) <span style="color:#ae81ff">1971</span>)))

  (+ <span style="color:#75715e">; add year</span>
     (* <span style="color:#ae81ff">365</span> (- (gregorian-year date) (<span style="color:#66d9ef">if </span>go-&gt; <span style="color:#ae81ff">1970</span> <span style="color:#ae81ff">1969</span>)))
     <span style="color:#75715e">; add month</span>
     (* (<span style="color:#66d9ef">if </span>go-&gt; <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>) 
        (apply + ((<span style="color:#66d9ef">if </span>go-&gt; take drop) days/month (- (gregorian-month date) <span style="color:#ae81ff">1</span>))))
     <span style="color:#75715e">; add day</span>
     (- (gregorian-day date) <span style="color:#ae81ff">1</span>)
     <span style="color:#75715e">; deal with leap years</span>
     (for/sum ([year (apply in-range leap-range)])
       (<span style="color:#66d9ef">if </span>(leap-year? year) (<span style="color:#66d9ef">if </span>go-&gt; <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>) <span style="color:#ae81ff">0</span>))))</code></pre></div>
<p>The <code>for/sum</code> is the most potentially problematic point I think. I feel like there should be a non-looped solution to that, but this worked well enough (and it took long enough to get some of the other details working). In yet another tiny error that nevertheless took forever to track down, I originally had the second <code>(if feb+ ...)</code> the same as the first. Needless to say, that sent a few things sideways.</p>

<p>Next, we want to be able to invert that function. I couldn&rsquo;t work out a clean closed form for this one, so I just loop, first setting the year, then the month, then the day. It&rsquo;s a bit longer and I couldn&rsquo;t combine the forwards and backwards code, but it works well enough.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; convert from days since 1 jan 1970 to gregorian date</span>
(<span style="color:#66d9ef">define </span>(days-&gt;gregorian days)
  (cond
    <span style="color:#75715e">; work forward from 1 jan 1970</span>
    [(&gt; days <span style="color:#ae81ff">0</span>)
     (<span style="color:#66d9ef">let </span>loop ([days days] [year <span style="color:#ae81ff">1970</span>] [month <span style="color:#ae81ff">1</span>] [day <span style="color:#ae81ff">1</span>])
       (<span style="color:#66d9ef">define </span>d/y (<span style="color:#66d9ef">if </span>(leap-year? year) <span style="color:#ae81ff">366</span> <span style="color:#ae81ff">365</span>))
       (<span style="color:#66d9ef">define </span>d/m (<span style="color:#66d9ef">if </span>(<span style="color:#66d9ef">and </span>(leap-year? year) (= month <span style="color:#ae81ff">2</span>))
                       <span style="color:#ae81ff">29</span>
                       (list-ref days/month (- month <span style="color:#ae81ff">1</span>))))
       (cond
         [(&gt;= days d/y)
          (loop (- days d/y) (+ year <span style="color:#ae81ff">1</span>) month day)]
         [(&gt;= days d/m)
          (loop (- days d/m) year (+ month <span style="color:#ae81ff">1</span>) day)]
         [else
          (make-gregorian year month (+ day days))]))]
    <span style="color:#75715e">; work backwards from 1 jan 1970</span>
    [(&lt; days <span style="color:#ae81ff">0</span>)
     (<span style="color:#66d9ef">let </span>loop ([days (- (abs days) <span style="color:#ae81ff">1</span>)] [year <span style="color:#ae81ff">1969</span>] [month <span style="color:#ae81ff">12</span>] [day <span style="color:#ae81ff">31</span>])
       (<span style="color:#66d9ef">define </span>d/y (<span style="color:#66d9ef">if </span>(leap-year? year) <span style="color:#ae81ff">366</span> <span style="color:#ae81ff">365</span>))
       (<span style="color:#66d9ef">define </span>d/m (<span style="color:#66d9ef">if </span>(<span style="color:#66d9ef">and </span>(leap-year? year) (= month <span style="color:#ae81ff">2</span>))
                       <span style="color:#ae81ff">29</span>
                       (list-ref days/month (- month <span style="color:#ae81ff">1</span>))))
       (cond
         [(&gt;= days d/y)
          (loop (- days d/y) (- year <span style="color:#ae81ff">1</span>) month day)]
         [(&gt;= days d/m)
          (loop (- days d/m) year (- month <span style="color:#ae81ff">1</span>) (list-ref days/month (- month <span style="color:#ae81ff">2</span>)))]
         [else
          (make-gregorian year month (- d/m days))]))]
    <span style="color:#75715e">; that was easy</span>
    [else
     (make-gregorian <span style="color:#ae81ff">1970</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>)]))</code></pre></div>
<p>Now that the two hard functions are out of the way, we get the easy ones. <code>mayan-&gt;days</code> is almost trivial, just a matter of multiplying each value by the correct multiple. Likewise, <code>days-&gt;mayan</code> works by repeated division (with remainder). I&rsquo;d never before used the <code>define-values</code> / <code>quotient/remainder</code> pattern before, but it works really well.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; convert from mayan to days since 1 jan 1970</span>
(<span style="color:#66d9ef">define </span>(mayan-&gt;days date)
  (+ <span style="color:#ae81ff">-1856305</span>
     (mayan-kin date)
     (* <span style="color:#ae81ff">20</span> (mayan-uinal date))
     (* <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">18</span> (mayan-tun date))
     (* <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">20</span> (mayan-katun date))
     (* <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">20</span> (mayan-baktun date))))

<span style="color:#75715e">; convert from days since 1 jan 1970 to a mayan date</span>
(<span style="color:#66d9ef">define </span>(days-&gt;mayan days)
  (define-values (baktun baktun-days) (quotient/remainder (+ days <span style="color:#ae81ff">1856305</span>) (* <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">20</span>)))
  (define-values (katun katun-days) (quotient/remainder baktun-days (* <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">20</span>)))
  (define-values (tun tun-days) (quotient/remainder katun-days (* <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">18</span>)))
  (define-values (uinal kin) (quotient/remainder tun-days <span style="color:#ae81ff">20</span>))
  (make-mayan baktun katun tun uinal kin))</code></pre></div>
<p>After that, it&rsquo;s just a matter of wiring them together:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; convert from gregorian to mayan</span>
(<span style="color:#66d9ef">define </span>(gregorian-&gt;mayan date)
  (days-&gt;mayan (gregorian-&gt;days date)))

<span style="color:#75715e">; convert from mayan to gregorian </span>
(<span style="color:#66d9ef">define </span>(mayan-&gt;gregorian date)
  (days-&gt;gregorian (mayan-&gt;days date)))</code></pre></div>
<p>I love it when everything comes together like that. ðŸ˜„</p>

<p>Of course, we want to make sure to do some testing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; do some testing</span>
(require rackunit)
(for ([test (in-list <span style="color:#f92672">&#39;</span>((( <span style="color:#ae81ff">741</span>  <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">28</span>)  <span style="color:#ae81ff">-448705</span> ( <span style="color:#ae81ff">9</span> <span style="color:#ae81ff">15</span> <span style="color:#ae81ff">10</span>  <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">0</span>))
                       ((<span style="color:#ae81ff">1900</span>  <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">1</span>)  <span style="color:#ae81ff">-25567</span>  (<span style="color:#ae81ff">12</span> <span style="color:#ae81ff">14</span>  <span style="color:#ae81ff">5</span>  <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">18</span>))
                       ((<span style="color:#ae81ff">1969</span>  <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">17</span>)  <span style="color:#ae81ff">-229</span>    (<span style="color:#ae81ff">12</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">15</span> <span style="color:#ae81ff">13</span> <span style="color:#ae81ff">16</span>))
                       ((<span style="color:#ae81ff">1970</span>  <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">1</span>)   <span style="color:#ae81ff">0</span>      (<span style="color:#ae81ff">12</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">16</span>  <span style="color:#ae81ff">7</span>  <span style="color:#ae81ff">5</span>))
                       ((<span style="color:#ae81ff">1970</span> <span style="color:#ae81ff">10</span>  <span style="color:#ae81ff">1</span>)   <span style="color:#ae81ff">273</span>    (<span style="color:#ae81ff">12</span> <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">17</span>  <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">18</span>))
                       ((<span style="color:#ae81ff">1987</span> <span style="color:#ae81ff">10</span>  <span style="color:#ae81ff">1</span>)   <span style="color:#ae81ff">6482</span>   (<span style="color:#ae81ff">12</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">14</span>  <span style="color:#ae81ff">7</span>  <span style="color:#ae81ff">7</span>))
                       ((<span style="color:#ae81ff">1989</span>  <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">17</span>)   <span style="color:#ae81ff">6956</span>   (<span style="color:#ae81ff">12</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">15</span> <span style="color:#ae81ff">13</span>  <span style="color:#ae81ff">1</span>))
                       ((<span style="color:#ae81ff">2012</span> <span style="color:#ae81ff">12</span> <span style="color:#ae81ff">21</span>)   <span style="color:#ae81ff">15695</span>  (<span style="color:#ae81ff">13</span>  <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">0</span>))
                       ((<span style="color:#ae81ff">2013</span>  <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">25</span>)   <span style="color:#ae81ff">15730</span>  (<span style="color:#ae81ff">13</span>  <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">15</span>))))])

  (<span style="color:#66d9ef">define </span>g (apply make-gregorian (car test)))
  (<span style="color:#66d9ef">define </span>d (cadr test))
  (<span style="color:#66d9ef">define </span>m (apply make-mayan (caddr test)))

  (check-equal? (gregorian-&gt;days g) d)
  (check-equal? (days-&gt;gregorian d) g)
  (check-equal? (days-&gt;gregorian (gregorian-&gt;days g)) g)  

  (check-equal? (mayan-&gt;days m) d)
  (check-equal? (days-&gt;mayan d) m)
  (check-equal? (days-&gt;mayan (mayan-&gt;days m)) m)

  (check-equal? (gregorian-&gt;mayan g) m)
  (check-equal? (mayan-&gt;gregorian m) g))</code></pre></div>
<p>Interestingly, it was 21 December 2012 that was the only case broken before I fixed the error in <code>days-&gt;gregorian</code>. So much for the end of the world&hellip;</p>

<p>This was actually a really neat program to work through. I&rsquo;m glad that I stumbled across the <a title="Daily Programmer Challenge #117 [Intermediate] Mayan Long Count" href="http://www.reddit.com/r/dailyprogrammer/comments/16obmx/011613_challenge_117_intermediate_mayan_long_count/">Daily Programmer</a> challenges. With an easy problem each Monday, an intermediate one each Wednesday (like this one), and a hard one each Friday, there are more than enough interesting problems to keep me busy for quite a while.</p>

<p>As always, if you&rsquo;d like to download the entire code, you can do so here:
<a href="https://github.com/jpverkamp/small-projects/blob/master/blog/mayan-conversion.rkt" title="Mayan conversion on GitHub">Mayan conversion source</a></p>
	</div>

    
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Gregorian\/Mayan conversion";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2013\/01\/25\/gregorian\/mayan-conversion\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>


</article>

            </div>
        </div>

        <footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>

            
            <li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>
            
        </ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js"></script>

<script type="text/javascript" src="/custom.js" defer></script>

</body>
</html>
