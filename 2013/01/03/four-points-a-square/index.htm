<!DOCTYPE html>
<html>
<head>
        
        

        <title>Four points, a square? | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js"></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/obsidian.css" />
        <script src="/highlight/highlight.pack.js"></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" />
        <script src="/custom.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="http://blog.jverkamp.com/feed/" />
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://blog.jverkamp.com"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="http://blog.jverkamp.com/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/archives/2004">2004</a></li><li><a href="http://blog.jverkamp.com/category/archives/2005">2005</a></li><li><a href="http://blog.jverkamp.com/category/archives/2006">2006</a></li><li><a href="http://blog.jverkamp.com/category/archives/2007">2007</a></li><li><a href="http://blog.jverkamp.com/category/archives/2008">2008</a></li><li><a href="http://blog.jverkamp.com/category/archives/2009">2009</a></li><li><a href="http://blog.jverkamp.com/category/archives/2010">2010</a></li><li><a href="http://blog.jverkamp.com/category/archives/2011">2011</a></li><li><a href="http://blog.jverkamp.com/category/archives/2012">2012</a></li><li><a href="http://blog.jverkamp.com/category/archives/2013">2013</a></li><li><a href="http://blog.jverkamp.com/category/archives/2014">2014</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="http://blog.jverkamp.com/category/other/cooking">Cooking</a></li><li><a href="http://blog.jverkamp.com/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/photography/dp-challenge">DP Challenge</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosets">Photosets</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/programming/by-language">By Language</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-project">By Project</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-source">By Source</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/research/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/writing/by-genre">By Genre</a></li><li><a href="http://blog.jverkamp.com/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="http://blog.jverkamp.com/category/writing/novels">Novels</a></li><li><a href="http://blog.jverkamp.com/category/writing/other">Other</a></li><li><a href="http://blog.jverkamp.com/category/writing/short-stories">Short Stories</a></li></ul></li></ul>

      <form action="http://www.google.com/search" method="get" onSubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input name="q" type="hidden" />
          <input name="qfront" type="text" class="form-control" placeholder="Search" />
          <button type="submit" class="btn btn-default" value="Search">Search</button>
        </p>
      </form>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Four points, a square?</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2013-01-03"><span class="year">2013</span> <span class="month">Jan</span> <span class="day">3</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="http://blog.jverkamp.com/category/programming/by-topic/mathematics">Mathematics</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/mathematics/geometry">Geometry</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-source/programming-praxis">Programming Praxis</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/scheme">Scheme</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/racket">Racket</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <p><a title="Four Points Determine a Square" href="http://programmingpraxis.com/2013/01/02/four-points-determine-a-square/">Another post</a> from Programming Praxis. This one was originally intended for Friday but they posted it early, so I figured I would go ahead and do the same. The problem is actually deceptively straight forward:</p>
<p>Given four points, do they form a square?</p>
<!--more-->
<p>My first thought was to directly calculate the angles between each trio of points. You should be able to determine which trios are ordered by finding the 90 degree angles and you could then check the distances. Before I got too far into my old geometry textbooks to figure out how to calculate those angles though, I realized that you'd don't actually need the angles at all.</p>
<p>Instead, all you need is three distances. If you calculate the distances from one point to the other three, a square will always have two equal and short distances on the sides and another multiple of the square root of two across the diagonal. Better yet, only squares have those three distances. So just start at any one point and run these calculations:</p>
<pre class="scheme"><code>; test if four points for a square
(define (square? pts)
  ; calculate and sort the pairwise distances
  (define dists
    (sort
     (list (dist (car pts) (cadr pts))
           (dist (car pts) (caddr pts))
           (dist (car pts) (cadddr pts)))
     &lt;))

  ; two must be equal, those are edges
  ; the last is the diagonal and should be sqrt 2 * edge
  (and (= (car dists)
          (cadr dists))
       (= (caddr dists)
          (* (sqrt 2) (car dists)))))</code></pre>
<p>This is assuming that you have <code>sqr</code> and <code>dist</code> defined as such:</p>
<pre class="scheme"><code>; square a number
(define (sqr x) (* x x))

; standard distance function
(define (dist p1 p2)
  (sqrt (+ (sqr (- (cadr p2) (cadr p1)))
           (sqr (- (car p2) (car p1))))))</code></pre>
<p>To test it out, we'll run all of the tests provided in the original post from Programming Praxis:</p>
<pre class="scheme"><code>&gt;(square? '((0 0) (0 1) (1 0) (1 1))) ; unit square
#t
&gt;(square? '((0 0) (2 1) (3 -1) (1 -2))) ; at an angle
#t
&gt;(square? '((0 0) (1 1) (0 1) (1 0))) ; re-ordered points
#t
&gt;(square? '((0 0) (0 2) (3 2) (3 0))) ; rectangle
#f
&gt;(square? '((0 0) (3 4) (8 4) (5 0))) ; rhombus
#f
&gt;(square? '((0 0) (0 0) (1 1) (0 0))) ; not a polygon
#f
&gt;(square? '((0 0) (0 0) (1 0) (0 1))) ; not a polygon
#f</code></pre>
<p>Looks good to go. It's interesting how something like that can actually be pretty simple. Just three distance calculations and you're golden.</p>
<p>Except, it turns out that it's not quite so simple. This actually ended up being the same idea as the <a href="http://programmingpraxis.com/2013/01/02/four-points-determine-a-square/2/" title="Solution for Four Points Determine a Square">original solution</a> provided at Programming Praxis, but as another commenter pointed out (<a href="http://bonsaicode.wordpress.com/2013/01/02/programming-praxis-four-points-determine-a-square/" title="Programming Praxis - Four Points Determine a Square">their solution in Haskell</a>), there's one test case that this method fails on:</p>
<pre class="scheme"><code>&gt; (square? '((0 0) (0 1) (1 0) (-1 -1))) ; designed to fail
#f</code></pre>
<p>In this case, the distances are all correct (you have two sides and a square root of 2 multiple for the diagonal) but unfortunately the diagonal goes the wrong direction. So how do you fix that case?</p>
<p>Well, you should just be able to test the sides from the far point. That requires figuring out which distance that belonged to though (which isn't horrible), but I wanted something a bit more amusing. So what I've done here is extend the function out to calculate all 16 pairwise distances between the points (including self comparisons):</p>
<pre class="scheme"><code>; calculate all pairwise distances
(define dists
  (sort
   (for*/list ([a (in-list pts)]
               [b (in-list pts)])
     (dist a b))
   &lt;))</code></pre>
<p>What we should get is four zeros (for the self comparisons), eight copies of the sides (because order isn't preserved we have both the side <em>ab</em> and <em>ba</em> for each side), and four copies of the diagonal at a square root of two multiple. Using <code>take</code> and <code>drop</code> on a sorted list to pull out those sections and making sure they are equal (it's times like these that I remember and am glad that <code>=</code> takes two <em>or more</em> arguments), and everything should work out nicely:</p>
<pre class="scheme"><code>; we should have:
(and
 ; 4x zero for self matches
 (apply = (cons 0 (take dists 4)))
 ; 8x identical distances for the sides
 (apply = (take (drop dists 4) 8))
 ; 4x sqrt(2) * side for the diagonals
 (apply = (cons (* (sqrt 2) (car (drop dists 4)))
                (drop dists 12))))</code></pre>
<p>It's a bit strange and definitely not the most efficient (<code>take</code> and <code>drop</code> are duplicating work and I believe that <code>apply</code> isn't necessarily the most efficient thing, although I could be wrong), but for the number of tests we're doing, it's still essentially instantanous.</p>
<p>This time, I also added a series of <code><a href="http://docs.racket-lang.org/search/index.html?q=RackUnit">RackUnit</a></code> tests to make sure everything works:</p>
<pre class="scheme"><code>(check-true (square? '((0 0) (0 1) (1 0) (1 1))) "unit square")
(check-true (square? '((0 0) (2 1) (3 -1) (1 -2))) "at an angle")
(check-true (square? '((0 0) (1 1) (0 1) (1 0))) "re-ordered points")

(check-false (square? '((0 0) (0 2) (3 2) (3 0))) "rectangle")
(check-false (square? '((0 0) (3 4) (8 4) (5 0))) "rhombus")
(check-false (square? '((0 0) (0 0) (1 1) (0 0))) "not a polygon")
(check-false (square? '((0 0) (0 0) (1 0) (0 1))) "not a polygon")

(check-false (square? '((0 0) (0 1) (1 0) (-1 -1))) "failed original test")</code></pre>
<p>Running it, there are no errors, so everything appears to be good. Hopefully there isn't another sneaky sort of error going on, but for the moment I doubt it.</p>
<p>As mentioned, this is the sort of thing that you may see on those puzzle sort of interview questions. While I don't personally think there's much worth in that sort of question (more often than not, you're testing if someone has heard the question before), they're still often fun to work out the first time. I'd be particularly interested to see how an interviewer would deal with the first (incorrect) solution and how the interviewee could deal with being told that there's a corner case that they missed but not which one.</p>
<p>If you'd like to see the entire source code for this post, you can do so here:</p>
<p>- <a title="Four points a square source on GitHub" href="https://github.com/jpverkamp/small-projects/blob/master/blog/four-points-a-square.rkt">four-points-a-square.rkt</a></p>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Four points, a square?";
var disqus_url = "http://blog.jverkamp.com/2013/01/03/four-points-a-square/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2013/01/03/confession-day-62">← Confession - Day 62</a></li><li><a href="http://blog.jverkamp.com/category/archives">Archives</a></li><li><a href="http://blog.jverkamp.com/2013/01/04/confession-day-63">Confession - Day 63 →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2013/01/02/happy-new-year">← Happy New Year</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/2013/01/06/wombat-ide-its-alive-bug-fixes">Wombat IDE - It's Alive! (bug fixes) →</a></li></ul></nav>

                <div class="legal">
                        <a href="http://blog.jverkamp.com/feed/atom.xml">feed <img style="border: 0;" src="http://blog.jverkamp.com/rss.png" /></a><br />
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="http://directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53688146-1', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>