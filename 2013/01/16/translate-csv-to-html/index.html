<!DOCTYPE html>
<html onclick >
<head>
    <title>Translate CSV to HTML â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Translate CSV to HTML</h1>

        <div class="entry-meta"><span class="entry-date">2013-01-16</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/10/06/generated-html-index/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/html">HTML</a><a href="https://blog.jverkamp.com/2013/03/06/partitioning-the-dutch-national-flag/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2013/01/03/four-points-a-square/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/racket">Racket</a><a href="https://blog.jverkamp.com/2013/01/20/triangle-trilemma/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2013/01/06/wombat-ide-its-alive-bug-fixes/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a><a href="https://blog.jverkamp.com/2013/01/20/triangle-trilemma/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2013/01/03/four-points-a-square/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/programming-praxis">Programming Praxis</a><a href="https://blog.jverkamp.com/2013/01/20/triangle-trilemma/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/10/04/querying-csv-files-with-sql/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/csv">CSV</a><a href="https://blog.jverkamp.com/2015/12/11/csv-to-json/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2012/10/06/generated-html-index/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/web-development">Web Development</a><a href="https://blog.jverkamp.com/2013/03/06/partitioning-the-dutch-national-flag/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2013/01/06/wombat-ide-its-alive-bug-fixes/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2013/01/17/decoding-escaped-unicode-strings/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2013/01/15/all-good-things.../" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2013/01/17/decoding-escaped-unicode-strings/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><p><a href="http://programmingpraxis.com/2013/01/15/translate-csv-to-html/" title="Translate CSV to HTML">Yesterday&rsquo;s post</a> from Programming Praxis asks us to write a function that will read content formatted as <a href="https://en.wikipedia.org/wiki/comma-separated%20values">comma-separated values</a> and output the result as an HTML table. Their solution uses the <a href="http://programmingpraxis.com/essays/#text-file-databases" title="Text file database">text file database library</a> that they posted about (which is a neat concept, you should check it out), but I think I&rsquo;m going to work out the solution more directly.</p>
<p>To make the problem more interesting, I wanted to add a few additional constraints:</p>
<ul>
<li>The parsed must be able to handle quoted expressions that may themselves contain commas or escaped quotes (example: &ldquo;to be, or not &quot;to be&quot;&rdquo; should parse as a single item)</li>
<li>Any expression that could be <em>read</em> as a Scheme expression should be</li>
<li>All other expressions should be read as strings</li>
</ul>
<p>So if we were to take this as a sample input file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">this</span><span style="color:#f92672">,</span><span style="color:#f92672">is</span> <span style="color:#f92672">a</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;test of awesome&#34;</span>
<span style="color:#f92672">1</span><span style="color:#f92672">,</span><span style="color:#f92672">2</span><span style="color:#f92672">,</span><span style="color:#f92672">3</span>.<span style="color:#a6e22e">14</span>
<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#f92672">&lt;</span><span style="color:#f92672">void</span><span style="color:#f92672">&gt;,</span><span style="color:#e6db74">&#34;frog, \&#34;neblins\&#34;&#34;</span><span style="color:#f92672">,</span>#f
</code></pre></div><p>The output should be a list of lists like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#f92672">&#39;</span>((<span style="color:#a6e22e">this</span> <span style="color:#e6db74">&#34;is a&#34;</span> <span style="color:#e6db74">&#34;test of awesome&#34;</span>)
  (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3.14</span>)
  (<span style="color:#e6db74">&#34;#&lt;void&gt;&#34;</span> <span style="color:#e6db74">&#34;frog, \&#34;neblins\&#34;&#34;</span> <span style="color:#66d9ef">#f</span>)))
</code></pre></div><p>Note how &ldquo;is a&rdquo; had to be parsed as a string because it was two objects, both quoted strings parsed correctly (including the escaped quotes and comma), and the numbers and <em>#f</em> all were converted into Scheme objects. Also, since <em>#<void></em> isn&rsquo;t &lsquo;readable&rsquo;, it should be read as a string.</p>
<p>From there, we&rsquo;ll want to output that as HTML, but we&rsquo;ll get to that in a bit. If you&rsquo;d like to follow along with the full code though, you can do so on GitHub: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/csv-to-html.rkt" title="GitHub: csv to html source">csv to html source</a></p>
<p>My basic avenue of attack is to use a <a href="https://en.wikipedia.org/wiki/finite%20state%20machine">finite state machine</a> to parse the input. I&rsquo;m going to have four states:</p>
<ul>
<li>start &ndash; when we&rsquo;re starting a line item</li>
<li>string &ndash; while we&rsquo;re reading a string</li>
<li>string/escape &ndash; immediately after an escape in a string</li>
<li>normal &ndash; any non-string line item</li>
</ul>
<p>With these, we&rsquo;ll need to keep track of three additional things (all lists):</p>
<ul>
<li>lines &ndash; all of the completed lines we&rsquo;ve read thus far</li>
<li>current-line &ndash; the progress we&rsquo;ve made on the current line</li>
<li>current-block &ndash; the progress we&rsquo;ve made on the current line item</li>
</ul>
<p>All three will start out empty. So our basic code is going to look something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; read csv content from the current input stream</span>
<span style="color:#75715e">; try to parse each value as a Scheme value, on fail return a string</span>
<span style="color:#75715e">; make sure to correctly handle quoted strings</span>
(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">read-csv</span>)
  (<span style="color:#66d9ef">let </span>loop ([lines <span style="color:#f92672">&#39;</span>()]
             [current-line <span style="color:#f92672">&#39;</span>()]
             [current-block <span style="color:#f92672">&#39;</span>()]
             [mode <span style="color:#e6db74">&#39;start</span>]) <span style="color:#75715e">; start, string, string/escape, or normal</span>
    <span style="color:#f92672">...</span>)
</code></pre></div><p>So far, so good. Although it does a whopping lot of nothing as of yet. Let&rsquo;s fix that.</p>
<p>First, we want to read the next character. Then we&rsquo;ll need to process it. The first case to consider will be if we&rsquo;re at the end of the file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#f92672">...</span>
(<span style="color:#66d9ef">define </span>next (<span style="color:#a6e22e">read-char</span>))
(<span style="color:#a6e22e">cond</span>
  <span style="color:#75715e">; eof, stop reading</span>
  [(eof-object? next)
   (reverse (cons (reverse (cons (<span style="color:#a6e22e">try-read</span> (list-&gt;string (reverse current-block)))
                                 current-line))
                  lines))]
<span style="color:#f92672">...</span>
</code></pre></div><p>For the moment, ignore the <em>try-read</em> function. That will do the work of trying to parse a string as a Scheme object and falling back to a string if it fails. Other than that, one additional thing to note is that all three of the lists mentioned above are being built backwards (that&rsquo;s just the nature of <a href="https://en.wikipedia.org/wiki/tail%20recursion">tail recursion</a>; ask me why in the comments if you&rsquo;re curious).</p>
<p>That means when we&rsquo;re done with each block/line, we have to <em>reverse</em> it. You incur an <em>O(n)</em> cost, but compared to some of the other stuff we&rsquo;re doing, that&rsquo;ll be negligible. If you&rsquo;re really interested in performance, you&rsquo;d probably want to read a line at a time into memory and split it using <em>substring</em>.</p>
<p>In any case, now that possibility is out of the way, the next to consider is whether we&rsquo;re in <em>string</em> mode or <em>normal</em> / non-string mode. That&rsquo;s actually probably the easiest state to deal with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#f92672">...</span>
<span style="color:#75715e">; start in string or normal mode</span>
[(eq? mode <span style="color:#e6db74">&#39;start</span>)
 (<span style="color:#a6e22e">loop</span> lines current-line (cons next current-block) (<span style="color:#66d9ef">if </span>(eq? next <span style="color:#e6db74">#\&#34;</span>) <span style="color:#e6db74">&#39;string</span> <span style="color:#e6db74">&#39;normal</span>))]
<span style="color:#f92672">...</span>
</code></pre></div><p>All we have to do is check for an opening quote.</p>
<p>Next, dealing with string mode. Basically, we have three options. Either we continue with normal characters in the string, we find an escape character, or we end the string.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#f92672">...</span>
      <span style="color:#75715e">; look for escaped characters in string mode</span>
      [(<span style="color:#66d9ef">and </span>(eq? mode <span style="color:#e6db74">&#39;string</span>) (eq? next <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">\\</span>))
       (<span style="color:#a6e22e">loop</span> lines current-line (cons next current-block) <span style="color:#e6db74">&#39;string/escape</span>)]

      <span style="color:#75715e">; read next character in escape mode</span>
      [(eq? mode <span style="color:#e6db74">&#39;string/escape</span>)
       (<span style="color:#a6e22e">loop</span> lines current-line (cons next current-block) <span style="color:#e6db74">&#39;string</span>)]

      <span style="color:#75715e">; end the string in string mode (the next character must be a comma or newline)</span>
      <span style="color:#75715e">; todo: deal with \r\n newlines</span>
      [(<span style="color:#66d9ef">and </span>(eq? mode <span style="color:#e6db74">&#39;string</span>) (eq? next <span style="color:#e6db74">#\&#34;</span>))
       (<span style="color:#66d9ef">define </span>done-block (<span style="color:#a6e22e">try-read</span> (list-&gt;string (reverse (cons next current-block)))))
       (<span style="color:#66d9ef">define </span>next-next (<span style="color:#a6e22e">read-char</span>))
       (<span style="color:#a6e22e">cond</span>
         [(eq? next-next <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">,</span>)
          (<span style="color:#a6e22e">loop</span> lines (cons done-block current-line) <span style="color:#f92672">&#39;</span>() <span style="color:#e6db74">&#39;start</span>)]
         [(eq? next-next <span style="color:#e6db74">#\newline</span>)
          (<span style="color:#66d9ef">define </span>done-line (reverse (cons done-block current-line)))
          (<span style="color:#a6e22e">loop</span> (cons done-line lines) <span style="color:#f92672">&#39;</span>() <span style="color:#f92672">&#39;</span>() <span style="color:#e6db74">&#39;start</span>)]
         [else
          (<span style="color:#a6e22e">error</span> <span style="color:#e6db74">&#39;read-csv</span> <span style="color:#e6db74">&#34;Invalid string literal, missing comma or newline&#34;</span>)])]
<span style="color:#f92672">...</span>
</code></pre></div><p>This is a bit more complicated, but only a bit. The interesting parts to note are that if we see an escape, we just skip over (buffering) the next character. That way, we can skip right past things like &quot;. Technically, we could read ahead (like we have to do in the third part of this anyways) and skip the state entirely, but I think this way is cleaner.</p>
<p>To show the other way though, consider the third part where a string mode block ends. There are three possible endings here (each of which could be states, but I&rsquo;m demonstrating both methods). Either you have a comma after the quote and you go on to another item on this line, you have a newline (I need to but haven&rsquo;t dealt with \r or \r\n <a href="https://en.wikipedia.org/wiki/line%20endings">line endings</a>. For now, this is Unix (including OS X) only.), or you have an error. One interesting thing to note: this system actually allows for multiline strings. So these two would be equivalent:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#e6db74">&#34;hello
</span><span style="color:#e6db74">world&#34;</span>

<span style="color:#e6db74">&#34;hello\nworld&#34;</span>
</code></pre></div><p>Next, we have cases for the end of an item. These are basically the same as the string cases above, but I broke them out into their own cond cases this time.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#f92672">...</span>
<span style="color:#75715e">; end an item</span>
[(<span style="color:#66d9ef">and </span>(eq? mode <span style="color:#e6db74">&#39;normal</span>) (eq? next <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">,</span>))
 (<span style="color:#66d9ef">define </span>done-block (<span style="color:#a6e22e">try-read</span> (list-&gt;string (reverse current-block))))
 (<span style="color:#a6e22e">loop</span> lines (cons done-block current-line) <span style="color:#f92672">&#39;</span>() <span style="color:#e6db74">&#39;start</span>)]

<span style="color:#75715e">; end a line</span>
<span style="color:#75715e">; todo: deal with \r\n</span>
[(<span style="color:#66d9ef">and </span>(eq? mode <span style="color:#e6db74">&#39;normal</span>) (eq? next <span style="color:#e6db74">#\newline</span>))
 (<span style="color:#66d9ef">define </span>done-block (<span style="color:#a6e22e">try-read</span> (list-&gt;string (reverse current-block))))
 (<span style="color:#66d9ef">define </span>done-line (reverse (cons done-block current-line)))
 (<span style="color:#a6e22e">loop</span> (cons done-line lines) <span style="color:#f92672">&#39;</span>() <span style="color:#f92672">&#39;</span>() <span style="color:#e6db74">&#39;start</span>)]
<span style="color:#f92672">...</span>
</code></pre></div><p>Like I said, this is the same as before.</p>
<p>Finally, we have the default case. If nothing else happens, just buffer the character and keep reading. This should happen most of the time. Note that <em>mode</em> (the FSM state) is preserved. This is important.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#f92672">...</span>
<span style="color:#75715e">; buffer all other characters</span>
[else
 (<span style="color:#a6e22e">loop</span> lines current-line (cons next current-block) mode)])))
<span style="color:#f92672">...</span>
</code></pre></div><p>And there you have it. A fully functional CSV parser. You can try it out (although you&rsquo;ll need the definite for <em>try-read</em>, which I&rsquo;ll get to in a moment) like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#a6e22e">with-input-from-string</span>
   <span style="color:#e6db74">&#34;Beth,12.75,0,mfg
</span><span style="color:#e6db74">   Dan,8.50,10,sales
</span><span style="color:#e6db74">   Kathy,11.40,30,sales
</span><span style="color:#e6db74">   Mark,12.75,40,mfg
</span><span style="color:#e6db74">   Mary,7.50,20,mfg
</span><span style="color:#e6db74">   Susie,10.30,25,acctg&#34;</span>
   read-csv)
<span style="color:#f92672">&#39;</span>((<span style="color:#a6e22e">Beth</span> <span style="color:#ae81ff">12.75</span> <span style="color:#ae81ff">0</span> mfg) (<span style="color:#a6e22e">Dan</span> <span style="color:#ae81ff">8.5</span> <span style="color:#ae81ff">10</span> sales)
  (<span style="color:#a6e22e">Kathy</span> <span style="color:#ae81ff">11.4</span> <span style="color:#ae81ff">30</span> sales) (<span style="color:#a6e22e">Mark</span> <span style="color:#ae81ff">12.75</span> <span style="color:#ae81ff">40</span> mfg)
  (<span style="color:#a6e22e">Mary</span> <span style="color:#ae81ff">7.5</span> <span style="color:#ae81ff">20</span> mfg) (<span style="color:#a6e22e">Susie</span> <span style="color:#ae81ff">10.3</span> <span style="color:#ae81ff">25</span> acctg))
</code></pre></div><p>Note how all of the names and positions were parsed as symbols. If you really wanted them as strings, you could just quote them:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#a6e22e">with-input-from-string</span>
   <span style="color:#e6db74">&#34;\&#34;Beth\&#34;,12.75,0,mfg&#34;</span>
   read-csv)
<span style="color:#f92672">&#39;</span>((<span style="color:#e6db74">&#34;Beth&#34;</span> <span style="color:#ae81ff">12.75</span> <span style="color:#ae81ff">0</span> mfg))
</code></pre></div><p>Now that I&rsquo;ve showed that off sufficiently, what black magic is going on in that <em>try-read</em> function? Remember, the goal is to try to read the input as a single Scheme object. If that fails (for any reason) or if there is more than one object, just fall back and return the original string.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; parse a block into a scheme object</span>
<span style="color:#75715e">; if that fails, just return the original string</span>
(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">try-read</span> block)
  (<span style="color:#a6e22e">with-handlers</span> ([exn? (<span style="color:#66d9ef">lambda </span>(<span style="color:#a6e22e">err</span>) block)])
    (<span style="color:#a6e22e">with-input-from-string</span>
     block
     (<span style="color:#66d9ef">lambda </span>()
       (<span style="color:#66d9ef">define </span>result (<span style="color:#a6e22e">read</span>))
       (<span style="color:#a6e22e">when</span> (not (eof-object? (<span style="color:#a6e22e">read</span>)))
         (<span style="color:#a6e22e">error</span> <span style="color:#e6db74">&#39;try-read</span> <span style="color:#e6db74">&#34;unfinished&#34;</span>))
       result))))
</code></pre></div><p>This is actually the first time I&rsquo;ve worked with Racket&rsquo;s <code><a href="http://docs.racket-lang.org/search/index.html?q=exceptions">exceptions</a></code>
 and I have to say, they&rsquo;re actually pretty nice to work with. Just add an exception predicate (I used <em>exn?</em> to catch all of them) and say what that should return.</p>
<p>The last bit there, with the <em>(when (not (eof-object? &hellip;)))</em> is to throw just such an exception if there&rsquo;s still more to read. I didn&rsquo;t have this originally, but that mean that something like this would happen:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#a6e22e">with-input-from-string</span>
   <span style="color:#e6db74">&#34;hello world&#34;</span>
   read-csv)
<span style="color:#f92672">&#39;</span>(hello)
</code></pre></div><p>With the added code, you get a string as expected:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#a6e22e">with-input-from-string</span>
   <span style="color:#e6db74">&#34;hello world&#34;</span>
   read-csv)
<span style="color:#f92672">&#39;</span>((<span style="color:#e6db74">&#34;hello world&#34;</span>))
</code></pre></div><p>So that&rsquo;s all we need to parse the CSV files. What about the second half of that <a href="http://programmingpraxis.com/2013/01/15/translate-csv-to-html/" title="Translate CSV to HTML">original question</a> though? We still need to output an HTML table!</p>
<p>Well, actually that&rsquo;s by far the easier part. Just use <em>for</em> loops around <em>printf</em> statements.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; write a list of lists to an html table</span>
(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">csv-&gt;html</span> csv)
  (<span style="color:#a6e22e">with-output-to-string</span>
   (<span style="color:#66d9ef">lambda </span>()
     (<span style="color:#a6e22e">printf</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>
| ~a |
|----|

</code></pre></div><p>Bam. Done.</p>
<p>And there you have it, the ability to read CSV files and write them back out as HTML tables. I think I may actually put this in to replace the (relatively new) <a href="http://blog.jverkamp.com/wombat-ide/c211-csv-api/" title="Wombat API: (c211 csv)">(c211 csv)</a> library in Wombat. It handles quoted strings much more nicely (or at all).</p>
<p>As a final aside, yes. I realize this could be written much more &lsquo;concisely&rsquo; if you remove the constraints on quoted items and trying to convert to Scheme objects:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#a6e22e">require</span> racket/string)

(<span style="color:#66d9ef">define </span>(<span style="color:#a6e22e">csv-&gt;html</span> csv)
  (<span style="color:#a6e22e">printf</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>
| ~s |
|----|

</code></pre></div><p>But where&rsquo;s the fun in that? ðŸ˜„</p>
<p>If you&rsquo;d like to download the full code for today&rsquo;s post, you can do so on GitHub: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/csv-to-html.rkt" title="GitHub: csv to html source">csv to html source</a></p></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
