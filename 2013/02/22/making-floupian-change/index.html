<!doctype html><html>
<head>
<title>Making Floupian Change â€“ jverkamp.com</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css integrity=sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous>
<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel=stylesheet>
<link rel=stylesheet href=/custom.css defer>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script>
</head>
<body>
<div id=wrapper><header id=page-header role=banner>
<h1><a href=/>JP's Blog</a></h1>
<ul id=page-header-links>
<li>
<a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a>
</li>
<li>
<form action=//www.google.com/search method=get onsubmit="(function(a){a.q.value='site:blog.jverkamp.com '+a.qfront.value})(this)" class="navbar-form navbar-right" role=search _lpchecked=1>
<div class=form-group>
<input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button>
</div>
</form>
</li>
</ul>
<nav id=header-navigation role=navigation class=ribbon>
<ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li>
</ul>
</nav>
</header>
<div id=page-content-wrapper>
<div id=page-content><article>
<header>
<h1 class=entry-title>Making Floupian Change</h1>
<div class=entry-meta><span class=entry-date>2013-02-22</span>
</div>
<div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li>
<a class=taxonomy-key href=/programming/languages/>Languages</a>
<ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/02/20/npr-sunday-puzzle/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2013/03/06/partitioning-the-dutch-national-flag/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2013/02/20/npr-sunday-puzzle/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2013/03/06/partitioning-the-dutch-national-flag/ class=next-link></a></li></ul>
</li><li>
<a class=taxonomy-key href=/programming/sources/>Sources</a>
<ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/02/20/npr-sunday-puzzle/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/programming-praxis>Programming Praxis</a><a href=https://blog.jverkamp.com/2013/03/06/partitioning-the-dutch-national-flag/ class=next-link></a></li></ul>
</li><li><a class=taxonomy-key href=/programming>programming</a>
<ul>
<li><a href=https://blog.jverkamp.com/2013/02/20/npr-sunday-puzzle/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2013/03/01/february-#1gam-post-mortem/ class=next-link>Next</a></ul>
</li><li><a class=taxonomy-key href=/>All Posts</a>
<ul>
<li><a href=https://blog.jverkamp.com/2013/02/20/npr-sunday-puzzle/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2013/02/27/warm-bodies/ class=next-link>Next</a></ul>
</li></ul>
</div>
</div>
</header>
<div class=entry-content><p>On the island of Floup in the South Pacific ((not a real place)), one might find coins worth 1, 3, 7, 31, or 153 floupia each. In addition, they have a most curious custom. Whenever one makes a payment of any sort, it is considered rude not to minimize the total number of coins involved in the exchange. For example, if someone were to purchase a nice refreshing beverage for 17 floupia ((the floupia is currently performing rather well against the dollar)), one might pay with three 7f coins and receive a 1f and a 3f coin in exchange for a total of 5 coins. But that would be terrible, as a more efficient solutions exists: pay a single 31f coin and receive two 7f coins as change.</p>
<p>Today&rsquo;s challenge on <a title=Floupia href=http://programmingpraxis.com/2013/02/22/floupia/>Programming Praxis</a> (a guest submission!) is to write a program that can make change in any situation, should you be visiting Floup or a Floupian traveling abroad. No matter the coinage, it should be possible to minimize the transaction.</p>
<p>To start, my goal is to make use of the functional programming model and write one function to set up a coin system which will in turn return the function that makes change. One could do much the same thing with an object oriented model. So the final structure we&rsquo;re looking at will be something like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=color:#75715e>; define a function that will accept payment from a list of coins</span>
(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-coinage</span> coins)
  <span style=color:#f92672>...</span>

  <span style=color:#75715e>; make a payment of a given value</span>
  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-payment</span> value)
    <span style=color:#f92672>...</span>)

  <span style=color:#75715e>; return the payment function</span>
  make-payment)
</code></pre></div><p>Optimally, this will allow us to run this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme>&gt; (<span style=color:#66d9ef>define </span>floupia (<span style=color:#a6e22e>make-coinage</span> <span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>153</span>)))
&gt; (<span style=color:#a6e22e>floupia</span> <span style=color:#ae81ff>17</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>31</span>) (<span style=color:#ae81ff>7</span> <span style=color:#ae81ff>7</span>))
</code></pre></div><p>So what do we need to write the internal <code>make-payment</code> function?</p>
<p>Well, my first thought was to start with the value we&rsquo;re trying to pay. Then, recursively try paying with each coin in turn until we&rsquo;ve paid the entire bill. Unfortunately, in this original plan, I neglected to take into account the fact that we need to minimize both the number of coins in the payment and in the change. That&rsquo;s okay though, the code was already getting ugly. ðŸ˜„</p>
<p>So for the second try, we&rsquo;re going to think about the problem the other way. Start by generating all possible combinations of <em>n</em> coins (starting with <em>(= n 1)</em>). For each combination, calculate each possible way to split the coins between the payment and change. For each split, check if the difference between the two is the target value. If so, the first solution we find is the minimal one (since we start with 1 coin and count up). It&rsquo;s terribly inefficient, but it&rsquo;s guaranteed to find a solution if one exists.</p>
<p>For that to work though, we need to be able to generate coin lists. So we need a helper function:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=color:#75715e>; generate all lists of n coins</span>
(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-coin-list</span> n-coins)
  (<span style=color:#a6e22e>cond</span>
    [(= n-coins <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&#39;</span>(())]
    [else
     (<span style=color:#a6e22e>for*/list</span> ([coin (<span style=color:#a6e22e>in-list</span> coins)]
                 [sublist (<span style=color:#a6e22e>in-list</span> (<span style=color:#a6e22e>make-coin-list</span> (- n-coins <span style=color:#ae81ff>1</span>)))])
       (cons coin sublist))]))
</code></pre></div><p>Simple enough. <code>for*/list</code> makes a set of nested loops that say for each possible new coin, add it to each (recursive) list of one less coin. Add in the base case of zero coins and we&rsquo;re good to go. ((Challenge: Returning <code>'()</code> in the base case doesn&rsquo;t work at all. Can you figure out what it would do and why (without running it)? ))</p>
<p>Now that we have that, we&rsquo;re ready to do the bulk of the problem:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=color:#75715e>; make a payment of a given value</span>
(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>make-payment</span> value)
  (call/cc 
   (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>return</span>)
     <span style=color:#75715e>; avoid staring contests</span>
     (<span style=color:#a6e22e>unless</span> (zero? (remainder value (apply gcd coins)))
       (<span style=color:#a6e22e>return</span> <span style=color:#66d9ef>#f</span>))

     <span style=color:#75715e>; loop up through possible numbers of coins</span>
     <span style=color:#75715e>; and each split within that of payment and change</span>
     (<span style=color:#a6e22e>for</span> ([n-coins (<span style=color:#a6e22e>in-naturals</span>)])
       (<span style=color:#a6e22e>for*</span> ([coin-list (<span style=color:#a6e22e>in-list</span> (<span style=color:#a6e22e>make-coin-list</span> n-coins))]
              [split-at (<span style=color:#a6e22e>in-range</span> (+ <span style=color:#ae81ff>1</span> (length coin-list)))])
         <span style=color:#75715e>; if we have a valid payment, this is a minimal solution</span>
         (<span style=color:#66d9ef>define </span>payment (<span style=color:#a6e22e>take</span> coin-list split-at))
         (<span style=color:#66d9ef>define </span>change (<span style=color:#a6e22e>drop</span> coin-list split-at))
         (<span style=color:#a6e22e>when</span> (= (- (apply + payment) value) (apply + change))
           (<span style=color:#a6e22e>return</span> (list payment change))))))))
</code></pre></div><p>It&rsquo;s a bit of a blog of code, but I think it all builds pretty naturally. The <code>call/cc</code> sets up a break points so we can return immediately when we find a solution. The outer loop counts upwards for the number of coins. The inner nested <code>for*</code> will try each coin list and for each list all possible splits. Then we pull apart the list and check if it&rsquo;s a valid solution. ((Challenge: Identify all of the relatively inefficient function calls in this code. There are at least half a dozen. ðŸ˜„))</p>
<p>Let&rsquo;s give it a few tries:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme>&gt; (<span style=color:#66d9ef>define </span>floupia (<span style=color:#a6e22e>make-coinage</span> <span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>153</span>)))
&gt; (<span style=color:#a6e22e>floupia</span> <span style=color:#ae81ff>17</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>31</span>) (<span style=color:#ae81ff>7</span> <span style=color:#ae81ff>7</span>))
&gt; (<span style=color:#a6e22e>floupia</span> <span style=color:#ae81ff>99</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>153</span>) (<span style=color:#ae81ff>31</span> <span style=color:#ae81ff>31</span>))
&gt; (<span style=color:#a6e22e>floupia</span> <span style=color:#ae81ff>57</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>31</span>) (<span style=color:#ae81ff>7</span>))
</code></pre></div><p>It also works perfectly well for non-floupian currency:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme>&gt; (<span style=color:#66d9ef>define </span>us (<span style=color:#a6e22e>make-coinage</span> <span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>25</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>100</span>)))
&gt; (<span style=color:#66d9ef>define </span>uk (<span style=color:#a6e22e>make-coinage</span> <span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>100</span> <span style=color:#ae81ff>200</span>)))
&gt; (<span style=color:#a6e22e>us</span> <span style=color:#ae81ff>119</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>10</span> <span style=color:#ae81ff>10</span> <span style=color:#ae81ff>100</span>) (<span style=color:#ae81ff>1</span>))
&gt; (<span style=color:#a6e22e>us</span> <span style=color:#ae81ff>123</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>25</span> <span style=color:#ae81ff>100</span>) (<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>))
&gt; (<span style=color:#a6e22e>uk</span> <span style=color:#ae81ff>119</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>20</span> <span style=color:#ae81ff>100</span>) (<span style=color:#ae81ff>1</span>))
&gt; (<span style=color:#a6e22e>uk</span> <span style=color:#ae81ff>123</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>100</span>) ())
</code></pre></div><p>Heck, if you wanted, you could even use <a href=https://en.wikipedia.org/wiki/Money%20in%20harry%20potter#Economy>Knuts, Sickles, and Galleons</a>!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme>&gt; (<span style=color:#66d9ef>define </span>harry-potter (<span style=color:#a6e22e>make-coinage</span> <span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>493</span>)))
&gt; (<span style=color:#a6e22e>harry-potter</span> <span style=color:#ae81ff>100</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>17</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>17</span> <span style=color:#ae81ff>17</span>) (<span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>))
</code></pre></div><p>So now you know, if you&rsquo;re every buying a 1000 Knut keepsake from a Floupian wizard, you should pay with 6 Sickles and expect 2 Knuts in return. ðŸ˜„</p>
<p>That&rsquo;s all there is. This was a really fun problem to work through. It&rsquo;s interesting when a problem makes you think through a relatively common situation (making change) in an uncommon way.</p>
<p>If you&rsquo;d like to see/download the entire source in one place, it&rsquo;s available on GitHub:</p>
<ul>
<li><a href=https://github.com/jpverkamp/small-projects/blob/master/blog/floupia.rkt title="Floupia source on GitHub">Floupia source</a></li>
</ul>
<p><strong>Edit:</strong> It turns out that there were two small(ish) problems with the code as posted.</p>
<p>First, as pointed out in the comments, there are some coin systems which would result in non-stable transactions. For example, if you had only 3c and 6c coins, how could you pay for an 11c item? It may be rude to involve more coins than absolutely necessary, but just imagine how rude it would be to stand there staring at one another&mldr; forever.</p>
<p>All you need to do is check the <code>gcd</code> though. If the <code>value</code> you&rsquo;re trying to make change for is not divisible by the <code>gcd</code> of the <code>coins</code>, then there&rsquo;s no valid solution. So just add this right inside of the <code>call/cc</code> (added above):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=color:#75715e>; avoid staring contests</span>
(<span style=color:#a6e22e>unless</span> (zero? (remainder value (apply gcd coins)))
  (<span style=color:#a6e22e>return</span> <span style=color:#66d9ef>#f</span>))
</code></pre></div><p>Now, if there&rsquo;s no solution you&rsquo;ll get <code>#f</code> back:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme>&gt; (<span style=color:#66d9ef>define </span>strangeness (<span style=color:#a6e22e>make-coinage</span> <span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>3</span> <span style=color:#ae81ff>6</span>)))
&gt; (<span style=color:#a6e22e>strangeness</span> <span style=color:#ae81ff>12</span>)
<span style=color:#f92672>&#39;</span>((<span style=color:#ae81ff>6</span> <span style=color:#ae81ff>6</span>) ())
&gt; (<span style=color:#a6e22e>strangeness</span> <span style=color:#ae81ff>11</span>)
<span style=color:#66d9ef>#f</span>
</code></pre></div><p>Second, we weren&rsquo;t actually checking all of the splits. I&rsquo;d forgotten one of the most basic rules: check your edge cases. It turned out that with the original code, the case where one could pay with exact change and get nothing in return was being ignored. So I&rsquo;ve added a <code>(+ 1 ...)</code> to the range check that will fix that. It slightly alters a few of the answers actually (and in one case finds a better one). There&rsquo;s something to be said for always calculating test cases by hand.</p></div>
</article></div>
</div><footer id=page-footer role=contentinfo>
<nav id=footer-navigation role=navigation class=ribbon>
<ul class=main-navigation>
<li><a href=/archive-by-date/>All posts: By Date</a></li>
<li><a href=/archive-by-tag/>All posts: By Tag</a></li>
<li>
<a href=/atom.xml>
RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
</sup>
</a>
</li><li>
<a href=/programming/atom.xml>
RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
</sup>
</a>
</li></ul>
</nav>
<div id=page-footer-content>
<div class=legal>
<p>
All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US>
<img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png>
</a>
</p>
<p>
Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a>
</p>
</div>
</div>
</footer>
</div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js integrity=sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin=anonymous></script>
<script src=/custom.js></script>
</body>
</html>