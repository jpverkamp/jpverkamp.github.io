<!doctype html><html><head><title>AoC 2025 Day 11: Graphinator – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.a8e11addf4349ee2ca5045f7f3cbf1febbf2c3a2840be2143ea69539c10f8c7f.js integrity="sha256-qOEa3fQ0nuLKUEX388vx/rvyw6KEC+IUPqaVOcEPjH8=" defer></script><script src=/katex_17296078054267651618.min.4a06464d8d6f8358d8896de62b53b5a89205d335dfd8c5b6b27edd7c039ae9d8.js integrity="sha256-SgZGTY1vg1jYiW3mK1O1qJIF0zXf2MW2sn7dfAOa6dg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.a17078917a4403310cd19178939257b706fb5e1da76167c9f4a6d2123c9d59c4.js integrity="sha256-oXB4kXpEAzEM0ZF4k5JXtwb7Xh2nYWfJ9KbSEjydWcQ=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.7420a1602c62a85d4b50881c1d8ce42f72c049dc2b097d440696425d6e54bb1e.css integrity="sha256-dCChYCxiqF1LUIgcHYzkL3LASdwrCX1EBpZCXW5Uux4="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.61064b3964637440ee1c28e577377fcf238ddc5939020ef8b3c3cae543898111.css integrity="sha256-YQZLOWRjdEDuHCjldzd/zyON3Fk5Ag74s8PK5UOJgRE="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>AoC 2025 Day 11: Graphinator</h1><div class=entry-meta><span class=entry-date>2025-12-11</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/10/aoc-2025-day-10-linear-algebranator/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/rust>Rust</a><a href=https://blog.jverkamp.com/2025/12/12/aoc-2025-day-12-knapsackinator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/10/aoc-2025-day-10-linear-algebranator/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2025/12/12/aoc-2025-day-12-knapsackinator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/10/aoc-2025-day-10-linear-algebranator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/memoization>Memoization</a><a href=https://blog.jverkamp.com/2025/12/12/aoc-2025-day-12-knapsackinator/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2025/12/03/aoc-2025-day-3-loopinator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/recursion>Recursion</a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/10/aoc-2025-day-10-linear-algebranator/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2025>Advent of Code 2025</a><a href=https://blog.jverkamp.com/2025/12/12/aoc-2025-day-12-knapsackinator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2025/12/10/aoc-2025-day-10-linear-algebranator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2025/12/12/aoc-2025-day-12-knapsackinator/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2025/12/10/aoc-2025-day-10-linear-algebranator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2025/12/12/aoc-2025-day-12-knapsackinator/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><h2 id=source-day-11-reactor>Source: <a href=https://adventofcode.com/2025/day/11 target=_blank rel=noopener>Day 11: Reactor</a></h2><p><a href=https://github.com/jpverkamp/advent-of-code/blob/master/2025/src/day11.rs target=_blank rel=noopener>Full solution</a> for today (spoilers!).</p><nav id=TableOfContents><ul><li><a href=#source-day-11-reactor>Source: Day 11: Reactor</a></li><li><a href=#part-1>Part 1</a></li><li><a href=#part-2>Part 2</a></li><li><a href=#benchmarks>Benchmarks</a></li></ul></nav><h2 id=part-1>Part 1</h2><blockquote><p>Given a <a href=https://en.wikipedia.org/wiki/directed%20graph>directed graph</a> defined where <code>aaa: you hhh</code> means <code>aaa</code> is connected to <code>you</code> and <code>hhh</code>, how many paths are there from <code>you</code> to <code>out</code>.</p></blockquote><p>Well, since we assume the number of paths is finite, I expect this is more like a tree than a graph. Or rather a <a href=https://en.wikipedia.org/wiki/directed%20acyclic%20graph>DAG</a>. </p><p>You can see this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ <span style=color:#f92672>(</span><span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>digraph {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    you [style=filled fillcolor=red]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    out [style=filled fillcolor=green]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;&amp;</span> cat input/2025/day11.txt | awk <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    key=$1;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sub(/:$/, &#34;&#34;, key);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    for (i=2; i&lt;=NF; i++)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        print key &#34; -&gt; &#34; $i 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;}&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#f92672>)</span> | dot -Tpng -o aoc2025_day11_part1.png
</span></span></code></pre></div><p><a href=/embeds/2025/aoc/aoc2025_day11_part1.png><img width=100% src=/embeds/2025/aoc/aoc2025_day11_part1.png></a></p><p>(Click for the full version)</p><p>It&rsquo;s not very pretty, but you can see the structure. You have a set of 6 tiers, each of which have a few (4-5) nodes in between that all paths cross through. But, <code>you</code> is right before the last tier, so we can just solve this recursively (and you can guess what part 2 will be &#x1f604;):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part1</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> outputs <span style=color:#f92672>=</span> HashMap::new();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#66d9ef>in</span> input.lines() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> (src, dsts) <span style=color:#f92672>=</span> line.split_once(<span style=color:#e6db74>&#34;: &#34;</span>).unwrap();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> dst <span style=color:#66d9ef>in</span> dsts.split_whitespace() {
</span></span><span style=display:flex><span>            outputs.entry(src).or_insert_with(Vec::new).push(dst);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Assuming no loops
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>paths</span>(outputs: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>HashMap</span><span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span>, Vec<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;&gt;</span>, src: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>, dst: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> src <span style=color:#f92672>==</span> dst {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> total <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(dsts) <span style=color:#f92672>=</span> outputs.get(src) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> next <span style=color:#66d9ef>in</span> dsts {
</span></span><span style=display:flex><span>                total <span style=color:#f92672>+=</span> paths(outputs, next, dst);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        total
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    paths(<span style=color:#f92672>&amp;</span>outputs, <span style=color:#e6db74>&#34;you&#34;</span>, <span style=color:#e6db74>&#34;out&#34;</span>).to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Which works well enough:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run-and-bench <span style=color:#ae81ff>11</span> part1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>796</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1: 143.184µs ± 77.932µs <span style=color:#f92672>[</span>min: 117.125µs, max: 868.583µs, median: 132.709µs<span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=part-2>Part 2</h2><blockquote><p>Go from <code>svr</code> to <code>out</code> and pass through both <code>dac</code> and <code>fft</code>.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ <span style=color:#f92672>(</span><span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>digraph {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    svr [style=filled fillcolor=red]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    dac [style=filled fillcolor=blue]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fft [style=filled fillcolor=blue]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    out [style=filled fillcolor=green]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;&amp;</span> cat input/2025/day11.txt | awk <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    key=$1;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    sub(/:$/, &#34;&#34;, key);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    for (i=2; i&lt;=NF; i++)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        print key &#34; -&gt; &#34; $i 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#39;}&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#f92672>)</span> | dot -Tpng -o aoc2025_day11_part2.png
</span></span></code></pre></div><p><a href=/embeds/2025/aoc/aoc2025_day11_part2.png><img width=100% src=/embeds/2025/aoc/aoc2025_day11_part2.png></a></p><p>Okay, so this time, we have to go through the whole thing. One thing that we know, because of the structure of the graph, is that at any particular point along the path, there are a <em>ton</em> of ways you could get from there to the end, so it&rsquo;s a perfect candidate for <a href=https://en.wikipedia.org/wiki/dynamic%20programming>dynamic programming</a> or <a href=https://en.wikipedia.org/wiki/memoization>memoization</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_memo</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> outputs <span style=color:#f92672>=</span> HashMap::new();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> ids <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec!</span>[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#66d9ef>in</span> input.lines() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> (src, dsts) <span style=color:#f92672>=</span> line.split_once(<span style=color:#e6db74>&#34;: &#34;</span>).unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>ids.contains(<span style=color:#f92672>&amp;</span>src) {
</span></span><span style=display:flex><span>            ids.push(src);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> src_id <span style=color:#f92672>=</span> ids.iter().position(<span style=color:#f92672>|&amp;</span>x<span style=color:#f92672>|</span> x <span style=color:#f92672>==</span> src).unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> dst <span style=color:#66d9ef>in</span> dsts.split_whitespace() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>ids.contains(<span style=color:#f92672>&amp;</span>dst) {
</span></span><span style=display:flex><span>                ids.push(dst);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> dst_id <span style=color:#f92672>=</span> ids.iter().position(<span style=color:#f92672>|&amp;</span>x<span style=color:#f92672>|</span> x <span style=color:#f92672>==</span> dst).unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            outputs.entry(src_id).or_insert_with(Vec::new).push(dst_id);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Still assuming no loops
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// This time, we have to go from src to dst and hit all of targets
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// We&#39;ll memoize on (src, dst, remaining targets)
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// In order to memoize and not deal with lifetimes, we&#39;ll use indices instead of &amp;strs
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>paths</span>(
</span></span><span style=display:flex><span>        outputs: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>HashMap</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span>, Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;&gt;</span>,
</span></span><span style=display:flex><span>        src: <span style=color:#66d9ef>usize</span>,
</span></span><span style=display:flex><span>        dst: <span style=color:#66d9ef>usize</span>,
</span></span><span style=display:flex><span>        targets: <span style=color:#66d9ef>&amp;</span>Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>        memo: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mut</span> HashMap<span style=color:#f92672>&lt;</span>(<span style=color:#66d9ef>usize</span>, <span style=color:#66d9ef>usize</span>, Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>), <span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>    ) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(<span style=color:#f92672>&amp;</span>cached) <span style=color:#f92672>=</span> memo.get(<span style=color:#f92672>&amp;</span>(src, dst, targets.clone())) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> cached;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// If we&#39;re at the dst, we&#39;re done either way
</span></span></span><span style=display:flex><span>        <span style=color:#75715e>// If we did visit all the targets, this is a valid path
</span></span></span><span style=display:flex><span>        <span style=color:#75715e>// If not, this is not a valid path, so recur up a zero!
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> src <span style=color:#f92672>==</span> dst {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> targets.is_empty() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Side path: if we&#39;re on a target node, remove it from targets
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> targets.contains(<span style=color:#f92672>&amp;</span>src) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> new_targets <span style=color:#f92672>=</span> targets.clone();
</span></span><span style=display:flex><span>            new_targets.retain(<span style=color:#f92672>|&amp;</span>x<span style=color:#f92672>|</span> x <span style=color:#f92672>!=</span> src);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> paths(outputs, src, dst, <span style=color:#f92672>&amp;</span>new_targets, memo);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Otherwise, recur
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> total <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(dsts) <span style=color:#f92672>=</span> outputs.get(<span style=color:#f92672>&amp;</span>src) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> next <span style=color:#66d9ef>in</span> dsts {
</span></span><span style=display:flex><span>                total <span style=color:#f92672>+=</span> paths(outputs, <span style=color:#f92672>*</span>next, dst, targets, memo);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        memo.insert((src, dst, targets.clone()), total);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        total
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> svr_id <span style=color:#f92672>=</span> ids.iter().position(<span style=color:#f92672>|&amp;</span>x<span style=color:#f92672>|</span> x <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;svr&#34;</span>).unwrap();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> out_id <span style=color:#f92672>=</span> ids.iter().position(<span style=color:#f92672>|&amp;</span>x<span style=color:#f92672>|</span> x <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;out&#34;</span>).unwrap();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> dac_id <span style=color:#f92672>=</span> ids.iter().position(<span style=color:#f92672>|&amp;</span>x<span style=color:#f92672>|</span> x <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;dac&#34;</span>).unwrap();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> fft_id <span style=color:#f92672>=</span> ids.iter().position(<span style=color:#f92672>|&amp;</span>x<span style=color:#f92672>|</span> x <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;fft&#34;</span>).unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    paths(
</span></span><span style=display:flex><span>        <span style=color:#f92672>&amp;</span>outputs,
</span></span><span style=display:flex><span>        svr_id,
</span></span><span style=display:flex><span>        out_id,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>vec!</span>[dac_id, fft_id],
</span></span><span style=display:flex><span>        <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> HashMap::new(),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    .to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>One change that I had to do here was to use <code>usize</code> for all of the IDs rather than <code>&amp;str</code>. This avoids allocating a bunch of <code>String</code> while at the same time, letting us have a pretty quick cache.</p><p>I did generalize for any number of <code>targets</code> rather than just 2, which I thought was neat. If you want it to run faster, a pair of <code>bool</code> variables for <code>has_seen_dac</code> etc would probably be faster.</p><p>But still:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>$</span> just run<span style=color:#f92672>-</span>and<span style=color:#f92672>-</span>bench <span style=color:#ae81ff>11</span> part2_memo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>294053029111296</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part2_memo: <span style=color:#ae81ff>4.288263</span>ms <span style=color:#960050;background-color:#1e0010>±</span> <span style=color:#ae81ff>144.887</span><span style=color:#960050;background-color:#1e0010>µ</span>s [min: <span style=color:#ae81ff>4.137417</span>ms, max: <span style=color:#ae81ff>4.72625</span>ms, median: <span style=color:#ae81ff>4.241917</span>ms]
</span></span></code></pre></div><h2 id=benchmarks>Benchmarks</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just bench <span style=color:#ae81ff>11</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1: 127.686µs ± 3.013µs <span style=color:#f92672>[</span>min: 121.542µs, max: 144.167µs, median: 127.334µs<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>part2_memo: 4.545146ms ± 78.356µs <span style=color:#f92672>[</span>min: 4.165917ms, max: 4.687ms, median: 4.563333ms<span style=color:#f92672>]</span>
</span></span></code></pre></div><table><thead><tr><th>Day</th><th>Part</th><th>Solution</th><th>Benchmark</th></tr></thead><tbody><tr><td>11</td><td>1</td><td><code>part1</code></td><td>127.686µs ± 3.013µs</td></tr><tr><td>11</td><td>2</td><td><code>part2_memo</code></td><td>4.545146ms ± 78.356µs</td></tr></tbody></table></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>