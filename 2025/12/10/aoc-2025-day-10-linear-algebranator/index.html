<!doctype html><html><head><title>AoC 2025 Day 10: Linear Algebranator – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.a8e11addf4349ee2ca5045f7f3cbf1febbf2c3a2840be2143ea69539c10f8c7f.js integrity="sha256-qOEa3fQ0nuLKUEX388vx/rvyw6KEC+IUPqaVOcEPjH8=" defer></script><script src=/katex_17296078054267651618.min.4a06464d8d6f8358d8896de62b53b5a89205d335dfd8c5b6b27edd7c039ae9d8.js integrity="sha256-SgZGTY1vg1jYiW3mK1O1qJIF0zXf2MW2sn7dfAOa6dg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.a17078917a4403310cd19178939257b706fb5e1da76167c9f4a6d2123c9d59c4.js integrity="sha256-oXB4kXpEAzEM0ZF4k5JXtwb7Xh2nYWfJ9KbSEjydWcQ=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.7420a1602c62a85d4b50881c1d8ce42f72c049dc2b097d440696425d6e54bb1e.css integrity="sha256-dCChYCxiqF1LUIgcHYzkL3LASdwrCX1EBpZCXW5Uux4="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.61064b3964637440ee1c28e577377fcf238ddc5939020ef8b3c3cae543898111.css integrity="sha256-YQZLOWRjdEDuHCjldzd/zyON3Fk5Ag74s8PK5UOJgRE="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>AoC 2025 Day 10: Linear Algebranator</h1><div class=entry-meta><span class=entry-date>2025-12-10</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/09/aoc-2025-day-9-polygoninator/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/rust>Rust</a><a href=https://blog.jverkamp.com/2025/12/11/aoc-2025-day-11-graphinator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/09/aoc-2025-day-9-polygoninator/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2025/12/11/aoc-2025-day-11-graphinator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/topics/bfs>BFS</a></li><li><a class=taxonomy-value href=/programming/topics/branch-and-bound>Branch and Bound</a></li><li><a href=https://blog.jverkamp.com/2025/12/08/aoc-2025-day-8-point-cloudinator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/combinatorics>Combinatorics</a></li><li><a class=taxonomy-value href=/programming/topics/integer-linear-programming>Integer Linear Programming</a></li><li><a href=https://blog.jverkamp.com/2024/12/23/aoc-2024-day-23-lan-partinator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/memoization>Memoization</a><a href=https://blog.jverkamp.com/2025/12/11/aoc-2025-day-11-graphinator/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2025/12/09/aoc-2025-day-9-polygoninator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/optimization>Optimization</a></li><li><a href=https://blog.jverkamp.com/2014/02/16/exploring-parallelism-in-racket-with-sha-512-mining/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/parallelism>Parallelism</a><a href=https://blog.jverkamp.com/2025/12/12/aoc-2025-day-12-knapsackinator/ class=next-link></a></li><li><a class=taxonomy-value href=/programming/topics/rayon>Rayon</a></li><li><a class=taxonomy-value href=/programming/topics/smt-solver>SMT Solver</a></li><li><a class=taxonomy-value href=/programming/topics/z3>Z3</a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/09/aoc-2025-day-9-polygoninator/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2025>Advent of Code 2025</a><a href=https://blog.jverkamp.com/2025/12/11/aoc-2025-day-11-graphinator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2025/12/09/aoc-2025-day-9-polygoninator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2025/12/11/aoc-2025-day-11-graphinator/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2025/12/09/aoc-2025-day-9-polygoninator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2025/12/11/aoc-2025-day-11-graphinator/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><h2 id=source-day-10-factory>Source: <a href=https://adventofcode.com/2025/day/10 target=_blank rel=noopener>Day 10: Factory</a></h2><p><a href=https://github.com/jpverkamp/advent-of-code/blob/master/2025/src/day10.rs target=_blank rel=noopener>Full solution</a> for today (spoilers!).</p><nav id=TableOfContents><ul><li><a href=#source-day-10-factory>Source: Day 10: Factory</a></li><li><a href=#part-1>Part 1</a></li><li><a href=#part-2>Part 2</a></li><li><a href=#part-2---a-system-of-equations-wip>Part 2 - A system of equations [WIP]</a></li><li><a href=#part-2---memoization>Part 2 - Memoization</a></li><li><a href=#part-2---add-branch-and-bound>Part 2 - Add branch and bound</a></li><li><a href=#part-2---just-use-z3>Part 2 - Just use z3</a></li><li><a href=#1211-part-2---equations-continued>[12/11] Part 2 - Equations continued</a></li><li><a href=#benchmarks>Benchmarks</a></li></ul></nav><h2 id=part-1>Part 1</h2><blockquote><p>Given a target light pattern <code>[.##.]</code> and a series of buttons (<code>(3) (1, 3) etc</code>) where the first button toggles light &lsquo;3&rsquo; (the 4th light) and the second toggles the first and 4th etc, what is the minimum number of buttons you need to press to match the light pattern.</p></blockquote><p>Okay, first: parsing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[derive(Debug)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Machine</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Cache the size of machine
</span></span></span><span style=display:flex><span>    size: <span style=color:#66d9ef>usize</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// The target states of lights, true means light should be turned on
</span></span></span><span style=display:flex><span>    lights: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>bool</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sets of buttons, each button toggles the given index of wires
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// So if buttons[0] is [3, 4, 5], button 0 will toggle 3, 4, and 5
</span></span></span><span style=display:flex><span>    buttons: Vec<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;&gt;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Target joltage requirements
</span></span></span><span style=display:flex><span>    joltage: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> From<span style=color:#f92672>&lt;&amp;</span><span style=color:#66d9ef>str</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>for</span> Machine {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>from</span>(value: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>Self</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> parts <span style=color:#f92672>=</span> value.split_ascii_whitespace().collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> light_part <span style=color:#f92672>=</span> parts[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> lights <span style=color:#f92672>=</span> light_part[<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span>light_part.len() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            .chars()
</span></span><span style=display:flex><span>            .map(<span style=color:#f92672>|</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;#&#39;</span>)
</span></span><span style=display:flex><span>            .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> size <span style=color:#f92672>=</span> lights.len();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> button_parts <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>parts[<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span>parts.len() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> buttons <span style=color:#f92672>=</span> button_parts
</span></span><span style=display:flex><span>            .iter()
</span></span><span style=display:flex><span>            .map(<span style=color:#f92672>|</span>button<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>                button[<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span>button.len() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>                    .split(<span style=color:#e6db74>&#39;,&#39;</span>)
</span></span><span style=display:flex><span>                    .map(<span style=color:#f92672>|</span>v<span style=color:#f92672>|</span> v.parse::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>().unwrap())
</span></span><span style=display:flex><span>                    .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>()
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>            .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> joltage_part <span style=color:#f92672>=</span> parts[parts.len() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> joltage <span style=color:#f92672>=</span> joltage_part[<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span>joltage_part.len() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            .split(<span style=color:#e6db74>&#39;,&#39;</span>)
</span></span><span style=display:flex><span>            .map(<span style=color:#f92672>|</span>v<span style=color:#f92672>|</span> v.parse::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>().unwrap())
</span></span><span style=display:flex><span>            .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Self {
</span></span><span style=display:flex><span>            size,
</span></span><span style=display:flex><span>            lights,
</span></span><span style=display:flex><span>            buttons,
</span></span><span style=display:flex><span>            joltage,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>Because none of the machines are running, the joltage requirements are irrelevant and can be safely ignored.</p></blockquote><p>Uh huh.</p><p>So this is actually a fairly straight forward <a href=https://en.wikipedia.org/wiki/depth-first%20search>depth-first search</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>impl</span> Machine {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>solve_lights</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> queue <span style=color:#f92672>=</span> VecDeque::new();
</span></span><span style=display:flex><span>        queue.push_back((<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>vec!</span>[<span style=color:#66d9ef>false</span>; self.size]));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>let</span> Some((presses, lights)) <span style=color:#f92672>=</span> queue.pop_front() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> button <span style=color:#66d9ef>in</span> self.buttons.iter() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> new_lights <span style=color:#f92672>=</span> lights
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .enumerate()
</span></span><span style=display:flex><span>                    .map(<span style=color:#f92672>|</span>(i, on)<span style=color:#f92672>|</span> <span style=color:#66d9ef>if</span> button.contains(<span style=color:#f92672>&amp;</span>i) { <span style=color:#f92672>!</span>on } <span style=color:#66d9ef>else</span> { <span style=color:#f92672>*</span>on })
</span></span><span style=display:flex><span>                    .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                queue.push_back((presses <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, new_lights));
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>unreachable!</span>(<span style=color:#e6db74>&#34;no solution found&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Start with <code>0</code> presses and no lights on, keep scanning until we found the pattern:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part1</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_lights())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>One trick I went ahead and did here (pulling in the <code><a href=https://docs.rs//latest//><code></code></a></code>
crate <em>gasp</em>), was to auto-parallelize it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part1_rayon</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .par_bridge()
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_lights())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So how does it run?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run-and-bench <span style=color:#ae81ff>10</span> part1 <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>452</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1: 1.212226433s ± 13.832532ms <span style=color:#f92672>[</span>min: 1.199442042s, max: 1.247776833s, median: 1.208264834s<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ just run-and-bench <span style=color:#ae81ff>10</span> part1_rayon <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>452</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1_rayon: 331.882295ms ± 5.14392ms <span style=color:#f92672>[</span>min: 324.905666ms, max: 342.0265ms, median: 331.103208ms<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>I &mldr; am not thrilled with this.</p><p>And feel like part 2 is going to be fun(tm).</p><h2 id=part-2>Part 2</h2><blockquote><p>Instead of lights, you have to hit the target joltages. So <code>(3)</code> increases the 4th <code>joltage</code> by 1 and <code>(1 3)</code> increments the 2nd and 4th. What is the minimum number of button presses to hit the target joltages.</p></blockquote><p>So it&rsquo;s the same program, just much bigger, right?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>impl</span> Machine {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>solve_joltage</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Working on {self:?}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> queue <span style=color:#f92672>=</span> VecDeque::new();
</span></span><span style=display:flex><span>        queue.push_back((<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>vec!</span>[<span style=color:#ae81ff>0</span>; self.size]));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>let</span> Some((presses, joltages)) <span style=color:#f92672>=</span> queue.pop_front() {
</span></span><span style=display:flex><span>            log::<span style=color:#a6e22e>debug!</span>(<span style=color:#e6db74>&#34;[{presses}, {}] {joltages:?}&#34;</span>, queue.len());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> joltages <span style=color:#f92672>==</span> self.joltage {
</span></span><span style=display:flex><span>                log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Found solution {presses}&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> presses;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> joltages
</span></span><span style=display:flex><span>                .iter()
</span></span><span style=display:flex><span>                .zip(self.joltage.iter())
</span></span><span style=display:flex><span>                .any(<span style=color:#f92672>|</span>(current, target)<span style=color:#f92672>|</span> current <span style=color:#f92672>&gt;</span> target)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                log::<span style=color:#a6e22e>debug!</span>(<span style=color:#e6db74>&#34;OVER JOLTAGE!&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> button <span style=color:#66d9ef>in</span> self.buttons.iter() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> new_joltages <span style=color:#f92672>=</span> joltages
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .enumerate()
</span></span><span style=display:flex><span>                    .map(<span style=color:#f92672>|</span>(i, v)<span style=color:#f92672>|</span> <span style=color:#66d9ef>if</span> button.contains(<span style=color:#f92672>&amp;</span>i) { v <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> } <span style=color:#66d9ef>else</span> { <span style=color:#f92672>*</span>v })
</span></span><span style=display:flex><span>                    .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                queue.push_back((presses <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, new_joltages));
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>unreachable!</span>(<span style=color:#e6db74>&#34;no solution found&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_joltage())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_rayon</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .par_bridge()
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_joltage())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Yeah&mldr; that&rsquo;s never going to finish.</p><h2 id=part-2---a-system-of-equations-wip>Part 2 - A system of equations [WIP]</h2><p>Here&rsquo;s a partial solution. The idea was that we have a system of equations. If we add and subtract a bunch of them, can we find any of the numbers that way?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>impl</span> Equation {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>negated</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#a6e22e>Self</span> {
</span></span><span style=display:flex><span>        Equation {
</span></span><span style=display:flex><span>            constant: <span style=color:#f92672>-</span>self.constant,
</span></span><span style=display:flex><span>            coefficients: <span style=color:#a6e22e>self</span>.coefficients.iter().map(<span style=color:#f92672>|&amp;</span>c<span style=color:#f92672>|</span> <span style=color:#f92672>-</span>c).collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>(),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>reduced</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#a6e22e>Self</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> gcd <span style=color:#f92672>=</span> self
</span></span><span style=display:flex><span>            .coefficients
</span></span><span style=display:flex><span>            .iter()
</span></span><span style=display:flex><span>            .cloned()
</span></span><span style=display:flex><span>            .filter(<span style=color:#f92672>|&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            .fold(<span style=color:#ae81ff>0</span>, num::integer::gcd);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> reduced <span style=color:#f92672>=</span> <span style=color:#66d9ef>if</span> gcd <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> gcd <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>            self.clone()
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            Equation {
</span></span><span style=display:flex><span>                constant: <span style=color:#a6e22e>self</span>.constant <span style=color:#f92672>/</span> gcd,
</span></span><span style=display:flex><span>                coefficients: <span style=color:#a6e22e>self</span>
</span></span><span style=display:flex><span>                    .coefficients
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .map(<span style=color:#f92672>|&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>/</span> gcd)
</span></span><span style=display:flex><span>                    .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>(),
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> reduced.constant <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>            reduced.negated()
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            reduced
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> std::fmt::Display <span style=color:#66d9ef>for</span> Equation {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>fmt</span>(<span style=color:#f92672>&amp;</span>self, f: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mut</span> std::fmt::Formatter<span style=color:#f92672>&lt;</span>&#39;_<span style=color:#f92672>&gt;</span>) -&gt; <span style=color:#a6e22e>std</span>::fmt::Result {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> terms: Vec<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> self
</span></span><span style=display:flex><span>            .coefficients
</span></span><span style=display:flex><span>            .iter()
</span></span><span style=display:flex><span>            .enumerate()
</span></span><span style=display:flex><span>            .filter(<span style=color:#f92672>|</span>(_, coef)<span style=color:#f92672>|</span> <span style=color:#f92672>**</span>coef <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            .map(<span style=color:#f92672>|</span>(i, <span style=color:#f92672>&amp;</span>coef)<span style=color:#f92672>|</span> <span style=color:#a6e22e>format!</span>(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{coef}</span><span style=color:#e6db74> * x</span><span style=color:#e6db74>{i}</span><span style=color:#e6db74>&#34;</span>))
</span></span><span style=display:flex><span>            .collect();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>write!</span>(f, <span style=color:#e6db74>&#34;{} = {}&#34;</span>, terms.join(<span style=color:#e6db74>&#34; + &#34;</span>), self.constant)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Machine {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>solve_joltage_eqn</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Working on {self:?}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> equations: <span style=color:#a6e22e>HashSet</span><span style=color:#f92672>&lt;</span>Equation<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> HashSet::new();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> idx <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>self.size {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> coefficients <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec!</span>[<span style=color:#ae81ff>0</span>; self.buttons.len()];
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (bi, button) <span style=color:#66d9ef>in</span> self.buttons.iter().enumerate() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> button.contains(<span style=color:#f92672>&amp;</span>idx) {
</span></span><span style=display:flex><span>                    coefficients[bi] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            equations.insert(Equation {
</span></span><span style=display:flex><span>                constant: <span style=color:#a6e22e>self</span>.joltage[idx] <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>isize</span>,
</span></span><span style=display:flex><span>                coefficients,
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> eq <span style=color:#66d9ef>in</span> <span style=color:#f92672>&amp;</span>equations {
</span></span><span style=display:flex><span>            log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Equation: {eq}&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> known_values <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec!</span>[None; self.buttons.len()];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> _i <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> _i <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>3</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>; <span style=color:#75715e>// DEBUG
</span></span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Expanding equations, iter=</span><span style=color:#e6db74>{_i}</span><span style=color:#e6db74>, count=</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, equations.len());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> initial_equations <span style=color:#f92672>=</span> equations.clone();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> initial_size <span style=color:#f92672>=</span> equations.len();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> eq1 <span style=color:#66d9ef>in</span> initial_equations.iter() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> eq2 <span style=color:#66d9ef>in</span> initial_equations.iter() {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> eq1 <span style=color:#f92672>!=</span> eq2 {
</span></span><span style=display:flex><span>                        equations.insert(eq1.clone() <span style=color:#f92672>+</span> eq2.clone());
</span></span><span style=display:flex><span>                        equations.insert(eq1.clone().negated() <span style=color:#f92672>+</span> eq2.clone());
</span></span><span style=display:flex><span>                        equations.insert(eq2.clone().negated() <span style=color:#f92672>+</span> eq1.clone());
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> equations.len() <span style=color:#f92672>==</span> initial_size {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Look for any single-variable equations
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> single_var_eqs: Vec<span style=color:#f92672>&lt;</span>Equation<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> equations
</span></span><span style=display:flex><span>                .iter()
</span></span><span style=display:flex><span>                .filter(<span style=color:#f92672>|</span>eq<span style=color:#f92672>|</span> eq.coefficients.iter().filter(<span style=color:#f92672>|&amp;&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>).count() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>                .cloned()
</span></span><span style=display:flex><span>                .collect();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Found </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> single-variable equations&#34;</span>, single_var_eqs.len());
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> eq <span style=color:#66d9ef>in</span> single_var_eqs.iter() {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;  </span><span style=color:#e6db74>{eq}</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Record known values
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> eq <span style=color:#66d9ef>in</span> single_var_eqs.iter() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> xi <span style=color:#f92672>=</span> eq
</span></span><span style=display:flex><span>                    .coefficients
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .position(<span style=color:#f92672>|&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                    .unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                known_values[xi] <span style=color:#f92672>=</span> Some(eq.constant <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Known values so far: </span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>, known_values);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Remove all equations that use only known values
</span></span></span><span style=display:flex><span>            equations <span style=color:#f92672>=</span> equations
</span></span><span style=display:flex><span>                .into_iter()
</span></span><span style=display:flex><span>                .filter(<span style=color:#f92672>|</span>eq<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>                    eq.coefficients
</span></span><span style=display:flex><span>                        .iter()
</span></span><span style=display:flex><span>                        .enumerate()
</span></span><span style=display:flex><span>                        .any(<span style=color:#f92672>|</span>(i, <span style=color:#f92672>&amp;</span>c)<span style=color:#f92672>|</span> c <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> known_values[i].is_none())
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>                .collect();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Look for any equations with exactly two values and constant = 0
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> two_var_zero_eqs: Vec<span style=color:#f92672>&lt;</span>Equation<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> equations
</span></span><span style=display:flex><span>                .iter()
</span></span><span style=display:flex><span>                .filter(<span style=color:#f92672>|</span>eq<span style=color:#f92672>|</span> eq.coefficients.iter().filter(<span style=color:#f92672>|&amp;&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>).count() <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>                .cloned()
</span></span><span style=display:flex><span>                .collect();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Found </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> two-variable&#34;</span>, two_var_zero_eqs.len());
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> eq <span style=color:#66d9ef>in</span> two_var_zero_eqs {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;  </span><span style=color:#e6db74>{eq}</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>panic!</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And running it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ head -n <span style=color:#ae81ff>1</span> input/2025/day10.txt | RUST_LOG<span style=color:#f92672>=</span>debug cargo run --release --bin day10 run part2_eqn -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Finished <span style=color:#e6db74>`</span>release<span style=color:#e6db74>`</span> profile <span style=color:#f92672>[</span>optimized<span style=color:#f92672>]</span> target<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> in 0.05s
</span></span><span style=display:flex><span>     Running <span style=color:#e6db74>`</span>target/release/day10 run part2_eqn -<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>false, true, true, true, false, true, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 4, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 4, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>29, 44, 42, 26, 66, 27, 30, 36<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Equation: <span style=color:#ae81ff>1</span> * x0 + <span style=color:#ae81ff>1</span> * x1 + <span style=color:#ae81ff>1</span> * x3 + <span style=color:#ae81ff>1</span> * x6 + <span style=color:#ae81ff>1</span> * x7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Equation: <span style=color:#ae81ff>1</span> * x0 + <span style=color:#ae81ff>1</span> * x1 + <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x3 + <span style=color:#ae81ff>1</span> * x4 + <span style=color:#ae81ff>1</span> * x5 + <span style=color:#ae81ff>1</span> * x6 + <span style=color:#ae81ff>1</span> * x7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Equation: <span style=color:#ae81ff>1</span> * x0 + <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x4 + <span style=color:#ae81ff>1</span> * x6 + <span style=color:#ae81ff>1</span> * x7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>36</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Equation: <span style=color:#ae81ff>1</span> * x0 + <span style=color:#ae81ff>1</span> * x3 + <span style=color:#ae81ff>1</span> * x5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>29</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Equation: <span style=color:#ae81ff>1</span> * x1 + <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x5 + <span style=color:#ae81ff>1</span> * x6 <span style=color:#f92672>=</span> <span style=color:#ae81ff>44</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Equation: <span style=color:#ae81ff>1</span> * x0 + <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x6 <span style=color:#f92672>=</span> <span style=color:#ae81ff>26</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Equation: <span style=color:#ae81ff>1</span> * x1 + <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x6 <span style=color:#f92672>=</span> <span style=color:#ae81ff>27</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:27:20Z INFO  day10<span style=color:#f92672>]</span> Equation: <span style=color:#ae81ff>1</span> * x0 + <span style=color:#ae81ff>1</span> * x1 + <span style=color:#ae81ff>1</span> * x5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>Expanding equations, iter<span style=color:#f92672>=</span>0, count<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>1</span> single-variable equations
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span>
</span></span><span style=display:flex><span>Known values so far: <span style=color:#f92672>[</span>None, None, None, None, None, Some<span style=color:#f92672>(</span>17<span style=color:#f92672>)</span>, None, None<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>3</span> two-variable
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x4 + <span style=color:#ae81ff>1</span> * x7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  -1 * x0 + <span style=color:#ae81ff>1</span> * x1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x1 + -1 * x3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Expanding equations, iter<span style=color:#f92672>=</span>1, count<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span>
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>2</span> single-variable equations
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x0 <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span>
</span></span><span style=display:flex><span>Known values so far: <span style=color:#f92672>[</span>Some<span style=color:#f92672>(</span>6<span style=color:#f92672>)</span>, None, None, None, None, Some<span style=color:#f92672>(</span>17<span style=color:#f92672>)</span>, None, None<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>13</span> two-variable
</span></span><span style=display:flex><span>  -1 * x0 + <span style=color:#ae81ff>1</span> * x3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x1 + <span style=color:#ae81ff>1</span> * x3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x1 + <span style=color:#ae81ff>1</span> * x5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>24</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x4 <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x0 + <span style=color:#ae81ff>1</span> * x3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x0 + -1 * x3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x0 + <span style=color:#ae81ff>1</span> * x1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>  -1 * x0 + <span style=color:#ae81ff>1</span> * x1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x1 + -1 * x3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span> * x3 + <span style=color:#ae81ff>1</span> * x5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>29</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x6 <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x4 + <span style=color:#ae81ff>1</span> * x7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span> * x1 + <span style=color:#ae81ff>1</span> * x5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>31</span>
</span></span><span style=display:flex><span>Expanding equations, iter<span style=color:#f92672>=</span>2, count<span style=color:#f92672>=</span><span style=color:#ae81ff>1481</span>
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>4</span> single-variable equations
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>17</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x0 <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>Known values so far: <span style=color:#f92672>[</span>Some<span style=color:#f92672>(</span>6<span style=color:#f92672>)</span>, Some<span style=color:#f92672>(</span>7<span style=color:#f92672>)</span>, None, Some<span style=color:#f92672>(</span>6<span style=color:#f92672>)</span>, None, Some<span style=color:#f92672>(</span>17<span style=color:#f92672>)</span>, None, None<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>5</span> two-variable
</span></span><span style=display:flex><span>  -1 * x2 + <span style=color:#ae81ff>1</span> * x7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x4 <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x2 + <span style=color:#ae81ff>1</span> * x6 <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>  -1 * x4 + <span style=color:#ae81ff>1</span> * x6 <span style=color:#f92672>=</span> <span style=color:#ae81ff>13</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span> * x4 + <span style=color:#ae81ff>1</span> * x7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>thread <span style=color:#e6db74>&#39;main&#39;</span> panicked at src/bin/day10.rs:449:9:
</span></span><span style=display:flex><span>explicit panic
</span></span><span style=display:flex><span>note: run with <span style=color:#e6db74>`</span>RUST_BACKTRACE<span style=color:#f92672>=</span>1<span style=color:#e6db74>`</span> environment variable to display a backtrace
</span></span><span style=display:flex><span>;_; code<span style=color:#f92672>=</span><span style=color:#ae81ff>101</span>
</span></span></code></pre></div><p>There&rsquo;s something there. Just by shoving equations around, we know:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>x0 = 6
</span></span><span style=display:flex><span>x1 = 7
</span></span><span style=display:flex><span>x3 = 6
</span></span><span style=display:flex><span>x5 = 17
</span></span></code></pre></div><p>And what&rsquo;s more, we have 5 equations that directly relate two variables, for example, we know:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>x2 + x4 = 7
</span></span><span style=display:flex><span>x2 + x6 = 20
</span></span></code></pre></div><p>I might have to come back to this one.</p><h2 id=part-2---memoization>Part 2 - Memoization</h2><p>Okay, let&rsquo;s go back to the original solution and apply another couple of tricks.</p><p>First: <a href=https://en.wikipedia.org/wiki/memoization>memoization</a>. Solve the problem recursively and every time we find the answer to a smaller part of the problem, write that down. Then build up increasingly large &lsquo;memoized&rsquo; answers until we have it all.</p><p>Second: Let&rsquo;s recur relatively intelligently. We know that there are a few joltage values that are only controller by a very few buttons. Let&rsquo;s solve those first, since they have the highest &lsquo;branching factor&rsquo; (in theory).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>impl</span> Machine {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>solve_joltage_memo</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Working on {self:?}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> memo <span style=color:#f92672>=</span> std::collections::HashMap::new();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> stats <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span><span style=color:#66d9ef>usize</span>, <span style=color:#ae81ff>0</span><span style=color:#66d9ef>usize</span>); <span style=color:#75715e>// (hits, misses)
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>helper</span>(
</span></span><span style=display:flex><span>            machine: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>Machine</span>,
</span></span><span style=display:flex><span>            current: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>            memo: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mut</span> std::collections::HashMap<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>, <span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>            stats: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mut</span> (<span style=color:#66d9ef>usize</span>, <span style=color:#66d9ef>usize</span>),
</span></span><span style=display:flex><span>        ) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(<span style=color:#f92672>&amp;</span>result) <span style=color:#f92672>=</span> memo.get(<span style=color:#f92672>&amp;</span>current) {
</span></span><span style=display:flex><span>                stats.<span style=color:#ae81ff>0</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                stats.<span style=color:#ae81ff>1</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> current <span style=color:#f92672>==</span> machine.joltage {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> min_presses <span style=color:#f92672>=</span> <span style=color:#66d9ef>usize</span>::<span style=color:#66d9ef>MAX</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Find the joltage that is impacted by the fewest buttons taking into account current state
</span></span></span><span style=display:flex><span>            <span style=color:#75715e>// Break ties by highest remaining joltage
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best_joltage_idx <span style=color:#f92672>=</span> None;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best_button_count <span style=color:#f92672>=</span> <span style=color:#66d9ef>usize</span>::<span style=color:#66d9ef>MAX</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best_remaining_joltage <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>usize</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> idx <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>machine.size {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Skip any joltages that are already at target
</span></span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> current[idx] <span style=color:#f92672>&gt;=</span> machine.joltage[idx] {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Count how many buttons contribute to this joltage
</span></span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> button_count <span style=color:#f92672>=</span> machine
</span></span><span style=display:flex><span>                    .buttons
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .filter(<span style=color:#f92672>|</span>button<span style=color:#f92672>|</span> button.contains(<span style=color:#f92672>&amp;</span>idx))
</span></span><span style=display:flex><span>                    .count();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> remaining_joltage <span style=color:#f92672>=</span> machine.joltage[idx] <span style=color:#f92672>-</span> current[idx];
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> button_count <span style=color:#f92672>&lt;</span> best_button_count
</span></span><span style=display:flex><span>                    <span style=color:#f92672>||</span> (button_count <span style=color:#f92672>==</span> best_button_count
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&amp;&amp;</span> remaining_joltage <span style=color:#f92672>&gt;</span> best_remaining_joltage)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    best_button_count <span style=color:#f92672>=</span> button_count;
</span></span><span style=display:flex><span>                    best_remaining_joltage <span style=color:#f92672>=</span> remaining_joltage;
</span></span><span style=display:flex><span>                    best_joltage_idx <span style=color:#f92672>=</span> Some(idx);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Try pressing each button that affects that joltage only
</span></span></span><span style=display:flex><span>            <span style=color:#75715e>// This is still guaranteed to eventually find an optimal solution since all joltages must jolt
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> button <span style=color:#66d9ef>in</span> machine.buttons.iter() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(joltage_idx) <span style=color:#f92672>=</span> best_joltage_idx
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>button.contains(<span style=color:#f92672>&amp;</span>joltage_idx)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> new_joltages <span style=color:#f92672>=</span> current
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .enumerate()
</span></span><span style=display:flex><span>                    .map(<span style=color:#f92672>|</span>(i, v)<span style=color:#f92672>|</span> <span style=color:#66d9ef>if</span> button.contains(<span style=color:#f92672>&amp;</span>i) { v <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> } <span style=color:#66d9ef>else</span> { <span style=color:#f92672>*</span>v })
</span></span><span style=display:flex><span>                    .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Don&#39;t recur into cases that put any joltage over joltage
</span></span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> new_joltages
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .zip(machine.joltage.iter())
</span></span><span style=display:flex><span>                    .any(<span style=color:#f92672>|</span>(current, target)<span style=color:#f92672>|</span> current <span style=color:#f92672>&gt;</span> target)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> recur_presses <span style=color:#f92672>=</span> helper(machine, new_joltages, memo, stats);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> recur_presses <span style=color:#f92672>!=</span> <span style=color:#66d9ef>usize</span>::<span style=color:#66d9ef>MAX</span> {
</span></span><span style=display:flex><span>                    min_presses <span style=color:#f92672>=</span> min_presses.min(recur_presses <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            memo.insert(current.clone(), min_presses);
</span></span><span style=display:flex><span>            min_presses
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> helper(self, <span style=color:#a6e22e>vec!</span>[<span style=color:#ae81ff>0</span>; self.size], <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> memo, <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> stats);
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Found solution: {result}&#34;</span>);
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Memo stats: hits={}, misses={}&#34;</span>, stats.<span style=color:#ae81ff>0</span>, stats.<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        result
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_memo</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_joltage_memo())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_memo_rayon</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .par_bridge()
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_joltage_memo())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So&mldr; how does it do?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ head -n <span style=color:#ae81ff>1</span> input/2025/day10.txt | time RUST_LOG<span style=color:#f92672>=</span>debug cargo run --release --bin day10 run part2_memo -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Finished <span style=color:#e6db74>`</span>release<span style=color:#e6db74>`</span> profile <span style=color:#f92672>[</span>optimized<span style=color:#f92672>]</span> target<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> in 0.05s
</span></span><span style=display:flex><span>     Running <span style=color:#e6db74>`</span>target/release/day10 run part2_memo -<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:30:58Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>false, true, true, true, false, true, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 4, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 4, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>29, 44, 42, 26, 66, 27, 30, 36<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:30:58Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:30:58Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>462347, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>258517</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span>RUST_LOG<span style=color:#f92672>=</span>debug cargo run --release --bin day10 run part2_memo -  0.20s user 0.04s system 95% cpu 0.249 total
</span></span></code></pre></div><p>You know&mldr; that isn&rsquo;t actually all that bad?</p><p>Unfortunately, it varies wildly when it comes to different problems:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/Projects/advent-of-code/2025 jp@venus <span style=color:#f92672>{</span>git master<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>$ head -n <span style=color:#ae81ff>2</span> input/2025/day10.txt | tail -n <span style=color:#ae81ff>1</span> | time RUST_LOG<span style=color:#f92672>=</span>debug cargo run --release --bin day10 run part2_memo -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Finished <span style=color:#e6db74>`</span>release<span style=color:#e6db74>`</span> profile <span style=color:#f92672>[</span>optimized<span style=color:#f92672>]</span> target<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> in 0.05s
</span></span><span style=display:flex><span>     Running <span style=color:#e6db74>`</span>target/release/day10 run part2_memo -<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:31:57Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>true, true, true, false, true, false, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>3, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 5, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4, 5, 6, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>214, 221, 33, 36, 226, 204, 203, 217<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>(It didn&rsquo;t finish even several minutes later, so I gave up.)</p><h2 id=part-2---add-branch-and-bound>Part 2 - Add branch and bound</h2><p>So <a href=https://en.wikipedia.org/wiki/branch%20and%20bound>branch and bound</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>impl</span> Machine {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>solve_joltage_branch_and_bound</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Working on {self:?}&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> start <span style=color:#f92672>=</span> std::time::Instant::now();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best_solution <span style=color:#f92672>=</span> <span style=color:#66d9ef>usize</span>::<span style=color:#66d9ef>MAX</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> memo <span style=color:#f92672>=</span> std::collections::HashMap::new();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> stats <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span><span style=color:#66d9ef>usize</span>, <span style=color:#ae81ff>0</span><span style=color:#66d9ef>usize</span>); <span style=color:#75715e>// (hits, misses)
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>branch_and_bound_recursive</span>(
</span></span><span style=display:flex><span>            machine: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>Machine</span>,
</span></span><span style=display:flex><span>            presses: <span style=color:#66d9ef>usize</span>,
</span></span><span style=display:flex><span>            joltages: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>            best_solution: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mut</span> <span style=color:#66d9ef>usize</span>,
</span></span><span style=display:flex><span>            memo: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mut</span> std::collections::HashMap<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>, Option<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;&gt;</span>,
</span></span><span style=display:flex><span>            stats: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mut</span> (<span style=color:#66d9ef>usize</span>, <span style=color:#66d9ef>usize</span>),
</span></span><span style=display:flex><span>        ) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Check memoization first
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(cached) <span style=color:#f92672>=</span> memo.get(<span style=color:#f92672>&amp;</span>joltages) {
</span></span><span style=display:flex><span>                stats.<span style=color:#ae81ff>0</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>match</span> cached {
</span></span><span style=display:flex><span>                    Some(min_remaining) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>let</span> total <span style=color:#f92672>=</span> presses <span style=color:#f92672>+</span> min_remaining;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> total <span style=color:#f92672>&lt;</span> <span style=color:#f92672>*</span>best_solution {
</span></span><span style=display:flex><span>                            <span style=color:#f92672>*</span>best_solution <span style=color:#f92672>=</span> total;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                    None <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                        <span style=color:#75715e>// State is infeasible
</span></span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            stats.<span style=color:#ae81ff>1</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Pruning: if current presses &gt;= best known solution, stop
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> presses <span style=color:#f92672>&gt;=</span> <span style=color:#f92672>*</span>best_solution {
</span></span><span style=display:flex><span>                memo.insert(joltages, None);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Check if we&#39;ve found a solution
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> joltages <span style=color:#f92672>==</span> machine.joltage {
</span></span><span style=display:flex><span>                <span style=color:#f92672>*</span>best_solution <span style=color:#f92672>=</span> (<span style=color:#f92672>*</span>best_solution).min(presses);
</span></span><span style=display:flex><span>                memo.insert(joltages, Some(<span style=color:#ae81ff>0</span>));
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Check if we&#39;ve exceeded the target (infeasible)
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> joltages
</span></span><span style=display:flex><span>                .iter()
</span></span><span style=display:flex><span>                .zip(machine.joltage.iter())
</span></span><span style=display:flex><span>                .any(<span style=color:#f92672>|</span>(current, target)<span style=color:#f92672>|</span> current <span style=color:#f92672>&gt;</span> target)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                memo.insert(joltages, None);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Estimate lower bound for remaining presses
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> remaining <span style=color:#f92672>=</span> machine
</span></span><span style=display:flex><span>                .joltage
</span></span><span style=display:flex><span>                .iter()
</span></span><span style=display:flex><span>                .zip(joltages.iter())
</span></span><span style=display:flex><span>                .map(<span style=color:#f92672>|</span>(target, current)<span style=color:#f92672>|</span> target.saturating_sub(<span style=color:#f92672>*</span>current))
</span></span><span style=display:flex><span>                .max()
</span></span><span style=display:flex><span>                .unwrap_or(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Pruning: if lower bound + current presses &gt;= best solution, stop
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> presses <span style=color:#f92672>+</span> remaining <span style=color:#f92672>&gt;=</span> <span style=color:#f92672>*</span>best_solution {
</span></span><span style=display:flex><span>                memo.insert(joltages, None);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Find the joltage with fewest buttons affecting it (and still needs to reach target)
</span></span></span><span style=display:flex><span>            <span style=color:#75715e>// This optimization significantly reduces the search space
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best_joltage_idx <span style=color:#f92672>=</span> None;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best_button_count <span style=color:#f92672>=</span> <span style=color:#66d9ef>usize</span>::<span style=color:#66d9ef>MAX</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best_remaining_joltage <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>usize</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> idx <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>machine.size {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Skip any joltages that are already at target
</span></span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> joltages[idx] <span style=color:#f92672>&gt;=</span> machine.joltage[idx] {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Count how many buttons contribute to this joltage
</span></span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> button_count <span style=color:#f92672>=</span> machine
</span></span><span style=display:flex><span>                    .buttons
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .filter(<span style=color:#f92672>|</span>button<span style=color:#f92672>|</span> button.contains(<span style=color:#f92672>&amp;</span>idx))
</span></span><span style=display:flex><span>                    .count();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> remaining_joltage <span style=color:#f92672>=</span> machine.joltage[idx] <span style=color:#f92672>-</span> joltages[idx];
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> button_count <span style=color:#f92672>&lt;</span> best_button_count
</span></span><span style=display:flex><span>                    <span style=color:#f92672>||</span> (button_count <span style=color:#f92672>==</span> best_button_count
</span></span><span style=display:flex><span>                        <span style=color:#f92672>&amp;&amp;</span> remaining_joltage <span style=color:#f92672>&gt;</span> best_remaining_joltage)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    best_button_count <span style=color:#f92672>=</span> button_count;
</span></span><span style=display:flex><span>                    best_remaining_joltage <span style=color:#f92672>=</span> remaining_joltage;
</span></span><span style=display:flex><span>                    best_joltage_idx <span style=color:#f92672>=</span> Some(idx);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> min_remaining_presses <span style=color:#f92672>=</span> <span style=color:#66d9ef>usize</span>::<span style=color:#66d9ef>MAX</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Try pressing each button that affects the chosen joltage
</span></span></span><span style=display:flex><span>            <span style=color:#75715e>// This constrains the search to only promising branches
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> button <span style=color:#66d9ef>in</span> machine.buttons.iter() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(joltage_idx) <span style=color:#f92672>=</span> best_joltage_idx
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>button.contains(<span style=color:#f92672>&amp;</span>joltage_idx)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> new_joltages <span style=color:#f92672>=</span> joltages
</span></span><span style=display:flex><span>                    .iter()
</span></span><span style=display:flex><span>                    .enumerate()
</span></span><span style=display:flex><span>                    .map(<span style=color:#f92672>|</span>(i, v)<span style=color:#f92672>|</span> <span style=color:#66d9ef>if</span> button.contains(<span style=color:#f92672>&amp;</span>i) { v <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> } <span style=color:#66d9ef>else</span> { <span style=color:#f92672>*</span>v })
</span></span><span style=display:flex><span>                    .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> initial_best <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>best_solution;
</span></span><span style=display:flex><span>                branch_and_bound_recursive(
</span></span><span style=display:flex><span>                    machine,
</span></span><span style=display:flex><span>                    presses <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                    new_joltages,
</span></span><span style=display:flex><span>                    best_solution,
</span></span><span style=display:flex><span>                    memo,
</span></span><span style=display:flex><span>                    stats,
</span></span><span style=display:flex><span>                );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Track minimum remaining presses from this state
</span></span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span>best_solution <span style=color:#f92672>!=</span> initial_best {
</span></span><span style=display:flex><span>                    min_remaining_presses <span style=color:#f92672>=</span> min_remaining_presses.min(<span style=color:#f92672>*</span>best_solution <span style=color:#f92672>-</span> presses <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Memoize the minimum remaining presses from this state
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> min_remaining_presses <span style=color:#f92672>!=</span> <span style=color:#66d9ef>usize</span>::<span style=color:#66d9ef>MAX</span> {
</span></span><span style=display:flex><span>                memo.insert(joltages, Some(min_remaining_presses));
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                memo.insert(joltages, None);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        branch_and_bound_recursive(
</span></span><span style=display:flex><span>            self,
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>vec!</span>[<span style=color:#ae81ff>0</span>; self.size],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> best_solution,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> memo,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> stats,
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Found solution: {best_solution}&#34;</span>);
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Memo stats: hits={}, misses={}&#34;</span>, stats.<span style=color:#ae81ff>0</span>, stats.<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Elapsed time: {:.2?}&#34;</span>, start.elapsed());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> best_solution <span style=color:#f92672>==</span> <span style=color:#66d9ef>usize</span>::<span style=color:#66d9ef>MAX</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>unreachable!</span>(<span style=color:#e6db74>&#34;no solution found&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        best_solution
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_branch_and_bound</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_joltage_branch_and_bound())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_branch_and_bound_rayon</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> count <span style=color:#f92672>=</span> input.lines().count();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> finished <span style=color:#f92672>=</span> Arc::new(Mutex::new(<span style=color:#ae81ff>0</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> start <span style=color:#f92672>=</span> std::time::Instant::now();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .par_bridge()
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> m.solve_joltage_branch_and_bound();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> finished <span style=color:#f92672>=</span> finished.lock().unwrap();
</span></span><span style=display:flex><span>            <span style=color:#f92672>*</span>finished <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            log::<span style=color:#a6e22e>info!</span>(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;Completed {}/{} machines after {:.2?}&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>*</span>finished,
</span></span><span style=display:flex><span>                count,
</span></span><span style=display:flex><span>                start.elapsed()
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            result
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>That&rsquo;s getting to be an awful lot of code.</p><p>This one is the most successful I&rsquo;ve had so far though.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/Projects/advent-of-code/2025 jp@venus <span style=color:#f92672>{</span>git master<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>$ RUST_LOG<span style=color:#f92672>=</span>info just run <span style=color:#ae81ff>10</span> part2_branch_and_bound_rayon
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>false, true, true, true, false, true, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 4, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 4, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>29, 44, 42, 26, 66, 27, 30, 36<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>true, true, true, false, true, false, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>3, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 5, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4, 5, 6, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>214, 221, 33, 36, 226, 204, 203, 217<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>true, true, false, true, false, true, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 4, 5, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3, 4, 5, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 5, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 4, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4, 6, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>68, 52, 32, 65, 52, 36, 65, 88<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>false, true, false, true, false, false, false, true, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 4, 5, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 5, 6, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 5, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 4, 6, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 5, 6, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 5, 9<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>68, 64, 220, 49, 46, 43, 59, 35, 36, 57<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 7, lights: <span style=color:#f92672>[</span>true, true, false, true, false, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>5<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>26, 16, 194, 197, 13, 205, 13<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>false, true, true, false, false, false, false, false, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 4, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 6, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 4, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 6, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 4, 5, 6, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 4, 6, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 5, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 6, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 6, 7, 8, 9<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>12, 56, 55, 72, 88, 16, 88, 57, 85, 79<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 5, lights: <span style=color:#f92672>[</span>true, false, false, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>27, 21, 43, 41, 6<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 5, lights: <span style=color:#f92672>[</span>true, false, true, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>4, 29, 25, 14, 25<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>43</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>3, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>191</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 47.33µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 1/172 machines after 495.88µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>29</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>0, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>55</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 46.96µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 2/172 machines after 511.38µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 5, lights: <span style=color:#f92672>[</span>false, false, true, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 4<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>15, 32, 19, 17, 21<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 6, lights: <span style=color:#f92672>[</span>false, true, false, true, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>42, 46, 35, 25, 35, 32<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 5, lights: <span style=color:#f92672>[</span>true, true, false, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>141, 151, 155, 18, 151<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 7, lights: <span style=color:#f92672>[</span>false, false, true, true, false, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 2, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 5<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>34, 37, 14, 35, 29, 64, 55<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>155</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>0, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>311</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 112.33µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 3/172 machines after 770.63µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 6, lights: <span style=color:#f92672>[</span>true, false, true, false, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>53, 66, 23, 56, 32, 52<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>205</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>958, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>1626</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 480.58µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>true, false, false, false, false, true, true, false, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>5, 6, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 5, 6, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 5, 6, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 5, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 5, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 4, 5, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 5, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4, 5, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 5, 6, 7, 8<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>49, 233, 86, 233, 57, 297, 253, 271, 72, 271<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 4/172 machines after 896.63µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 4, lights: <span style=color:#f92672>[</span>true, true, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>40, 15, 38, 38<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>53</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>27, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>181</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 26.54µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 5/172 machines after 937.71µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 5, lights: <span style=color:#f92672>[</span>false, true, false, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>30, 21, 12, 30, 15<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>33</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>0, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>55</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 11.92µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 6/172 machines after 959.17µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 5, lights: <span style=color:#f92672>[</span>true, true, true, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>24, 12, 4, 30, 9<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>47</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>1238, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>1681</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 400.25µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>107, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 70.92µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 7/172 machines after 1.04ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 7, lights: <span style=color:#f92672>[</span>false, false, true, false, true, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 4<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>45, 16, 57, 23, 49, 23, 43<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 8/172 machines after 1.05ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 6, lights: <span style=color:#f92672>[</span>false, false, false, true, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>1, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 5<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>36, 11, 27, 29, 27, 37<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>46</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>758, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>1763</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 731.42µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 9/172 machines after 1.43ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 6, lights: <span style=color:#f92672>[</span>false, false, true, true, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 3, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 5<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>67, 69, 19, 60, 37, 51<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>true, true, false, true, true, false, false, true, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>3, 5, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 5, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 5, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 4, 5, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 4, 5, 6, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>5, 6, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>55, 54, 73, 53, 39, 97, 75, 73, 75, 37<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>37</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>2636, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>3538</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 2.72ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 10/172 machines after 3.91ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>false, true, false, false, false, true, true, false, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 2, 5, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 5, 6, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 6, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 4, 7, 8<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>39, 69, 24, 40, 20, 11, 6, 28, 62, 36<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>76</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>75, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>402</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 104.88µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 11/172 machines after 4.04ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>false, false, false, true, true, true, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4, 5, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 6, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>56, 33, 48, 55, 29, 11, 63, 18<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>5808, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>7417</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 4.41ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 12/172 machines after 5.64ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 5, lights: <span style=color:#f92672>[</span>false, true, false, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>1, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>23, 28, 26, 33, 26<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>7146, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>19282</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 6.77ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>37</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>9575, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>10767</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 3.53ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 13/172 machines after 9.85ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 7, lights: <span style=color:#f92672>[</span>true, true, true, false, true, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4, 5, 6<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>39, 14, 23, 178, 208, 197, 208<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>97</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>7795, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>21797</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 6.92ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 14/172 machines after 10.83ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 7, lights: <span style=color:#f92672>[</span>true, false, true, true, true, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>1, 2, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 6<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>151, 134, 151, 33, 11, 11, 134<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 15/172 machines after 11.53ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>false, false, false, false, false, false, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 2, 4, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 6<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>91, 80, 63, 32, 60, 42, 50, 65<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>209</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>3807, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>4862</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 8.39ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>47887, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>33096</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 17.85ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 16/172 machines after 18.99ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 9, lights: <span style=color:#f92672>[</span>false, false, true, true, false, true, false, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 6, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>5, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 4, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 5, 6, 8<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>67, 79, 51, 89, 68, 93, 75, 87, 72<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 17/172 machines after 21.90ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 4, lights: <span style=color:#f92672>[</span>true, true, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>19, 7, 12, 12<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>31</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>49, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>107</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 21.33µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 18/172 machines after 21.94ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 5, lights: <span style=color:#f92672>[</span>false, true, false, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 4<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>29, 25, 205, 214, 208<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>229</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>5369, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>6296</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 1.33ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 19/172 machines after 23.37ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 9, lights: <span style=color:#f92672>[</span>true, true, true, false, true, false, true, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 2, 5, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4, 5, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 5, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3, 4, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 5<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>71, 35, 55, 65, 65, 78, 52, 52, 57<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>59116, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>47414</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 20.99ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 20/172 machines after 28.07ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>false, false, false, false, false, true, true, false, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 2, 3, 4, 5, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4, 5, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 6, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>5, 6, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 6, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 6, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 5, 6, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 5, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 5, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 5, 6, 8<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>48, 77, 30, 85, 62, 82, 99, 11, 99, 107<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>162</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>26488, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>57440</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 21.73ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 21/172 machines after 34.41ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>false, true, true, true, false, false, true, true, false, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>1, 2, 3, 4, 5, 6, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 5, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 4, 5, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 5, 6, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 5, 6, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3, 6, 8, 9<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>46, 82, 72, 101, 68, 70, 60, 45, 62, 95<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>237547, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>155579</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 117.22ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Completed 22/172 machines after 124.06ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:36Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 7, lights: <span style=color:#f92672>[</span>true, true, false, true, false, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>3, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3, 4, 5, 6<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>74, 33, 19, 53, 45, 43, 16<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:37Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>86</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:37Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>1162560, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>1268171</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:37Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 717.54ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:37Z INFO  day10<span style=color:#f92672>]</span> Completed 23/172 machines after 813.30ms
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:37Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>false, false, false, false, false, true, true, false, true, true<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4, 5, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3, 4, 5, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 4, 5, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 5, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3, 4, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 6<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>31, 52, 39, 48, 64, 34, 53, 33, 55, 15<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>91</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>1920758, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>2301548</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 1.73s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>74</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>1558944, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>2743455</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 1.75s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Completed 24/172 machines after 1.92s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>false, true, true, false, false, true, true, true, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 3, 4, 6, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 5, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 3, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 5, 6, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 6, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 6, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 4, 5, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>6, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>61, 32, 27, 62, 56, 32, 35, 41, 36, 52<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Completed 25/172 machines after 2.15s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:38Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>true, false, false, false, false, false, false, false, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>1, 3, 4, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 4, 5, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 5, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>3, 6, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 6, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 4, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>5, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>6<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>36, 70, 32, 60, 49, 33, 64, 58, 35, 45<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>88</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>1715277, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>5244782</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 3.48s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Completed 26/172 machines after 3.91s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 6, lights: <span style=color:#f92672>[</span>true, false, false, true, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 5<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>13, 42, 20, 0, 33, 9<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>0, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>76</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 17.13µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Completed 27/172 machines after 3.91s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 6, lights: <span style=color:#f92672>[</span>true, true, true, false, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 1, 2<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 5<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>199, 238, 232, 27, 12, 38<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>238</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Memo stats: hits<span style=color:#f92672>=</span>26, misses<span style=color:#f92672>=</span><span style=color:#ae81ff>445</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Elapsed time: 74.29µs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Completed 28/172 machines after 3.91s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:33:40Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 10, lights: <span style=color:#f92672>[</span>false, true, false, false, true, false, false, false, true, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>1, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 2, 3, 4, 7, 8<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 5, 6, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 3, 4, 5, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 5, 6, 7, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 5, 7, 8, 9<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 3, 4, 6, 8<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>24, 64, 85, 71, 35, 52, 39, 83, 58, 76<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Letting that run for more than an hour, it managed to get through some 120 of them. There are still ones that even this isn&rsquo;t managing to solve. And, given that I <em>know</em> how to solve this one quickly if I just give up and use an external program&mldr;</p><h2 id=part-2---just-use-z3>Part 2 - Just use z3</h2><p>Okay. Let&rsquo;s just give up and use <a href=https://github.com/Z3Prover/z3 target=_blank rel=noopener>z3</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>impl</span> Machine {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>solve_joltage_z3</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>usize</span> {
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Working on {self:?}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> buffer <span style=color:#f92672>=</span> String::new();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        buffer.push_str(<span style=color:#e6db74>&#34;(set-option :produce-models true)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>        buffer.push_str(<span style=color:#e6db74>&#34;(set-logic QF_LIA)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Our variables are how many times each button is pressed
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>self.buttons.len() {
</span></span><span style=display:flex><span>            buffer.push_str(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>format!</span>(<span style=color:#e6db74>&#34;(declare-const p</span><span style=color:#e6db74>{i}</span><span style=color:#e6db74> Int)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>));
</span></span><span style=display:flex><span>            buffer.push_str(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>format!</span>(<span style=color:#e6db74>&#34;(assert (&gt;= p</span><span style=color:#e6db74>{i}</span><span style=color:#e6db74> 0))</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Each joltage has to end up exactly matching pi * if button[i] contains it
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> idx <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>self.size {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> terms: Vec<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec!</span>[];
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (bi, button) <span style=color:#66d9ef>in</span> self.buttons.iter().enumerate() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> button.contains(<span style=color:#f92672>&amp;</span>idx) {
</span></span><span style=display:flex><span>                    terms.push(<span style=color:#a6e22e>format!</span>(<span style=color:#e6db74>&#34;p</span><span style=color:#e6db74>{bi}</span><span style=color:#e6db74>&#34;</span>));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> sum <span style=color:#f92672>=</span> <span style=color:#66d9ef>if</span> terms.is_empty() {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;0&#34;</span>.to_string()
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>format!</span>(<span style=color:#e6db74>&#34;(+ </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>)&#34;</span>, terms.join(<span style=color:#e6db74>&#34; &#34;</span>))
</span></span><span style=display:flex><span>            };
</span></span><span style=display:flex><span>            buffer.push_str(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>format!</span>(<span style=color:#e6db74>&#34;(assert (= </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>))</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, sum, self.joltage[idx]));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Our objective is to minimize the total presses
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> total <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>self.buttons.len())
</span></span><span style=display:flex><span>            .map(<span style=color:#f92672>|</span>i<span style=color:#f92672>|</span> <span style=color:#a6e22e>format!</span>(<span style=color:#e6db74>&#34;p</span><span style=color:#e6db74>{i}</span><span style=color:#e6db74>&#34;</span>))
</span></span><span style=display:flex><span>            .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>()
</span></span><span style=display:flex><span>            .join(<span style=color:#e6db74>&#34; &#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        buffer.push_str(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>format!</span>(<span style=color:#e6db74>&#34;(minimize (+ </span><span style=color:#e6db74>{total}</span><span style=color:#e6db74>))</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        buffer.push_str(<span style=color:#e6db74>&#34;(check-sat)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>        buffer.push_str(<span style=color:#e6db74>&#34;(get-model)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>debug!</span>(<span style=color:#e6db74>&#34;Z3 input:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{buffer}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> f <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> f <span style=color:#f92672>=</span> NamedTempFile::new().expect(<span style=color:#e6db74>&#34;failed to create temp file for z3&#34;</span>);
</span></span><span style=display:flex><span>            f.write_all(buffer.as_bytes())
</span></span><span style=display:flex><span>                .expect(<span style=color:#e6db74>&#34;failed to write z3 input to temp file&#34;</span>);
</span></span><span style=display:flex><span>            f
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Now call Z3 on it
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> output <span style=color:#f92672>=</span> std::process::Command::new(<span style=color:#e6db74>&#34;z3&#34;</span>)
</span></span><span style=display:flex><span>            .arg(f.path().to_str().unwrap())
</span></span><span style=display:flex><span>            .output()
</span></span><span style=display:flex><span>            .expect(<span style=color:#e6db74>&#34;failed to execute z3&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Parse output
</span></span></span><span style=display:flex><span>        <span style=color:#75715e>// sat
</span></span></span><span style=display:flex><span>        <span style=color:#75715e>// (
</span></span></span><span style=display:flex><span>        <span style=color:#75715e>//   (define-fun p5 () Int
</span></span></span><span style=display:flex><span>        <span style=color:#75715e>//     0)
</span></span></span><span style=display:flex><span>        <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> stdout <span style=color:#f92672>=</span> String::from_utf8_lossy(<span style=color:#f92672>&amp;</span>output.stdout);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> total_presses <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>debug!</span>(<span style=color:#e6db74>&#34;Z3 output:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>{stdout}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> lines <span style=color:#f92672>=</span> stdout.lines();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>let</span> Some(line) <span style=color:#f92672>=</span> lines.next() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> line.contains(<span style=color:#e6db74>&#34;(define-fun&#34;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> next_line <span style=color:#f92672>=</span> lines.next().unwrap();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> presses: <span style=color:#66d9ef>usize</span> <span style=color:#f92672>=</span> next_line
</span></span><span style=display:flex><span>                    .trim()
</span></span><span style=display:flex><span>                    .trim_end_matches(<span style=color:#e6db74>&#39;)&#39;</span>)
</span></span><span style=display:flex><span>                    .parse()
</span></span><span style=display:flex><span>                    .expect(<span style=color:#e6db74>&#34;failed to parse presses&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                total_presses <span style=color:#f92672>+=</span> presses;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;Found solution: {total_presses}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        total_presses
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_z3</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_joltage_z3())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_z3_rayon</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    input
</span></span><span style=display:flex><span>        .lines()
</span></span><span style=display:flex><span>        .map(Machine::from)
</span></span><span style=display:flex><span>        .par_bridge()
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>m<span style=color:#f92672>|</span> m.solve_joltage_z3())
</span></span><span style=display:flex><span>        .sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So basically this is just formulating this as a series of constraints, like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ head -n <span style=color:#ae81ff>1</span> input/2025/day10.txt | RUST_LOG<span style=color:#f92672>=</span>debug cargo run --release --bin day10 run part2_z3 -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Finished <span style=color:#e6db74>`</span>release<span style=color:#e6db74>`</span> profile <span style=color:#f92672>[</span>optimized<span style=color:#f92672>]</span> target<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> in 0.04s
</span></span><span style=display:flex><span>     Running <span style=color:#e6db74>`</span>target/release/day10 run part2_z3 -<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:11:48Z INFO  day10<span style=color:#f92672>]</span> Working on Machine <span style=color:#f92672>{</span> size: 8, lights: <span style=color:#f92672>[</span>false, true, true, true, false, true, false, false<span style=color:#f92672>]</span>, buttons: <span style=color:#f92672>[[</span>0, 2, 3, 4, 6, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 4, 5, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 2, 4<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>4, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>0, 1, 4, 6<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>1, 2, 3, 4, 5, 7<span style=color:#f92672>]</span>, <span style=color:#f92672>[</span>2, 4, 7<span style=color:#f92672>]]</span>, joltage: <span style=color:#f92672>[</span>29, 44, 42, 26, 66, 27, 30, 36<span style=color:#f92672>]</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:11:48Z DEBUG day10<span style=color:#f92672>]</span> Z3 input:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>set-option :produce-models true<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>set-logic QF_LIA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>declare-const p0 Int<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(</span>&gt;<span style=color:#f92672>=</span> p0 0<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>declare-const p1 Int<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(</span>&gt;<span style=color:#f92672>=</span> p1 0<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>declare-const p2 Int<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(</span>&gt;<span style=color:#f92672>=</span> p2 0<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>declare-const p3 Int<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(</span>&gt;<span style=color:#f92672>=</span> p3 0<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>declare-const p4 Int<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(</span>&gt;<span style=color:#f92672>=</span> p4 0<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>declare-const p5 Int<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(</span>&gt;<span style=color:#f92672>=</span> p5 0<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>declare-const p6 Int<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(</span>&gt;<span style=color:#f92672>=</span> p6 0<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>declare-const p7 Int<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(</span>&gt;<span style=color:#f92672>=</span> p7 0<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(=</span> <span style=color:#f92672>(</span>+ p0 p3 p5<span style=color:#f92672>)</span> 29<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(=</span> <span style=color:#f92672>(</span>+ p1 p2 p5 p6<span style=color:#f92672>)</span> 44<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(=</span> <span style=color:#f92672>(</span>+ p0 p1 p3 p6 p7<span style=color:#f92672>)</span> 42<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(=</span> <span style=color:#f92672>(</span>+ p0 p2 p6<span style=color:#f92672>)</span> 26<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(=</span> <span style=color:#f92672>(</span>+ p0 p1 p2 p3 p4 p5 p6 p7<span style=color:#f92672>)</span> 66<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(=</span> <span style=color:#f92672>(</span>+ p1 p2 p6<span style=color:#f92672>)</span> 27<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(=</span> <span style=color:#f92672>(</span>+ p0 p1 p5<span style=color:#f92672>)</span> 30<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>assert <span style=color:#f92672>(=</span> <span style=color:#f92672>(</span>+ p0 p2 p4 p6 p7<span style=color:#f92672>)</span> 36<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>minimize <span style=color:#f92672>(</span>+ p0 p1 p2 p3 p4 p5 p6 p7<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>check-sat<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>get-model<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:11:48Z DEBUG day10<span style=color:#f92672>]</span> Z3 output:
</span></span><span style=display:flex><span>    sat
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>define-fun p2 <span style=color:#f92672>()</span> Int
</span></span><span style=display:flex><span>        0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>define-fun p6 <span style=color:#f92672>()</span> Int
</span></span><span style=display:flex><span>        20<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>define-fun p3 <span style=color:#f92672>()</span> Int
</span></span><span style=display:flex><span>        6<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>define-fun p7 <span style=color:#f92672>()</span> Int
</span></span><span style=display:flex><span>        3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>define-fun p4 <span style=color:#f92672>()</span> Int
</span></span><span style=display:flex><span>        7<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>define-fun p0 <span style=color:#f92672>()</span> Int
</span></span><span style=display:flex><span>        6<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>define-fun p1 <span style=color:#f92672>()</span> Int
</span></span><span style=display:flex><span>        7<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>(</span>define-fun p5 <span style=color:#f92672>()</span> Int
</span></span><span style=display:flex><span>        17<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-12-11T05:11:48Z INFO  day10<span style=color:#f92672>]</span> Found solution: <span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>66</span>
</span></span></code></pre></div><p>Each <code>p0</code>, <code>p1</code>, &mldr; is how many &lsquo;presses&rsquo; we are making, so they&rsquo;re each <code>>= 0</code>. Then for each target joltage, we sum the presses that contribute towards that value. THen finally, minimize the sum.</p><p>That&rsquo;s&mldr; it?</p><p>And it&rsquo;s even faster than part 1:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run-and-bench <span style=color:#ae81ff>10</span> part2_z3_rayon <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>17424</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part2_z3_rayon: 129.899304ms ± 2.541906ms <span style=color:#f92672>[</span>min: 125.474959ms, max: 133.146667ms, median: 131.154084ms<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>That is just not that satisfying.</p><h2 id=1211-part-2---equations-continued>[12/11] Part 2 - Equations continued</h2><p>And so we go down the rabbit hole.</p><p>So this is basically the continuation of yesterdays work with <a href=#edit-part-2---equations-continued>equations</a>. Basically:</p><ol><li><p>For each machine, generate a set of equations of the form</p><p>$$c_1 p_1 + c_2 p_2 + &mldr; = C$$</p></li><li><p>Several time, expand those equations by adding each set of equations pairwise</p></li><li><p>Any time we end up with an expression exactly like</p></li></ol><p>$$c_1 p_1 = C$$</p><p>We know that $$p_1 = \frac{C}{c_1}$$.</p><ol start=4><li><p>Any time we have all positive or negative values on an equation, it gives an upper bound</p><p>So for the above equation (if all coefficients are positive), we know that</p><p>$$p_1 \le \frac{C}{c_1}$$</p></li><li><p>Start the solver as we did before, except:</p></li><li><p>Any time we have a known value (from step 3), immediately assign that value</p></li><li><p>Any time we have <em>any</em> equation where all but one <code>c_n</code> is known, assign that last value</p></li><li><p>Iterate each remaining value recursively starting with the lowest bounds</p></li></ol><p>So in parts, first we create the equations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> equations: <span style=color:#a6e22e>HashSet</span><span style=color:#f92672>&lt;</span>Equation<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> HashSet::new();
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> idx <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>self.size {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> coefficients <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec!</span>[<span style=color:#ae81ff>0</span>; self.buttons.len()];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (bi, button) <span style=color:#66d9ef>in</span> self.buttons.iter().enumerate() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> button.contains(<span style=color:#f92672>&amp;</span>idx) {
</span></span><span style=display:flex><span>            coefficients[bi] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    equations.insert(Equation {
</span></span><span style=display:flex><span>        constant: <span style=color:#a6e22e>self</span>.joltage[idx] <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>isize</span>,
</span></span><span style=display:flex><span>        coefficients,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then we expand that list, setting bounds:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>for</span> _i <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span><span style=color:#ae81ff>3</span> {
</span></span><span style=display:flex><span>    tracing::<span style=color:#a6e22e>info!</span>(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;[{machine_id}] Expanding equations, iter={_i}, count={}&#34;</span>,
</span></span><span style=display:flex><span>        equations.len()
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> initial_equations <span style=color:#f92672>=</span> equations.clone();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> initial_size <span style=color:#f92672>=</span> equations.len();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> eq1 <span style=color:#66d9ef>in</span> initial_equations.iter() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> eq2 <span style=color:#66d9ef>in</span> initial_equations.iter() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> eq1 <span style=color:#f92672>!=</span> eq2 {
</span></span><span style=display:flex><span>                equations.insert(eq1.clone() <span style=color:#f92672>+</span> eq2.clone());
</span></span><span style=display:flex><span>                equations.insert(eq1.clone().negated() <span style=color:#f92672>+</span> eq2.clone());
</span></span><span style=display:flex><span>                equations.insert(eq2.clone().negated() <span style=color:#f92672>+</span> eq1.clone());
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> equations.len() <span style=color:#f92672>==</span> initial_size {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Look for any single-variable equations
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> single_var_eqs: Vec<span style=color:#f92672>&lt;</span>Equation<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> equations
</span></span><span style=display:flex><span>        .iter()
</span></span><span style=display:flex><span>        .filter(<span style=color:#f92672>|</span>eq<span style=color:#f92672>|</span> eq.coefficients.iter().filter(<span style=color:#f92672>|&amp;&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>).count() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        .cloned()
</span></span><span style=display:flex><span>        .collect();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    tracing::<span style=color:#a6e22e>info!</span>(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;[{machine_id}] Found {} single-variable equations&#34;</span>,
</span></span><span style=display:flex><span>        single_var_eqs.len()
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> eq <span style=color:#66d9ef>in</span> single_var_eqs.iter() {
</span></span><span style=display:flex><span>        tracing::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;  {eq}&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Record known values
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> eq <span style=color:#66d9ef>in</span> single_var_eqs.iter() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> xi <span style=color:#f92672>=</span> eq.coefficients.iter().position(<span style=color:#f92672>|&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>).unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>assert!</span>(eq.constant <span style=color:#f92672>%</span> eq.coefficients[xi] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        bounds[xi] <span style=color:#f92672>=</span> Bound::Known(eq.constant <span style=color:#f92672>/</span> eq.coefficients[xi]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    tracing::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;[{machine_id}] Known values so far: {bounds:?}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Apply known values to all equations
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> known_values <span style=color:#f92672>=</span> bounds
</span></span><span style=display:flex><span>        .iter()
</span></span><span style=display:flex><span>        .map(<span style=color:#f92672>|</span>b<span style=color:#f92672>|</span> <span style=color:#66d9ef>match</span> b {
</span></span><span style=display:flex><span>            Bound::Known(v) <span style=color:#f92672>=&gt;</span> Some(<span style=color:#f92672>*</span>v <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>),
</span></span><span style=display:flex><span>            _ <span style=color:#f92672>=&gt;</span> None,
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> updated_equations: <span style=color:#a6e22e>HashSet</span><span style=color:#f92672>&lt;</span>Equation<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>        equations.iter().map(<span style=color:#f92672>|</span>eq<span style=color:#f92672>|</span> eq.apply(<span style=color:#f92672>&amp;</span>known_values)).collect();
</span></span><span style=display:flex><span>    equations <span style=color:#f92672>=</span> updated_equations;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// For any equation with only positive co-efficients, we can set bounds
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// Assume that we put as much as possible into each variable for bound
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> eq <span style=color:#66d9ef>in</span> equations.iter() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// All negative is all positive, just... opposite!
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> eq <span style=color:#f92672>=</span> <span style=color:#66d9ef>if</span> eq.coefficients.iter().all(<span style=color:#f92672>|&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            eq.negated()
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            eq.clone()
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>eq.coefficients.iter().all(<span style=color:#f92672>|&amp;</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> eq.constant <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (i, coef) <span style=color:#66d9ef>in</span> eq.coefficients.iter().enumerate() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span>coef <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> max_times <span style=color:#f92672>=</span> eq.constant <span style=color:#f92672>/</span> <span style=color:#f92672>*</span>coef;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>match</span> <span style=color:#f92672>&amp;</span>bounds[i] {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Previously unknown bounds now have a maximum value
</span></span></span><span style=display:flex><span>                Bound::Unknown <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                    bounds[i] <span style=color:#f92672>=</span> Bound::Bounded(<span style=color:#ae81ff>0</span>, max_times);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#75715e>// If this sets a better upper bound, yay?
</span></span></span><span style=display:flex><span>                Bound::Bounded(l, u) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span>u <span style=color:#f92672>&gt;</span> max_times {
</span></span><span style=display:flex><span>                        bounds[i] <span style=color:#f92672>=</span> Bound::Bounded(<span style=color:#f92672>*</span>l, max_times);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Known bounds don&#39;t need to change
</span></span></span><span style=display:flex><span>                <span style=color:#75715e>// Hopefully this doesn&#39;t prove our bounds are wrong :smile:
</span></span></span><span style=display:flex><span>                Bound::Known(_) <span style=color:#f92672>=&gt;</span> {}
</span></span><span style=display:flex><span>            };
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Remove all equations that still depend on known variables
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// Because of the apply step above, these should be zeroed out
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> filtered_equations: <span style=color:#a6e22e>HashSet</span><span style=color:#f92672>&lt;</span>Equation<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> equations
</span></span><span style=display:flex><span>        .iter()
</span></span><span style=display:flex><span>        .filter(<span style=color:#f92672>|</span>eq<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>            eq.coefficients
</span></span><span style=display:flex><span>                .iter()
</span></span><span style=display:flex><span>                .enumerate()
</span></span><span style=display:flex><span>                .all(<span style=color:#f92672>|</span>(i, <span style=color:#f92672>&amp;</span>c)<span style=color:#f92672>|</span> <span style=color:#f92672>!</span>(c <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>matches!</span>(bounds[i], Bound::Known(_))))
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .cloned()
</span></span><span style=display:flex><span>        .collect();
</span></span><span style=display:flex><span>    equations <span style=color:#f92672>=</span> filtered_equations;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then we have our recursive solver:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[tracing::instrument(skip(machine, bounds, equations))]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>helper</span>(
</span></span><span style=display:flex><span>    machine: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>Machine</span>,
</span></span><span style=display:flex><span>    presses: <span style=color:#66d9ef>&amp;</span>Vec<span style=color:#f92672>&lt;</span>Option<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;&gt;</span>,
</span></span><span style=display:flex><span>    bounds: <span style=color:#66d9ef>&amp;</span>Vec<span style=color:#f92672>&lt;</span>Bound<span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>    equations: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>HashSet</span><span style=color:#f92672>&lt;</span>Equation<span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>) -&gt; Option<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> machine_id <span style=color:#f92672>=</span> machine.id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If the currently known presses make for an impossible voltage, fail
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// If we went beyond the bounds without finding an answer, fail
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> current <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec!</span>[<span style=color:#ae81ff>0</span>; machine.size];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (press, button) <span style=color:#66d9ef>in</span> presses.iter().zip(machine.buttons.iter()) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Some(p) <span style=color:#f92672>=</span> press {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> b <span style=color:#66d9ef>in</span> button {
</span></span><span style=display:flex><span>                current[<span style=color:#f92672>*</span>b] <span style=color:#f92672>+=</span> p;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    log::<span style=color:#a6e22e>debug!</span>(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;[{machine_id}] helper({presses:?}) =&gt; {current:?} vs {:?}&#34;</span>,
</span></span><span style=display:flex><span>        machine.joltage
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If we have exactly the right current, this is the correct solution
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> current <span style=color:#f92672>==</span> machine.joltage {
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>debug!</span>(<span style=color:#e6db74>&#34;[{machine_id}] Found an answer!: {presses:?}&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> press_total <span style=color:#f92672>=</span> presses.iter().map(<span style=color:#f92672>|</span>v<span style=color:#f92672>|</span> v.unwrap_or(<span style=color:#ae81ff>0</span>)).sum::<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Some(press_total);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> current
</span></span><span style=display:flex><span>        .iter()
</span></span><span style=display:flex><span>        .zip(machine.joltage.iter())
</span></span><span style=display:flex><span>        .any(<span style=color:#f92672>|</span>(c, j)<span style=color:#f92672>|</span> c <span style=color:#f92672>&gt;</span> j)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>debug!</span>(<span style=color:#e6db74>&#34;[{machine_id}] OVER JOLTAGE&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> None;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If we made it this far and all presses are set, this solution is under joltage
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> presses.iter().all(<span style=color:#f92672>|</span>f<span style=color:#f92672>|</span> f.is_some()) {
</span></span><span style=display:flex><span>        log::<span style=color:#a6e22e>debug!</span>(<span style=color:#e6db74>&#34;[{machine_id}] under joltage :(&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> None;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If we have any equation where all but 1 variable is known, we can set the last one
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> eq <span style=color:#66d9ef>in</span> equations.iter() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> unknown_vars: Vec<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>usize</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> eq
</span></span><span style=display:flex><span>            .coefficients
</span></span><span style=display:flex><span>            .iter()
</span></span><span style=display:flex><span>            .enumerate()
</span></span><span style=display:flex><span>            .filter(<span style=color:#f92672>|</span>(i, _)<span style=color:#f92672>|</span> presses[<span style=color:#f92672>*</span>i].is_none() <span style=color:#f92672>&amp;&amp;</span> eq.coefficients[<span style=color:#f92672>*</span>i] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            .map(<span style=color:#f92672>|</span>(i, _)<span style=color:#f92672>|</span> i)
</span></span><span style=display:flex><span>            .collect();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> unknown_vars.len() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> xi <span style=color:#f92672>=</span> unknown_vars[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> sum_known <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>isize</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (i, <span style=color:#f92672>&amp;</span>coef) <span style=color:#66d9ef>in</span> eq.coefficients.iter().enumerate() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> i <span style=color:#f92672>!=</span> xi
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>let</span> Some(p) <span style=color:#f92672>=</span> presses[i] {
</span></span><span style=display:flex><span>                        sum_known <span style=color:#f92672>+=</span> coef <span style=color:#f92672>*</span> (p <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>isize</span>);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> required_xi <span style=color:#f92672>=</span> (eq.constant <span style=color:#f92672>-</span> sum_known) <span style=color:#f92672>/</span> eq.coefficients[xi];
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> required_xi <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>                log::<span style=color:#a6e22e>debug!</span>(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;[{machine_id}] Negative press violation on equation {eq} with {presses:?}&#34;</span>
</span></span><span style=display:flex><span>                );
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> None;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> new_presses <span style=color:#f92672>=</span> presses.clone();
</span></span><span style=display:flex><span>            new_presses[xi] <span style=color:#f92672>=</span> Some(required_xi <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>);
</span></span><span style=display:flex><span>            log::<span style=color:#a6e22e>debug!</span>(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;[{machine_id}] Applying equation {eq}, {presses:?} =&gt; {new_presses:?}&#34;</span>
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> helper(
</span></span><span style=display:flex><span>                machine,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&amp;</span>new_presses,
</span></span><span style=display:flex><span>                bounds,
</span></span><span style=display:flex><span>                equations,
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// The current index is the unset press with the lowest range
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> current_idx <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best_size <span style=color:#f92672>=</span> <span style=color:#66d9ef>isize</span>::<span style=color:#66d9ef>MAX</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (i, p) <span style=color:#66d9ef>in</span> presses.iter().enumerate() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> p.is_some() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> range_size <span style=color:#f92672>=</span> <span style=color:#66d9ef>match</span> bounds[i] {
</span></span><span style=display:flex><span>            Bound::Unknown <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>isize</span>::<span style=color:#66d9ef>MAX</span>,
</span></span><span style=display:flex><span>            Bound::Bounded(lo, hi) <span style=color:#f92672>=&gt;</span> hi <span style=color:#f92672>-</span> lo <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            Bound::Known(_) <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> range_size <span style=color:#f92672>&lt;</span> best_size {
</span></span><span style=display:flex><span>            current_idx <span style=color:#f92672>=</span> i;
</span></span><span style=display:flex><span>            best_size <span style=color:#f92672>=</span> range_size;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    tracing::<span style=color:#a6e22e>debug!</span>(<span style=color:#e6db74>&#34;[{machine_id}] Selected {current_idx} as the next index&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Test each value at the current idx, finding the best recursive answer
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> best <span style=color:#f92672>=</span> None;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> bounds[current_idx] {
</span></span><span style=display:flex><span>        Bound::Unknown <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Not sure how I can end up here, but it&#39;s possible?
</span></span></span><span style=display:flex><span>            <span style=color:#75715e>// Hopefully we&#39;ll eventually find an answer
</span></span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> value <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> next_presses <span style=color:#f92672>=</span> presses.clone();
</span></span><span style=display:flex><span>                next_presses[current_idx] <span style=color:#f92672>=</span> Some(value <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> helper(
</span></span><span style=display:flex><span>                    machine,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&amp;</span>next_presses,
</span></span><span style=display:flex><span>                    bounds,
</span></span><span style=display:flex><span>                    equations,
</span></span><span style=display:flex><span>                );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> best.is_none() {
</span></span><span style=display:flex><span>                    best <span style=color:#f92672>=</span> result;
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> result.is_some() {
</span></span><span style=display:flex><span>                    best <span style=color:#f92672>=</span> Some(best.unwrap().min(result.unwrap()));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Bound::Bounded(lo, hi) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> value <span style=color:#66d9ef>in</span> lo<span style=color:#f92672>..=</span>hi {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> next_presses <span style=color:#f92672>=</span> presses.clone();
</span></span><span style=display:flex><span>                next_presses[current_idx] <span style=color:#f92672>=</span> Some(value <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> helper(
</span></span><span style=display:flex><span>                    machine,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&amp;</span>next_presses,
</span></span><span style=display:flex><span>                    bounds,
</span></span><span style=display:flex><span>                    equations,
</span></span><span style=display:flex><span>                );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> best.is_none() {
</span></span><span style=display:flex><span>                    best <span style=color:#f92672>=</span> result;
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> result.is_some() {
</span></span><span style=display:flex><span>                    best <span style=color:#f92672>=</span> Some(best.unwrap().min(result.unwrap()));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Bound::Known(v) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> next_presses <span style=color:#f92672>=</span> presses.clone();
</span></span><span style=display:flex><span>            next_presses[current_idx] <span style=color:#f92672>=</span> Some(v <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>);
</span></span><span style=display:flex><span>            best <span style=color:#f92672>=</span> helper(
</span></span><span style=display:flex><span>                machine,
</span></span><span style=display:flex><span>                <span style=color:#f92672>&amp;</span>next_presses,
</span></span><span style=display:flex><span>                bounds,
</span></span><span style=display:flex><span>                equations,
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    best
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>which we can kick off easy enough:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span>tracing::<span style=color:#a6e22e>info!</span>(<span style=color:#e6db74>&#34;[{machine_id}] Starting recursive search&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> result <span style=color:#f92672>=</span> helper(
</span></span><span style=display:flex><span>    self,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>vec!</span>[None; self.buttons.len()],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>bounds,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>equations,
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>And&mldr; it works!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$ cargo run --release --bin day10 -- run part2_eqn_rayon input/2025/day10.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>17424
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cargo run --release --bin day10 -- bench part2_eqn_rayon --warmup 0 --iters 1 input/2025/day10.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part2_eqn_rayon: 79.115645459s ± 0ns [min: 79.115645459s, max: 79.115645459s, median: 79.115645459s]
</span></span></code></pre></div><p>Digging into the debugging a bit more (it&rsquo;s fun to watch), the longest machine in my input was line 97 (zero based) taking 65.22s. There were fewer than the number of cores I had machines that took more than a minute, so the parallelization really worked out.</p><p>That&rsquo;s still more than a minute, but given that the time was basically ∞ before&mldr; that&rsquo;s not actually that bad. I expect I&rsquo;m still doing a <em>ton</em> of allocations and work I probably don&rsquo;t have to. So I could really tune this down more. But at this point, I solved it fast (z3) and without libraries (other than rayon for free parallelization). Pretty good to me!</p><h2 id=benchmarks>Benchmarks</h2><p>This one is a mess.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run-and-bench <span style=color:#ae81ff>10</span> part1 <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>452</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1: 1.212226433s ± 13.832532ms <span style=color:#f92672>[</span>min: 1.199442042s, max: 1.247776833s, median: 1.208264834s<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ just run-and-bench <span style=color:#ae81ff>10</span> part1_rayon <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>452</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1_rayon: 331.882295ms ± 5.14392ms <span style=color:#f92672>[</span>min: 324.905666ms, max: 342.0265ms, median: 331.103208ms<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ just run-and-bench <span style=color:#ae81ff>10</span> part2_z3_rayon <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>17424</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part2_z3_rayon: 129.899304ms ± 2.541906ms <span style=color:#f92672>[</span>min: 125.474959ms, max: 133.146667ms, median: 131.154084ms<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cargo run --release --bin day10 -- bench part2_eqn_rayon --warmup <span style=color:#ae81ff>0</span> --iters <span style=color:#ae81ff>1</span> input/2025/day10.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part2_eqn_rayon: 79.115645459s ± 0ns <span style=color:#f92672>[</span>min: 79.115645459s, max: 79.115645459s, median: 79.115645459s<span style=color:#f92672>]</span>
</span></span></code></pre></div><table><thead><tr><th>Day</th><th>Part</th><th>Solution</th><th>Benchmark</th></tr></thead><tbody><tr><td>10</td><td>1</td><td><code>part1</code></td><td>1.212226433s ± 13.832532ms</td></tr><tr><td>10</td><td>1</td><td><code>part1_rayon</code></td><td>331.882295ms ± 5.14392ms</td></tr><tr><td>10</td><td>2</td><td><code>part2_z3_rayon</code></td><td>129.899304ms ± 2.541906ms</td></tr><tr><td>10</td><td>2</td><td><code>part2_eqn_rayon</code></td><td>79.115645459s ± 0ns</td></tr></tbody></table><p>I &mldr; can do better. We&rsquo;ll see if/when I come back to this one.</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>