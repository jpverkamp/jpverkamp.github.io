<!doctype html><html><head><title>AoC 2025 Day 4: Fade Awayinator – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>AoC 2025 Day 4: Fade Awayinator</h1><div class=entry-meta><span class=entry-date>2025-12-04</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/03/aoc-2025-day-3-loopinator/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/rust>Rust</a><a href=https://blog.jverkamp.com/2025/12/05/aoc-2025-day-5-range-merginator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/03/aoc-2025-day-3-loopinator/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2025/12/05/aoc-2025-day-5-range-merginator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2025/12/03/aoc-2025-day-3-loopinator/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2025>Advent of Code 2025</a><a href=https://blog.jverkamp.com/2025/12/05/aoc-2025-day-5-range-merginator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2025/12/03/aoc-2025-day-3-loopinator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2025/12/05/aoc-2025-day-5-range-merginator/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2025/12/03/aoc-2025-day-3-loopinator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2025/12/05/aoc-2025-day-5-range-merginator/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><h2 id=source-day-4-printing-department>Source: <a href=https://adventofcode.com/2025/day/4 target=_blank rel=noopener>Day 4: Printing Department</a></h2><p><a href=https://github.com/jpverkamp/advent-of-code/blob/master/2025/src/day4.rs target=_blank rel=noopener>Full solution</a> for today (spoilers!).</p><nav id=TableOfContents><ul><li><a href=#source-day-4-printing-department>Source: <a href=https://adventofcode.com/2025/day/4>Day 4: Printing Department</a></a></li><li><a href=#part-1>Part 1</a></li><li><a href=#part-2>Part 2</a></li><li><a href=#part-2---no-map>Part 2 - No Map</a></li><li><a href=#rendering>Rendering</a><ul><li><a href=#register_render><code>register_render</code></a></li><li><a href=#render_imagewidth-height-filename-f><code>render_image!(width, height, filename, f)</code></a></li><li><a href=#render_framewidth-height-f><code>render_frame!(width, height, f)</code></a></li></ul></li><li><a href=#rendering-part-2>Rendering Part 2</a></li><li><a href=#edit-part-2---floodfill>[Edit] Part 2 - Floodfill</a></li><li><a href=#benchmarks>Benchmarks</a></li></ul></nav><h2 id=part-1>Part 1</h2><blockquote><p>Given a grid of solid <code>@</code> and empty cells <code>.</code>, count how many solid cells have less than 4 neighbors.</p></blockquote><p>Okay, let&rsquo;s get a <code>Grid</code> going. I&rsquo;ve done something similar to this a few times, so <a href=https://github.com/jpverkamp/advent-of-code/blob/master/2025/src/grid.rs target=_blank rel=noopener>here</a> is the newest iteration. Basically, a <code>Grid&lt;T></code> can story any <code>Copy</code> type (just to make some operations easier).</p><p>You can build it from an <code>&amp;str</code> by providing a function <code>Fn(char) -> T</code> and it will handle bounds checking. I did add a couple of interesting functions I hadn&rsquo;t done before:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Grid<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span>
</span></span><span style=display:flex><span>    T: Copy,
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>iter</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#a6e22e>impl</span> Iterator<span style=color:#f92672>&lt;</span>Item <span style=color:#f92672>=</span> (<span style=color:#66d9ef>isize</span>, <span style=color:#66d9ef>isize</span>, T)<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        (<span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>self.width)
</span></span><span style=display:flex><span>            .flat_map(<span style=color:#66d9ef>move</span> <span style=color:#f92672>|</span>x<span style=color:#f92672>|</span> (<span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>self.height).map(<span style=color:#66d9ef>move</span> <span style=color:#f92672>|</span>y<span style=color:#f92672>|</span> (x, y, self.get(x, y).unwrap())))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>neighbors</span>(<span style=color:#f92672>&amp;</span>self, x: <span style=color:#66d9ef>isize</span>, y: <span style=color:#66d9ef>isize</span>) -&gt; <span style=color:#a6e22e>impl</span> Iterator<span style=color:#f92672>&lt;</span>Item <span style=color:#f92672>=</span> Option<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;&gt;</span> {
</span></span><span style=display:flex><span>        [
</span></span><span style=display:flex><span>            (<span style=color:#f92672>-</span><span style=color:#ae81ff>1_</span><span style=color:#66d9ef>isize</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1_</span><span style=color:#66d9ef>isize</span>),
</span></span><span style=display:flex><span>            (<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>            (<span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>            (<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>),
</span></span><span style=display:flex><span>            (<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>),
</span></span><span style=display:flex><span>            (<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>            (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>            (<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>        .into_iter()
</span></span><span style=display:flex><span>        .map(<span style=color:#66d9ef>move</span> <span style=color:#f92672>|</span>(xd, yd)<span style=color:#f92672>|</span> self.get(x <span style=color:#f92672>+</span> xd, y <span style=color:#f92672>+</span> yd))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Really, that should be implementing <code>Iter</code> but I suppose this works well enough. It&rsquo;s an <code>.iter</code> that will iterate over the <code>(x, y, v: T)</code>, so you can do all sorts of things (like only count <code>@</code> squares). And then <code>neighbors</code> will iterate over the 8 neighbors.</p><p>All of which means we can implement this problem as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part1</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> g <span style=color:#f92672>=</span> Grid::read(input, <span style=color:#f92672>|</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;@&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    g.iter()
</span></span><span style=display:flex><span>        .filter(<span style=color:#f92672>|</span>(x, y, r)<span style=color:#f92672>|</span> 
</span></span><span style=display:flex><span>            <span style=color:#f92672>*</span>r 
</span></span><span style=display:flex><span>            <span style=color:#f92672>&amp;&amp;</span> g.neighbors(<span style=color:#f92672>*</span>x, <span style=color:#f92672>*</span>y).filter(<span style=color:#f92672>|</span>v<span style=color:#f92672>|</span> <span style=color:#f92672>*</span>v <span style=color:#f92672>==</span> Some(<span style=color:#66d9ef>true</span>)).count() <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        .count()
</span></span><span style=display:flex><span>        .to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Use the <code>.iter()</code> function and count only <code>@</code> tiles that have <code>&lt; 4</code> neighbors that are <code>@</code>. That&rsquo;s it!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run <span style=color:#ae81ff>4</span> part1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1: <span style=color:#ae81ff>1393</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ just bench <span style=color:#ae81ff>4</span> part1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1: 105.073µs ± 4.234µs <span style=color:#f92672>[</span>min: 103.167µs, max: 120.083µs, median: 103.5µs<span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=part-2>Part 2</h2><blockquote><p>Repeat the process until no more changes can be made. Count how many total <code>@</code> are removed.</p></blockquote><p>For this one, I don&rsquo;t just want <code>.iter()</code> I also want <code>map</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>impl</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Grid<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>where</span>
</span></span><span style=display:flex><span>    T: Copy,
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>map</span>(<span style=color:#f92672>&amp;</span>self, f: <span style=color:#a6e22e>impl</span> Fn(<span style=color:#66d9ef>isize</span>, <span style=color:#66d9ef>isize</span>, T) -&gt; <span style=color:#a6e22e>T</span>) -&gt; <span style=color:#a6e22e>Grid</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        Grid {
</span></span><span style=display:flex><span>            width: <span style=color:#a6e22e>self</span>.width,
</span></span><span style=display:flex><span>            height: <span style=color:#a6e22e>self</span>.height,
</span></span><span style=display:flex><span>            data: <span style=color:#a6e22e>self</span>.iter().map(<span style=color:#f92672>|</span>(x, y, v)<span style=color:#f92672>|</span> f(x, y, v)).collect::<span style=color:#f92672>&lt;</span>Vec<span style=color:#f92672>&lt;</span>_<span style=color:#f92672>&gt;&gt;</span>(),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You provide a function that can map over <code>(x, y, V: T)</code> and it will create a new <code>Grid</code> from that:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> g <span style=color:#f92672>=</span> Grid::read(input, <span style=color:#f92672>|</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;@&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> initial_count <span style=color:#f92672>=</span> g.iter().filter(<span style=color:#f92672>|</span>(_, _, v)<span style=color:#f92672>|</span> <span style=color:#f92672>*</span>v).count();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> previous_count <span style=color:#f92672>=</span> initial_count;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>loop</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> new_g <span style=color:#f92672>=</span> g.map(<span style=color:#f92672>|</span>x, y, v<span style=color:#f92672>|</span> 
</span></span><span style=display:flex><span>            v
</span></span><span style=display:flex><span>            <span style=color:#f92672>&amp;&amp;</span> g.neighbors(x, y).filter(
</span></span><span style=display:flex><span>                <span style=color:#f92672>|</span>v<span style=color:#f92672>|</span> <span style=color:#f92672>*</span>v <span style=color:#f92672>==</span> Some(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            ).count() <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> new_count <span style=color:#f92672>=</span> new_g.iter().filter(<span style=color:#f92672>|</span>(_, _, v)<span style=color:#f92672>|</span> <span style=color:#f92672>*</span>v).count();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> previous_count <span style=color:#f92672>==</span> new_count {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (initial_count <span style=color:#f92672>-</span> new_count).to_string();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        g <span style=color:#f92672>=</span> new_g;
</span></span><span style=display:flex><span>        previous_count <span style=color:#f92672>=</span> new_count;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Which works:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run <span style=color:#ae81ff>4</span> part2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>8643</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ just bench <span style=color:#ae81ff>4</span> part2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part2: 4.882715ms ± 86.998µs <span style=color:#f92672>[</span>min: 4.727625ms, max: 5.216583ms, median: 4.877ms<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>I think we can do a bit better than that though&mldr;</p><h2 id=part-2---no-map>Part 2 - No Map</h2><p>One problem with the <code>Map</code> is that we&rsquo;re allocating a new map on each iteration. Let&rsquo;s do it with mutation instead:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_no_map</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> g <span style=color:#f92672>=</span> Grid::read(input, <span style=color:#f92672>|</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;@&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>loop</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> changed <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> x <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>g.width() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> y <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>g.height() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> g.get(x, y) <span style=color:#f92672>==</span> Some(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&amp;&amp;</span> g.neighbors(x, y).filter(<span style=color:#f92672>|</span>v<span style=color:#f92672>|</span> <span style=color:#f92672>*</span>v <span style=color:#f92672>==</span> Some(<span style=color:#66d9ef>true</span>)).count() <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    g.set(x, y, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>                    changed <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                    count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>changed {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    count.to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Which is ~5x faster.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run <span style=color:#ae81ff>4</span> part2_no_map
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>8643</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ just bench <span style=color:#ae81ff>4</span> part2_no_map
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part2_no_map: 1.157833ms ± 25.989µs <span style=color:#f92672>[</span>min: 1.117667ms, max: 1.253459ms, median: 1.157167ms<span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=rendering>Rendering</h2><p>Another thing I like to do with these problems is to render the solutions. Sometimes they look <em>pretty cool</em>. So let&rsquo;s add that to my basic macro for this year:</p><ul><li><a href=https://github.com/jpverkamp/advent-of-code/blob/master/2025/aoc_macros/src/render.rs target=_blank rel=noopener>render.rs</a></li><li><a href=https://github.com/jpverkamp/advent-of-code/blob/master/2025/aoc_macros/src/lib.rs#L237 target=_blank rel=noopener>lib.rs CLI</a></li><li><a href=https://github.com/jpverkamp/advent-of-code/blob/master/2025/aoc_macros/src/lib.rs#L511 target=_blank rel=noopener>lib.rs register_render</a></li></ul><p>This gives us a few new macros:</p><h3 id=register_render><code>register_render</code></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register_render(scale = 4, fps = 10)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_render</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>This will register a function to the CLI for rendering, so you can <code>./day4 render part2_render</code>.</p><p>This doesn&rsquo;t actually render anything by itself.</p><p>The <code>scale</code> and <code>fps</code> are both optional.</p><h3 id=render_imagewidth-height-filename-f><code>render_image!(width, height, filename, f)</code></h3><p><code>width</code> and <code>height</code> are the size of the image to render, <code>filename</code> is&mldr; the filename, and <code>f</code> should be a function <code>Fn(usize, usize) -> (u8, u8, u8)</code> that maps each pixel to a color.</p><h3 id=render_framewidth-height-f><code>render_frame!(width, height, f)</code></h3><p>The same parameters, but this one is a bit more interesting in implementation. What happens is that if any calls are made to <code>render_frame</code>, the macro will keep track of them. Then after the function is done, it will write all of those frames to disk and use <code>ffmpeg</code> to make a video.</p><p>Pretty fun implementation. This one, I probably did half and half with an LLM. I&rsquo;m not using them for the problems themselves, but this was something I&rsquo;ve written before (albeit without the cool macro bits) and just want working.</p><p>Granted, the implementation is&mldr; a bit weird? I might go back and rewrite it at some point.</p><h2 id=rendering-part-2>Rendering Part 2</h2><p>In any case, here&rsquo;s the rendering I made for this one!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register_render(scale = 4, fps = 10)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_render</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> g <span style=color:#f92672>=</span> Grid::read(input, <span style=color:#f92672>|</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;@&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>loop</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> removed <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec!</span>[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> x <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>g.width() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> y <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>g.height() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> g.get(x, y) <span style=color:#f92672>==</span> Some(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&amp;&amp;</span> g.neighbors(x, y).filter(<span style=color:#f92672>|</span>v<span style=color:#f92672>|</span> <span style=color:#f92672>*</span>v <span style=color:#f92672>==</span> Some(<span style=color:#66d9ef>true</span>)).count() <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    g.set(x, y, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>                    removed.push((x, y));
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        aoc::<span style=color:#a6e22e>render_frame!</span>(g.width() <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>, g.height() <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>usize</span>, <span style=color:#f92672>|</span>x, y<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> removed.contains(<span style=color:#f92672>&amp;</span>(x <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>isize</span>, y <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>isize</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> (<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>match</span> g.get(x <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>isize</span>, y <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>isize</span>) {
</span></span><span style=display:flex><span>                Some(<span style=color:#66d9ef>true</span>) <span style=color:#f92672>=&gt;</span> (<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>),
</span></span><span style=display:flex><span>                _ <span style=color:#f92672>=&gt;</span> (<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>255</span>),
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> removed.is_empty() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Which makes this:</p><p><video controls src=/embeds/2025/aoc/aoc2025_day4_part2_render.mp4></video></p><p>The black pixels are <code>@</code>, white are <code>.</code>, and red pixels are the ones just removed this iteration.</p><p>Pretty cool!</p><h2 id=edit-part-2---floodfill>[Edit] Part 2 - Floodfill</h2><p>Someone mentioned a bit of runtime analysis here. What if instead of going through the entire map until it stabilizes, we go through the entire map once, but at each point flood fill from there until we stop removing points?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[aoc::register]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>part2_floodfill</span>(input: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#a6e22e>impl</span> Into<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> g <span style=color:#f92672>=</span> Grid::read(input, <span style=color:#f92672>|</span>c<span style=color:#f92672>|</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;@&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> count <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> y <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>g.height() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> x <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>g.width() {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// At each point, flood fill points we can remove 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> stack <span style=color:#f92672>=</span> <span style=color:#a6e22e>vec!</span>[(x, y)];
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>let</span> Some((cx, cy)) <span style=color:#f92672>=</span> stack.pop() {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Any points we can&#39;t remove in the stack are ignored
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> g.get(cx, cy) <span style=color:#f92672>!=</span> Some(<span style=color:#66d9ef>true</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> g.neighbors(cx, cy).filter(<span style=color:#f92672>|</span>v<span style=color:#f92672>|</span> <span style=color:#f92672>*</span>v <span style=color:#f92672>==</span> Some(<span style=color:#66d9ef>true</span>)).count() <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>4</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Remove point, add neighbors to stack
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                g.set(cx, cy, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>                count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> nx <span style=color:#66d9ef>in</span> (cx <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)<span style=color:#f92672>..=</span>(cx <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> ny <span style=color:#66d9ef>in</span> (cy <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)<span style=color:#f92672>..=</span>(cy <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> nx <span style=color:#f92672>==</span> cx <span style=color:#f92672>&amp;&amp;</span> ny <span style=color:#f92672>==</span> cy {
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                        stack.push((nx, ny));
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    count.to_string()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Which:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run <span style=color:#ae81ff>4</span> part2_floodfill
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>8643</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ just bench <span style=color:#ae81ff>4</span> part2_floodfill
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part2_floodfill: 666.912µs ± 26.553µs <span style=color:#f92672>[</span>min: 644.542µs, max: 824.167µs, median: 661.542µs<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Is actually ~2x as fast. Huh, neat.</p><p>Rendered:</p><p><video controls src=/embeds/2025/aoc/aoc2025_day4_part2_render_floodfill.mp4></video></p><p>(It looks a lot slower since I&rsquo;m rendering one frame per pixel removed.)</p><h2 id=benchmarks>Benchmarks</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ just run <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1: <span style=color:#ae81ff>1393</span>
</span></span><span style=display:flex><span>part2: <span style=color:#ae81ff>8643</span>
</span></span><span style=display:flex><span>part2_no_map: <span style=color:#ae81ff>8643</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ just bench <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>part1: 107.041µs ± 5.007µs <span style=color:#f92672>[</span>min: 102.5µs, max: 121.5µs, median: 106.708µs<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>part2: 4.826662ms ± 86.921µs <span style=color:#f92672>[</span>min: 4.70625ms, max: 5.170375ms, median: 4.807792ms<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>part2_no_map: 1.164075ms ± 33.765µs <span style=color:#f92672>[</span>min: 1.115709ms, max: 1.286ms, median: 1.159042ms<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>part2_floodfill: 670.268µs ± 19.006µs <span style=color:#f92672>[</span>min: 645.541µs, max: 752.125µs, median: 667.542µs<span style=color:#f92672>]</span>
</span></span></code></pre></div><table><thead><tr><th>Day</th><th>Part</th><th>Solution</th><th>Benchmark</th></tr></thead><tbody><tr><td>4</td><td>1</td><td><code>part1</code></td><td>107.041µs ± 5.007µs</td></tr><tr><td>4</td><td>2</td><td><code>part2</code></td><td>4.826662ms ± 86.921µs</td></tr><tr><td>4</td><td>2</td><td><code>part2_no_map</code></td><td>1.164075ms ± 33.765µs</td></tr><tr><td>4</td><td>2</td><td><code>part2_floodfill</code></td><td>670.268µs ± 19.006µs</td></tr></tbody></table></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>