<!doctype html><html><head><title>Building a virtual CPU from NAND gates up – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Building a virtual CPU from NAND gates up</h1><div class=entry-meta><span class=entry-date>2025-07-21</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/languages/assembly>Assembly</a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/topics/todo>TODO</a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2025/05/29/parsing-pem-certificates-asn.1-in-javascript/ class=previous-link>Prev</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2025/07/17/million-dollar-baby/ class=previous-link>Prev</a></ul></li></ul></div></div></header><div class=entry-content><p>Over the past couple of weeks, I&rsquo;ve spent entirely longer than I probably should have falling down the rabbit hole that is the game <a href=https://store.steampowered.com/app/1444480/Turing_Complete/ target=_blank rel=noopener>Turing Complete</a>.</p><p>In a nutshell, you start with basically nothing, build up simple logic gates, create memory cells and 1-bit addition, build that into 8-bit math and logic, read instructions RAM, implement loops, and function calls (in hardware!), and eventually use your very own custom built CPU to solve a few programming challenges.</p><p>If that sounds at all interesting to you, I highly recommend it. It&rsquo;s a well laid out program and I had a lot of fun going back to my computer engineering days in undergrad!</p><p>In any case, I wanted to share my final CPU (as a sort of &rsquo;last look&rsquo; before I can finally move on to other things). I have the language that I ended up designing, which is roughly based on the one they had you designing, but I redid decent bits of it to add some more features and clean it up (in my opinion).</p><p>So below, we have:</p><nav id=TableOfContents><ul><li><a href=#requirements>Requirements</a></li><li><a href=#final-language-specification>Final Language Specification</a><ul><li><a href=#flags>Flags</a></li><li><a href=#arity--pp-bits>Arity / <code>pp</code> bits</a></li><li><a href=#alulogic-opcodes>ALU/Logic Opcodes</a></li><li><a href=#ramromstack-operations>RAM/ROM/Stack Operations</a></li><li><a href=#conditionals>Conditionals</a></li><li><a href=#jumpsmode-switching-pp--0>Jumps/Mode switching (<code>pp == 0</code>)</a></li><li><a href=#parameters>Parameters</a></li></ul></li><li><a href=#final-hardware>Final Hardware</a><ul><li><a href=#the-decoder>The decoder</a></li><li><a href=#register-input-decoder>Register input decoder</a></li><li><a href=#alu>ALU</a></li><li><a href=#jump-engine>Jump engine</a></li><li><a href=#stack-memory>Stack memory</a></li><li><a href=#ram-and-rom>RAM and ROM</a></li></ul></li><li><a href=#solutions-assembly-language>Solutions (Assembly Language)</a><ul><li><a href=#ai-showdown>AI Showdown</a></li><li><a href=#planet-names>Planet names</a></li><li><a href=#robot-racing>Robot Racing</a></li><li><a href=#tower-of-alloy>Tower of Alloy</a></li><li><a href=#delicious-order>Delicious Order</a></li><li><a href=#water-world>Water World</a></li><li><a href=#robot-racing-now-with-more-cheating>Robot Racing (now with more cheating)</a></li></ul></li><li><a href=#future-work>Future work</a></li></ul></nav><p>First, we&rsquo;ll talk about the language that I designed the CPU around, then pictures of the virtual CPU hardware, and finally a few assembly programs that I actually ran on this (virtual) hardware.</p><p>I&rsquo;d absolutely love to try to build this or program it onto an <a href=https://en.wikipedia.org/wiki/FPGA>FPGA</a> or something like that, but I think that&rsquo;s a problem for another time. &#x1f604;</p><h2 id=requirements>Requirements</h2><p>Okay, first up, what requirements and/or design specifications did we have for our virtual machine?</p><ul><li>8-bit instructions, registers, and memory - I did consider bumping this up, the game has components scaled up to 64-bits for you, but I didn&rsquo;t end up needing it, so didn&rsquo;t implement it</li><li>Basic arithmetic and logic operators</li><li>The ability to decode instructions from a program RAM<ul><li>These instructions should allow variable width operations; this is a difference from the architecture the game leads you to; all of those instructions are exactly 4 bytes</li></ul></li><li>Registers for short term storage</li><li>A stack based memory system for longer term storage (you don&rsquo;t <em>really</em> need this, you can implement it in RAM)</li><li>256 bytes of RAM accessed by address</li><li>256 bytes of persistent RAM/ROM (I only used this for <a href=#robot-racing-now-with-more-cheating>an alternate solution</a> to one problem; it&rsquo;s the last thing I implemented)</li><li>All instructions can be conditional (similar to what <a href=https://www.zachtronics.com/shenzhen-io/ target=_blank rel=noopener>SHENZHEN I/O</a> does and another departure to how the suggested architecture runs)</li><li>Jumps (for loops) and function calls (with a proper stack for recursion)</li></ul><h2 id=final-language-specification>Final Language Specification</h2><p>So, how do I set that up?</p><h3 id=flags>Flags</h3><p>Okay, first things first, I want all instructions to be stored in a single byte with 0-2 arguments after that. As mentioned, all instructions can be conditional (similar to what <a href=https://www.zachtronics.com/shenzhen-io/ target=_blank rel=noopener>SHENZHEN I/O</a> does) and I directly encode the <a href=https://en.wikipedia.org/wiki/arity>arity</a> into the function name. So for the first byte, we end up with something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>cnpp oooo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c - conditional bit; if the &#39;conditional&#39; flag is not set, skip this instruction
</span></span><span style=display:flex><span>n - unconditional bit; does the opposite of c (if both c and n are set, weird things happen)
</span></span><span style=display:flex><span>pp - number of args / how much PC should be advanced 01/10/11 for 1, 2, 3; 00 signifies a jump
</span></span><span style=display:flex><span>oooo - opcodes
</span></span></code></pre></div><p>If the highest bit (<code>c</code>) is set, only run this instruction if the <code>conditional</code> flag is set (I&rsquo;ll come back to this). If <code>n</code> is set, only run if <code>conditional</code> is <em>not</em> set. Set both to <code>0</code> for an unconditional operation and both being <code>1</code> is an error and will <code>halt</code> the CPU.</p><p>When I&rsquo;m encoding this in assembly programs, it looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r0</span> <span style=color:#66d9ef>r1</span> <span style=color:#66d9ef>r2</span>    <span style=color:#75715e># not conditional
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r2</span> <span style=color:#ae81ff>5</span> <span style=color:#66d9ef>r3</span>   <span style=color:#75715e># conditional
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r2</span> <span style=color:#ae81ff>7</span> <span style=color:#66d9ef>r3</span>   <span style=color:#75715e># negative conditional
</span></span></span></code></pre></div><h3 id=arity--pp-bits>Arity / <code>pp</code> bits</h3><p>After that, two bits (<code>pp</code>) that specify the arity of the function. This is constant for any ALU based operations and strange things™ will happen if this is not correct. This does mean there are a number of nonsense parameters that can probably be abused in various ways (like <code>pp = 01</code> for <code>add</code> would run the <code>add</code> and then set the <code>PC</code> to what should be the <code>b</code> parameter).</p><p>Let&rsquo;s just call that <a href=https://en.wikipedia.org/wiki/undefined%20behavior>undefined behavior</a>. &#x1f604;</p><p>Okay, now the actual operations.</p><h3 id=alulogic-opcodes>ALU/Logic Opcodes</h3><p>For anything with <code>pp != 00</code>, we basically have our ALU first:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0000</span> <span style=color:#a6e22e>add</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0001</span> <span style=color:#a6e22e>sub</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0010</span> <span style=color:#a6e22e>mul</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0011</span> <span style=color:#a6e22e>div</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0100</span> <span style=color:#a6e22e>not</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0101</span> <span style=color:#a6e22e>and</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0110</span> <span style=color:#a6e22e>or</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0111</span> <span style=color:#a6e22e>xor</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><p>It&rsquo;s &mldr; certainly a choice to have a hardware <code>div</code>, but they gave it to me (once I implemented it in assembly on my CPU first), but we&rsquo;ll go with it.</p><h3 id=ramromstack-operations>RAM/ROM/Stack Operations</h3><p>Next up (still with <code>pp != 00</code>), we have memory based instructions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1000</span> <span style=color:#a6e22e>store</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>addr</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>store</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>value</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>in_a</span> <span style=color:#66d9ef>to</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>address</span> <span style=color:#66d9ef>in_b</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1001</span> <span style=color:#a6e22e>load</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>addr</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>load</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>value</span> <span style=color:#66d9ef>from</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>address</span> <span style=color:#66d9ef>in_a</span> <span style=color:#66d9ef>to</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1010</span> <span style=color:#a6e22e>push</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>push</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>value</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>in_a</span> <span style=color:#66d9ef>to</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>stack</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1011</span> <span style=color:#a6e22e>pop</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>out</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>pop</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>value</span> <span style=color:#66d9ef>from</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>stack</span> <span style=color:#66d9ef>to</span> <span style=color:#66d9ef>out</span>
</span></span></code></pre></div><p>These will store/load from RAM (by default) or persistent RAM/ROM (if <code>mode_rom</code> has been set, see below) or alternatively <code>push/pop</code> from stack memory.</p><p>I really could have just dropped the stack, I didn&rsquo;t end up really using it much. It can actually be used directly as an offset in A/B parameters, but I didn&rsquo;t actually do this. &#x1f937;</p><h3 id=conditionals>Conditionals</h3><p>Next up, conditional functions. These don&rsquo;t do anything (much) themselves, but instead will set the <code>conditional</code> flag until the next time that a conditional function is called:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1100</span> <span style=color:#a6e22e>ceq</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1101</span> <span style=color:#a6e22e>cltu</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>compare</span> <span style=color:#66d9ef>less</span> <span style=color:#66d9ef>than</span> <span style=color:#66d9ef>unsigned</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1110</span> <span style=color:#a6e22e>clt</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>compare</span> <span style=color:#66d9ef>less</span> <span style=color:#66d9ef>than</span> <span style=color:#66d9ef>signed</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1111</span> <span style=color:#a6e22e>cle</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span></code></pre></div><h3 id=jumpsmode-switching-pp--0>Jumps/Mode switching (<code>pp == 0</code>)</h3><p>And finally, we get to the case where <code>pp == 0</code>, which is jumps, function call, and also the only place I could fit mode switching (when I added that at the last minute):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0000</span> <span style=color:#a6e22e>jmp</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>absolute</span> <span style=color:#66d9ef>jump</span> (<span style=color:#ae81ff>8</span><span style=color:#66d9ef>bit</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0001</span> <span style=color:#a6e22e>jmp16</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>absolute</span> <span style=color:#66d9ef>jump</span> (<span style=color:#ae81ff>16</span><span style=color:#66d9ef>bit</span>) (<span style=color:#66d9ef>not</span> <span style=color:#66d9ef>implemented</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0010</span> <span style=color:#a6e22e>rjmp</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>relative</span> <span style=color:#66d9ef>jump</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0011</span> <span style=color:#a6e22e>rjmp16</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>relative</span> <span style=color:#66d9ef>jump</span> (<span style=color:#ae81ff>16</span><span style=color:#66d9ef>bit</span>) (<span style=color:#66d9ef>not</span> <span style=color:#66d9ef>implemented</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0100</span> <span style=color:#a6e22e>call</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>subroutine</span> (<span style=color:#ae81ff>8</span><span style=color:#66d9ef>bit</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0101</span> <span style=color:#a6e22e>call16</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_a</span><span style=color:#960050;background-color:#1e0010>}</span> <span style=color:#960050;background-color:#1e0010>{</span><span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span> - <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>subroutine</span> (<span style=color:#ae81ff>16</span><span style=color:#66d9ef>bit</span>) (<span style=color:#66d9ef>not</span> <span style=color:#66d9ef>implemented</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0110</span> 
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>0111</span> <span style=color:#a6e22e>ret</span> - <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>from</span> <span style=color:#66d9ef>subroutine</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1000</span> <span style=color:#a6e22e>halt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1010</span> <span style=color:#a6e22e>set</span> <span style=color:#66d9ef>store</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>load</span> <span style=color:#66d9ef>mode</span> -<span style=color:#960050;background-color:#1e0010>&gt;</span> <span style=color:#66d9ef>ram</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>1011</span> <span style=color:#a6e22e>set</span> <span style=color:#66d9ef>store</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#66d9ef>load</span> <span style=color:#66d9ef>mode</span> -<span style=color:#960050;background-color:#1e0010>&gt;</span> <span style=color:#66d9ef>rom</span>
</span></span></code></pre></div><p>Originally, I was set up so that I could use a pair of values in order to jump to 16-bit values so I could have programs longer than 256 bytes. But&mldr; I didn&rsquo;t need it, so the <code>**16</code> operations never ended up used.</p><p>In addition, <code>call</code> does <em>not</em> preserve registers. You have to do it yourself, which is something I do in the <a href=#tower-of-alloy>Tower of Alloy</a> problem and (for the one and only time) use the stack for that. I did plan to automatically store the first three registers (<code>r0</code> to <code>r2</code>; since we can read/write 4 bytes at a time) but never implemented it. So it goes.</p><h3 id=parameters>Parameters</h3><p>Okay, that&rsquo;s enough to specify the instructions, what about those actual parameters that the arity / <code>pp</code> specify?</p><p>Well, for input, we can have immediate values (positive if the first two bits are <code>00</code>, negative if <code>01</code>). Then we can also read the <code>nth</code> value down the stack as a parameter (<code>10</code> prefix), which I never used. And finally, if the prefix is <code>11</code>, then we have the 6 built in registers + stdin (<code>11-- -111</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>{</span><span style=color:#a6e22e>in_a</span> <span style=color:#960050;background-color:#1e0010>/</span> <span style=color:#66d9ef>in_b</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>00</span><span style=color:#a6e22e>vv</span> <span style=color:#66d9ef>vvvv</span> - <span style=color:#66d9ef>positive</span> <span style=color:#66d9ef>immediate</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>01</span><span style=color:#a6e22e>vv</span> <span style=color:#66d9ef>vvvv</span> - <span style=color:#66d9ef>negative</span> <span style=color:#66d9ef>immediate</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>10--</span> <span style=color:#a6e22e>nnnn</span> - <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>nth</span> <span style=color:#66d9ef>value</span> <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>stack</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>11--</span> <span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>rrr</span> - <span style=color:#66d9ef>registers</span> <span style=color:#66d9ef>r0-r5</span><span style=color:#75715e>; 110 reads SC, 111 reads IN
</span></span></span></code></pre></div><p>And likewise, for output&mldr; we only have the registers (<code>11-- -111</code> is stdout).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>{</span><span style=color:#a6e22e>out</span><span style=color:#960050;background-color:#1e0010>}</span>
</span></span><span style=display:flex><span>    <span style=color:#960050;background-color:#1e0010>1---</span> <span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>rrr</span> - <span style=color:#66d9ef>registers</span> <span style=color:#66d9ef>r0-r5</span><span style=color:#75715e>; 110 does nothing, 111 writes to OUT
</span></span></span></code></pre></div><p>And&mldr; that&rsquo;s it (isn&rsquo;t it enough? &#x1f604;), let&rsquo;s get onto the hardware!</p><h2 id=final-hardware>Final Hardware</h2><p>Okay, we have a language. Next step is to build something that can actually run that!</p><figure><img src=/2025/07/21/building-a-virtual-cpu-from-nand-gates-up/turing-complete.png alt="An image showing the entire virtual CPU"></figure><p>For any of these images, you can right click, open image in a new tab to see the full size image. The first two overview images are already zoomed pretty far out though, so you really can&rsquo;t see details or comments.</p><p>If you want a bit more detailed map, here are the various regions of the CPU:</p><figure><img src=/2025/07/21/building-a-virtual-cpu-from-nand-gates-up/turing-complete-regions.png alt="An image showing the entire virtual CPU, with regions marked on it"></figure><p>From top left down rows, we have:</p><ul><li>In the top left, the <a href=#jump-engine>jump decoder</a></li><li>Below that, we have a circuit <a href=#the-decoder>to update the PC and decode the program</a></li><li>In the 3rd row, far left, we have <a href=#stack-memory>stack memory</a></li><li>The next two in that row are <a href=#register-input-decoder>decoders for A input and B input</a></li><li>The final block in the third row is <a href=#alu>the ALU</a></li><li>The bottom left is the <a href=#ram-and-rom>system RAM and ROM</a></li></ul><h3 id=the-decoder>The decoder</h3><p>Okay, first, we have the program encoder itself.</p><figure><img src=/2025/07/21/building-a-virtual-cpu-from-nand-gates-up/turing-complete-program.png alt="Handling the program"></figure><p>In here, we always read 4 bytes, even if we&rsquo;re not going to use them. To the left of the <code>PROGRAM</code>, we have the <code>PC</code> with a bunch of logic:</p><ul><li>If we have <code>pp != 0</code>, advance by <code>pp</code> bytes</li><li>If we have <code>pp == 0</code>, use the jump <code>pp</code> calculator to set the next value</li></ul><p>To the right, we decode the initial instructions creating several interesting values. Such as <code>p0</code> and <code>p1</code>, a flag if we&rsquo;re doing a <code>push/pop</code>, if we&rsquo;re running an ALU operation (<code>do_op</code>), and the <code>N</code> and <code>C</code> flags (we&rsquo;ll come back to those in the <a href=#alu>conditional</a> hardware).</p><h3 id=register-input-decoder>Register input decoder</h3><p>Next up, we have two copies of our input decoders. Primarily, these will read from the registers (which are input in the bottom right of this image), stack address, or <code>INPUT</code>. If we have an immediate value, those are parsed (and expanded for the negative case) in the bottom left of this image. THis is then set up to the very top blue line (<code>A</code>) for use by the ALU.</p><figure><img src=/2025/07/21/building-a-virtual-cpu-from-nand-gates-up/turing-complete-register-read.png alt="Showing how inputs are parsed from registers, stack pointer, and INPUT"></figure><p>This is duplicated for the <code>B</code> input immediately beside here.</p><h3 id=alu>ALU</h3><p>Next up, the ALU itself (and conditional logic).</p><figure><img src=/2025/07/21/building-a-virtual-cpu-from-nand-gates-up/turing-complete-alu.png alt="The ALU showing all operations in parallel and the output being selected by a flag"></figure><p>Here, we will take whatever was put on <code>A</code> and <code>B</code> <a href=#register-input-decoder>above</a> and in parallel calculate all the possible ALU operations. This is then selected by what the opcode actually was an sent back out to the third blue line on the main bus: <code>out</code>.</p><p>In addition, on the right side here, we have the conditional flag and code.</p><p>Basically, if we are running one of the four conditional operations, we will select the combination of <code>&lt;</code> (signed and not) or <code>=</code> and then set that into the <code>conditional</code> flag. One wrinkle here:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>ceq</span> <span style=color:#66d9ef>r1</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>...</span>
</span></span></code></pre></div><p>What does that do? Checks if <code>r0 == 0 && r1 == 0</code>. Because the second operation is itself conditional, we only update the register if it was already <code>true</code>. If it was false, it doesn&rsquo;t run and we end up with <code>conditional</code> flag = <code>N</code> for the next instructions(s).</p><p>In a nutshell, that&rsquo;s why we have the <code>if is+do cond; set c</code> comment. &#x1f604;</p><h3 id=jump-engine>Jump engine</h3><p>Okay, jumping (heh) from there, we have the code that handles <code>jump</code> instructions.</p><figure><img src=/2025/07/21/building-a-virtual-cpu-from-nand-gates-up/turing-complete-jump.png alt="Showing the jump decoder and also the call stack"></figure><p>Here we have a pile of possible instructions in parallel (even if half of them have &lsquo;halt&rsquo; nodes, for the 16 bit versions). If a specific instruction is decoded, then we will update the PC using that one. One caveat though: these can be <code>conditional</code>! If <code>C</code> or <code>N</code> is set. So if it is, use the new value for <code>PC</code>. If not, always advance by <code>2</code> for everything but <code>ret</code>, which advances by <code>1</code>. Yay hardcoding!</p><p>This also does handle the special case of <code>mode</code> instructions (since they don&rsquo;t have parameters, but should advance <code>1</code>).</p><p>Finally, we have a <code>STACK</code> there. That&rsquo;s used for <code>call</code> (the current PC is pushed to the stack; +2 to not run the call again on <code>ret</code>) and <code>ret</code> (the most recent <code>call</code> address off the stack). Whee!</p><h3 id=stack-memory>Stack memory</h3><p>Okay, next up, just below the program decoder, we have the stack:</p><figure><img src=/2025/07/21/building-a-virtual-cpu-from-nand-gates-up/turing-complete-stack.png></figure><p>Mostly, we implement <code>push</code> and <code>pop</code> here.</p><p>But&ndash;you might ask&ndash;this isn&rsquo;t a <code>STACK</code>, this is a <code>RAM</code>?!</p><p>Why? Because we do also have to set the <code>in_a_from_stack</code> (and the same for <code>b</code>) if we have a parameter that&rsquo;s reading from teh stack. This&mldr; was not worth it. So we have to be able to access further down than a single value. So it goes.</p><h3 id=ram-and-rom>RAM and ROM</h3><p>Finally, we have <code>RAM</code> (implemented early) but also <code>ROM</code> (which is really more of &lsquo;persistent&rsquo; <code>RAM</code> / a hard drive):</p><figure><img src=/2025/07/21/building-a-virtual-cpu-from-nand-gates-up/turing-complete-ram-rom.png></figure><p>These basically work the same way and take the same input/output/address values as each other. We do have to make sure that we have the correct instruction though, so we don&rsquo;t accidentally write to <code>ROM</code> when we meant <code>RAM</code> and vice versa.</p><p>This flag just the left of the <code>RAM</code> banks specifies which one we will <code>store</code> to/<code>load</code> from.</p><p>One gotcha here: the <code>ROM/HDD</code> isn&rsquo;t directly addressed. Instead, the <code>address</code> line is how much to <code>seek</code>. So if you run a series of commands like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#ae81ff>42</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#ae81ff>57</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#ae81ff>99</span> <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><p>If we&rsquo;re in <code>RAM</code> mode, we&rsquo;ll have:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>0 42 57 99 0 0 0 ...
</span></span></code></pre></div><p>But in <code>ROM</code> mode, we&rsquo;d have:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>42 57 0 99 0 0 [0] ...
</span></span></code></pre></div><p>Because we store <code>42</code> and advance <code>1</code>, then store <code>57</code> and advance <code>2</code>, and finally store <code>99</code> and advance <code>3</code> (so the next <code>store</code> will go to that <code>[0]</code>).</p><p>Yay little gotchas!</p><h2 id=solutions-assembly-language>Solutions (Assembly Language)</h2><p>Okay, enough about the hardware, let&rsquo;s talk a bit about the assembly language solutions I actually implemented using this hardware to solve various problems.</p><h3 id=ai-showdown>AI Showdown</h3><p>Okay, for the first problem, we have an &lsquo;interview&rsquo; problem I&rsquo;ve seen before. You&rsquo;re playing a card game against a(nother) robot. You have a stack of cards and take turns drawing 1, 2, or 3 cards. Whoever draws the last card loses.</p><p>This actually has a perfect solution, which is based on the current remainder at each step. So that&rsquo;s exactly how I solved it:</p><ul><li>Loop<ul><li>Calculate the current remainder/mod 4</li><li>For each specific case, send a specific output value and then jump back to the loop</li></ul></li></ul><p>That&rsquo;s it!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>div</span> <span style=color:#66d9ef>r0</span> <span style=color:#ae81ff>4</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mul</span> <span style=color:#66d9ef>r1</span> <span style=color:#ae81ff>4</span> <span style=color:#66d9ef>r2</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sub</span> <span style=color:#66d9ef>r0</span> <span style=color:#66d9ef>r2</span> <span style=color:#66d9ef>r2</span> <span style=color:#75715e># r2 is remainder
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># mod 0, take 3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r2</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># mod 1, we lost!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r2</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># mod 2, take 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r2</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># mod 3, take 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r2</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>halt</span>
</span></span></code></pre></div><p>That <code>halt</code> at the end should never be reached, but is a remainder of our older testing code.</p><h3 id=planet-names>Planet names</h3><p>Second problem, string processing!</p><p>You&rsquo;re given a string (which is a list of planet names, all lower case letters, in <a href=https://en.wikipedia.org/wiki/ASCII>ASCII</a>). Capitalize the first letter word (the first letter after a space) in a string.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>last_space</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>char</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>space</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># r0 is &#39;last character was space&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>last_space</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>char</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># if last was space
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>last_space</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>sub</span> <span style=color:#66d9ef>char</span> <span style=color:#66d9ef>space</span> <span style=color:#66d9ef>char</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>last_space</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># out the (maybe mod) character
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>char</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># if new character is a space
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>char</span> <span style=color:#66d9ef>space</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>jump</span> <span style=color:#66d9ef>loop</span>
</span></span></code></pre></div><p>Here we see that we can name registers using the game&rsquo;s built in <code>const</code> syntax. It does make debugging easier. Other than that, you have the <code>ceq char space</code> to set the <code>last_space</code> flag and one interesting bit of <code>ASCII</code> knowledge: If you add/subtract a <code>space</code> (which is ASCII 32), you swap between upper and lower case letters!</p><p>And that&rsquo;s it!</p><h3 id=robot-racing>Robot Racing</h3><p>Run a maze (which is actually a <a href=https://en.wikipedia.org/wiki/Hilbert%20curve>Hilbert curve</a>) using a robot that can only move in 4 directions (up, down, left, right).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>down</span>  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>left</span>  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>up</span>    <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>urdr</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>rulu</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>rull</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>dluu</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>rulu</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>urdr</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>urdd</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>ldrr</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>rulu</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>urdr</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>urdd</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>ldrd</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>dlul</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>ldrd</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>ldrr</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#66d9ef>rurd</span> <span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>halt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>urdr</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>up</span>    <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>down</span>  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>rulu</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>up</span>    <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>left</span>  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>up</span>    <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>load</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>load</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>load</span> <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>load</span> <span style=color:#ae81ff>3</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ret</span>
</span></span></code></pre></div><p>So&mldr; I totally just hard coded this. There is some repetition in which functions are called, but it&rsquo;s still kind of long and annoying. We&rsquo;ll <a href=#robot-racing-now-with-more-cheating>come back to this</a>.</p><h3 id=tower-of-alloy>Tower of Alloy</h3><p>Solve the <a href=https://en.wikipedia.org/wiki/Tower%20of%20Hanoi>Tower of Hanoi</a> problem using my virtual CPU.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>toggle</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># read n, src, dst, and spare from input
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>add</span> <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r2</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r3</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>call</span> <span style=color:#66d9ef>hanoi</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>halt</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># expects r0=n, r1=src, r2=dst, r3=spare
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>hanoi</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># if n==0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>ret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># else
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># h(n-1, src, spare, dst)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>push</span> <span style=color:#66d9ef>r0</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>push</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span> <span style=color:#66d9ef>r2</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span> <span style=color:#66d9ef>r3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sub</span> <span style=color:#66d9ef>r0</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r2</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r4</span> <span style=color:#75715e># spare -&gt; temp
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r3</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r2</span> <span style=color:#75715e># dst -&gt; spare
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r4</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r3</span> <span style=color:#75715e># temp -&gt; dst
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>call</span> <span style=color:#66d9ef>hanoi</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span> <span style=color:#66d9ef>r3</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span> <span style=color:#66d9ef>r2</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># move src -&gt; dst
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>call</span> <span style=color:#66d9ef>move</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># h(n-1, spare, dst, src)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e># don&#39;t need to preserve this time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>sub</span> <span style=color:#66d9ef>r0</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r4</span> <span style=color:#75715e># src -&gt; temp
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r3</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r1</span> <span style=color:#75715e># spare -&gt; src
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r4</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r3</span> <span style=color:#75715e># temp -&gt; spare/r3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>call</span> <span style=color:#66d9ef>hanoi</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># move a disk from r1(src) to r2(dst)
</span></span></span><span style=display:flex><span><span style=color:#75715e># expects magnet to be off 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>move</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>toggle</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r2</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>toggle</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ret</span>
</span></span></code></pre></div><p>So here we come into proving that our CPU handles recursion! We were given (as a hint) the code for solving the Tower of Hanoi. ALl we have to do is implement it. And because I don&rsquo;t automatically save any registers, this is the one time I use <code>push</code> and <code>pop</code> to store the current values before making a recursive call and restoring them after.</p><p>And that&rsquo;s it! A (relatively) complicated algorithm built on my very own hardware. A long way from <code>NAND</code> gates.</p><h3 id=delicious-order>Delicious Order</h3><p>This is a sorting problem. We&rsquo;re given a series of 15 values and have to output them in sorted order.</p><p>I just went for a brain dead <a href=https://en.wikipedia.org/wiki/bubble%20sort>bubble sort</a>. I expect that (because I have <code>div</code>), I could actually implement <a href=https://en.wikipedia.org/wiki/merge%20sort>merge sort</a>, although I wonder if we&rsquo;d run into the 256 byte program size limit. That would certainly be interesting to try. Maybe another day.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#75715e># read 15
</span></span></span><span style=display:flex><span><span style=color:#75715e># sort
</span></span></span><span style=display:flex><span><span style=color:#75715e># output 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_i</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_j0</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_j1</span> <span style=color:#66d9ef>r2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_j0_v</span> <span style=color:#66d9ef>r3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_j1_v</span> <span style=color:#66d9ef>r4</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_temp</span> <span style=color:#66d9ef>r5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>read_loop</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>store</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>r_i</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r_i</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>read_loop</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_i</span> <span style=color:#75715e># i is r0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_j0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_j</span> <span style=color:#75715e># j is r1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r_j0</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r_j1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># compare j and j+1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>load</span> <span style=color:#66d9ef>r_j0</span> <span style=color:#66d9ef>r_j0_v</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>load</span> <span style=color:#66d9ef>r_j1</span> <span style=color:#66d9ef>r_j1_v</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># are they out of order
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>cltu</span> <span style=color:#66d9ef>r_j1_v</span> <span style=color:#66d9ef>r_j0_v</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>store</span> <span style=color:#66d9ef>r_j0_v</span> <span style=color:#66d9ef>r_j1</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>store</span> <span style=color:#66d9ef>r_j1_v</span> <span style=color:#66d9ef>r_j0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># have we finished j loop
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r_j0</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r_j0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>r_j0</span> <span style=color:#ae81ff>14</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_j</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>r_i</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r_i</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_i</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># now we have to output them
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>write_loop</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>load</span> <span style=color:#66d9ef>r_i</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r_i</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>r_i</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>write_loop</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>halt</span>
</span></span></code></pre></div><p>I actually did this one twice, since at first (until I started naming registers) I just couldn&rsquo;t get it right. This one instead loops 15 times. On each loop, it finds the smallest value (and it&rsquo;s index), writes out that value, and then sets that index to 255 (a <a href=https://en.wikipedia.org/wiki/sentinel%20value>sentinel value</a>).</p><p>One gotcha (right at the top there): because of how we implement immediates&mldr; we can&rsquo;t have a constant for <code>255</code>. Oops. But hey, <code>!0 = 255</code> and we can name it <code>c_255</code>. But we&rsquo;re constantly using one of our six registers just for this&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#75715e># I ... can&#39;t make a 255 constant
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>not</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_read</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>c_255</span> <span style=color:#66d9ef>r5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>read_loop</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>store</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>r_read</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r_read</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r_read</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r_read</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>read_loop</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_i</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>write_loop</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>call</span> <span style=color:#66d9ef>output_smallest</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r_i</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>halt</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r_i</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r_i</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>jump</span> <span style=color:#66d9ef>write_loop</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_index</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_min_index</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_min_value</span> <span style=color:#66d9ef>r2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>r_value</span> <span style=color:#66d9ef>r3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>output_smallest</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_index</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_min_index</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>c_255</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_min_value</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span> <span style=color:#66d9ef>output_loop</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>load</span> <span style=color:#66d9ef>r_index</span> <span style=color:#66d9ef>r_value</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># skip already written
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r_value</span> <span style=color:#66d9ef>c_255</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>skip_done</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># first non-0 value | &lt; current
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r_min_value</span> <span style=color:#66d9ef>c_255</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>cltu</span> <span style=color:#66d9ef>r_value</span> <span style=color:#66d9ef>r_min_value</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r_index</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_min_index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r_value</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>r_min_value</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>label</span> <span style=color:#66d9ef>skip_done</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r_index</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>r_index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>r_index</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>r_min_value</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>store</span> <span style=color:#66d9ef>c_255</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>ret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jump</span> <span style=color:#66d9ef>output_loop</span>
</span></span></code></pre></div><h3 id=water-world>Water World</h3><p>Solve a relatively common &lsquo;interview&rsquo; problem, where you have a 2D heightmap and you have to calculate the amount of water that could be held by it.</p><p>This is arguably the &lsquo;hardest&rsquo; problem, not because it&rsquo;s algorithmically terrible difficult (any open space that has a wall anywhere to both the left and right can store water), but because it&rsquo;s interesting™ to implement.</p><p>I did end up implementing that algorithm, using a <a href=https://en.wikipedia.org/wiki/bitmask>bitmask</a> to store: if it&rsquo;s a wall, if there&rsquo;s a wall to the left, and if there&rsquo;s a wall to the right. Then, only the ones that are <code>0</code>, <code>1</code>, and <code>1</code> respectively are counted!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>width</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>r0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>r1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>r2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>wall</span> <span style=color:#66d9ef>r3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>sum</span> <span style=color:#66d9ef>r3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>bits</span> <span style=color:#66d9ef>r4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># loop 1: walls
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_x</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>wall</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_y</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mul</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>width</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>wall</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>load</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>or</span> <span style=color:#66d9ef>bits</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>b0001</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>store</span> <span style=color:#66d9ef>bits</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>y</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>width</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_y</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>x</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>width</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_x</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># loop 2: look left 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_x2</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_y2</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mul</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>width</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>x</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>skip_left</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sub</span> <span style=color:#66d9ef>index</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>load</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>index</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>and</span> <span style=color:#66d9ef>bits</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>b0011</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>bits</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>load</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>or</span> <span style=color:#66d9ef>bits</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>b0010</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>store</span> <span style=color:#66d9ef>bits</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>label</span> <span style=color:#66d9ef>skip_left</span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>add</span> <span style=color:#66d9ef>y</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>width</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_y2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>x</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>width</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_x2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># loop 3: look right
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>sub</span> <span style=color:#66d9ef>width</span> <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_x3</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_y3</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mul</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>width</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>add</span> <span style=color:#66d9ef>index</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>load</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sub</span> <span style=color:#66d9ef>index</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>and</span> <span style=color:#66d9ef>bits</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>b0101</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>bits</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>load</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>or</span> <span style=color:#66d9ef>bits</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>b0100</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>store</span> <span style=color:#66d9ef>bits</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>y</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>width</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_y3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sub</span> <span style=color:#66d9ef>x</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>x</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>n</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_x3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># loop 4: count
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>sum</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_x4</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop_y4</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mul</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>width</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>index</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>load</span> <span style=color:#66d9ef>index</span> <span style=color:#66d9ef>bits</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ceq</span> <span style=color:#66d9ef>bits</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>b0110</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>add</span> <span style=color:#66d9ef>sum</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>sum</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>y</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>width</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_y4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>x</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>add</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>clt</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>width</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span><span style=color:#960050;background-color:#1e0010>|</span><span style=color:#66d9ef>jump</span> <span style=color:#66d9ef>loop_x4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>add</span> <span style=color:#66d9ef>sum</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>halt</span>
</span></span></code></pre></div><h3 id=robot-racing-now-with-more-cheating>Robot Racing (now with more cheating)</h3><p>Okay, I lied. One more. Back to the <a href=https://en.wikipedia.org/wiki/Hilbert%20curve>Hilbert curve</a> problem. One of the achievements for this game is to solve the entire problem in less than 64 bytes&mldr;</p><p>Given everything you&rsquo;ve seen, you might be able to guess how I &lsquo;solved&rsquo; this one. &#x1f604;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>mode_rom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>label</span> <span style=color:#66d9ef>loop</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>load</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>out</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>jump</span> <span style=color:#66d9ef>loop</span>
</span></span></code></pre></div><p>That&rsquo;s so dumb. But also so awesome. Basically, I have persistent memory now, so before running this problem, I run a different one to just store all the moves in order in persistent memory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>down</span>  <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>left</span>  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>const</span> <span style=color:#66d9ef>up</span>    <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mode_rom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>up</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>down</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>...</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>up</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>right</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#66d9ef>down</span> <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>And it&rsquo;s <em>actually</em> persistent, even between problems. Whee!</p><p>I found that amusing.</p><h2 id=future-work>Future work</h2><p>And that&rsquo;s it. Turing complete!</p><p>If I ever come back to this, I would love to make a full 64-bit architecture. I bet I could mostly just change all of the registers and RAM/ROM to be 64-bit and that should do it.</p><p>Another option? Implement a LISP machine / stack machine / <a href=https://en.wikipedia.org/wiki/reverse%20Polish%20notation>reverse Polish notation</a>. Something totally different.</p><p>Will I? Who knows!</p><p>Onward!</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>