<!doctype html><html><head><title>Backing up Moves Data â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.30448892aa1f91e9c4cb5494e5c5e5abc13b7778de7786e5256cdc7d2424813a.js integrity="sha256-MESIkqofkenEy1SU5cXlq8E7d3jed4blJWzcfSQkgTo=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg=" defer></script>
<script src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90=" defer></script>
<script src=/main.min.82ab51144325fae71ddbca46269a80c63b28bdab6be6b01aa9ec638c013748e6.js integrity="sha256-gqtRFEMl+ucd28pGJpqAxjsovatr5rAaqexjjAE3SOY=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.7cfac95bdd962d85ceec560e50fe7b04c44b58a76e5202006ef36ca8c0a7d836.css integrity="sha256-fPrJW92WLYXO7FYOUP57BMRLWKduUgIAbvNsqMCn2DY="><link rel=stylesheet href=/main.min.5cb1123af6f7b30230b5393c75ce8864dee1f2dcd12b5c4d5cfc0bf351a34476.css integrity="sha256-XLESOvb3swIwtTk8dc6IZN7h8tzRK1xNXPwL81GjRHY="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>Backing up Moves Data</h1><div class=entry-meta><span class=entry-date>2015-07-10</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2015/07/02/scraping-kindle-highlights/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2015/07/16/automagically-storing-python-objects-in-redis/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2015/07/02/scraping-kindle-highlights/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/backups>Backups</a><a href=https://blog.jverkamp.com/2015/09/08/backing-up-github-repositories/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2015/07/02/scraping-kindle-highlights/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2015/07/16/automagically-storing-python-objects-in-redis/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2015/07/05/equoid/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2015/07/11/the-fuller-memorandum/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Another <a href=https://blog.jverkamp.com/2015/01/29/ios-backups-in-racket-apps/>backup post</a>, this time I&rsquo;m going to back up my data from the <a href=https://www.moves-app.com/>Moves App</a> (step counter + GPS tracker). Theoretically, it should be possible to get this same data from the app as part of my <a href=https://blog.jverkamp.com/2015/01/29/ios-backups-in-racket-apps/>iOS Backup</a> series, but the data there is in a strange binary format. Much easier to use their API.</p><p>The first step will be to make a few helper methods. As I often do with web scripts, I&rsquo;ll be using <a href=https://blog.jverkamp.com/2007/10/20/pymint-a-python-multi-interpreter/>Python</a> and the excellent <a href=http://docs.python-requests.org/en/latest/>Requests</a> library. First things first, we have to get an <code>access_token</code> using an <a href=https://en.wikipedia.org/wiki/OAuth>OAuth</a> handshake. It&rsquo;s a little complicated since our app is designed to run from the command line, yet needs to interact with the user on initial set up, but luckily that only has to be done once:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Request a new access token</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> <span style=color:#e6db74>&#39;access_token&#39;</span> <span style=color:#f92672>in</span> config:
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://api.moves-app.com/oauth/v1/authorize?response_type=code&amp;client_id=</span><span style=color:#e6db74>{client_id}</span><span style=color:#e6db74>&amp;scope=</span><span style=color:#e6db74>{scope}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(
</span></span><span style=display:flex><span>        client_id <span style=color:#f92672>=</span> config[<span style=color:#e6db74>&#39;client_id&#39;</span>],
</span></span><span style=display:flex><span>        scope <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;activity location&#39;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;Opening URL in browser...&#39;</span>)
</span></span><span style=display:flex><span>    webbrowser<span style=color:#f92672>.</span>open(url)
</span></span><span style=display:flex><span>    code <span style=color:#f92672>=</span> raw_input(<span style=color:#e6db74>&#39;Please follow prompts and enter code: &#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(<span style=color:#e6db74>&#39;https://api.moves-app.com/oauth/v1/access_token?grant_type=authorization_code&amp;code=</span><span style=color:#e6db74>{code}</span><span style=color:#e6db74>&amp;client_id=</span><span style=color:#e6db74>{client_id}</span><span style=color:#e6db74>&amp;client_secret=</span><span style=color:#e6db74>{client_secret}</span><span style=color:#e6db74>&amp;redirect_uri=</span><span style=color:#e6db74>{redirect_uri}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(
</span></span><span style=display:flex><span>        code <span style=color:#f92672>=</span> code,
</span></span><span style=display:flex><span>        client_id <span style=color:#f92672>=</span> config[<span style=color:#e6db74>&#39;client_id&#39;</span>],
</span></span><span style=display:flex><span>        client_secret <span style=color:#f92672>=</span> config[<span style=color:#e6db74>&#39;client_secret&#39;</span>],
</span></span><span style=display:flex><span>        redirect_uri <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://localhost/&#39;</span>,
</span></span><span style=display:flex><span>    ))
</span></span><span style=display:flex><span>    js <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>    print(js)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    config[<span style=color:#e6db74>&#39;access_token&#39;</span>] <span style=color:#f92672>=</span> js[<span style=color:#e6db74>&#39;access_token&#39;</span>]
</span></span><span style=display:flex><span>    config[<span style=color:#e6db74>&#39;refresh_token&#39;</span>] <span style=color:#f92672>=</span> js[<span style=color:#e6db74>&#39;refresh_token&#39;</span>]
</span></span><span style=display:flex><span>    config[<span style=color:#e6db74>&#39;user_id&#39;</span>] <span style=color:#f92672>=</span> js[<span style=color:#e6db74>&#39;user_id&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;config.yaml&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> fout:
</span></span><span style=display:flex><span>        yaml<span style=color:#f92672>.</span>safe_dump(config, fout, default_flow_style<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span></code></pre></div><p>Basically, we have to have two values to start the handshake: <code>client_id</code> and <code>client_secret</code>. I&rsquo;ve put those in a separate file (<code>config.yaml</code>) so that we don&rsquo;t have secrets in a repository. From there, we make a request to a given endpoint (see above), which opens in a browser. The user then gets an eight digit code which they enter in the app on the phone, prompting the web browser in turn to redirect with a <code>code</code> parameter. This part is a little ugly and I could make it much nicer by running a temporary single endpoint server, but since this only needs to be done once, I didn&rsquo;t bother.</p><p>After that, we take the <code>code</code> we just got, along with the <code>client_id</code> and <code>client_secret</code> and get the initial <code>access_token</code> and a <code>refresh_token</code> we can periodically use to prove we&rsquo;re still the same person.</p><p>Next, a little bit of framework. We&rsquo;ll wrap the default <code>requests</code> object to automatically provide an <code>access_token</code> to any <code>GET</code> or <code>POST</code> requests I want to make to the API, now that I&rsquo;ve gotten one:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>makeMethod</span>(f):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run</span>(url, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;access_token&#39;</span> <span style=color:#f92672>in</span> config:
</span></span><span style=display:flex><span>            headers <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;Authorization&#39;</span>: <span style=color:#e6db74>&#39;Bearer </span><span style=color:#e6db74>{access_token}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(access_token <span style=color:#f92672>=</span> config[<span style=color:#e6db74>&#39;access_token&#39;</span>])}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            headers <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://api.moves-app.com/api/1.1&#39;</span> <span style=color:#f92672>+</span> url<span style=color:#f92672>.</span>format(<span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;data&#39;</span> <span style=color:#f92672>in</span> kwargs:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> f(url, data <span style=color:#f92672>=</span> kwargs[<span style=color:#e6db74>&#39;data&#39;</span>], headers <span style=color:#f92672>=</span> headers)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> f(url, headers <span style=color:#f92672>=</span> headers)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get <span style=color:#f92672>=</span> makeMethod(requests<span style=color:#f92672>.</span>get)
</span></span><span style=display:flex><span>post <span style=color:#f92672>=</span> makeMethod(requests<span style=color:#f92672>.</span>post)
</span></span></code></pre></div><p>With that, we can just always use that <code>refresh_token</code> we got above every time we run the script. This is definitely over kill, but it saves a little bit of logic telling when we have to refresh the code or not and doesn&rsquo;t really cost anything more than a single extra request:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Perform a refresh on the access token just as a matter of course</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(<span style=color:#e6db74>&#39;https://api.moves-app.com/oauth/v1/access_token&#39;</span>, data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;grant_type&#39;</span>: <span style=color:#e6db74>&#39;refresh_token&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;refresh_token&#39;</span>: config[<span style=color:#e6db74>&#39;refresh_token&#39;</span>],
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;client_id&#39;</span>: config[<span style=color:#e6db74>&#39;client_id&#39;</span>],
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;client_secret&#39;</span>: config[<span style=color:#e6db74>&#39;client_secret&#39;</span>]
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>js <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>config[<span style=color:#e6db74>&#39;access_token&#39;</span>] <span style=color:#f92672>=</span> js[<span style=color:#e6db74>&#39;access_token&#39;</span>]
</span></span><span style=display:flex><span>config[<span style=color:#e6db74>&#39;refresh_token&#39;</span>] <span style=color:#f92672>=</span> js[<span style=color:#e6db74>&#39;refresh_token&#39;</span>]
</span></span><span style=display:flex><span>config[<span style=color:#e6db74>&#39;user_id&#39;</span>] <span style=color:#f92672>=</span> js[<span style=color:#e6db74>&#39;user_id&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;config.yaml&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> fout:
</span></span><span style=display:flex><span>    yaml<span style=color:#f92672>.</span>safe_dump(config, fout, default_flow_style<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span></code></pre></div><p>Next, fetch my user profile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Load the user profile to see how far back data goes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>user_profile <span style=color:#f92672>=</span> get(<span style=color:#e6db74>&#39;/user/profile&#39;</span>)<span style=color:#f92672>.</span>json()
</span></span></code></pre></div><p>The most interesting bit of information here is <code>.profile.firstDate</code>, which tells us when we first started using Moves. We can then loop from that date forward in time, grabbing any days we are missing. Since sometimes previous days aren&rsquo;t completely done processing the next morning, I&rsquo;ll also always re-download the last week&rsquo;s worth of data no matter what.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Loop through all missing files, or force load anything less than a week ago</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>date <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>strptime(user_profile[<span style=color:#e6db74>&#39;profile&#39;</span>][<span style=color:#e6db74>&#39;firstDate&#39;</span>], <span style=color:#e6db74>&#39;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>today <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>now()
</span></span><span style=display:flex><span>oneWeekAgo <span style=color:#f92672>=</span> today <span style=color:#f92672>-</span> datetime<span style=color:#f92672>.</span>timedelta(days <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> date <span style=color:#f92672>&lt;</span> today:
</span></span><span style=display:flex><span>    dir <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#39;data&#39;</span>, date<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;%Y&#39;</span>), date<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;%m&#39;</span>))
</span></span><span style=display:flex><span>    filename <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(dir, date<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#39;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;.json&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> date <span style=color:#f92672>&gt;</span> oneWeekAgo <span style=color:#f92672>and</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(filename):
</span></span><span style=display:flex><span>        date <span style=color:#f92672>+=</span> datetime<span style=color:#f92672>.</span>timedelta(days <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(dir):
</span></span><span style=display:flex><span>        os<span style=color:#f92672>.</span>makedirs(dir)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print(filename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> get(<span style=color:#e6db74>&#39;/user/storyline/daily/</span><span style=color:#e6db74>{date}</span><span style=color:#e6db74>?trackPoints=true&#39;</span>, date <span style=color:#f92672>=</span> date<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> response<span style=color:#f92672>.</span>status_code <span style=color:#f92672>!=</span> <span style=color:#ae81ff>200</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;Bad response, stopping&#39;</span>)
</span></span><span style=display:flex><span>        print(response<span style=color:#f92672>.</span>text)
</span></span><span style=display:flex><span>        sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> int(response<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;x-ratelimit-minuteremaining&#39;</span>]) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;Rate limited, waiting one minute before continuing&#39;</span>)
</span></span><span style=display:flex><span>        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>60</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> int(response<span style=color:#f92672>.</span>headers[<span style=color:#e6db74>&#39;x-ratelimit-hourremaining&#39;</span>]) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;Rate limited, wait one hour and try again&#39;</span>)
</span></span><span style=display:flex><span>        time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>3600</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> codecs<span style=color:#f92672>.</span>open(filename, <span style=color:#e6db74>&#39;w&#39;</span>, <span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#66d9ef>as</span> fout:
</span></span><span style=display:flex><span>        fout<span style=color:#f92672>.</span>write(response<span style=color:#f92672>.</span>text)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    date <span style=color:#f92672>+=</span> datetime<span style=color:#f92672>.</span>timedelta(days <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><p>There is a neat bit in there with the <code>x-ratelimit-minuteremaining</code> and <code>x-ratelimit-hourremaining</code>. If we&rsquo;re downloading the entire history for the first time, you&rsquo;re going to get rate limited. So in this case, we&rsquo;ll wait a minute or an hour until the rate limit has expired.</p><p>And that&rsquo;s it. In the end, I end up with a pile of files, one for each day, each with exactly where I was on that day. I can use that data for all sorts of interesting analytics, like how far I walk in the average week, what my area of influence is, or even to combine with my <a href=/photography/>photography</a> so that I can geotag my pictures. It&rsquo;s a lot of fun.</p><p>So, yes. I am something of a digital hoarder. But on the flip side, storage space is cheap and data is interesting. Perhaps I&rsquo;ll get a post or two out of making pretty pretty pictures out of where all I&rsquo;ve been!</p><p>If you&rsquo;d like to see / download the entire script for my Moves backup (or any of my other non-iOS backups, those are <a href=https://blog.jverkamp.com/2015/01/29/ios-backups-in-racket-apps/>here</a>), you can do so here: <a href=https://github.com/jpverkamp/backup>jpverkamp/backup on GitHub</a></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>