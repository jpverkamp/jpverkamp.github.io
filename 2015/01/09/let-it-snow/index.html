<!doctype html><html><head><title>Let it snow! – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Let it snow!</h1><div class=entry-meta><span class=entry-date>2015-01-09</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2015/01/22/ios-backups-in-racket-groundwork/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2015/01/22/ios-backups-in-racket-groundwork/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/stack-exchange>Stack Exchange</a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/cellular-automata>Cellular Automata</a><a href=https://blog.jverkamp.com/2016/12/18/aoc-2016-day-18-its-a-trap/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/graphics>Graphics</a><a href=https://blog.jverkamp.com/2015/03/05/gif-shrinkage-with-imagemagick/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/09/17/invader-fractals/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/procedural-content>Procedural Content</a><a href=https://blog.jverkamp.com/2016/12/13/aoc-2016-day-13-noisy-puzzle/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2015/01/22/ios-backups-in-racket-groundwork/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2015/01/14/writing-excuses-10.1-five-story-ideas/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>♫ Oh the weather outside is frightful<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>&mldr; ♫</p><figure><img src=/embeds/2015/snowflake.gif></figure><p>Today&rsquo;s post is inspired once again by the <a href=https://codegolf.stackexchange.com/>Code Golf StackExchange</a>: <a href=https://codegolf.stackexchange.com/questions/42506/draw-a-snowflake>Draw a snowflake</a>. Sounds simple enough, yes?</p><p>The basic idea is to take a similar sort of code to what I used about 10 months ago when I wrote a post on <a href=https://blog.jverkamp.com/2014/03/11/brownian-trees/>Brownian trees</a>. The main difference this time is that this time we want <a href=https://en.wikipedia.org/wiki/rotational/radial>rotational symmetry</a> and <a href=https://en.wikipedia.org/wiki/reflectional>reflectional symmetry</a> symmetry. To do that, instead of generating points in an entire circular world, we will instead use only a slice, which we can than repeat and rotate. It turns out there&rsquo;s a reasonable amount of math involved in making that actually work right, but the code should still be fairly straight forward.</p><p>First, we need to decide what data types we&rsquo;re going to work with. Originally, I had a struct for both the points and the snowflakes themselves, but then I realized with have a very powerful tool at our disposal: <a href=https://en.wikipedia.org/wiki/complex%20numbers>complex numbers</a>.</p><p>What does representing points as complex numbers buy us?</p><ul><li>Conversion between <a href=https://en.wikipedia.org/wiki/cartesian%20coordinates>cartesian coordinates</a> (<code><a href="http://docs.racket-lang.org/search/index.html?q=make-rectangular">make-rectangular</a></code>
) and <a href=https://en.wikipedia.org/wiki/polar%20coordinates>polar coordinates</a> with <code><a href="http://docs.racket-lang.org/search/index.html?q=make-rectangular">make-rectangular</a></code>
and <code><a href="http://docs.racket-lang.org/search/index.html?q=make-polar">make-polar</a></code></li><li>Add offsets to points</li><li>Determine the distance between two points with subtration and <code><a href="http://docs.racket-lang.org/search/index.html?q=magnitude">magnitude</a></code></li><li>The ability to rate points (again via <code><a href="http://docs.racket-lang.org/search/index.html?q=make-polar">make-polar</a></code>
)</li></ul><p>Sounds worth doing. &#x1f604;</p><p>So then we just need a structure for snowflakes to start with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>(<span style=color:#66d9ef>struct</span> snowflake (radius arms points) <span style=color:#66d9ef>#:prefab</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Generate a new snowflake with the given number of arms</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (make-snowflake radius arms)
</span></span><span style=display:flex><span>  (snowflake radius arms <span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>0</span>)))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p><code>radius</code> and <code>arms</code> will be constants that store the structure of the snowflake, while <code>points</code> will change (sans mutation, since we didn&rsquo;t make it <code>#:mutable</code>) as we add more points. Originally I had a grid of points, but since we&rsquo;re moving going to be constantly converting between cartesean and polar coordinates and moving about in a continuous space, it didn&rsquo;t work so well. On the down side, the larger an image gets, the longer it takes to compare to previous points. If I wanted to optimize this, something like a <a href=https://en.wikipedia.org/wiki/quadtree>quadtree</a>, but at the moment, this works well enough.</p><p>Next, we want the ability to add points to a snowflake, or to check if a point is currently in it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Rotate a point so that the angle is in the range [θ, -θ)</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (clampθ p θmin θmax)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> θΔ (- θmax θmin))
</span></span><span style=display:flex><span>  (make-polar
</span></span><span style=display:flex><span>   (magnitude p)
</span></span><span style=display:flex><span>   (<span style=color:#66d9ef>let</span> loop ([θ (<span style=color:#66d9ef>if</span> (= <span style=color:#ae81ff>0</span> p) <span style=color:#ae81ff>0</span> (angle p))])
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>cond</span>
</span></span><span style=display:flex><span>       [(&lt;  θ θmin) (loop (+ θ θΔ))]
</span></span><span style=display:flex><span>       [(&gt;= θ θmax) (loop (- θ θΔ))]
</span></span><span style=display:flex><span>       [<span style=color:#66d9ef>else</span>        θ]))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Test if a snowflake contains a point within a given Δ</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Return the index of the point if it does, #f otherwise</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (snowflake-contains? s p Δ)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (snowflake radius arms points) s)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> θ  (/ 2π arms))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> pα (clampθ p <span style=color:#ae81ff>0</span> θ))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> pβ (make-polar (magnitude pα) (<span style=color:#66d9ef>if</span> (= pα <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>0</span> (- θ (angle pα)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>for/first</span> ([i (in-naturals)]
</span></span><span style=display:flex><span>              [point (in-list points)]
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>#:when</span> (<span style=color:#66d9ef>or</span> (&lt; (magnitude (- pα point)) Δ)
</span></span><span style=display:flex><span>                         (&lt; (magnitude (- pβ point)) Δ)))
</span></span><span style=display:flex><span>    i))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Add a new point to the snowflake</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (snowflake-set s p)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (snowflake radius arms points) s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> θmax (/ 2π arms))
</span></span><span style=display:flex><span>  (snowflake radius arms (cons (clampθ p <span style=color:#ae81ff>0</span> θmax) points)))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Oof. That&rsquo;s an intense bit of code. First, the <code>clampθ</code> function. The goal here is, as mentioned earlier, we want to be able to take an arbitrary point and rotate it so that it&rsquo;s in a range we can specify. Basically, modular arithmatic on angles, whee!</p><p>Next, checking if a <code>snowflake-contains?</code> a point. This has one particularly interesting argument: <code>Δ</code>. This basically is a margin of error. That way we can check if a point is &lsquo;close enough&rsquo; to any of the points currently in the snowflake, thus building the brownian tree. Next, we have <code>pα</code> and <code>pβ</code>. <code>pα</code> is taking the point and rotating it into the proper frame of reference (giving the rotational symmetry we want), while <code>pβ</code> gives us reflectional symmetry.</p><p>Likewise, <code>snowflake-set</code> adds a point to the snowflake. This one is much simpler, just adding the point to the snowflake. Here&rsquo;s where we aren&rsquo;t actually mutating the snowflake, but rather returning a new copy.</p><p>Cool<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><p>Now, the meat and potatoes: The function that makes a snowflake grow:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Generate a new point on the snowflake by drifting a point inwards</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (snowflake-grow s [Δ (sqrt <span style=color:#ae81ff>2</span>)])
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (snowflake radius arms points) s)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let</span> loop ([p (make-polar radius (* (random) 2π))])
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>cond</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; Hit an already existing point, add it and return</span>
</span></span><span style=display:flex><span>      [(snowflake-contains? s p Δ)
</span></span><span style=display:flex><span>       (snowflake-set s p)]
</span></span><span style=display:flex><span>      <span style=color:#75715e>; Otherwise, try to drift inwards</span>
</span></span><span style=display:flex><span>      [<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>       (loop
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>for/fold</span> ([p p])
</span></span><span style=display:flex><span>                  ([step (in-list
</span></span><span style=display:flex><span>                          (list
</span></span><span style=display:flex><span>                           <span style=color:#75715e>; Drift randomly</span>
</span></span><span style=display:flex><span>                           (<span style=color:#66d9ef>λ</span> (p) (+ p (make-polar
</span></span><span style=display:flex><span>                                        (* (random) Δ)
</span></span><span style=display:flex><span>                                        (* (random) 2π))))
</span></span><span style=display:flex><span>                           <span style=color:#75715e>; Drift inwards</span>
</span></span><span style=display:flex><span>                           (<span style=color:#66d9ef>λ</span> (p) (make-polar
</span></span><span style=display:flex><span>                                   (- (magnitude p) (* (random) Δ))
</span></span><span style=display:flex><span>                                   (angle p)))))])
</span></span><span style=display:flex><span>          (step p)))])))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>I think the strangest bit in this code is the <code>for/fold</code> in the middle. Basically, it will apply a series of functions to a point in order to make it wiggle around. Why I did this was that I was experimenting with a number of other &lsquo;wiggle&rsquo; functions as I was developing. In the end, I only have two&ndash;one for random motion, the other for inwards drift&ndash;but I liked the style well enough so I kept it.</p><p>Specifically, the first of the two functions, will generate a new random point that is up <code>Δ</code> units away in any direction and add it to our current flake. The second will keep the same angle, but move directly inwards, again by a random amount up to <code>Δ</code>. This is exactly why we wanted to use complex numbers for our points.</p><p>So all we have to do to make a snowflake is to call this function a bunch of times in a row:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>(render-snowflake
</span></span><span style=display:flex><span>   (<span style=color:#66d9ef>for/fold</span> ([s (make-snowflake <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>6</span>)])
</span></span><span style=display:flex><span>             ([i (in-range <span style=color:#ae81ff>20</span>)])
</span></span><span style=display:flex><span>     (snowflake-grow s <span style=color:#ae81ff>4</span>)))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><figure><img src=/embeds/2015/sample-6-20steps.png></figure><p>(We&rsquo;ll define <code>render-snowflake</code> in a bit.)</p><p>Cool! We already have some nice flakey structure. Let&rsquo;s take it out to it&rsquo;s logical conclusion and keep growing until we hit the radius:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Generate an entire snowflake</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (generate-snowflake radius arms [Δ (sqrt <span style=color:#ae81ff>2</span>)])
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let</span> loop ([s (make-snowflake radius arms)])
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define</span> s^ (snowflake-grow s Δ))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if</span> (&gt; (magnitude (car (snowflake-points s^))) radius)
</span></span><span style=display:flex><span>        s^
</span></span><span style=display:flex><span>        (loop s^))))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Basically, we keep adding points. If, at any point, the newest point added was further out from the center than our radius, we&rsquo;re done. Bam.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (render-snowflake (generate-snowflake <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>4</span>))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><figure><img src=/embeds/2015/sample-6.png></figure><p>Or we can generate a bunch of snowflakes with different numbers of arms:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (<span style=color:#66d9ef>for/list</span> ([arms (in-range <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>9</span>)])
</span></span><span style=display:flex><span>    (render-snowflake (generate-snowflake <span style=color:#ae81ff>50</span> arms <span style=color:#ae81ff>4</span>)))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p><figure><img src=/embeds/2015/sample-arms-3.png></figure><figure><img src=/embeds/2015/sample-arms-4.png></figure><figure><img src=/embeds/2015/sample-arms-5.png></figure><figure><img src=/embeds/2015/sample-arms-6.png></figure><figure><img src=/embeds/2015/sample-arms-7.png></figure><figure><img src=/embeds/2015/sample-arms-8.png></figure></p><p>Or we can experiment with different values for the packing radius:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (<span style=color:#66d9ef>for/list</span> ([Δ (in-list (list <span style=color:#ae81ff>1</span> (sqrt <span style=color:#ae81ff>2</span>) <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> π <span style=color:#ae81ff>4</span>))])
</span></span><span style=display:flex><span>    (render-snowflake (generate-snowflake <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>6</span> Δ)))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p><figure><img src=/embeds/2015/sample-delta-1.png></figure><figure><img src=/embeds/2015/sample-delta-root2.png></figure><figure><img src=/embeds/2015/sample-delta-2.png></figure><figure><img src=/embeds/2015/sample-delta-3.png></figure><figure><img src=/embeds/2015/sample-delta-pi.png></figure><figure><img src=/embeds/2015/sample-delta-4.png></figure></p><p>Okay, so how have I been rendering these things?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Render a snowflake to a bitmap</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (render-snowflake s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (snowflake radius arms data) s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> size (+ <span style=color:#ae81ff>1</span> (* radius <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (flomap-&gt;bitmap
</span></span><span style=display:flex><span>   (build-flomap*
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>1</span> size size
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>λ</span> (x y)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>define</span> p (make-rectangular (- x radius) (- y radius)))
</span></span><span style=display:flex><span>      (vector (<span style=color:#66d9ef>if</span> (snowflake-contains? s p <span style=color:#ae81ff>1</span>) <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>))))))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Simple. That&rsquo;s the beauty of making that <code>snowflake-contains?</code> function as we did earlier.</p><p>One neat trick that we can do though, since we have all of the points ordered by how they were added to the snowflake (albeit in reverse), we can render each step along the way as a single frame:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Render a snowflake being formed</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (render-snowflake/frames s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (snowflake radius arms data) s)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> snowflakes
</span></span><span style=display:flex><span>    (reverse
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>for/fold</span> ([s* (list (make-snowflake radius arms))])
</span></span><span style=display:flex><span>               ([pt (in-list (reverse data))])
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>match-define</span> (list* first rest) s*)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>match-define</span> (snowflake <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>_</span> data^) first)
</span></span><span style=display:flex><span>       (list* (snowflake radius arms (cons pt data^)) s*))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (map render-snowflake snowflakes))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>And turn that into a fun animation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>(<span style=color:#66d9ef>require</span> mrlib/gif)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(write-animated-gif
</span></span><span style=display:flex><span> (render-snowflake/frames (generate-snowflake <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span> filename
</span></span><span style=display:flex><span> <span style=color:#66d9ef>#:last-frame-delay</span> <span style=color:#ae81ff>50</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><figure><img src=/embeds/2015/snowflake.gif></figure><p>I&rsquo;ve not used the <code><a href="http://docs.racket-lang.org/search/index.html?q=mrlib/gif">mrlib/gif</a></code>
library before (instead I&rsquo;ve been using <code><a href="http://docs.racket-lang.org/search/index.html?q=2htdp/universe">2htdp/universe</a></code>
to generate the frames and <a href=http://www.imagemagick.org/>ImageMagick</a> to combine them), but it&rsquo;s really nice. Should make future animations even easier!</p><p>One step further, we can take that index from <code>snowflake-contains?</code> to colorize images. We just need to tweak <code>render-snowflake</code> a bit:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Render a snowflake to a bitmap</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (render-snowflake s <span style=color:#66d9ef>#:colorize?</span> [colorize? <span style=color:#66d9ef>#f</span>])
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (snowflake radius arms data) s)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> size (+ <span style=color:#ae81ff>1</span> (* radius <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> data-length (length data))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (flomap-&gt;bitmap
</span></span><span style=display:flex><span>   (build-flomap*
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if</span> colorize? <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>1</span>) size size
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>λ</span> (x y)
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>define</span> p (make-rectangular (- x radius) (- y radius)))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>define</span> index (snowflake-contains? s p <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>cond</span>
</span></span><span style=display:flex><span>        [(<span style=color:#66d9ef>and</span> colorize? index) (<span style=color:#66d9ef>let</span> ([g (- <span style=color:#ae81ff>1</span> (/ index data-length))])
</span></span><span style=display:flex><span>                                 (vector g g <span style=color:#ae81ff>1</span>))]
</span></span><span style=display:flex><span>        [colorize?             (vector <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>)]
</span></span><span style=display:flex><span>        [index                 (vector <span style=color:#ae81ff>1</span>)]
</span></span><span style=display:flex><span>        [<span style=color:#66d9ef>else</span>                  (vector <span style=color:#ae81ff>0</span>)])))))<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Trying it out:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (write-animated-gif
</span></span><span style=display:flex><span>   (render-snowflake/frames (generate-snowflake <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>4</span>) <span style=color:#66d9ef>#:colorize?</span> <span style=color:#66d9ef>#t</span>)
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>   filename
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>#:last-frame-delay</span> <span style=color:#ae81ff>50</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><figure><img src=/embeds/2015/snowflake-colorized.gif></figure><p>And there we have it. As always, the code is available on GitHub: <a href=https://github.com/jpverkamp/small-projects/blob/master/blog/let-it-snow.rkt>let-it-snow.rkt</a></p><p>♫ Let it snow, let it snow, let it snow! ♫<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Honestly, it&rsquo;s not. The weather here is really nice. That&rsquo;s one of the reasons I moved here in the first place.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Heh.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>To the tune of Frozen&rsquo;s Let it Go. &#x1f607;&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>