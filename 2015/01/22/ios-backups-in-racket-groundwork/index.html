<!doctype html><html><head><title>iOS Backups in Racket: Groundwork â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.30448892aa1f91e9c4cb5494e5c5e5abc13b7778de7786e5256cdc7d2424813a.js integrity="sha256-MESIkqofkenEy1SU5cXlq8E7d3jed4blJWzcfSQkgTo=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg=" defer></script>
<script src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90=" defer></script>
<script src=/main.min.82ab51144325fae71ddbca46269a80c63b28bdab6be6b01aa9ec638c013748e6.js integrity="sha256-gqtRFEMl+ucd28pGJpqAxjsovatr5rAaqexjjAE3SOY=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.7cfac95bdd962d85ceec560e50fe7b04c44b58a76e5202006ef36ca8c0a7d836.css integrity="sha256-fPrJW92WLYXO7FYOUP57BMRLWKduUgIAbvNsqMCn2DY="><link rel=stylesheet href=/main.min.5cb1123af6f7b30230b5393c75ce8864dee1f2dcd12b5c4d5cfc0bf351a34476.css integrity="sha256-XLESOvb3swIwtTk8dc6IZN7h8tzRK1xNXPwL81GjRHY="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>iOS Backups in Racket: Groundwork</h1><div class=entry-meta><span class=entry-date>2015-01-22</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2015/01/09/let-it-snow/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2015/01/23/ios-backups-in-racket-contacts/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2015/01/09/let-it-snow/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2015/01/23/ios-backups-in-racket-contacts/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2012/09/05/backing-up-google-reader-/-calendar/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/backups>Backups</a><a href=https://blog.jverkamp.com/2015/01/23/ios-backups-in-racket-contacts/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/06/17/factor-trees/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/data-structures>Data Structures</a><a href=https://blog.jverkamp.com/2015/01/23/ios-backups-in-racket-contacts/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/series/ios-backups-in-racket>iOS Backups in Racket</a><a href=https://blog.jverkamp.com/2015/01/23/ios-backups-in-racket-contacts/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2015/01/09/let-it-snow/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2015/01/23/ios-backups-in-racket-contacts/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2015/01/21/writing-excuses-10.2-combine-and-grow/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2015/01/23/ios-backups-in-racket-contacts/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>For the last little while, I&rsquo;ve been spending my spare programming time working on a slightly larger project than I normally do: a <a href=https://blog.jverkamp.com/2014/06/11/call-stack-bracket-matcher/>Racket</a> library for reading iOS backups.</p><p>Basically, I want to take the mess that is an iOS backup (not particularly designed to be easy to read by other programs) and extract some information from it, backing it up in a more easily readable format.</p><p>Specifically, I would like to be able to backup:</p><ul><li>Contact information: Even thought they&rsquo;re mostly from Facebook, it will be useful for the other parts</li><li>Messages: These are taking up a large portion of my phone&rsquo;s hard drive, mostly due to attachments. Back them up just in case<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></li><li>Photos: I&rsquo;m already backing these up, but it would be nice to have it in the same process</li><li>Application data:</li><li>List of applications over time</li><li><a href=https://www.moves-app.com/>Moves</a>: GPS location</li><li><a href=http://www.downcastapp.com/>Downcast</a>: List of current podcasts</li><li><a href=http://www.sleepcycle.com/>Sleep Cycle</a>: Sleep data</li><li><a href=http://www.boardgamescorer.com/>Boardgame Scorer</a>: High scores for board games</li></ul><p>The first thing to look at is the basic structure of the iOS backup directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>~/Library/Application Support/MobileSync/Backup/
</span></span><span style=display:flex><span>    86b1...aa36/
</span></span><span style=display:flex><span>        0003...1b9a
</span></span><span style=display:flex><span>        0009...521c
</span></span><span style=display:flex><span>        000b...46ab
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span>        fff6...5152
</span></span><span style=display:flex><span>        fff8...9f8a
</span></span><span style=display:flex><span>        fffa...ca34
</span></span><span style=display:flex><span>        Info.plist
</span></span><span style=display:flex><span>        Manifest.mbdb
</span></span><span style=display:flex><span>        Manifest.plist
</span></span><span style=display:flex><span>        Status.plist
</span></span></code></pre></div><p>Okay, that&rsquo;s helpful<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. 6788 files, all but four of which named via <a href=https://en.wikipedia.org/wiki/SHA-1>SHA-1</a> hashes. I know that there are pictures, applications, and various databases here, so there has to be a map somewhere.</p><p>But first, those last four files:</p><ul><li><code>Info.plist</code> - Contains information about the backup, including the phone&rsquo;s name, various IDs, the phone&rsquo;s number, and versioning information</li><li><code>Manifest.mbdb</code> - Binary file containing a listing of every file in the backup</li><li><code>Manifest.plist</code> - Legacy file, useful information is mostly a list of installed applications</li><li><code>Status.plist</code> - Mostly a subset of the information in <code>Info.plist</code></li></ul><p>Of those, we&rsquo;ll start with the first one. We want to be able to load that information into a basic structure to represent a backup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Represents an iPhone backup on disk</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>struct</span> backup (name hash date phone-number path) <span style=color:#66d9ef>#:prefab</span>)
</span></span></code></pre></div><p>Cool. First thing first, let&rsquo;s find the backups on disk. We want to be able to support either Windows or OSX (I use both), so try both locations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Load all backups on disk into a list</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> list-backups
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let*</span> (<span style=color:#75715e>; OS agnostic (I hope) way of finding the backup root</span>
</span></span><span style=display:flex><span>         [backup-root
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>for*/first</span> ([path-parts (in-list <span style=color:#f92672>&#39;</span>((<span style=color:#e6db74>&#34;AppData&#34;</span> <span style=color:#e6db74>&#34;Roaming&#34;</span> <span style=color:#e6db74>&#34;Apple Computer&#34;</span>
</span></span><span style=display:flex><span>                                               <span style=color:#e6db74>&#34;MobileSync&#34;</span> <span style=color:#e6db74>&#34;Backup&#34;</span>)
</span></span><span style=display:flex><span>                                              (<span style=color:#e6db74>&#34;Library&#34;</span> <span style=color:#e6db74>&#34;Application Support&#34;</span>
</span></span><span style=display:flex><span>                                                <span style=color:#e6db74>&#34;MobileSync&#34;</span> <span style=color:#e6db74>&#34;Backup&#34;</span>)))]
</span></span><span style=display:flex><span>                       [path (in-value (apply build-path
</span></span><span style=display:flex><span>                                              (cons (find-system-path <span style=color:#f92672>&#39;</span><span style=color:#e6db74>home-dir</span>)
</span></span><span style=display:flex><span>                                                    path-parts)))]
</span></span><span style=display:flex><span>                       <span style=color:#66d9ef>#:when</span> (directory-exists? path))
</span></span><span style=display:flex><span>            path)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#75715e>; List all backups in that directory, along with some metadata</span>
</span></span><span style=display:flex><span>         [backups
</span></span><span style=display:flex><span>          (<span style=color:#66d9ef>for/list</span> ([dir (in-list (directory-list backup-root))])
</span></span><span style=display:flex><span>            (<span style=color:#66d9ef>define</span> info-file
</span></span><span style=display:flex><span>              (call-with-input-file (build-path backup-root dir <span style=color:#e6db74>&#34;Info.plist&#34;</span>)
</span></span><span style=display:flex><span>                read-plist/jsexpr))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            (backup (dict-ref info-file <span style=color:#f92672>&#39;</span><span style=color:#e6db74>|Device Name|</span>)
</span></span><span style=display:flex><span>                    (path-&gt;string dir)
</span></span><span style=display:flex><span>                    (dict-ref info-file <span style=color:#f92672>&#39;</span><span style=color:#e6db74>|Last Backup Date|</span>)
</span></span><span style=display:flex><span>                    (normalize-contact (dict-ref info-file <span style=color:#f92672>&#39;</span><span style=color:#e6db74>|Phone Number|</span>))
</span></span><span style=display:flex><span>                    (build-path backup-root dir)))])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>Î»</span> () backups)))
</span></span></code></pre></div><p>The function is a little strange looking, mostly because of caching. Rather than scanning and loading the backup every time we want a list, scan it once on load, then return that whenever the function is called.</p><p>One thing missing though, we have to define the function <code>read-plist/jsexpr</code> yet. Luckily, we have the <code><a href="http://docs.racket-lang.org/search/index.html?q=xml/plist">xml/plist</a></code>
library to handle the first part of this<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>, but personally I&rsquo;d rather a more straight forward format (a <code><a href="http://docs.racket-lang.org/search/index.html?q=jsexpr">jsexpr</a></code>
is basically a mix of hashes, lists, and atoms):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Convert a plist into a JSON expression</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (plist-&gt;jsexpr data)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match</span> data
</span></span><span style=display:flex><span>    [(? string?) data]
</span></span><span style=display:flex><span>    [<span style=color:#f92672>`</span>(<span style=color:#e6db74>true</span>) <span style=color:#66d9ef>#t</span>]
</span></span><span style=display:flex><span>    [<span style=color:#f92672>`</span>(<span style=color:#e6db74>false</span>) <span style=color:#66d9ef>#f</span>]
</span></span><span style=display:flex><span>    [<span style=color:#f92672>`</span>(<span style=color:#e6db74>integer</span> <span style=color:#f92672>,</span>v) v]
</span></span><span style=display:flex><span>    [<span style=color:#f92672>`</span>(<span style=color:#e6db74>real</span> <span style=color:#f92672>,</span>v) v]
</span></span><span style=display:flex><span>    [<span style=color:#f92672>`</span>(<span style=color:#e6db74>data</span> <span style=color:#f92672>,</span>v) v] <span style=color:#75715e>; Should we special case these?</span>
</span></span><span style=display:flex><span>    [<span style=color:#f92672>`</span>(<span style=color:#e6db74>date</span> <span style=color:#f92672>,</span>v) v] <span style=color:#75715e>; Ditto</span>
</span></span><span style=display:flex><span>    [<span style=color:#f92672>`</span>(<span style=color:#e6db74>array</span> <span style=color:#f92672>.</span> <span style=color:#f92672>,</span>v*)
</span></span><span style=display:flex><span>     (map plist-&gt;jsexpr v*)]
</span></span><span style=display:flex><span>    [<span style=color:#f92672>`</span>(<span style=color:#e6db74>dict</span> <span style=color:#f92672>.</span> <span style=color:#f92672>,</span>kv*)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>for/hash</span> ([kv (in-list kv*)])
</span></span><span style=display:flex><span>       (values (string-&gt;symbol (second kv)) (plist-&gt;jsexpr (third kv))))]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Read a plist file as a JSON expression from a file</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (read-plist/jsexpr [in (current-input-port)])
</span></span><span style=display:flex><span>  (plist-&gt;jsexpr (read-plist in)))
</span></span></code></pre></div><p>I still haven&rsquo;t decided if special casing <code>data</code> and <code>date</code> elements is worthwhile.</p><p>The other interesting function is another utility function <code>normalize-contact</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Process a phone number or email address into a common format</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (normalize-contact value)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> re <span style=color:#e6db74>#px&#34;^\\+?1? ?[\\(\\.]?(\\d\\d\\d)[\\)\\.-]? ?(\\d\\d\\d)[ \\.-]?(\\d\\d\\d\\d)$&#34;</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>cond</span>
</span></span><span style=display:flex><span>    [(sql-null? value)
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>#f</span>]
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Standard phone numbers</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>; TODO: Figure out international numbers</span>
</span></span><span style=display:flex><span>    [(regexp-match re value)
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>=&gt;</span> (<span style=color:#66d9ef>Î»</span> (<span style=color:#66d9ef>match</span>) (string-join (rest <span style=color:#66d9ef>match</span>) <span style=color:#e6db74>&#34;.&#34;</span>))]
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Email addresses</span>
</span></span><span style=display:flex><span>    [(regexp-match <span style=color:#e6db74>#px&#34;^[^@]+@[^@]+$&#34;</span> value)
</span></span><span style=display:flex><span>     value]
</span></span><span style=display:flex><span>    <span style=color:#75715e>; Short phone numbers</span>
</span></span><span style=display:flex><span>    [(regexp-match <span style=color:#e6db74>#px&#34;^\\d{,6}$&#34;</span> value)
</span></span><span style=display:flex><span>     value]
</span></span><span style=display:flex><span>    <span style=color:#75715e>; No idea...</span>
</span></span><span style=display:flex><span>    [<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>#f</span>]))
</span></span></code></pre></div><p>Phone numbers in an iPhone backup are stored all sorts of odd ways. In particular, once you start looking at the contacts, you can get three or four different formats just for normal area code + 7 phone numbers (I haven&rsquo;t yet decided how to support international numbers). So this can be used to at least put them all in the same format.</p><p>But with that, we now have the ability to list all backups on the local system:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (list-backups)
</span></span><span style=display:flex><span><span style=color:#f92672>&#39;</span>(<span style=color:#f92672>#s</span>(<span style=color:#e6db74>backup</span>
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;JPâ€™s iPhone&#34;</span>
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;63b5...a651&#34;</span>
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;2014-04-17T21:53:16Z&#34;</span>
</span></span><span style=display:flex><span>     <span style=color:#e6db74>&#34;{redacted}&#34;</span>
</span></span><span style=display:flex><span>     <span style=color:#e6db74>#&lt;path:/Users/jp/Library/Application</span> <span style=color:#e6db74>Support/MobileSync/Backup/63b5....a651&gt;</span>))
</span></span></code></pre></div><p>It&rsquo;s an older backup, but that&rsquo;s fine.</p><p>Next, what if we have more than one backup on the system? It would be nice to have a function that could take that list of backups and load just one (that other parts of the library can access) based on name/hash/phone number:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Store the most recently used backup for other modules</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> current-backup (make-parameter <span style=color:#66d9ef>#f</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Load a specific backup, try to guess what the identifier is</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (read-backup identifier)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>for/first</span> ([backup (in-list (list-backups))]
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>#:when</span> (<span style=color:#66d9ef>or</span> (equal? identifier (backup-date backup))
</span></span><span style=display:flex><span>                         (equal? identifier (backup-name backup))
</span></span><span style=display:flex><span>                         (equal? identifier (backup-hash backup))
</span></span><span style=display:flex><span>                         (equal? identifier (backup-phone-number backup))))
</span></span><span style=display:flex><span>    backup))
</span></span></code></pre></div><p>Fair enough. At the moment, you have to have an exact match, but that&rsquo;s fine. If we want to later, we could replace the calls to <code><a href="http://docs.racket-lang.org/search/index.html?q=equal?">equal?</a></code>
with <code><a href="http://docs.racket-lang.org/search/index.html?q=regexp-match">regexp-match</a></code>
.</p><p>So now I can find my own backup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (read-backup <span style=color:#e6db74>&#34;86b1...aa36&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>&#39;#s</span>(<span style=color:#e6db74>backup</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;JPâ€™s iPhone&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;63b5...a651&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;2014-04-17T21:53:16Z&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;{redacted}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>#&lt;path:/Users/jp/Library/Application</span> <span style=color:#e6db74>Support/MobileSync/Backup/63b5....a651&gt;</span>)
</span></span></code></pre></div><p>One more utility macro:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Parameterize code with a current backup</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define-syntax-rule</span> (with-backup identifier body <span style=color:#66d9ef>...</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>parameterize</span> ([current-backup (read-backup identifier)])
</span></span><span style=display:flex><span>    body <span style=color:#66d9ef>...</span>))
</span></span></code></pre></div><p>This will be nice, since it can let us do things like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (<span style=color:#66d9ef>define</span> contacts
</span></span><span style=display:flex><span>    (with-backup <span style=color:#e6db74>&#34;86b1...aa36&#34;</span>
</span></span><span style=display:flex><span>      (list-contacts)))
</span></span></code></pre></div><p>Nice and clean.</p><p>I think that&rsquo;s about enough for today. The entire code for today&rsquo;s post (along with the entire library thus far, which is significantly further along<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>), is available on GitHub: <a href=https://github.com/jpverkamp/ios-backup>ios-backup</a></p><p>Here is a list of all of the posts in this series:</p><div class=ranking><h3 class=title>Posts in <a href=/series/ios-backups-in-racket/>iOS Backups in Racket</a>:</h3><div class=content><ul><li><a href=https://blog.jverkamp.com/2015/01/22/ios-backups-in-racket-groundwork/>iOS Backups in Racket: Groundwork</a></li><li><a href=https://blog.jverkamp.com/2015/01/23/ios-backups-in-racket-contacts/>iOS Backups in Racket: Contacts</a></li><li><a href=https://blog.jverkamp.com/2015/01/27/ios-backups-in-racket-messages/>iOS Backups in Racket: Messages</a></li><li><a href=https://blog.jverkamp.com/2015/01/29/ios-backups-in-racket-apps/>iOS Backups in Racket: Apps</a></li></ul></div></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Yeah, I know I&rsquo;m something of a digital packrat. Â¯\<em>(ãƒ„)</em>/Â¯ Disk space is cheap.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Except on iPhones. Seriously, that&rsquo;s the only difference within a model, yes?&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>For some definitions of helpful&mldr;&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Sort of. Turns out that library doesn&rsquo;t handle binary plists. We&rsquo;ll work around that when we handle applications.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>Although still somewhat lacking in documentation&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>