<!DOCTYPE html>
<html>
<head>
    <title>
    Setting up Postfix and OpenDKIM â€“ jverkamp.com
</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css">

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />


    
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper">
        <header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
        
            
        
            
            <li><a href="https://blog.jverkamp.com/photography/">Photography</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/programming/">Programming</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/research/">Research</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/writing/">Writing</a></li>
            
        
            <li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>


        <div id="page-content-wrapper">
            <div id="page-content">
            
<article>
	<header>
		<h1 class="entry-title">Setting up Postfix and OpenDKIM</h1>

        <div class="entry-meta">
            
            <span class="entry-date">2015-08-10</span>
            
            
        </div>

        <div class="entry-tags">
    
    

    <ul class="taxonomy-keys">
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                            
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/03/12/caesar-cipher/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/cryptography">Cryptography</a>
                        
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2012/09/03/backing-up-gmail/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/email">Email</a>
                        <a href="https://blog.jverkamp.com/2016/01/02/inlining-plaintext-attachments-in-gmail/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                            
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2013/09/14/diffie-hellman-key-exchange/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/public-key-cryptography">Public-key cryptography</a>
                        
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    

    
        
        <li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2015/07/22/finding-aws-iam-users-by-access-key/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2015/08/24/adjacency-matrix-generator/" class="next-link">Next</a>
                
            </ul>
        </li>
        

        
        <li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2015/08/03/the-engines-of-god/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2015/08/12/deepsix/" class="next-link">Next</a>
                
            </ul>
        </li>
        
    
    </ul>
</div>

    </header>

	<div class="entry-content">
		<p>Last week, I was presented with a fairly interesting challenge: add DKIM (via <a href="http://www.opendkim.org/">OpenDKIM</a>) support to our mail servers (running <a href="http://www.postfix.org/">Postfix</a>). Given that I&rsquo;ve never actually worked on a mail server before, it sounded fun. ðŸ˜„</p>

<p></p>

<p>First, a bit of background on what exactly DKIM is:</p>

<blockquote>
<p>DomainKeys Identified Mail (DKIM) is an email validation system designed to detect email spoofing by providing a mechanism to allow receiving mail exchangers to check that incoming mail from a domain is authorized by that domain&rsquo;s administrators and that the email (including attachments) has not been modified during transport. A digital signature included with the message can be validated by the recipient using the signer&rsquo;s public key published in the DNS.
&ndash; Wikipedia: <a href="https://en.wikipedia.org/wiki/DKIM">DKIM</a></p>
</blockquote>

<p>Sounds nice. So what in the world does that mean?</p>

<h2 id="a-bit-of-background">A bit of background</h2>

<p>Starting in the details, we have <a href="https://en.wikipedia.org/wiki/public%20key%20cryptography">public key cryptography</a>. The basic idea of public key cryptography is that you have some sort of algorithm with two keys: one of which can be used to encrypt things and can be made public and another separate piece of information which can be used to decrypt things and should remain private. That way, you can publish your public key, well, publically. Then anyone that wants to send you a message can do so, knowing that only you (since only you possess the private key) can read it.</p>

<p>If we take this a step further, we can swap the roles of the public and private key<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>. Instead of encrypting with the public key, we will use the private key, requiring the <em>public</em> key for decryption. This sounds mad, since the public key is, by definition public. So what&rsquo;s the point of a message that only you can write but anyone can read?</p>

<p>Well, that&rsquo;s exactly the point: <em>only you</em> can write it. This is what&rsquo;s called a digital signature. Since only your private key could have encoded the message and since only you have the private key, this allows anyone to read your message and be safe in the knowledge that you wrote it.</p>

<p>This is exactly what DKIM does.</p>

<p>By creating an public/private key pair, publishing the public key to a DNS record, and using the private key to sign messages, you are allowing any receiver to verify that <em>you</em> were person who sent them. Don&rsquo;t get me wrong, there are still a few problems with this approach (we&rsquo;ll get to them later), but it&rsquo;s a cool idea.</p>

<h2 id="implementation">Implementation</h2>

<p>So how do you actually implement it in practice?</p>

<p>Given that I don&rsquo;t have any particular previous experience with mail servers, the answer involves a lot of Google. Here are the steps that worked for me.</p>

<h4 id="have-a-previously-configured-server-correctly-delivering-mail-via-a-href-http-www-postfix-org-postfix-a">- Have a previously configured server correctly delivering mail via <a href="http://www.postfix.org/">Postfix</a></h4>

<h4 id="install-a-href-http-www-opendkim-org-opendkim-a">- Install <a href="http://www.opendkim.org/">OpenDKIM</a></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install -y opendkim opendkim-tools</code></pre></div>
<h4 id="generate-a-new-keypair">- Generate a new keypair</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo opendkim-genkey -s mail -d example.com</code></pre></div>
<p>The <code>-s</code> argument specifies a selector, which allows us to have multiple keypairs specified on the same domain (if we wanted to), while the <code>-d</code> is the domain we are signing for. In this case, we are generating a record for <code>mail._domainkey.example.com</code>.</p>

<p>This will generate two files. The first is <code>mail.private</code>, which we will move to <code>/etc/opendkim/keys/example.com.private</code> (to match the <code>KeyFile</code> later). Also, we need to make sure that the file has correctly narrow Unix permissions, or OpenDKIM will refuse to use it (for our own safety):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo chmod <span style="color:#ae81ff">0400</span> /etc/opendkim/keys/example.com.private
sudo chown opendkim:opendkim /etc/opendkim/keys/example.com.private
sudo adduser postfix opendkim</code></pre></div>
<p>The second file is <code>mail.txt</code>, which is a DNS record for the above domain. Set it up so this returns successfully:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ dig mail._domainkey.example.com TXT

...
;; ANSWER SECTION:
mail._domainkey.example.com. <span style="color:#ae81ff">599</span>	IN TXT <span style="color:#e6db74">&#34;v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC5N3lnvvrYgPCRSoqn+awTpE+iGYcKBPpo8HHbcFfCIIV10Hwo4PhCoGZSaKVHOjDm4yefKXhQjM7iKzEPuBatE7O47hAx1CJpNuIdLxhILSbEmbMxJrJAG0HZVn8z6EAoOHZNaPHmK2h4UUrjOG8zA5BHfzJf7tGwI+K619fFUwIDAQAB&#34;</span> ; ----- DKIM key mail <span style="color:#66d9ef">for</span> example.com
...</code></pre></div>
<p>That&rsquo;s (almost) all we have to do to configure the public half of the key pair. (We still have to use the same selector later in the <code>KeyFile</code>, but that&rsquo;s it.)</p>

<h4 id="create-an-opendkim-configuration-file-etc-opendkim-conf">- Create an OpenDKIM configuration file (<code>/etc/opendkim.conf</code>)</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Canonicalization        relaxed/relaxed
ExternalIgnoreList      refile:/etc/opendkim/TrustedHosts
InternalHosts           refile:/etc/opendkim/TrustedHosts
KeyTable                refile:/etc/opendkim/KeyTable
LogWhy                  Yes
MinimumKeyBits          <span style="color:#ae81ff">1024</span>
Mode                    sv
PidFile                 /var/run/opendkim/opendkim.pid
SigningTable            refile:/etc/opendkim/SigningTable
Socket                  inet:8891@localhost
Syslog                  Yes
SyslogSuccess           Yes
UMask                   <span style="color:#ae81ff">022</span>
UserID                  opendkim:opendkim</code></pre></div>
<p>What in the world do those all mean? Well, (based somewhat on documentation and somewhat on expirimentation):</p>

<ul>
<li><code>Canonicalization</code> - controls whether further mail servers can edit the message contents with destroying the signature. <code>relaxed</code> allows more modification, <code>simple</code> is more strict. <code>relaxed</code> seems to be the more common option.</li>
<li><code>ExternalIgnoreList</code> - hosts that we trust to send us mail; do not validate their DKIM signatures (if present). Specifying <code>refile</code> means that we can use wildcards.</li>
<li><code>InternalHosts</code> - hosts that will relay mail through us; if we see an unsigned message coming from one of them, sign it before forwarding it along (This is important! I&rsquo;ll get to why in a bit)</li>
<li><code>KeyTable</code> - a list of private keys we can use to sign messages (included later)</li>
<li><code>LogWhy</code> - log errors to <code>/var/log/mail.log</code> (useful for debugging)</li>
<li><code>MinimumKeyBits</code> - flag an error if we try to specify a private key shorter (less secure) than this</li>
<li><code>Mode</code> - various options, <code>sv</code> is fairly common and means <code>s</code>ign outgoing messages and <code>v</code>erify incoming ones</li>
<li><code>PidFile</code> - where to store the <a href="https://en.wikipedia.org/wiki/PID%20file">PID file</a></li>
<li><code>SigningTable</code> - specify which key from the <code>KeyTable</code> should be used for a given message</li>
<li><code>Socket</code> - how Postfix and OpenDKIM communicate</li>
<li><code>Syslog</code>, <code>SyslogSuccess</code> - log to <a href="https://en.wikipedia.org/wiki/syslog">syslog</a> as well as <code>mail.log</code>; log successes as well as failures</li>
<li><code>UMask</code> - allows other Linux users (such as Postfix&rsquo;s) to talk to OpenDKIM</li>
<li><code>UserID</code> - the user that OpenDKIM runs as</li>
</ul>

<p>Fairly straight forward.</p>

<h4 id="next-another-copy-of-the-socket-definition-in-etc-default-opendkim-i-m-actually-not-sure-why-this-one-is-necessary">- Next, another copy of the socket definition in <code>/etc/default/opendkim</code> (I&rsquo;m actually not sure why this one is necessary)</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">SOCKET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;inet:8891@localhost&#34;</span></code></pre></div>
<p>Next, specify our keys in <code>/etc/opendkim/KeyTable</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">example.com example.com:mail:/etc/opendkim/keys/example.com.private</code></pre></div>
<p>The first entry is a name for the key. It can be anything and doesn&rsquo;t necessary have to match the domain, just so long as the corresponding entry in <code>SigningTable</code> matches. After that, you have the domain where your public key is hosted, the selector on that domain, and where the private key is locally located. So in the above example, <code>example.com:mail</code> corresponds to a key at <code>mail._domainkey.example.com</code>.</p>

<p>And what emails to sign in <code>/etc/opendkim/SigningTable</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">*@example.com example.com
*@*.example.com example.com
*@*.example.org example.com</code></pre></div>
<p>This one is a bit more complicated, since for my particular case, I had emails coming from two different domains, along with subdomains in both cases (the first field). They can (and in this case) all use the same key, since the second entry matches the value specified in <code>KeyTable</code>.</p>

<p>Note again: Since we&rsquo;re using wildcards here, we have to specify <code>refile</code> up above in <code>opendkim.conf</code>.</p>

<h4 id="next-etc-opendkim-trustedhosts">- Next, <code>/etc/opendkim/TrustedHosts</code></h4>

<p>This file will be used to specify both incoming message we trust and outgoing message we will sign (although it doesn&rsquo;t have to do both).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ae81ff">127</span>.0.0.1
<span style="color:#ae81ff">10</span>.77.0.0/16
example.com
*.example.com
*.example.org
*.*.example.org</code></pre></div>
<p>Entries here can be either IP addresses, <a href="https://en.wikipedia.org/wiki/CIDR">CIDR</a> style IP ranges, or hostnames (including wildcards, since this is a <code>refile</code>), all of which I use above. This actually took a bit to figure out, since originally I was signing email directly from the box (successfully), but when I attempted to actually send a signed email from the product, it didn&rsquo;t work (since the frontends relay mail to the mail servers).</p>

<h4 id="okay-that-s-enough-to-configure-opendkim-next-we-need-to-tell-postfix-to-talk-to-it">- Okay, that&rsquo;s enough to configure OpenDKIM. Next, we need to tell Postfix to talk to it</h4>

<p>This one is relatively straight forward as well. Just add a few lines to the bottom of <code>/etc/postfix/main.cf</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># DKIM
</span><span style="color:#75715e"></span>milter_default_action <span style="color:#f92672">=</span> accept
milter_protocol <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
smtpd_milters <span style="color:#f92672">=</span> inet:localhost:8891
non_smtpd_milters <span style="color:#f92672">=</span> inet:localhost:8891</code></pre></div>
<p>Essentially, milter is a protocol Postfix uses for plugins. We want to configure all mail traffic (both from smptd and not) to go to OpenDKIM, via the port we specified (twice) earlier. Shiny.</p>

<h4 id="finally-restart-both-opendkim-and-postfix-so-they-can-take-advantage-of-their-new-settings">- Finally, restart both OpenDKIM and Postfix, so they can take advantage of their new settings</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo service opendkim restart
sudo service postfix restart</code></pre></div>
<p>This should only take a few seconds.</p>

<p>And that&rsquo;s it. We can send a test email:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#34;test email&#34;</span> | mail -s <span style="color:#e6db74">`</span>hostname<span style="color:#e6db74">`</span> me@example.com</code></pre></div>
<p>That will send an email with the <code>hostname</code> of the current machine to the specified address, useful if you&rsquo;re working with multiple different machines and need to know which are up to date.</p>

<p>Check the message headers and you should see a block that looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">DKIM-Signature: v<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>; a<span style="color:#f92672">=</span>rsa-sha256; c<span style="color:#f92672">=</span>relaxed/relaxed; d<span style="color:#f92672">=</span>example.com; s<span style="color:#f92672">=</span>mail;
	t<span style="color:#f92672">=</span><span style="color:#ae81ff">1439063676</span>; bh<span style="color:#f92672">=</span>RnRlt9pNo9HfghopMAD1V157IZOFVrE6piv9xdXYFNs<span style="color:#f92672">=</span>;
	h<span style="color:#f92672">=</span>To:Subject:Reply-To:From:Date;
	b<span style="color:#f92672">=</span>LekoRRQgOX97WUHP/ELtl/yhMzZsiCPr8kqaYUpZER5sYZ1dyAwgOKKvuI3mL3IMo
	 4Y90NDGv+CHm2ZmAaGmFOgGnDPsDxLE+ptleVBP/cQny9grftwA8Emc3MKS6aJ/w5P
	 E1bh2wFE8LiRTl/wcof6JL0MyeoR8R63FCKMgnA8<span style="color:#f92672">=</span></code></pre></div>
<p>Bam.</p>

<h2 id="a-few-caveats">A few caveats</h2>

<p>So, what is DKIM actually used for?</p>

<p>The original claim is that it&rsquo;s an <em>email validation system designed to detect email spoofing</em>. Which is all well and good, but there&rsquo;s one big problem: adaptation.</p>

<p>Numbers are a little hard to come by, but one site that I found is builtWith trends: <a href="https://trends.builtwith.com/mx/DKIM">DKIM Usage Statistics</a>. Their reported coverage notes:</p>

<ul>
<li>Quantcast Top 10k - 14 of 10,000</li>
<li>Quantcast Top 100k - 104 of 100,000</li>
<li>Quantcast Top Million - 585 of 865,105</li>
<li>Entire Internet - 24,064 of 328,844,222</li>
</ul>

<p>That&rsquo;s less than 0.1% in any category. Not so great.</p>

<p>This is a problem, not because it means that mail servers aren&rsquo;t using it, but rather because there is little reason for mail <em>clients</em> to support it. It&rsquo;s easy enough to verify a DKIM signature if present, but they&rsquo;re so rarely present, that most will not go through that effort.</p>

<p>Furthmore, the header does not sign the message headers and (unless you are using SMTP over TLS), it is trivial to remove. If the DKIM header is not present, the message is trivial to modify with the recipient none the wiser. This could be offset&ndash;for some business models&ndash;by requiring messages to contain a DKIM header and rejecting those that don&rsquo;t.</p>

<p>Still, it&rsquo;s an interesting technology and there&rsquo;s no particular harm (other than a small amount of extra CPU effort to do the signing) in implementing it.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">If I understand, all of the public key systems in general use have this property, although they don&rsquo;t strictly speaking have to.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
</ol>
</div>
	</div>

    
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Setting up Postfix and OpenDKIM";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2015\/08\/10\/setting-up-postfix-and-opendkim\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>


</article>

            </div>
        </div>

        <footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>

            
            <li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>
            
        </ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js"></script>

<script type="text/javascript" src="/custom.js" defer></script>

</body>
</html>
