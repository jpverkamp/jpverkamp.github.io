<!doctype html><html><head><title>Backing up GitHub repositories â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Backing up GitHub repositories</h1><div class=entry-meta><span class=entry-date>2015-09-08</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2015/08/24/adjacency-matrix-generator/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2015/09/14/mandelbrot/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2015/07/10/backing-up-moves-data/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/backups>Backups</a><a href=https://blog.jverkamp.com/2016/06/22/mirror-itunes-playlists-to-spotify/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2015/08/24/adjacency-matrix-generator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2015/09/14/mandelbrot/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2015/09/07/writing-excuses-10.5-the-market-noble/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2015/09/11/writing-excuses-10.6-second-place/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>The newest chapter in my quest to collect entirely too much data / back up All The Things!: GitHub.</p><p>Basically, I want to back up all of my own personal GitHub repositories along with any from organizations that I am involved with. Strictly speaking, this is a little strange, since it&rsquo;s unlikely that GitHub is going anywhere soon and, if it does, we are likely to have fair warning. But still, it&rsquo;s nice to have a local copy just in case GitHub is down.</p><p>The code is actually really straight forward. Most of the heavy lifting is being done by the <a href=https://github.com/copitux/python-github3>pygithub3</a> library. One caveat: it&rsquo;s a little strange to install. In my case, I had to first install <code>pygithub</code> and then <code>pygithub3</code> in order to satisfy a missing dependency (<a href=https://github.com/copitux/python-github3/issues/41>previously reported</a>).</p><p>After that, you can authenticate to GitHub, get a list of repositories, and download them all:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pygithub3
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Load a list of repos we don&#39;t want to download / update</span>
</span></span><span style=display:flex><span>ignored <span style=color:#f92672>=</span> set()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(<span style=color:#e6db74>&#39;ignore.txt&#39;</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;ignore.txt&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> fin:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> fin:
</span></span><span style=display:flex><span>            ignored<span style=color:#f92672>.</span>add(line<span style=color:#f92672>.</span>strip())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Connect to github (if you have MFA, your password must be a token)</span>
</span></span><span style=display:flex><span>gh <span style=color:#f92672>=</span> pygithub3<span style=color:#f92672>.</span>Github(os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#39;GITHUB_USERNAME&#39;</span>], os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#39;GITHUB_PASSWORD&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Loop over repos for the specified user, this will include their organization&#39;s repos as well</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> repo <span style=color:#f92672>in</span> gh<span style=color:#f92672>.</span>get_user()<span style=color:#f92672>.</span>get_repos():
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    remote_path <span style=color:#f92672>=</span> repo<span style=color:#f92672>.</span>ssh_url
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> repo<span style=color:#f92672>.</span>size
</span></span><span style=display:flex><span>    owner <span style=color:#f92672>=</span> repo<span style=color:#f92672>.</span>owner<span style=color:#f92672>.</span>login
</span></span><span style=display:flex><span>    name <span style=color:#f92672>=</span> repo<span style=color:#f92672>.</span>name
</span></span><span style=display:flex><span>    name_with_owner <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{owner}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{name}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(owner <span style=color:#f92672>=</span> owner, name <span style=color:#f92672>=</span> name)
</span></span><span style=display:flex><span>    print(name_with_owner)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Check if the repo is in the ignore list</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> name <span style=color:#f92672>in</span> ignored <span style=color:#f92672>or</span> name_with_owner <span style=color:#f92672>in</span> ignored:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;... skipping&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Build up a list of commands that will be run for the given repo</span>
</span></span><span style=display:flex><span>    local_path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#39;repos&#39;</span>, owner, name)
</span></span><span style=display:flex><span>    cmds <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;mkdir -p repos/</span><span style=color:#e6db74>{owner}</span><span style=color:#e6db74>; cd repos/</span><span style=color:#e6db74>{owner}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(owner <span style=color:#f92672>=</span> owner)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Already exists, update it</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(local_path):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;... updating&#39;</span>)
</span></span><span style=display:flex><span>        cmds <span style=color:#f92672>+=</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;cd </span><span style=color:#e6db74>{name}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(name <span style=color:#f92672>=</span> name),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;git pull --rebase --prune&#39;</span>,                 <span style=color:#75715e># Update to the most recent master</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;git submodule update --init --recursive&#39;</span>,   <span style=color:#75715e># Update submodules</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>    <span style=color:#75715e># Doesn&#39;t exist yet, clone it</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;... cloning&#39;</span>)
</span></span><span style=display:flex><span>        cmds <span style=color:#f92672>+=</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;git clone </span><span style=color:#e6db74>{url}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(url <span style=color:#f92672>=</span> remote_path), <span style=color:#75715e># Download a new clean copy using repo name as directory</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;cd </span><span style=color:#e6db74>{name}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(name <span style=color:#f92672>=</span> name),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;git submodule update --init --recursive&#39;</span>,   <span style=color:#75715e># Download and update submodules</span>
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Run each command specified above, bailing out if any failed (&amp;&amp;)</span>
</span></span><span style=display:flex><span>    cmds <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39; &amp;&amp; &#39;</span><span style=color:#f92672>.</span>join(cmds)
</span></span><span style=display:flex><span>    os<span style=color:#f92672>.</span>system(cmds)
</span></span><span style=display:flex><span>    print()
</span></span></code></pre></div><p>Basically, we&rsquo;re going to run a sequence of commands depending on if the repo was previously checked out or not. If it hasn&rsquo;t been (this is the first time), we want to run:</p><ul><li><code>git clone {url}</code></li><li><code>cd {name}</code></li><li><code>git submodule update --init --recursive</code></li></ul><p>This will get the initial version and any submodules. I&rsquo;m not sure that I&rsquo;m going to keep the submodule code around, but in interest of keeping everything in a runnable state even if GitHub were to vanish tomorrow, it seemed a good idea.</p><p>Alternatively, if we want to update a previously cloned repo:</p><ul><li><code>cd {name}</code></li><li><code>git pull --rebase --prune</code></li><li><code>git submodule update --init --recursive</code></li></ul><p>This is much the same, it just pulls any new code first.</p><p>And that&rsquo;s it. It took a little while to pull all of my repositories down (I have about 15 GB all told, counting various private repositories from work and my university days (which I still help to maintain)), but that&rsquo;s only necessary the first time. After that, it&rsquo;s much quicker.</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>