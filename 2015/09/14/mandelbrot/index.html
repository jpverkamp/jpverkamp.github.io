<!DOCTYPE html>
<html>
<head>
    <title>Mandelbrot – jverkamp.com</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Mandelbrot</h1>

        <div class="entry-meta"><span class="entry-date">2015-09-14</span>
            </div><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2015/09/08/backing-up-github-repositories/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2015/10/29/takuzu-solver/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2014/11/04/clockception/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/fractals">Fractals</a><a href="https://blog.jverkamp.com/2017/12/21/aoc-2017-day-21-fractal-expander/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2015/05/07/tuppers-self-referential-formula/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/graphics">Graphics</a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2015/09/08/backing-up-github-repositories/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2015/10/29/takuzu-solver/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2015/09/11/fragments/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2015/09/15/accidental-adventure/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</header>

	<div class="entry-content"><p>Perhaps the best known fractal of all: the <a href="https://en.wikipedia.org/wiki/Mandelbrot%20set">Mandelbrot set</a>.</p>

<figure>
    <img src="/embeds/2015/mandelbrot_default_400x300_hot-and-cold.png"/> 
</figure>


<p>Since I was already working on Python code that would render an image given a function (for a future post), I figured that I might as well render fractals with it.</p>

<p>The basic idea is simple. Use <a href="https://python-pillow.github.io/">pillow</a> (the successor <a href="http://www.pythonware.com/products/pil/">PIL</a>), create an empty image of a given size. Then, call a given function for each point in that image, passing the <code>x</code> and <code>y</code> coordinates of the function as parameters. Basically, the <code><a href="http://docs.racket-lang.org/search/index.html?q=build-flomap*">build-flomap*</a></code>
 function I use all the time in Racket.</p>

<p>It turns out, that&rsquo;s actually really straight forward:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_image</span>(width, height, generator):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    Generate an RGB image using a generator function.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    width, height -- the size of the generated image
</span><span style="color:#e6db74">    generator -- a function that takes (x, y) and returns (r, g, b)
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>

    <span style="color:#75715e"># Generate the data as a row-major list of (r, g, b)</span>
    data <span style="color:#f92672">=</span> [generator(x, y) <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(height) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(width)]

    <span style="color:#75715e"># Pack that into a Pillow image and return it</span>
    img <span style="color:#f92672">=</span> PIL<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;RGB&#39;</span>, (width, height))
    img<span style="color:#f92672">.</span>putdata(data)
    <span style="color:#66d9ef">return</span> img</code></pre></div>
<p>I like that you can have multiple <code>for</code> statements in a generator like that. It&rsquo;s very similiar to the different forms of Racket&rsquo;s <code><a href="http://docs.racket-lang.org/search/index.html?q=for">for</a></code>
<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>, but I always seem to forget that I can do that in Python.</p>

<p>One downside of this is that it&rsquo;s relatively slow (at least on the big multi-core machines we have now). Luckily, we can use the <code>&lt;a href=&quot;https://docs.python.org/2/library/multiprocessing.html&quot;&gt;multiprocessing&lt;/a&gt;</code> module to speed things up:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate_image</span>(width, height, generator, threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    Generate an RGB image using a generator function.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    width, height -- the size of the generated image
</span><span style="color:#e6db74">    generator -- a function that takes (x, y) and returns (r, g, b)
</span><span style="color:#e6db74">    threads -- if != 1, use multiprocessing to spawn this many processes
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>

    <span style="color:#75715e"># Generate the data as a row-major list of (r, g, b)</span>
    <span style="color:#66d9ef">if</span> threads <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
        data <span style="color:#f92672">=</span> [generator(x, y) <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(height) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(width)]
    <span style="color:#66d9ef">else</span>:
        pool <span style="color:#f92672">=</span> multiprocessing<span style="color:#f92672">.</span>Pool(threads)
        data <span style="color:#f92672">=</span> pool<span style="color:#f92672">.</span>starmap(generator, [(x, y) <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(height) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(width)])

    <span style="color:#75715e"># Pack that into a Pillow image and return it</span>
    img <span style="color:#f92672">=</span> PIL<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;RGB&#39;</span>, (width, height))
    img<span style="color:#f92672">.</span>putdata(data)
    <span style="color:#66d9ef">return</span> img</code></pre></div>
<p>By using <code>multiprocessing</code> rather than <code>threading</code>, we are actually spawning multiple Python processes, so we get a true multithreaded speedup. Since this program is almost entirely CPU bound, <code>threading</code> (with Python&rsquo;s <a href="https://en.wikipedia.org/wiki/global%20interpreter%20lock">global interpreter lock</a>) wouldn&rsquo;t actually be any faster.</p>

<p>An aside: Using <code>starmap</code> allows us to pass multiple parameters to the function we are mapping over. This was only introduced in Python 2.6 / 3.3, so make sure you have a sufficiently new version<sup class="footnote-ref" id="fnref:2"><a href="#fn:2">2</a></sup>.</p>

<p>With that, we can make some pretty pictures like I&rsquo;m sure I&rsquo;ve shown off before<sup class="footnote-ref" id="fnref:3"><a href="#fn:3">3</a></sup>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">generate_image(
    <span style="color:#ae81ff">400</span>,
    <span style="color:#ae81ff">300</span>,
    <span style="color:#66d9ef">lambda</span> x, y: (
        (x <span style="color:#f92672">*</span> y) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>,
        (x <span style="color:#f92672">+</span> y) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>,
        max(x, y) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
    )
)<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#39;sample.png&#39;</span>)</code></pre></div>
<figure>
    <img src="/embeds/2015/sample.png"/> 
</figure>


<p>Yes, I realize that&rsquo;s not the most Pythonic code in the world. And because the body of a Python <code>lambda</code> has to be an expression, you cannot write nearly as complicated functions as you could in Racket. It&rsquo;s perfectly valid though. :)</p>

<p>Okay, so we have a way to generate images, let&rsquo;s use it to generate Mandelbrot sets. The basic idea of the Mandelbrot set is surprisingly simple<sup class="footnote-ref" id="fnref:4"><a href="#fn:4">4</a></sup>:</p>

<p>Given a complex number <span class="latex-inline">\mathbb{C}</span>
, the <a href="https://en.wikipedia.org/wiki/complex">complex number</a> <a href="https://en.wikipedia.org/wiki/quadratic%20polynomial">quadratic polynomial</a>:</p>

<div class="latex-block">\mathbb{Z}_n+1 = \mathbb{Z}_n^2 + \mathbb{C}</div>


<p>Either does or does not escape to infinity. If the result remains bounded as <span class="latex-inline">n \to \infty</span>
, the number is part of the Mandelbrot set. If not, it&rsquo;s not. Because Python has built in support for complex numbers, this code is fairly elegant:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_mandelbrot_generator</span>(width, height, center, size, max_iterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span>):
        <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">        A generator that makes generate_image compatible mandelbrot generators.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        width, height -- the size of the resulting image (used for scale)
</span><span style="color:#e6db74">        center -- the focus point of the image
</span><span style="color:#e6db74">        size -- the size of the larger dimension
</span><span style="color:#e6db74">        max_iterations -- the scale to check before exploding, used for coloring
</span><span style="color:#e6db74">        &#39;&#39;&#39;</span>

        <span style="color:#75715e"># Scale the size so that is the size of the larger dimension</span>
        <span style="color:#66d9ef">if</span> width <span style="color:#f92672">&gt;=</span> height:
            size_x <span style="color:#f92672">=</span> size
            size_y <span style="color:#f92672">=</span> size <span style="color:#f92672">*</span> height <span style="color:#f92672">/</span> width
        <span style="color:#66d9ef">else</span>:
            size_x <span style="color:#f92672">=</span> size <span style="color:#f92672">*</span> width <span style="color:#f92672">/</span> height
            size_y <span style="color:#f92672">=</span> size

        <span style="color:#75715e"># Convert to a bounding box</span>
        min_x <span style="color:#f92672">=</span> center[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> size_x <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
        max_x <span style="color:#f92672">=</span> center[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> size_x <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
        min_y <span style="color:#f92672">=</span> center[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> size_y <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
        max_y <span style="color:#f92672">=</span> center[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> size_y <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>

        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generator</span>(x, y):
            <span style="color:#75715e"># Scale to the mandlebrot frame; convert to a complex number</span>
            x <span style="color:#f92672">=</span> (x <span style="color:#f92672">/</span> width) <span style="color:#f92672">*</span> (max_x <span style="color:#f92672">-</span> min_x) <span style="color:#f92672">+</span> min_x
            y <span style="color:#f92672">=</span> (y <span style="color:#f92672">/</span> height) <span style="color:#f92672">*</span> (max_y <span style="color:#f92672">-</span> min_y) <span style="color:#f92672">+</span> min_y
            c <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> y <span style="color:#f92672">*</span> <span style="color:#ae81ff">1j</span>

            <span style="color:#75715e"># Iterate until we escape to infinity or run out of iterations</span>
            <span style="color:#75715e"># For our purposes, we can consider infinity = 2</span>
            z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            <span style="color:#66d9ef">for</span> iteration <span style="color:#f92672">in</span> range(max_iterations):
                z <span style="color:#f92672">=</span> z <span style="color:#f92672">*</span> z <span style="color:#f92672">+</span> c

                <span style="color:#75715e"># Size is r of polar coordinates</span>
                (r, phi) <span style="color:#f92672">=</span> cmath<span style="color:#f92672">.</span>polar(z)
                <span style="color:#66d9ef">if</span> r <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>:
                    <span style="color:#66d9ef">break</span>

            g <span style="color:#f92672">=</span> int(<span style="color:#ae81ff">256</span> <span style="color:#f92672">*</span> iteration <span style="color:#f92672">/</span> max_iterations)
            <span style="color:#66d9ef">return</span> (g, g, g)

        <span style="color:#66d9ef">return</span> generator</code></pre></div>
<p>I&rsquo;ve chosen here to make a function that returns the actual color generator primarily so that we would have access to the <code>width</code> and <code>height</code> within the main function.</p>

<p>Amusingly, it&rsquo;s been proven that if the magnitude of <span class="latex-inline">\mathbb{Z}_n</span>
 crosses 2, it will go to infinity. Since <code>r</code> is the magnitude in the <a href="https://en.wikipedia.org/wiki/polar%20coordinate%20system">polar coordinate system</a> (<code>r</code>,<code>ϕ</code>), we can use that as an escape hatch and even as a basic way to color the output.</p>

<p>One side note: using the <code>multiprocessing</code> module, we have to be able to <code>&lt;a href=&quot;https://docs.python.org/2/library/pickle.html&quot;&gt;pickle&lt;/a&gt;</code> any variables to the function called. Functions defined in the global scope can be pickled, but functions used directly as parameters to other functions cannot; don&rsquo;t ask me why.</p>

<p>So if <code>threads</code> is not 1, this does not work:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">generate_image(
    <span style="color:#ae81ff">400</span>,
    <span style="color:#ae81ff">300</span>,
    make_mandelbrot_generator(<span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">300</span>, (<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">3</span>),
    threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
)</code></pre></div>
<p>But this does:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">generator <span style="color:#f92672">=</span> make_mandelbrot_generator(<span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">300</span>, (<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">3</span>),
generate_image(<span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">300</span>, generator, threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>)</code></pre></div>
<p>Weird.</p>

<p>Anyways, what do we get when we try it out?</p>

<figure>
    <img src="/embeds/2015/mandelbrot_default_400x300_grayscale.png"/> 
</figure>


<p>Beautiful<sup class="footnote-ref" id="fnref:5"><a href="#fn:5">5</a></sup>!</p>

<p>We need some color. Let&rsquo;s introduce one more parameter to the <code>make_mandelbrot_generator</code> function: <code>coloring</code>. Basically, a function that takes in a number in the range <code>[0, 1]</code> (which we&rsquo;re already computing; that is <code>iteration / max_iterations</code>) and return an RGB color. That way, we can have some more interesting colorations.</p>

<p>For example, the grayscale coloring function from earlier:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">grayscale</span>(v):
    <span style="color:#e6db74">&#39;&#39;&#39;Simple grayscale value.&#39;&#39;&#39;</span>

    g <span style="color:#f92672">=</span> int(<span style="color:#ae81ff">256</span> <span style="color:#f92672">*</span> v)
    <span style="color:#66d9ef">return</span> (g, g, g)</code></pre></div>
<p>Or how about instead, we render something in blue and red. Start at black, then fade up the blue channel, crossfade to red in the next third, and fade back to black in the last:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hot_and_cold</span>(v):
    <span style="color:#e6db74">&#39;&#39;&#39;Scale from black to blue to red and back to black.&#39;&#39;&#39;</span>

    r <span style="color:#f92672">=</span> g <span style="color:#f92672">=</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">if</span> v <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>:
        v <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> v
        b <span style="color:#f92672">=</span> int(<span style="color:#ae81ff">256</span> <span style="color:#f92672">*</span> v)
    <span style="color:#66d9ef">elif</span> v <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>:
        v <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> (v <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>)
        r <span style="color:#f92672">=</span> int(<span style="color:#ae81ff">256</span> <span style="color:#f92672">*</span> v)
        b <span style="color:#f92672">=</span> int(<span style="color:#ae81ff">256</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> v))
    <span style="color:#66d9ef">else</span>:
        v <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> (v <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">3</span>)
        r <span style="color:#f92672">=</span> int(<span style="color:#ae81ff">256</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> v))

    <span style="color:#66d9ef">return</span> (r, g, b)</code></pre></div>
<p>Let&rsquo;s render that one instead:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">generator <span style="color:#f92672">=</span> make_mandelbrot_generator(<span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">300</span>, (<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">3</span>),
generate_image(<span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">300</span>, generator, threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, coloring <span style="color:#f92672">=</span> hot_and_cold)</code></pre></div>
<figure>
    <img src="/embeds/2015/mandelbrot_default_400x300_hot-and-cold.png"/> 
</figure>


<p>Excellent. We have a simple Mandelbrot generator. It&rsquo;s not exactly what I set out to do for this post (really only the <code>generate_image</code> function is), but I think it&rsquo;s pretty cool.</p>

<p>As a bonus round, I made something of a basic testing framework:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">THREAD_COUNT <span style="color:#f92672">=</span> max(<span style="color:#ae81ff">1</span>, multiprocessing<span style="color:#f92672">.</span>cpu_count() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)

SIZES <span style="color:#f92672">=</span> [
    (<span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">300</span>),
    (<span style="color:#ae81ff">1920</span>, <span style="color:#ae81ff">1080</span>)
]

COLORINGS <span style="color:#f92672">=</span> [
    (<span style="color:#e6db74">&#39;grayscale&#39;</span>, grayscale),
    (<span style="color:#e6db74">&#39;hot-and-cold&#39;</span>, hot_and_cold),
]

IMAGES <span style="color:#f92672">=</span> [
    (<span style="color:#e6db74">&#39;default&#39;</span>, (<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">3</span>),
    <span style="color:#75715e"># http://www.nahee.com/Derbyshire/manguide.html</span>
    (<span style="color:#e6db74">&#39;seahorse-valley&#39;</span>, (<span style="color:#f92672">-</span><span style="color:#ae81ff">0.75</span>, <span style="color:#ae81ff">0.1</span>), <span style="color:#ae81ff">0.05</span>),
    (<span style="color:#e6db74">&#39;triple-spiral-valley&#39;</span>, (<span style="color:#ae81ff">0.088</span>, <span style="color:#ae81ff">0.654</span>), <span style="color:#ae81ff">0.25</span>),
    (<span style="color:#e6db74">&#39;quad-spiral-valley&#39;</span>, (<span style="color:#ae81ff">0.274</span>, <span style="color:#ae81ff">0.482</span>), <span style="color:#ae81ff">0.005</span>),
    (<span style="color:#e6db74">&#39;double-scepter-valley&#39;</span>, (<span style="color:#f92672">-</span><span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.8383</span>), <span style="color:#ae81ff">0.005</span>),
    (<span style="color:#e6db74">&#39;mini-mandelbrot&#39;</span>, (<span style="color:#f92672">-</span><span style="color:#ae81ff">1.75</span>, <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">0.1</span>),

]

<span style="color:#66d9ef">for</span> width, height <span style="color:#f92672">in</span> SIZES:
    <span style="color:#66d9ef">for</span> image_name, center, size <span style="color:#f92672">in</span> IMAGES:
        <span style="color:#66d9ef">for</span> coloring_name, coloring <span style="color:#f92672">in</span> COLORINGS:
            filename <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39;{width}x{height}&#39;</span>, <span style="color:#e6db74">&#39;mandelbrot_{name}_{width}x{height}_{coloring}.png&#39;</span>)
            filename <span style="color:#f92672">=</span> filename<span style="color:#f92672">.</span>format(
                name <span style="color:#f92672">=</span> image_name,
                width <span style="color:#f92672">=</span> width,
                height <span style="color:#f92672">=</span> height,
                coloring <span style="color:#f92672">=</span> coloring_name,
            )
            generator <span style="color:#f92672">=</span> make_mandelbrot_generator(width, height, center, size, coloring <span style="color:#f92672">=</span> coloring)

            start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
            img <span style="color:#f92672">=</span> generate_image(
                width,
                height,
                generator,
                threads <span style="color:#f92672">=</span> THREAD_COUNT
            )
            end <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()

            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(filename)):
                os<span style="color:#f92672">.</span>makedirs(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(filename))
            img<span style="color:#f92672">.</span>save(filename)

            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;{} generated in {} seconds with {} threads&#39;</span><span style="color:#f92672">.</span>format(
                filename,
                end <span style="color:#f92672">-</span> start,
                THREAD_COUNT
            ))</code></pre></div>
<p><code>multiprocessing.cpu_count() - 1</code> means that I leave one processor for other work (I was having issues with my computer freazing, <code>multiprocessing</code> is good at that). Other than that, generate a bunch of images and shove them into directories by size.</p>

<p>Here are a few examples from <a href="http://www.nahee.com/Derbyshire/manguide.html">nahee.com</a>:</p>

<h3 id="seahorse-valley-h3">Seahorse Valley<h3></h3>

<figure>
    <img src="/embeds/2015/mandelbrot_seahorse-valley_400x300_hot-and-cold.png"/> 
</figure>


<p><h3>Double Scepter Valley</p>

<figure>
    <img src="/embeds/2015/mandelbrot_double-scepter-valley_400x300_hot-and-cold.png"/> 
</figure>


<h3 id="triple-spiral-valley">Triple Spiral Valley</h3>

<figure>
    <img src="/embeds/2015/mandelbrot_triple-spiral-valley_400x300_hot-and-cold.png"/> 
</figure>


<h3 id="quad-spiral-valley">Quad Spiral Valley</h3>

<figure>
    <img src="/embeds/2015/mandelbrot_quad-spiral-valley_400x300_hot-and-cold.png"/> 
</figure>


<h3 id="mini-mandelbrot">Mini Mandelbrot</h3>

<figure>
    <img src="/embeds/2015/mandelbrot_mini-mandelbrot_400x300_hot-and-cold.png"/> 
</figure>


<p>Or how about one nice large one (right click, save as):</p>

<figure>
    <img src="/embeds/2015/mandelbrot_seahorse-valley_1920x1080_hot-and-cold.png"/> 
</figure>


<p>So much detail!</p>

<p>Enjoy!</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">The <a href="http://www.call-cc.org/">chicken</a> or the <a href="https://wiki.python.org/moin/egg">egg</a>?
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">Use Python 3. The more people that use it, the less we&rsquo;ll have issues with split-version libraries.
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
<li id="fn:3"><a href="https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/">Generating omnichromatic images</a> as an example
 <a class="footnote-return" href="#fnref:3"><sup>[return]</sup></a></li>
<li id="fn:4">or at least concise to explain
 <a class="footnote-return" href="#fnref:4"><sup>[return]</sup></a></li>
<li id="fn:5">Or at least elegant
 <a class="footnote-return" href="#fnref:5"><sup>[return]</sup></a></li>
</ol>
</div></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Mandelbrot";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2015\/09\/14\/mandelbrot\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="/custom.js" defer></script>
</body>
</html>
