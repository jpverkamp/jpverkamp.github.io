<!DOCTYPE html>
<html>
<head>
    <title>Advent of Code: Day 7 â€“ jverkamp.com</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li><a href="/resume" title="My Resume">Resume</a></li>
            <li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Advent of Code: Day 7</h1>

        <div class="entry-meta"><span class="entry-date">2015-12-07</span>
            </div><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2015/12/06/advent-of-code-day-6/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2015/12/08/advent-of-code-day-8/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2015/12/06/advent-of-code-day-6/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a><a href="https://blog.jverkamp.com/2015/12/08/advent-of-code-day-8/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2015/12/06/advent-of-code-day-6/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2015/12/08/advent-of-code-day-8/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2015/12/07/free-https-blog-hosting-via-github-and-cloudflare/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2015/12/08/advent-of-code-day-8/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</header>

	<div class="entry-content"><p><a href="http://adventofcode.com/2015/day/7">Source</a></p>

<p><strong>Part 1:</strong> Given a list of definitions of the form <code>123 -&gt; x</code>, <code>NOT e -&gt; f</code>, and <code>x AND y -&gt; z</code>, with possible operations <code>NOT</code>, <code>AND</code>, <code>OR</code>, <code>LSHIFT</code>, and <code>RSHIFT</code>, find the value of <code>a</code>. Assume all values are 16-bit integers.</p>

<p>This one is actually really cool. It&rsquo;s basically a full <a href="https://en.wikipedia.org/wiki/declarative%20programming%20language">declarative programming language</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">monops <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;NOT&#39;</span>: <span style="color:#66d9ef">lambda</span> x : <span style="color:#f92672">~</span>x <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xFFFF</span>,
}

binops <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;AND&#39;</span>: operator<span style="color:#f92672">.</span>and_,
    <span style="color:#e6db74">&#39;OR&#39;</span>: operator<span style="color:#f92672">.</span>or_,
    <span style="color:#e6db74">&#39;LSHIFT&#39;</span>: operator<span style="color:#f92672">.</span>lshift,
    <span style="color:#e6db74">&#39;RSHIFT&#39;</span>: operator<span style="color:#f92672">.</span>rshift,
}

machine <span style="color:#f92672">=</span> {}

<span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> sys<span style="color:#f92672">.</span>stdin:
    line <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip()

    m <span style="color:#f92672">=</span> (
        re<span style="color:#f92672">.</span>match(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(\w+) -&gt; (\w+)&#39;</span>, line)
        <span style="color:#f92672">or</span> re<span style="color:#f92672">.</span>match(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(\w+) (\w+) (\w+) -&gt; (\w+)&#39;</span>, line)
        <span style="color:#f92672">or</span> re<span style="color:#f92672">.</span>match(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(\w+) (\w+) -&gt; (\w+)&#39;</span>, line)
    )<span style="color:#f92672">.</span>groups()

    machine[m[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]] <span style="color:#f92672">=</span> m[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate</span>(register_or_value):
    <span style="color:#66d9ef">try</span>:
        <span style="color:#66d9ef">return</span> int(register_or_value)
    <span style="color:#66d9ef">except</span>:
        <span style="color:#66d9ef">return</span> run(register_or_value)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(register, state <span style="color:#f92672">=</span> {}):
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> register <span style="color:#f92672">in</span> state:
        command <span style="color:#f92672">=</span> machine[register]

        <span style="color:#66d9ef">if</span> len(command) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
            value, <span style="color:#f92672">=</span> command
            state[register] <span style="color:#f92672">=</span> evaluate(value)

        <span style="color:#66d9ef">elif</span> len(command) <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
            monop, input <span style="color:#f92672">=</span> command
            state[register] <span style="color:#f92672">=</span> monops[monop](evaluate(input))

        <span style="color:#66d9ef">elif</span> len(command) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
            input_1, binop, input_2 <span style="color:#f92672">=</span> command
            state[register] <span style="color:#f92672">=</span> binops[binop](evaluate(input_1), evaluate(input_2))

    <span style="color:#66d9ef">return</span> state[register]


<span style="color:#66d9ef">print</span>(run(<span style="color:#e6db74">&#39;a&#39;</span>))</code></pre></div>
<p>Basically, we have two interesting functions: <code>evaluate</code> and <code>run</code>. Each of those will be applied to any parameters. <code>evaulate</code> will check first if the parameter is an integer, if so return it directly. If not, fall back to <code>run</code>, which is a <a href="https://en.wikipedia.org/wiki/memoized">memoized</a> virtual machine.</p>

<p>If we have the values of any inputs (either because they are numeric or because we&rsquo;ve already calculated them), it will directly calculate the value for that gate and cache it. If not, it will calculate any recursive outputs it needs (caching them as well), and then calculate it&rsquo;s own. Through the power of <a href="https://en.wikipedia.org/wiki/dynamic%20programming">dynamic programming</a>, this will naturally resolve the order the gates need to be run in while still running in <code>O(n)</code> time to the number of gates. Very cool, in my opinion<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>.</p>

<p>The only other oddity is the definition of <code>NOT</code>. Since Python integers are not 16-bits, doing a bitwise and with <code>0xFFFF</code> (the maximum 16-bit value) will lock the result into that range.</p>

<p><strong>Part 2:</strong> Take the value of <code>a</code> after running part 1 and assign it to <code>b</code>. Run the simulation again.</p>

<p>Due to how I load in the instructions, this is as easy as adding a line of the form <code>14710 -&gt; b</code> to the end of my input before running it. That will replace the previous command for <code>b</code>. You can do it in a <a href="http://www.zsh.org/"><code>zsh</code></a> one liner<sup class="footnote-ref" id="fnref:2"><a href="#fn:2">2</a></sup>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh"><span style="color:#f92672">{</span>cat input.txt; <span style="color:#f92672">(</span>echo <span style="color:#e6db74">&#34;\n&#34;</span> &amp;<span style="color:#75715e">#96;cat input.txt | python part-1.py&amp;#96; &#34;-&gt; b&#34;)} | python3 part-1.py</span></code></pre></div><div class="footnotes">

<hr />

<ol>
<li id="fn:1">which would be why I have a blog
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">I&rsquo;m sure other, inferior<sup class="footnote-ref" id="fnref:3"><a href="#fn:3">3</a></sup>shells would work just as well
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
<li id="fn:3">Just kidding<sup class="footnote-ref" id="fnref:4"><a href="#fn:4">4</a></sup>
 <a class="footnote-return" href="#fnref:3"><sup>[return]</sup></a></li>
<li id="fn:4">Or am I?
 <a class="footnote-return" href="#fnref:4"><sup>[return]</sup></a></li>
</ol>
</div></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Advent of Code: Day 7";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2015\/12\/07\/advent-of-code-day-7\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="/custom.js" defer></script>
</body>
</html>
