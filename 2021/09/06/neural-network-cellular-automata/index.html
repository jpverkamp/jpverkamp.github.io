<!doctype html><html><head><title>Neural Network Cellular Automata â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.982c2d7bb434b4cf8b19c2cf38ef7e7f7162ddbed610e5bdddbb937001e26574.js integrity="sha256-mCwte7Q0tM+LGcLPOO9+f3Fi3b7WEOW93buTcAHiZXQ=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.e0e68b86dea32185ab89b0b9cc01649107cc6b0be3290c8c7b13c716bc0dabfa.css integrity="sha256-4OaLht6jIYWribC5zAFkkQfMawvjKQyMexPHFrwNq/o="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>Neural Network Cellular Automata</h1><div class=entry-meta><span class=entry-date>2021-09-06</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/08/18/solving-snakebird/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/javascript>JavaScript</a><a href=https://blog.jverkamp.com/2022/02/23/runelang-language-specification/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2020/12/11/pictogenesis-stack-transpiling/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/cellular-automata>Cellular Automata</a><a href=https://blog.jverkamp.com/2021/12/06/aoc-2021-day-6-we-all-glow-down-here/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2021/03/24/a-quick-ruby-dsl-for-creating-l-systems/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/generative-art>Generative Art</a><a href=https://blog.jverkamp.com/2021/12/06/aoc-2021-day-6-we-all-glow-down-here/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2010/03/17/anngram-ngrams-vs-words/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/neural-networks>Neural Networks</a></li><li><a href=https://blog.jverkamp.com/2021/01/08/genuary-triple-nested-loops/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/p5js>p5js</a><a href=https://blog.jverkamp.com/2023/02/01/genuary-2023.01-perfect-loop/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2021/03/24/a-quick-ruby-dsl-for-creating-l-systems/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/procedural-content>Procedural Content</a><a href=https://blog.jverkamp.com/2022/02/23/runelang-language-specification/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2021/08/18/solving-snakebird/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/12/01/advent-of-code-2021/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2021/09/05/transmetropolitan-vol.-5-lonely-city/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/09/07/mercy-watson-something-wonky-this-way-comes/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Okay. A <a href=https://old.reddit.com/r/cellular_automata/comments/ph1zez/random_neural_network_based_cellular_automata/ target=_blank rel=noopener>random post</a> on the <a href=https://old.reddit.com/r/cellular_automata/ target=_blank rel=noopener>/r/cellular_automata subreddit</a> inspired me.</p><p>Let&rsquo;s generate a cellular automata where each pixel updates based on a neural network given as input:</p><ul><li>The x/y coordinates (scaled to the range 0-1)</li><li>An optional random value (to make it more dynamic)</li><li>A variety of neighboring data, such as:<ul><li>The number of neighbors that are &lsquo;active&rsquo; (> 50% white), ranges 0-8 scaled to 0-1. This should allow <a href=https://en.wikipedia.org/wiki/Conway%27s%20Game%20of%20Life>Conway's Game of Life</a></li><li>The RGB values of all neighbors (allows a superset of the above)</li><li>Gradients, subtract color value of the left from the right so that you get edges and side to side movement</li></ul></li></ul><p>Let&rsquo;s do it!</p><p>First off, I&rsquo;m going to use <a href=https://brain.js.org/#/ target=_blank rel=noopener>brain.js</a> for the neural networks. It&rsquo;s quick and easy to use with one big exception: I couldn&rsquo;t figure out how to generate random weights. It&rsquo;s not really something that neural networks are &lsquo;designed&rsquo; to do in general and I did eventually figure it out, but it was a bit of a pain.</p><p>Things to play with:</p><ul><li>The <code>regenerate</code> button will generate a new random network</li><li>The <code>debug</code> button will toggle debug information under your mouse</li><li>The <code>network</code> button will toggle a JSON view of the current neural network</li><li>The <code>svg</code> button will toggle a rendered SVG of the current neural network</li><li>The <code>import</code> button can take a JSON object containing a network (copied from the <code>network</code> tab) and load it back in</li><li><code>gridSize</code> controls how large pixels are (making them too small will cause performance issues)</li><li><code>showBorder</code> will render pixel borders</li><li><code>outputAddNoise</code> will add noise to the pixels after they are generated by the network</li><li><code>inputAddNoise</code> will add noise to the first input to the neural network (otherwise it will be zero)</li><li><code>inputAddXY</code> will add X/Y as the second and third input to the neural network (otherwise zero)</li><li><code>biasScale</code> and <code>weightScale</code> control the generated values of the neural network; the given values generally have output, too small or large will mean all values end up the same</li><li><code>activation</code> changes the neural network activation function</li><li><code>colorInputMode</code> controls how additional inputs are added:<ul><li><code>neighbor count</code> is counting how many neighbors each pixel has, ranges 0-8 scaled to 0-1</li><li><code>neighbor RGB</code> passes the R, G, B value of the 8 neighboring pixels in as 0-1 each (for 24 input channels)</li><li><code>gradiant x/y</code> will pass the difference between right/left and top/bottom, making patterns that tend to move</li><li><code>none</code> will ignore neighbor hood, using only noise/x/y (if on above)</li></ul></li><li><code>hiddenLayers</code> should be a JSON list of number defining how many neurons are in each hidden layer of the neural network; more is more complicated behavior but slower</li></ul><p>Below the code is broken up a bit, we have:</p><ul><li><code>init.js</code> initializes the sketch, not super interesting</li><li><code>input-modes.js</code> defines the different input modes above, basically it stores how many values will be generated and a function to generate them</li><li><code>input.js</code> takes those values and adds noise/x/y if requested</li><li><code>reset.js</code> resets the sketch, this also does the work of setting up the random neural network, which is one of the most interesting bits of the code</li><li><code>draw.js</code> updates the network (using a double buffer so that we don&rsquo;t modify the input values as we&rsquo;re generating them) and draws them to the screen</li></ul><p>Let&rsquo;s check it out!</p><div class=tab><button id=iframedemo class="tablinks default" data-tabset=f64f onclick='changeTab(event,"f64f","iframedemo")'>Demo</button>
<button id=init.js class=tablinks data-tabset=f64f onclick='changeTab(event,"f64f","init.js")'>init.js</button>
<button id=input-modes.js class=tablinks data-tabset=f64f onclick='changeTab(event,"f64f","input-modes.js")'>input-modes.js</button>
<button id=input-at.js class=tablinks data-tabset=f64f onclick='changeTab(event,"f64f","input-at.js")'>input-at.js</button>
<button id=reset.js class=tablinks data-tabset=f64f onclick='changeTab(event,"f64f","reset.js")'>reset.js</button>
<button id=draw.js class=tablinks data-tabset=f64f onclick='changeTab(event,"f64f","draw.js")'>draw.js</button></div><div class=tabcontent data-tabset=f64f id=iframedemo><iframe marginwidth=0 width=660 height=660 frameborder=0 srcdoc="
            
<html>
<head>
<script src=&#34;https://blog.jverkamp.com/p5_12556498581193807062.min.4791c7caff6fe71c2a8c919b57d35f49d0266cfde21b68a9272af180925679ca.js&#34; integrity=&#34;sha256-R5HHyv9v5xwqjJGbV9NfSdAmbP3iG2ipJyrxgJJWeco=&#34; defer></script><script src=&#34;https://blog.jverkamp.com/quicksettings_13755902899324222893.min.2a42b2a52ef781cfc8b23b19463b94ebca971666c0b532a26ff6710cd844f344.js&#34; integrity=&#34;sha256-KkKypS73gc/IsjsZRjuU68qXFmbAtTKib/ZxDNhE80Q=&#34; defer></script><script src=&#34;https://blog.jverkamp.com/p5.gui_14323647330486362791.min.25f90c9eb43149e2901f61d0b6b09a63dcd04667ea2a8a040eb494b20a2f8ab4.js&#34; integrity=&#34;sha256-JfkMnrQxSeKQH2HQtrCaY9zQRmfqKooEDrSUsgovirQ=&#34; defer></script><script src=&#34;https://blog.jverkamp.com/brain_15350434261734069643.min.fe358c8e43d5f11e1f45b657206f5d0745330052194c40d08fcc1dad1587052e.js&#34; integrity=&#34;sha256-/jWMjkPV8R4fRbZXIG9dB0UzAFIZTEDQj8wdrRWHBS4=&#34; defer></script>

    <style>canvas { border: 1px solid black; border-radius: 1em; }</style>
</head>
<body>

            <script>

            
                
                    
let gui;
let params = {
  gridSize: 10,
  gridSizeMin: 1,
  gridSizeMax: 20,
  showBorder: true,
  outputAddNoise: false,
  inputAddNoise: true,
  inputXY: true,
  biasScale: 2,
  biasScaleMin: 1,
  biasScaleMax: 10,
  biasScaleStep: 0.1,
  weightScale: 7,
  weightScaleMin: 1,
  weightScaleMax: 10,
  weightScaleStep: 0.1,
  activation: ['sigmoid', 'relu', 'leaky-relu', 'tanh'],
  colorInputMode: undefined,
  hiddenLayers: '[10, 10, 10, 10]',
};

let data = []
let gridWidth = 0
let gridHeight = 0

let outputSize = 3
let inputSize = 3 + (9 * outputSize) // x, y, and rgb of 3x3 area
let hiddenLayers = [10, 10, 10, 10]

let net = undefined

function toggleVisible(el) {
  if (el.style.display === 'none') {
    el.style.display = 'block'
  } else {
    el.style.display = 'none'
  }
}

function makeToggle(name, type) {
  let el = document.createElement(type)
  el.id = name
  el.style.display = 'none'
  
  let button = document.createElement('button')
  button.innerText = name
  button.addEventListener('click', function(e) { e.preventDefault(); toggleVisible(el); return false; })
  button.href = '#'

  return [button, el]
}

function oldSetup() {
  createCanvas(400, 400);

  let button = document.createElement('button')
  button.innerText = `regenerate`
  button.addEventListener('click', function(e) { e.preventDefault(); reset(); return false; })
  button.href = '#'
  document.body.appendChild(button)
  
  gui = createGuiPanel();
  gui.addObject(params);
  gui.setPosition(420, 0);

  let [debugButton, debugEl] = makeToggle('debug', 'pre')
  let [networkButton, networkEl] = makeToggle('network', 'pre')
  let [svgButton, svgEl] = makeToggle('svg', 'div')

  for (let el of [debugButton, networkButton, svgButton, debugEl, networkEl, svgEl]) {
    document.body.appendChild(el)
  }

  let importButton = document.createElement('button')
  importButton.innerText = `import`
  importButton.addEventListener('click', function(e) { 
    e.preventDefault();
    js = JSON.parse(prompt('Neural network JSON:'))
    reset(js)
    return false; 
  })
  importButton.href = '#'
  document.body.appendChild(importButton)

  document.body.appendChild(document.createElement('br'))

  reset()
}

                
                    
let inputModes = {
  'neighbor count': {
    size: 1,
    inputAt: (x, y) => {
      let neighbors = 0
      for (let xd = -1; xd <= 1; xd++) {
        for (let yd = -1; yd <= 1; yd++) {
          if (xd === 0 && yd === 0) 
            continue
          
          let g = (getData(x, y, 0) + getData(x, y, 1) + getData(x, y, 2)) / 3
          if (g > 0.5)
            neighbors += 1
        }
      }
      return [neighbors / 8.0]
    }
  },
  'neighbor RGB': {
    size: 24,
    inputAt: (x, y) => {
      let values = []
      for (let xd = -1; xd <= 1; xd++) {
        for (let yd = -1; yd <= 1; yd++) {
          if (xd === 0 && yd === 0) 
            continue
            
          for (let c = 0; c < outputSize; c++) {
            values.push(getData(x, y, c)) // RGB
          }
        }
      }
      return values
    }
  },
  'gradiant x/y': {
    size: 2,
    inputAt: (x, y) => {
      let gl = getData(x - 1, y, 0) + getData(x - 1, y, 1) + getData(x - 1, y, 2)
      let gr = getData(x + 1, y, 0) + getData(x + 1, y, 1) + getData(x + 1, y, 2)
      let gu = getData(x, y - 1, 0) + getData(x, y - 1, 1) + getData(x, y - 1, 2)
      let gd = getData(x, y + 1, 0) + getData(x, y + 1, 1) + getData(x, y + 2, 2)
      
      return [
        gr - gl,
        gd - gu
      ]
    }
  },
  'none': {
    size: 0,
    inputAt: (x, y) => [],
  }
}

params.colorInputMode = Object.keys(inputModes)

                
                    
function inputAt(x, y) {
  let input = [
    params.inputNoise ? Math.random() : 0,
    params.inputXY ? 1.0 * x / gridWidth : 0,
    params.inputXY ? 1.0 * y / gridHeight : 0,
  ]
  input = input.concat(inputModes[params.colorInputMode].inputAt(x, y))
  return input
}

                
                    
function reset(network) {
  inputSize = 3 + inputModes[params.colorInputMode].size
  hiddenLayers = JSON.parse(params.hiddenLayers)
  
  net = new brain.NeuralNetwork({
    hiddenLayers,
    activation: Array.isArray(params.activation) ? params.activation[0] : params.activation,
  })
  
  gridWidth = width / params.gridSize
  gridHeight = height / params.gridSize
  
  // Train it on random data to initialize
  let trainingData = []
  for (let i = 0; i < 1; i++) {
    let input = []
    for (let j = 0; j < inputSize; j++) {
      input.push(Math.random())
    }
    
    let output = []
    for (let j = 0; j < outputSize; j++) {
      output.push(Math.random())
    }
    
    trainingData.push({input, output})
  }
  net.train(trainingData, { iterations: 1 })
  
  // Rewrite the weights
  if (network) {
    net = net.fromJSON(network)
  } else {
    let js = net.toJSON()
    for (let layer = 1; layer < js.layers.length; layer++) {
      for (let neuron in js.layers[layer]) {
        let newBias = params.biasScale * Math.random() * 2 - params.biasScale
        js.layers[layer][neuron].bias = newBias
        
        for (let weight in js.layers[layer][neuron].weights) {
          let newWeight = params.weightScale * Math.random() * 2 - params.weightScale
          js.layers[layer][neuron].weights[weight] = newWeight
          
        }
      }
    }
    
    net = net.fromJSON(js)
  }
  
  data = []
  for (let x = 0; x < gridWidth; x++) {
    var row = []
    for (let y = 0; y < gridHeight; y++) {
      var pixel = []
      for (let c = 0; c < outputSize; c++) {
        pixel.push(Math.random())
      }
      row.push(pixel)
    }
    data.push(row)
  }
  
  document.getElementById('network').innerText = JSON.stringify(net.toJSON(), null, 2)
  params.network = JSON.stringify(net.toJSON())
}

                
                    
function getData(x, y, c) {
  try {
    return data[x][y][c] || 0
  } catch(ex) {
    return 0
  }
}

function draw() {
  if (params.showBorder) {
    stroke(0)
  } else {
    noStroke()
  }

  let buffer = []
  for (let x = 0; x < gridWidth; x++) {
    var row = []
    for (let y = 0; y < gridHeight; y++) {  
      let pixel = net.run(inputAt(x, y))   
      
      if (params.addNoise) {
        pixel[0] += (Math.random() - 0.5) / 100
        pixel[1] += (Math.random() - 0.5) / 100
        pixel[2] += (Math.random() - 0.5) / 100        
      }
      
      row.push(pixel)
    }
    buffer.push(row)
  } 
  data = buffer
  
  for (let x = 0; x < gridWidth; x++) {
    for (let y = 0; y < gridHeight; y++) {
      fill(255 * getData(x, y, 0), 255 * getData(x, y, 1), 255 * getData(x, y, 2))
      rect(x * params.gridSize, y * params.gridSize, params.gridSize, params.gridSize)
    }
  }
  
  let gx = Math.round(mouseX / params.gridSize)
  let gy = Math.round(mouseY / params.gridSize)
  let r = Math.round(255 * getData(gx, gy, 0))
  let g = Math.round(255 * getData(gx, gy, 1))
  let b = Math.round(255 * getData(gx, gy, 2))
  
  let debugData = {
    frame: frameCount,
    pt: {gx, gy},
    rgb: {r, g, b},
    output: net.run(inputAt(gx, gy)),
    input: inputAt(gx, gy),
  }
  
  document.getElementById('debug').innerText = JSON.stringify(debugData, null, 2)
  document.getElementById('svg').innerHTML = brain.utilities.toSVG(net)
}

                
            

            const START_PAUSED = false;

            
function setup() {
    // Load saved settings from the browser hash fragment
    if (parent.location.hash && typeof params !== &#34;undefined&#34;) {
        try {
            var settings = JSON.parse(atob(parent.location.hash.substring(1)));
            Object.keys(params).forEach((key) => params[key] = key in settings ? settings[key] : params[key]);
        } catch(ex) {
        }
    }

    oldSetup();
    if (START_PAUSED) {
        noLoop();
    }

    createButton(&#34;play/pause&#34;).mousePressed(() => {
        if (isLooping()) {
            noLoop();
        } else {
            loop();
        }
    });

    createButton(&#34;save&#34;).mousePressed(() => {
        saveCanvas('photo', 'png')
    });

    createButton(&#34;clear&#34;).mousePressed(() => {
        if (typeof reset !== 'undefined') {
            reset();
        } else {
            clear();
        }
    });

    createButton(&#34;reload&#34;).mousePressed(() => {
        window.location.reload();
    });

    if (typeof params !== &#34;undefined&#34;) {
        for (var el of document.querySelectorAll('input')) {
            if (el.id && el.id.startsWith('qs_')) {
                el.addEventListener('change', () => {
                    parent.location.hash = btoa(JSON.stringify(params));
                });
            }
        }
    }
}

            </script>
            
<noscript>To display this p5.js sketch, JavaScript must be enabled.</noscript>
</body>
</html>

        "></iframe></div><div class=tabcontent data-tabset=f64f id=init.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gui</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gridSize</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gridSizeMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gridSizeMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>20</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>showBorder</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>outputAddNoise</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>inputAddNoise</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>inputXY</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>biasScale</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>biasScaleMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>biasScaleMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>biasScaleStep</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.1</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>weightScale</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>7</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>weightScaleMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>weightScaleMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>weightScaleStep</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.1</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>activation</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;sigmoid&#39;</span>, <span style=color:#e6db74>&#39;relu&#39;</span>, <span style=color:#e6db74>&#39;leaky-relu&#39;</span>, <span style=color:#e6db74>&#39;tanh&#39;</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>colorInputMode</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>undefined</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hiddenLayers</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;[10, 10, 10, 10]&#39;</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gridWidth</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gridHeight</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>outputSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>inputSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>9</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>outputSize</span>) <span style=color:#75715e>// x, y, and rgb of 3x3 area
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hiddenLayers</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>10</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>net</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>undefined</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>toggleVisible</span>(<span style=color:#a6e22e>el</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>display</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;none&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>display</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;block&#39;</span>
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>display</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;none&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>makeToggle</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>el</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#a6e22e>type</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>display</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;none&#39;</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>button</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>innerText</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;click&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>e</span>) { <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>(); <span style=color:#a6e22e>toggleVisible</span>(<span style=color:#a6e22e>el</span>); <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>; })
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;#&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> [<span style=color:#a6e22e>button</span>, <span style=color:#a6e22e>el</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>button</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>innerText</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`regenerate`</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;click&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>e</span>) { <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>(); <span style=color:#a6e22e>reset</span>(); <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>; })
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>button</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;#&#39;</span>
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>button</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGuiPanel</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span>.<span style=color:#a6e22e>addObject</span>(<span style=color:#a6e22e>params</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span>.<span style=color:#a6e22e>setPosition</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>debugButton</span>, <span style=color:#a6e22e>debugEl</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>makeToggle</span>(<span style=color:#e6db74>&#39;debug&#39;</span>, <span style=color:#e6db74>&#39;pre&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>networkButton</span>, <span style=color:#a6e22e>networkEl</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>makeToggle</span>(<span style=color:#e6db74>&#39;network&#39;</span>, <span style=color:#e6db74>&#39;pre&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>svgButton</span>, <span style=color:#a6e22e>svgEl</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>makeToggle</span>(<span style=color:#e6db74>&#39;svg&#39;</span>, <span style=color:#e6db74>&#39;div&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>el</span> <span style=color:#66d9ef>of</span> [<span style=color:#a6e22e>debugButton</span>, <span style=color:#a6e22e>networkButton</span>, <span style=color:#a6e22e>svgButton</span>, <span style=color:#a6e22e>debugEl</span>, <span style=color:#a6e22e>networkEl</span>, <span style=color:#a6e22e>svgEl</span>]) {
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>el</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>importButton</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;button&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>importButton</span>.<span style=color:#a6e22e>innerText</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`import`</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>importButton</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;click&#39;</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>e</span>) { 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>js</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>prompt</span>(<span style=color:#e6db74>&#39;Neural network JSON:&#39;</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>reset</span>(<span style=color:#a6e22e>js</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>; 
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>importButton</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;#&#39;</span>
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>importButton</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>appendChild</span>(document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;br&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>reset</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=tabcontent data-tabset=f64f id=input-modes.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>inputModes</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;neighbor count&#39;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inputAt</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>neighbors</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>xd</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>xd</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>xd</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>yd</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>yd</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>yd</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>xd</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>yd</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>1</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>2</span>)) <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>g</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0.5</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>neighbors</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> [<span style=color:#a6e22e>neighbors</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>8.0</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;neighbor RGB&#39;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>24</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inputAt</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>values</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>xd</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>xd</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>xd</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>yd</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>yd</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>yd</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>xd</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>yd</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>outputSize</span>; <span style=color:#a6e22e>c</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>values</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>c</span>)) <span style=color:#75715e>// RGB
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>values</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;gradiant x/y&#39;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inputAt</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gl</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>1</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gr</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>1</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gu</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gd</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>gr</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>gl</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>gd</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>gu</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;none&#39;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inputAt</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; [],
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>colorInputMode</span> <span style=color:#f92672>=</span> Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>inputModes</span>)
</span></span></code></pre></div></div><div class=tabcontent data-tabset=f64f id=input-at.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>inputAt</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>inputNoise</span> <span style=color:#f92672>?</span> Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>inputXY</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>gridWidth</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>inputXY</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>gridHeight</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>concat</span>(<span style=color:#a6e22e>inputModes</span>[<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>colorInputMode</span>].<span style=color:#a6e22e>inputAt</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>input</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=tabcontent data-tabset=f64f id=reset.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>reset</span>(<span style=color:#a6e22e>network</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>inputSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>inputModes</span>[<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>colorInputMode</span>].<span style=color:#a6e22e>size</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hiddenLayers</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>hiddenLayers</span>)
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>net</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>brain</span>.<span style=color:#a6e22e>NeuralNetwork</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hiddenLayers</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>activation</span><span style=color:#f92672>:</span> Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>activation</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>activation</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>:</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>activation</span>,
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gridWidth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gridSize</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gridHeight</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gridSize</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Train it on random data to initialize
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>trainingData</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>inputSize</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>push</span>(Math.<span style=color:#a6e22e>random</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>output</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>outputSize</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>push</span>(Math.<span style=color:#a6e22e>random</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>trainingData</span>.<span style=color:#a6e22e>push</span>({<span style=color:#a6e22e>input</span>, <span style=color:#a6e22e>output</span>})
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>train</span>(<span style=color:#a6e22e>trainingData</span>, { <span style=color:#a6e22e>iterations</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span> })
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Rewrite the weights
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>network</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>net</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>fromJSON</span>(<span style=color:#a6e22e>network</span>)
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>js</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>toJSON</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>layer</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>layer</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>layer</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>neuron</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>[<span style=color:#a6e22e>layer</span>]) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newBias</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>biasScale</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>biasScale</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>[<span style=color:#a6e22e>layer</span>][<span style=color:#a6e22e>neuron</span>].<span style=color:#a6e22e>bias</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newBias</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>weight</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>[<span style=color:#a6e22e>layer</span>][<span style=color:#a6e22e>neuron</span>].<span style=color:#a6e22e>weights</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newWeight</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>weightScale</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>weightScale</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>[<span style=color:#a6e22e>layer</span>][<span style=color:#a6e22e>neuron</span>].<span style=color:#a6e22e>weights</span>[<span style=color:#a6e22e>weight</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>newWeight</span>
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>net</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>fromJSON</span>(<span style=color:#a6e22e>js</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gridWidth</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>row</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gridHeight</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pixel</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>outputSize</span>; <span style=color:#a6e22e>c</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>pixel</span>.<span style=color:#a6e22e>push</span>(Math.<span style=color:#a6e22e>random</span>())
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>row</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>pixel</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>row</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;network&#39;</span>).<span style=color:#a6e22e>innerText</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>toJSON</span>(), <span style=color:#66d9ef>null</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>network</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>toJSON</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=tabcontent data-tabset=f64f id=draw.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>c</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span>][<span style=color:#a6e22e>c</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>ex</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>showBorder</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>noStroke</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gridWidth</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>row</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gridHeight</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>++</span>) {  
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pixel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>inputAt</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>))   
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>addNoise</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>pixel</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+=</span> (Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.5</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>pixel</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+=</span> (Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.5</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>pixel</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>+=</span> (Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>0.5</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>100</span>        
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>row</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>pixel</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>row</span>)
</span></span><span style=display:flex><span>  } 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>buffer</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gridWidth</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>gridHeight</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>0</span>), <span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>1</span>), <span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>rect</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gridSize</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gridSize</span>, <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gridSize</span>, <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gridSize</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gx</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>round</span>(<span style=color:#a6e22e>mouseX</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gridSize</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gy</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>round</span>(<span style=color:#a6e22e>mouseY</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>gridSize</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>round</span>(<span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>gx</span>, <span style=color:#a6e22e>gy</span>, <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>round</span>(<span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>gx</span>, <span style=color:#a6e22e>gy</span>, <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>round</span>(<span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>getData</span>(<span style=color:#a6e22e>gx</span>, <span style=color:#a6e22e>gy</span>, <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>debugData</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>frame</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>frameCount</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pt</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>gx</span>, <span style=color:#a6e22e>gy</span>},
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rgb</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>b</span>},
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>output</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>inputAt</span>(<span style=color:#a6e22e>gx</span>, <span style=color:#a6e22e>gy</span>)),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>input</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>inputAt</span>(<span style=color:#a6e22e>gx</span>, <span style=color:#a6e22e>gy</span>),
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;debug&#39;</span>).<span style=color:#a6e22e>innerText</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>debugData</span>, <span style=color:#66d9ef>null</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>  document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;svg&#39;</span>).<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>brain</span>.<span style=color:#a6e22e>utilities</span>.<span style=color:#a6e22e>toSVG</span>(<span style=color:#a6e22e>net</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><p>Take a look at the code and feel free to <a href=mailto:blog@jverkamp.com>ask me</a> if anything needs more explication. Of particular interest are:</p><h2 id=generating-a-random-brainjs-network>Generating a random brain.js network</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>net</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>brain</span>.<span style=color:#a6e22e>NeuralNetwork</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hiddenLayers</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>activation</span><span style=color:#f92672>:</span> Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>activation</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>activation</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>:</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>activation</span>,
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Train it on random data to initialize
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>trainingData</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>inputSize</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>push</span>(Math.<span style=color:#a6e22e>random</span>())
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>output</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>outputSize</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>push</span>(Math.<span style=color:#a6e22e>random</span>())
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>trainingData</span>.<span style=color:#a6e22e>push</span>({<span style=color:#a6e22e>input</span>, <span style=color:#a6e22e>output</span>})
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>train</span>(<span style=color:#a6e22e>trainingData</span>, { <span style=color:#a6e22e>iterations</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Rewrite the weights
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>js</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>toJSON</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>layer</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>layer</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>layer</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>neuron</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>[<span style=color:#a6e22e>layer</span>]) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newBias</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>biasScale</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>biasScale</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>[<span style=color:#a6e22e>layer</span>][<span style=color:#a6e22e>neuron</span>].<span style=color:#a6e22e>bias</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newBias</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>weight</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>[<span style=color:#a6e22e>layer</span>][<span style=color:#a6e22e>neuron</span>].<span style=color:#a6e22e>weights</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newWeight</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>weightScale</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>weightScale</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>js</span>.<span style=color:#a6e22e>layers</span>[<span style=color:#a6e22e>layer</span>][<span style=color:#a6e22e>neuron</span>].<span style=color:#a6e22e>weights</span>[<span style=color:#a6e22e>weight</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>newWeight</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>net</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>fromJSON</span>(<span style=color:#a6e22e>js</span>)
</span></span></code></pre></div><p>This is a bit of a pain, but I finally got it to work. In order to have value to rewrite, you have to train it at least once. Originally I trained on random data, but that didn&rsquo;t work nearly as well. So now instead, we train, export to JSON, rewrite all of the weights and biases, then load it back in. It&rsquo;s messy, but it works. Perhaps I&rsquo;ll make a PR for brain.js to allow random weights. Perhaps it does already and I just can&rsquo;t find it. :)</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>