<!doctype html><html><head><title>Solving Snakebird – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.30448892aa1f91e9c4cb5494e5c5e5abc13b7778de7786e5256cdc7d2424813a.js integrity="sha256-MESIkqofkenEy1SU5cXlq8E7d3jed4blJWzcfSQkgTo=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg=" defer></script>
<script src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90=" defer></script>
<script src=/main.min.82ab51144325fae71ddbca46269a80c63b28bdab6be6b01aa9ec638c013748e6.js integrity="sha256-gqtRFEMl+ucd28pGJpqAxjsovatr5rAaqexjjAE3SOY=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.7cfac95bdd962d85ceec560e50fe7b04c44b58a76e5202006ef36ca8c0a7d836.css integrity="sha256-fPrJW92WLYXO7FYOUP57BMRLWKduUgIAbvNsqMCn2DY="><link rel=stylesheet href=/main.min.5cb1123af6f7b30230b5393c75ce8864dee1f2dcd12b5c4d5cfc0bf351a34476.css integrity="sha256-XLESOvb3swIwtTk8dc6IZN7h8tzRK1xNXPwL81GjRHY="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>Solving Snakebird</h1><div class=entry-meta><span class=entry-date>2021-08-18</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/08/17/immutable.js-solvers/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/javascript>JavaScript</a><a href=https://blog.jverkamp.com/2021/09/06/neural-network-cellular-automata/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/08/17/immutable.js-solvers/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/small-scripts>Small Scripts</a><a href=https://blog.jverkamp.com/2022/01/25/pulling-more-than-5000-logs-from-datadog/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/08/17/immutable.js-solvers/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/algorithms>Algorithms</a><a href=https://blog.jverkamp.com/2021/12/08/aoc-2021-day-8-seven-segment-demystifier/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2021/08/17/immutable.js-solvers/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/backtracking>Backtracking</a><a href=https://blog.jverkamp.com/2022/10/04/solving-sudoku-again/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2021/08/17/immutable.js-solvers/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/generators>Generators</a><a href=https://blog.jverkamp.com/2022/10/04/solving-sudoku-again/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2021/08/17/immutable.js-solvers/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/puzzles>Puzzles</a><a href=https://blog.jverkamp.com/2022/10/04/solving-sudoku-again/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2021/08/17/immutable.js-solvers/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/09/06/neural-network-cellular-automata/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2021/08/17/immutable.js-solvers/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/08/18/leroy-ninker-saddles-up/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p><a href=https://store.steampowered.com/app/357300/Snakebird/>Snakebird!</a></p><figure><img src=/embeds/2021/snakebird-0.png></figure><p>A cute little puzzle game, where you move around snake(birds). Move any number of snakes around the level, eating fruit, and getting to the exit. The main gotchas are that you have gravity to content with&ndash;your snake will easily fall off the edge of the world&ndash;and each time you eat a fruit, your snake gets bigger. This can help get longer to get into hard to reach places or it can cause trouble when you trap yourself in corners.</p><p>Let&rsquo;s use the new <a href=2021-08-17-immutable.js-solvers>immutable.js solver</a> to solve these problems!</p><p>First, a representation of state. The above level can be represented in a text format as so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>----------------------
</span></span><span style=display:flex><span>--------##-----*------
</span></span><span style=display:flex><span>--------####----------
</span></span><span style=display:flex><span>----#----##-----------
</span></span><span style=display:flex><span>------#--#---+-#------
</span></span><span style=display:flex><span>---CBA---#-#---##---+-
</span></span><span style=display:flex><span>-#######---##-------##
</span></span><span style=display:flex><span>######################
</span></span></code></pre></div><p>The snake is defined as <code>ABC</code> (you can currently have up to three, <code>A-Z</code>, <code>a-z</code>, and <code>0-9</code>). Walls are <code>#</code>, fruit is <code>+</code>, and the exit is <code>*</code>. Later levels have spikes that kill you on contact, which I&rsquo;ll represent with <code>^</code>.</p><p>To load that in, we scan through the lines/columns of that input, building up an immutable.js <code>Record</code> with a <code>Set</code> of <code>Point</code> (another <code>Record</code>) for each type of object. The snakes are <code>List</code> of <code>Point</code> (although once they leave, I will <code>null</code> them out).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>List</span>, <span style=color:#a6e22e>Set</span>, <span style=color:#a6e22e>Record</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;immutable&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SNAKE_BOUNDS</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>min</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;A&#39;</span>, <span style=color:#a6e22e>max</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Z&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>min</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#a6e22e>max</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;z&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>min</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#a6e22e>max</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;9&#39;</span>},
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>Point</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Record</span>({<span style=color:#a6e22e>r</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>State</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Record</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>walls</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Set</span>(),   <span style=color:#75715e>// tiles that can&#39;t be walked through
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>spikes</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Set</span>(),  <span style=color:#75715e>// tiles that kill snakes touching them
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>snakes</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>List</span>(), <span style=color:#75715e>// each snake is an ordered list of points from head to tail
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fruits</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Set</span>(),  <span style=color:#75715e>// each fruit makes the snake that eats it one longer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>exit</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Point</span>(),  <span style=color:#75715e>// each snake that reaches the exit is removed, when the last is removed you win
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>loadLevel</span>(<span style=color:#a6e22e>path</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rawData</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#a6e22e>path</span>, {<span style=color:#a6e22e>encoding</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;utf8&#39;</span>})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>rawData</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;\n&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>walls</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Set</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>spikes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Set</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>snakes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>List</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fruits</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Set</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>exit</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Point</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// a list of snake definitions in files with an ordered range of characters for each
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// example snakes would be ABC or abc or 123
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rawSnakes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SNAKE_BOUNDS</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>_</span> =&gt; [])
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>r</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>r</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>cloop</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>].<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>c</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Point</span>({<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>c</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// empty space
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;-&#39;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// walls
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;#&#39;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>walls</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>walls</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>pt</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// spikes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;^&#39;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>spikes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>spikes</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>pt</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// fruits
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;+&#39;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fruits</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fruits</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>pt</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>            <span style=color:#75715e>// exit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;*&#39;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>exit</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pt</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>            <span style=color:#75715e>// snakes, just collect the points for now with the character for later sorting
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>SNAKE_BOUNDS</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>SNAKE_BOUNDS</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>min</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>SNAKE_BOUNDS</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>max</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>rawSnakes</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>push</span>([<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>], <span style=color:#a6e22e>pt</span>])
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span> <span style=color:#a6e22e>cloop</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>            <span style=color:#75715e>// wtf
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>throw</span> <span style=color:#e6db74>`Unknown character </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>r</span>][<span style=color:#a6e22e>c</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> at </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>r</span><span style=color:#e6db74>}</span><span style=color:#e6db74>:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>c</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// sort the snakes based on their character definition, push the list of points to state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rawSnake</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>rawSnakes</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rawSnake</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pts</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>pt</span>] <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>rawSnake</span>.<span style=color:#a6e22e>sort</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>pts</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>pt</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>snakes</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>List</span>(<span style=color:#a6e22e>pts</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>State</span>({<span style=color:#a6e22e>walls</span>, <span style=color:#a6e22e>spikes</span>, <span style=color:#a6e22e>snakes</span>, <span style=color:#a6e22e>fruits</span>, <span style=color:#a6e22e>exit</span>})
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Next, let&rsquo;s reverse that for debugging purposes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>snakebirdToString</span>(<span style=color:#a6e22e>state</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Determine drawing bounds
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// This is necessary since snakes can run off platforms a bit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>minR</span>, <span style=color:#a6e22e>maxR</span>, <span style=color:#a6e22e>minC</span>, <span style=color:#a6e22e>maxC</span>] <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>bound</span>(<span style=color:#a6e22e>pt</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>minR</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>minR</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>maxR</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>maxR</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>minC</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>minC</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>c</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>maxC</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>maxC</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>c</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>walls</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>bound</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>snake</span> =&gt; <span style=color:#a6e22e>snake</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>bound</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>fruits</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>bound</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bound</span>(<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>exit</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>str</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>minR</span>; <span style=color:#a6e22e>r</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>maxR</span>; <span style=color:#a6e22e>r</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>minC</span>; <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>maxC</span>; <span style=color:#a6e22e>c</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Point</span>({<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>c</span>})
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>walls</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>pt</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>str</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;#&#39;</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>spikes</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>pt</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>str</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;^&#39;</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>fruits</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>pt</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>str</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;+&#39;</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>exit</span>.<span style=color:#a6e22e>equals</span>(<span style=color:#a6e22e>pt</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>str</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;*&#39;</span>
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>snake</span> =&gt; <span style=color:#a6e22e>snake</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>pt</span>))) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>size</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>i</span>) <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>i</span>).<span style=color:#a6e22e>size</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>i</span>).<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>j</span>).<span style=color:#a6e22e>equals</span>(<span style=color:#a6e22e>pt</span>)) {
</span></span><span style=display:flex><span>                            <span style=color:#a6e22e>str</span> <span style=color:#f92672>+=</span> String.<span style=color:#a6e22e>fromCharCode</span>(<span style=color:#a6e22e>SNAKE_BOUNDS</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>min</span>.<span style=color:#a6e22e>charCodeAt</span>(<span style=color:#ae81ff>0</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span>)
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>str</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;-&#39;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>str</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;\n&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>str</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>It will get confused if more than one type of object is in the same place, but that shouldn&rsquo;t be possible, so we&rsquo;ll ignore the possibility for now.</p><p>Next, the <code>isValid</code> and <code>isSolved</code> functions, these are the easier part:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isValid</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>state</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// check if any snake is on a spike
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>snake</span> =&gt; <span style=color:#a6e22e>snake</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>pt</span> =&gt; <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>spikes</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>pt</span>)))) <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// check if any snake is falling forever
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// find the lowest row
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>maxR</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>walls</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>pt</span> =&gt; { <span style=color:#a6e22e>maxR</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>maxR</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>r</span>) })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// check that each snake has at least one point within that bound
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>every</span>(<span style=color:#a6e22e>snake</span> =&gt; <span style=color:#a6e22e>snake</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>pt</span> =&gt; <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>r</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>maxR</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isSolved</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>state</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>fruits</span>.<span style=color:#a6e22e>size</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>every</span>(<span style=color:#a6e22e>snake</span> =&gt; <span style=color:#a6e22e>snake</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We&rsquo;re going to rely on <code>generateNextStates</code> to not generate a few classes of invalid states: you can&rsquo;t move into a wall or another snake. <code>isValid</code> then only needs to check if we&rsquo;re on a spike (most likely we fell onto one, it won&rsquo;t move onto one). But as an edge case, we need to make sure that a snake doesn&rsquo;t run off the edge of the map and fall forever. I did design the state so that snakes can go slightly off the edge and come back in (it&rsquo;s necessary for some levels), but once you start falling off the world, you&rsquo;re going to fall forever.</p><p>Since <code>generateNextStates</code> will <code>null</code> snakes that reach the exit, <code>isSolved</code> only needs to check that they&rsquo;re all <code>null</code>. Otherwise keep going.</p><p>Okay, enough of that. Let&rsquo;s do the hard part: <code>generateNextStates</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>generateNextStates</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span><span style=color:#f92672>*</span> (<span style=color:#a6e22e>state</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// handle hitting the exits (including by falling)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// can only exit if there are no fruits left
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>fruits</span>.<span style=color:#a6e22e>size</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>size</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>snake</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>snake</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// if we hit an exit, remove this snake
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// only remove one snake per iteration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>pt</span> =&gt; <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>equals</span>(<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>exit</span>))) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>yield</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>state</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;snakes&#39;</span>, <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;snakes&#39;</span>).<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>i</span>, <span style=color:#66d9ef>null</span>)),
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>step</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>*`</span>,
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// handle gravity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>gravityEachSnake</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>size</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>snake</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>snake</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pt</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>snake</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>ptd</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;r&#39;</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// supported by a wall
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>walls</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>ptd</span>))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span> <span style=color:#a6e22e>gravityEachSnake</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// supported by another snake
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>otherSnake</span> =&gt; <span style=color:#a6e22e>snake</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>otherSnake</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>snake</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>otherSnake</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>otherSnake</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>ptd</span>)))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span> <span style=color:#a6e22e>gravityEachSnake</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// if we made it this far, the snake should fall one point
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newSnake</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>pt</span> =&gt; <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;r&#39;</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>yield</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>state</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;snakes&#39;</span>, <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;snakes&#39;</span>).<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>newSnake</span>)),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>step</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}</span><span style=color:#e6db74>f`</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Only generate a single fall per iteration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// otherwise try to move each snake in each direction
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>size</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>snake</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>snake</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>d</span>, <span style=color:#a6e22e>cd</span>, <span style=color:#a6e22e>rd</span>] <span style=color:#66d9ef>of</span> [[<span style=color:#e6db74>&#39;→&#39;</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>], [<span style=color:#e6db74>&#39;←&#39;</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>], [<span style=color:#e6db74>&#39;↓&#39;</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>], [<span style=color:#e6db74>&#39;↑&#39;</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]]) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// check that the square is empty
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// hitting a fruit or an exit is fine
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>get</span>(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>pt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;r&#39;</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>rd</span>).<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#a6e22e>pt</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;c&#39;</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>cd</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>walls</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>pt</span>)) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>snake</span> =&gt; <span style=color:#a6e22e>snake</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>pt</span>))) <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// move the snake by adding the new point to the front of the snake
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// if we hit a fruit, keep the last element to make the snake longer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// otherwise, remove the end of the list to simulate movement
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newSnake</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>snake</span>.<span style=color:#a6e22e>unshift</span>(<span style=color:#a6e22e>pt</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>ateFruit</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>fruits</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>pt</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>ateFruit</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>newSnake</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newSnake</span>.<span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newState</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;snakes&#39;</span>, <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>newSnake</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ateFruit</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>newState</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newState</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;fruits&#39;</span>, <span style=color:#a6e22e>newState</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;fruits&#39;</span>).<span style=color:#a6e22e>remove</span>(<span style=color:#a6e22e>pt</span>))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>yield</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>state</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>newState</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>step</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>i</span><span style=color:#e6db74>}${</span><span style=color:#a6e22e>d</span><span style=color:#e6db74>}${</span><span style=color:#a6e22e>ateFruit</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;g&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There are three cases to deal with:</p><ul><li>Exiting the level</li><li>Falling</li><li>Moving (with a substate of eating a fruit)</li></ul><p>First, exiting. To do that, we have to make sure that all of the fruits are gone first. Then we just check if any snake ran into the exit. If so, null it out. We only ever check if one snake exited at a time and don&rsquo;t processing falling or moving if they do (with the early <code>return</code>). So in this case, we can only yield a maximum of one <code>move</code>.</p><p>Next, falling. This one is a bit tricky, since we have to deal with a few different rules:</p><ul><li>If any segment of the snake is resting on a wall or another snake, it doesn&rsquo;t fall</li><li>If the snake is resting on itself, it can fall (as long as the first point is met)</li></ul><p>Ergo this fun condition:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>snakes</span>.<span style=color:#a6e22e>some</span>(<span style=color:#a6e22e>otherSnake</span> =&gt; <span style=color:#a6e22e>snake</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>otherSnake</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>snake</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>otherSnake</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>otherSnake</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>ptd</span>)))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>continue</span> <span style=color:#a6e22e>gravityEachSnake</span>
</span></span></code></pre></div><p>If <code>some</code> <code>otherSnake</code> that is not <code>null</code> (already exited), not the same as the current <code>snake</code>, and includes any point of a wall, don&rsquo;t fall. Otherwise, generate an updated snake where the each row is one greater.</p><p>The final condition is moving. Take each snake and each direction and potentially generate a move:</p><ul><li>If the square is occupied (by a wall, snake, or spike), don&rsquo;t generate that move. Otherwise, check for a fruit. If there isn&rsquo;t one, remove the last element of the snake and add a new head (to simulate moving). If there is, just generate a head and don&rsquo;t remove the tail to grow.</li></ul><p>And that&rsquo;s it, we have all of the possible moves.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>solveSnakebird</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>makeSolver</span>({ <span style=color:#a6e22e>returnFirst</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>searchMode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;bfs&#39;</span>, <span style=color:#a6e22e>debug</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>DEBUG</span>, <span style=color:#a6e22e>generateNextStates</span>, <span style=color:#a6e22e>isValid</span>, <span style=color:#a6e22e>isSolved</span> })
</span></span></code></pre></div><p>Some additional wrapping code to run it on the command line here (<a href=https://github.com/jpverkamp/solvers/blob/main/snakebird.js>snakebird.js</a>) and we can run it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$ node snakebird.js snakebird/0.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/0.txt =====
</span></span><span style=display:flex><span>----------------------
</span></span><span style=display:flex><span>--------##-----*------
</span></span><span style=display:flex><span>--------####----------
</span></span><span style=display:flex><span>----#----##-----------
</span></span><span style=display:flex><span>------#--#---+-#------
</span></span><span style=display:flex><span>---CBA---#-#---##---+-
</span></span><span style=display:flex><span>-#######---##-------##
</span></span><span style=display:flex><span>######################
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.414
</span></span><span style=display:flex><span>iterations: 11117
</span></span><span style=display:flex><span>raw steps: start 0→ 0→ 0→ 0↓ 0→ 0→ 0↑ 0↑ 0→ 0→ 0→g 0→ 0↓ 0f 0→ 0→ 0→ 0→ 0→ 0↑ 0→g 0↑ 0← 0← 0← 0← 0↑ 0← 0↑ 0↑ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) 3→ ↓ 2→ 2↑ 4→ ↓ 5→ ↑ → ↑ 4← ↑ ← 2↑
</span></span></code></pre></div><p>That&rsquo;s a surprising lot of nodes to check, but it works pretty well. And because I have <code>returnFirst: false</code>, it will always find the optimal solution!</p><p>But&mldr; wait. How did I do that? Updates to <code>immutable.js</code>. When we have a solution, record rather than return. When we find a duplicate, update for shorter moves:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// If we have a solution:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// - If we&#39;re returning the first solution, return it and steps to get to it
</span></span></span><span style=display:flex><span><span style=color:#75715e>// - If not, record it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isSolved</span>(<span style=color:#a6e22e>currentState</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>returnFirst</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>state</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>currentState</span>.<span style=color:#a6e22e>toJS</span>(),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>steps</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>stepsTo</span>(<span style=color:#a6e22e>currentNode</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>iterations</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>duration</span><span style=color:#f92672>:</span> (Date.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>startTime</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>error</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>solutions</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>solutions</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>currentState</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Otherwise, check:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// - If we&#39;ve reached a new known state
</span></span></span><span style=display:flex><span><span style=color:#75715e>// - If it&#39;s a known state that contains fewer steps
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Either way, do not continue processing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>visited</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>currentState</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>visitedPreviousNode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>visited</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>currentState</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>stepsTo</span>(<span style=color:#a6e22e>currentNode</span>).<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>stepsTo</span>(<span style=color:#a6e22e>visitedPreviousNode</span>).<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>visited</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>visited</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>currentState</span>, <span style=color:#a6e22e>currentNode</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>currentNode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>currentNode</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;previousNode&#39;</span>, <span style=color:#a6e22e>visitedPreviousNode</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>visited</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>visited</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>currentState</span>, <span style=color:#a6e22e>currentNode</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>At the end, we have to check for the shortest of the <code>solutions</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// If we&#39;ve made it this far, check if we have any solutions
</span></span></span><span style=display:flex><span><span style=color:#75715e>// We need to return the shortest one
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>shortestSolvedNode</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>debug</span>) <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;SOLUTIONS&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>debug</span>) <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>solutions</span>.<span style=color:#a6e22e>toJSON</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>solutions</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>node</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>visited</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>state</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>shortestSolvedNode</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>stepsTo</span>(<span style=color:#a6e22e>node</span>).<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>stepsTo</span>(<span style=color:#a6e22e>shortestSolvedNode</span>).<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>shortestSolvedNode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>node</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>iterations</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>duration</span><span style=color:#f92672>:</span> (Date.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>startTime</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>shortestSolvedNode</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>shortestSolvedNode</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>toJS</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>steps</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>stepsTo</span>(<span style=color:#a6e22e>shortestSolvedNode</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>
</span></span></code></pre></div><p>And that&rsquo;s it. We have a way to find the shortest solution to any snakebird problem!</p><p>Now&mldr; it doesn&rsquo;t actually work perfectly. Particularly in the case of multiple snakes, there is an explosion of states that runs out of RAM before we can solve the problem. One solution: throw more RAM at it! But I think we could use a bit more optimization first. Either an ability to persist nodes we haven&rsquo;t used in a while to disk or a scoring node to order our search better.</p><p>That can wait for another day though. Onward!</p><p>Output for the first 11 levels (I need optimization for 9):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$ for f in snakebird/*.txt
</span></span><span style=display:flex><span>      node snakebird.js --progress 1000000 --timeout 60 $f
</span></span><span style=display:flex><span>  end | tee log.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/0.txt =====
</span></span><span style=display:flex><span>----------------------
</span></span><span style=display:flex><span>--------##-----*------
</span></span><span style=display:flex><span>--------####----------
</span></span><span style=display:flex><span>----#----##-----------
</span></span><span style=display:flex><span>------#--#---+-#------
</span></span><span style=display:flex><span>---CBA---#-#---##---+-
</span></span><span style=display:flex><span>-#######---##-------##
</span></span><span style=display:flex><span>######################
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.425
</span></span><span style=display:flex><span>iterations: 11117
</span></span><span style=display:flex><span>raw steps: start 0→ 0→ 0→ 0↓ 0→ 0→ 0↑ 0↑ 0→ 0→ 0→g 0→ 0↓ 0f 0→ 0→ 0→ 0→ 0→ 0↑ 0→g 0↑ 0← 0← 0← 0← 0↑ 0← 0↑ 0↑ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) 3→ ↓ 2→ 2↑ 4→ ↓ 5→ ↑ → ↑ 4← ↑ ← 2↑
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/1.txt =====
</span></span><span style=display:flex><span>---*--
</span></span><span style=display:flex><span>------
</span></span><span style=display:flex><span>#-----
</span></span><span style=display:flex><span>+--#+#
</span></span><span style=display:flex><span>------
</span></span><span style=display:flex><span>-#BA--
</span></span><span style=display:flex><span>-####-
</span></span><span style=display:flex><span>-####-
</span></span><span style=display:flex><span>-###--
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.1
</span></span><span style=display:flex><span>iterations: 1569
</span></span><span style=display:flex><span>raw steps: start 0↑ 0← 0f 0↑ 0← 0← 0↑g 0→ 0f 0→ 0→ 0→ 0f 0↑ 0↑g 0↑ 0← 0↑ 0↑ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) ↑ ← ↑ 2← ↑ 4→ 3↑ ← 2↑
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/2.txt =====
</span></span><span style=display:flex><span>---##-------
</span></span><span style=display:flex><span>---###------
</span></span><span style=display:flex><span>--####--*---
</span></span><span style=display:flex><span>-#####------
</span></span><span style=display:flex><span>-##-+#---C--
</span></span><span style=display:flex><span>-##-----AB-+
</span></span><span style=display:flex><span>###--#####--
</span></span><span style=display:flex><span>#######-##--
</span></span><span style=display:flex><span>#######--#--
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.145
</span></span><span style=display:flex><span>iterations: 1849
</span></span><span style=display:flex><span>raw steps: start 0← 0← 0← 0← 0← 0↑ 0f 0→ 0↑g 0← 0f 0↑ 0→ 0f 0→ 0→ 0→ 0→ 0→ 0→ 0→g 0↑ 0← 0← 0f 0← 0↑ 0↑ 0↑ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) 5← ↑ → ↑ ← ↑ 8→ ↑ 3← 3↑
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/3.txt =====
</span></span><span style=display:flex><span>---##-------
</span></span><span style=display:flex><span>---###------
</span></span><span style=display:flex><span>--####--*---
</span></span><span style=display:flex><span>-#####------
</span></span><span style=display:flex><span>-##-+#---C--
</span></span><span style=display:flex><span>-##-----AB-+
</span></span><span style=display:flex><span>###--#####--
</span></span><span style=display:flex><span>#######-##--
</span></span><span style=display:flex><span>#######--#--
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.136
</span></span><span style=display:flex><span>iterations: 1849
</span></span><span style=display:flex><span>raw steps: start 0← 0← 0← 0← 0← 0↑ 0f 0→ 0↑g 0← 0f 0↑ 0→ 0f 0→ 0→ 0→ 0→ 0→ 0→ 0→g 0↑ 0← 0← 0f 0← 0↑ 0↑ 0↑ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) 5← ↑ → ↑ ← ↑ 8→ ↑ 3← 3↑
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/4.txt =====
</span></span><span style=display:flex><span>--CBA-*
</span></span><span style=display:flex><span>--D#---
</span></span><span style=display:flex><span>-------
</span></span><span style=display:flex><span>#^---^#
</span></span><span style=display:flex><span>-^-----
</span></span><span style=display:flex><span>-^^#^--
</span></span><span style=display:flex><span>---+---
</span></span><span style=display:flex><span>-----#-
</span></span><span style=display:flex><span>----##-
</span></span><span style=display:flex><span>----##-
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.325
</span></span><span style=display:flex><span>iterations: 4836
</span></span><span style=display:flex><span>raw steps: start 0↑ 0← 0← 0f 0↓ 0↓ 0→ 0f 0f 0→ 0→ 0↓ 0↓ 0← 0↓ 0← 0← 0↑ 0→g 0→ 0f 0↑ 0→ 0↑ 0↑ 0← 0← 0↑ 0→ 0↑ 0→ 0→ 0↑ 0↑ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) ↑ 2← 2↓ 3→ 2↓ ← ↓ 2← ↑ 2→ ↑ → 2↑ 2← ↑ → ↑ 2→ 2↑
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/5.txt =====
</span></span><span style=display:flex><span>---*-
</span></span><span style=display:flex><span>-#---
</span></span><span style=display:flex><span>+--+#
</span></span><span style=display:flex><span>-----
</span></span><span style=display:flex><span>^#--#
</span></span><span style=display:flex><span>-BA^^
</span></span><span style=display:flex><span>-C#^-
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.244
</span></span><span style=display:flex><span>iterations: 3087
</span></span><span style=display:flex><span>raw steps: start 0↑ 0↑ 0← 0↑ 0→ 0↑ 0f 0→g 0↑ 0f 0f 0→ 0→ 0↑ 0↑ 0← 0← 0← 0↓ 0← 0f 0← 0↑g 0↑ 0↑ 0→ 0→ 0→ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) 2↑ ← ↑ → ↑ → ↑ 2→ 2↑ 3← ↓ 2← 3↑ 3→
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/6.txt =====
</span></span><span style=display:flex><span>---##----
</span></span><span style=display:flex><span>---##----
</span></span><span style=display:flex><span>--##-----
</span></span><span style=display:flex><span>-###-----
</span></span><span style=display:flex><span>--#+-#---
</span></span><span style=display:flex><span>--#-----*
</span></span><span style=display:flex><span>BA---#---
</span></span><span style=display:flex><span>C##^-----
</span></span><span style=display:flex><span>D-###----
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.194
</span></span><span style=display:flex><span>iterations: 3553
</span></span><span style=display:flex><span>raw steps: start 0→ 0→ 0→ 0↑ 0→ 0→ 0↑ 0↑ 0← 0← 0↑ 0→ 0→ 0f 0↓ 0↓ 0← 0← 0↑ 0↑ 0↑ 0f 0f 0←g 0↓ 0f 0← 0← 0← 0← 0↑ 0→ 0→ 0f 0→ 0→ 0→ 0↑ 0→ 0→ 0→ 0→ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) 3→ ↑ 2→ 2↑ 2← ↑ 2→ 2↓ 2← 3↑ ← ↓ 4← ↑ 5→ ↑ 4→
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/7.txt =====
</span></span><span style=display:flex><span>------*---
</span></span><span style=display:flex><span>----------
</span></span><span style=display:flex><span>---#------
</span></span><span style=display:flex><span>----------
</span></span><span style=display:flex><span>#---------
</span></span><span style=display:flex><span>#---------
</span></span><span style=display:flex><span>#--#---abc
</span></span><span style=display:flex><span>---#--ABCd
</span></span><span style=display:flex><span>------####
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 22.459
</span></span><span style=display:flex><span>iterations: 526433
</span></span><span style=display:flex><span>raw steps: start 0↑ 0↑ 0→ 0↑ 0← 0← 0f 1↓ 1← 1↑ 0← 0← 1↑ 1↑ 1← 1← 1← 1← 1← 1↑ 1← 0↑ 0↑ 0← 0↑ 0← 0← 1← 1↑ 1↑ 1→ 0f 1f 1→ 1→ 1↑ 1→ 0↑ 0↑ 0→ 0↑ 0→ 0→ 0→ 0→ 0→ 0* 1→ 1→ 1→ 1↑ 1*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) 2↑ → ↑ 2← select(1; a-z) ↓ ← ↑ select(0; A-Z) 2← select(1; a-z) 2↑ 5← ↑ ← select(0; A-Z) 2↑ ← ↑ 2← select(1; a-z) ← 2↑ 3→ ↑ → select(0; A-Z) 2↑ → ↑ 5→ select(1; a-z) 3→ ↑
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/8.txt =====
</span></span><span style=display:flex><span>--------------*-
</span></span><span style=display:flex><span>----------------
</span></span><span style=display:flex><span>--CBA--------###
</span></span><span style=display:flex><span>-EDabc-----^^^##
</span></span><span style=display:flex><span>######^^^--^----
</span></span><span style=display:flex><span>-#####--^^#^----
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 34.044
</span></span><span style=display:flex><span>iterations: 680995
</span></span><span style=display:flex><span>raw steps: start 0↑ 0← 0↑ 0→ 0→ 0f 0↓ 0→ 1↑ 1→ 0→ 1↓ 1→ 0→ 0→ 1→ 0↓ 0→ 0f 1↑ 1→ 1→ 0↑ 1→ 0↑ 1↑ 1→ 1→ 1→ 1→ 0↑ 0↑ 0→ 0→ 0→ 0→ 0* 1→ 1↑ 1*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) ↑ ← ↑ 2→ ↓ → select(1; a-z) ↑ → select(0; A-Z) → select(1; a-z) ↓ → select(0; A-Z) 2→ select(1; a-z) → select(0; A-Z) ↓ → select(1; a-z) ↑ 2→ select(0; A-Z) ↑ select(1; a-z) → select(0; A-Z) ↑ select(1; a-z) ↑ 4→ select(0; A-Z) 2↑ 4→ select(1; a-z) → ↑
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/9.txt =====
</span></span><span style=display:flex><span>----*---
</span></span><span style=display:flex><span>--------
</span></span><span style=display:flex><span>--------
</span></span><span style=display:flex><span>----#^--
</span></span><span style=display:flex><span>--------
</span></span><span style=display:flex><span>--------
</span></span><span style=display:flex><span>---^^---
</span></span><span style=display:flex><span>-#------
</span></span><span style=display:flex><span>-----#--
</span></span><span style=display:flex><span>--------
</span></span><span style=display:flex><span>--------
</span></span><span style=display:flex><span>CBA--ab-
</span></span><span style=display:flex><span>D#####cd
</span></span><span style=display:flex><span>####-##e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 60.003
</span></span><span style=display:flex><span>iterations: 628280
</span></span><span style=display:flex><span>error: maxTime reached
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== snakebird/10.txt =====
</span></span><span style=display:flex><span>-###-----
</span></span><span style=display:flex><span>####-*---
</span></span><span style=display:flex><span>---#-----
</span></span><span style=display:flex><span>-+-#---D#
</span></span><span style=display:flex><span>-----ABC#
</span></span><span style=display:flex><span>--####-##
</span></span><span style=display:flex><span>---###-#-
</span></span><span style=display:flex><span>-----#-+-
</span></span><span style=display:flex><span>-----#-##
</span></span><span style=display:flex><span>-----#-##
</span></span><span style=display:flex><span>----##-##
</span></span><span style=display:flex><span>----####-
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>time taken: 0.579
</span></span><span style=display:flex><span>iterations: 16740
</span></span><span style=display:flex><span>raw steps: start 0↑ 0→ 0↑ 0↑ 0f 0↑ 0f 0f 0f 0f 0f 0f 0→g 0→ 0→ 0→ 0↑ 0← 0← 0f 0← 0← 0↑ 0↑ 0↑ 0← 0← 0← 0← 0← 0← 0↑ 0→g 0↑ 0→ 0f 0f 0→ 0→ 0→ 0↑ 0↑ 0↑ 0*
</span></span><span style=display:flex><span>combined steps: select(0; A-Z) ↑ → 3↑ 4→ ↑ 4← 3↑ 6← ↑ → ↑ 4→ 3↑
</span></span></code></pre></div><p>Pretty cool. Next up, optimization!</p><p>Source:</p><ul><li><a href=https://github.com/jpverkamp/solvers/blob/main/snakebird.js>snakebird.js</a></li><li><a href=https://github.com/jpverkamp/solvers/blob/main/solvers/immutable.js>solvers/immutable.js</a></li></ul></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>