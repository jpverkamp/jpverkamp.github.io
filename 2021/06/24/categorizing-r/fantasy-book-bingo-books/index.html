<!doctype html><html>
<head>
<title>Categorizing r/Fantasy Book Bingo Books â€“ jverkamp.com</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css integrity=sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous>
<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel=stylesheet>
<link rel=stylesheet href=/custom.css defer>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script>
</head>
<body>
<div id=wrapper><header id=page-header role=banner>
<h1><a href=/>JP's Blog</a></h1>
<ul id=page-header-links>
<li>
<a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a>
</li>
<li>
<form action=//www.google.com/search method=get onsubmit="(function(a){a.q.value='site:blog.jverkamp.com '+a.qfront.value})(this)" class="navbar-form navbar-right" role=search _lpchecked=1>
<div class=form-group>
<input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button>
</div>
</form>
</li>
</ul>
<nav id=header-navigation role=navigation class=ribbon>
<ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li>
</ul>
</nav>
</header>
<div id=page-content-wrapper>
<div id=page-content><article>
<header>
<h1 class=entry-title>Categorizing r/Fantasy Book Bingo Books</h1>
<div class=entry-meta><span class=entry-date>2021-06-24</span>
</div>
<div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li>
<a class=taxonomy-key href=/programming/languages/>Languages</a>
<ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/04/20/partitioning-a-linked-list/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2021/06/28/ordering-board-game-geek-geeklists-by-rank/ class=next-link></a></li></ul>
</li><li>
<a class=taxonomy-key href=/programming/sources/>Sources</a>
<ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/sources/apis>APIs</a><a href=https://blog.jverkamp.com/2021/06/26/generating-a-book-bingo-chart-in-hugo/ class=next-link></a></li></ul>
</li><li>
<a class=taxonomy-key href=/programming/topics/>Topics</a>
<ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/04/20/partitioning-a-linked-list/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/small-scripts>Small Scripts</a><a href=https://blog.jverkamp.com/2021/06/25/a-generic-brute-force-backtracking-solver/ class=next-link></a></li></ul>
</li><li><a class=taxonomy-key href=/programming>programming</a>
<ul>
<li><a href=https://blog.jverkamp.com/2021/04/20/partitioning-a-linked-list/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/06/25/a-generic-brute-force-backtracking-solver/ class=next-link>Next</a></ul>
</li><li><a class=taxonomy-key href=/>All Posts</a>
<ul>
<li><a href=https://blog.jverkamp.com/2021/06/22/the-sweet-far-thing/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/06/25/a-generic-brute-force-backtracking-solver/ class=next-link>Next</a></ul>
</li></ul>
</div>
</div>
</header>
<div class=entry-content><p>I&rsquo;ve been working through the <a href=https://blog.jverkamp.com/2021/04/01/2021-book-bingo/>r/Fantasy 2021 Book Bingo</a> this year:</p>
<h1>2021 Book Bingo</h1>
<table class=bingo><tr><td>
<p>5 SFF Short Stories (Hard: An entire anthology or collection)</p>
<hr><a href=https://blog.jverkamp.com/2021/03/26/attack-on-titan-vol.-1/>
<figure>
<img src=/embeds/books/attack-on-titan-vol-1.jpg>
<figcaption>Attack on Titan, Vol. 1</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Set in Asia (Hard: by an Asian author)</p>
<hr><a href=https://blog.jverkamp.com/2022/03/08/the-poppy-war/>
<figure>
<img src=/embeds/books/the-poppy-war.jpg>
<figcaption>The Poppy War</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p><a href=https://www.reddit.com/r/Fantasy/wiki/index/a-to-z-genre-guide>r/Fantasy A to Z Genre Guide</a> (Hard: by a BIPOC author)</p>
<hr></td><td>
<p>Found Family (Hard: featuring an LGBTQ+ character)</p>
<hr><a href=https://blog.jverkamp.com/2021/07/18/the-house-in-the-cerulean-sea/>
<figure>
<img src=/embeds/books/the-house-in-the-cerulean-sea.jpg>
<figcaption>The House in the Cerulean Sea</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>First person POV (Hard: Multiple)</p>
<hr></td></tr><tr><td>
<p>r/Fantasy Book Club (Hard: with participation)</p>
<hr></td><td>
<p>New to you author (Hard: haven&rsquo;t heard much about)</p>
<hr><a href=https://blog.jverkamp.com/2022/03/10/black-rain-and-paper-cranes/>
<figure>
<img src=/embeds/books/black-rain-and-paper-cranes.jpg>
<figcaption>Black Rain and Paper Cranes</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Gothic Fantasy (Hard: not in the <a href=https://bookriot.com/gothic-fantasy/>Book Riot article</a>)</p>
<hr><a href=https://blog.jverkamp.com/2021/06/09/mexican-gothic/>
<figure>
<img src=/embeds/books/mexican-gothic.jpg>
<figcaption>Mexican Gothic</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Backlist book (Hard: published before 2000)</p>
<hr></td><td>
<p>Revenge-seeking character (Hard: revenge as the major book plot)</p>
<hr><a href=https://blog.jverkamp.com/2021/10/01/red-sister/>
<figure>
<img src=/embeds/books/red-sister.jpg>
<figcaption>Red Sister</figcaption>
</figure>
</a><p>(Hard Mode)</p></td></tr><tr><td>
<p>Mystery plot (Hard: not primary world urban fantasy)</p>
<hr><a href=https://blog.jverkamp.com/2021/06/19/six-wakes/>
<figure>
<img src=/embeds/books/six-wakes.jpg>
<figcaption>Six Wakes</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Comfort read (Hard: that isn&rsquo;t a reread)</p>
<hr><a href=https://blog.jverkamp.com/2021/04/13/wild-sign/>
<figure>
<img src=/embeds/books/wild-sign.jpg>
<figcaption>Wild Sign</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Debut novel (Hard: published in 2021)</p>
<hr><a href=https://blog.jverkamp.com/2021/04/26/tales-of-nezura-book-1-the-zevolra/>
<figure>
<img src=/embeds/books/tales-of-nezura-book-1-the-zevolra.jpg>
<figcaption>Tales of Nezura: Book 1: The Zevolra</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Cat squasher (500+ pages; Hard: 800+ pages)</p>
<hr><a href=https://blog.jverkamp.com/2021/10/14/hellblazer-vol.-1-original-sins/>
<figure>
<img src=/embeds/books/hellblazer-vol-1-original-sins.jpg>
<figcaption>Hellblazer, Vol. 1: Original Sins</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>SFF-related nonfiction (Hard: published in the last 5 years)</p>
<hr><a href=https://blog.jverkamp.com/2022/03/07/daemon-voices/>
<figure>
<img src=/embeds/books/daemon-voices.jpg>
<figcaption>Daemon Voices</figcaption>
</figure>
</a><p>(Hard Mode)</p></td></tr><tr><td>
<p>Latinx or Latin American author (Hard: with fewer than 1000 Goodreads ratings)</p>
<hr></td><td>
<p>Self published (Hard: with fewer than 50 Goodreads ratings)</p>
<hr><a href=https://blog.jverkamp.com/2021/04/26/tales-of-nezura-book-1-the-zevolra/>
<figure>
<img src=/embeds/books/tales-of-nezura-book-1-the-zevolra.jpg>
<figcaption>Tales of Nezura: Book 1: The Zevolra</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Forest setting (Hard: for the entire book)</p>
<hr><a href=https://blog.jverkamp.com/2021/07/01/annihilation/>
<figure>
<img src=/embeds/books/annihilation.jpg>
<figcaption>Annihilation</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Genre mashup (Hard: of three or more genres)</p>
<hr><a href=https://blog.jverkamp.com/2021/07/13/gideon-the-ninth/>
<figure>
<img src=/embeds/books/gideon-the-ninth.jpg>
<figcaption>Gideon the Ninth</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Has chapter titles of more than one word (Hard: for every chapter)</p>
<hr><a href=https://blog.jverkamp.com/2021/04/21/the-midnight-library/>
<figure>
<img src=/embeds/books/the-midnight-library.jpg>
<figcaption>The Midnight Library</figcaption>
</figure>
</a><p>(Hard Mode)</p></td></tr><tr><td>
<p>___ of ___ (Hard: and ___)</p>
<hr><a href=https://blog.jverkamp.com/2021/12/08/an-alchemy-of-masques-and-mirrors/>
<figure>
<img src=/embeds/books/an-alchemy-of-masques-and-mirrors.jpg>
<figcaption>An Alchemy of Masques and Mirrors</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>First contact (Hard: that doesn&rsquo;t lead to war)</p>
<hr><a href=https://blog.jverkamp.com/2021/06/15/project-hail-mary/>
<figure>
<img src=/embeds/books/project-hail-mary.jpg>
<figcaption>Project Hail Mary</figcaption>
</figure>
</a><p>(Hard Mode)</p></td><td>
<p>Trans or Nonbinary (Hard: protagonist)</p>
<hr></td><td>
<p>Debut author (Hard: with an AMA)</p>
<hr></td><td>
<p>Witches (Hard: as the main protagonist)</p>
<hr><a href=https://blog.jverkamp.com/2021/04/11/a-great-and-terrible-beauty/>
<figure>
<img src=/embeds/books/a-great-and-terrible-beauty.jpg>
<figcaption>A Great and Terrible Beauty</figcaption>
</figure>
</a><p>(Hard Mode)</p></td></tr></table>
<p>One thing that I&rsquo;ve been having a bit of trouble with is categorizing books for that. There is a very active <a href=https://www.reddit.com/r/Fantasy/comments/mhz3k7/the_2021_rfantasy_bingo_recommendations_list/>recommendations thread</a>, but without the ability to load the entire thread, it &mldr; isn&rsquo;t great to search. So let&rsquo;s make that easier.</p>
<p>First thing first, let&rsquo;s get the raw data. It turns out that Reddit has a wonderfully simple API to start with, just add <code>.json</code> to a URL to get a thread in JSON format. <a href=https://www.reddit.com/r/Fantasy/comments/mhz3k7/the_2021_rfantasy_bingo_recommendations_list/.json>Example</a>. It&rsquo;s a bit of a weird format, but it&rsquo;s parsable. From there, you have references to child nodes that you can download in order to get one giant JSON object for the entire thread. Which sounds like a fascinating problem, but this time around, I just skipped that and used <a href=https://github.com/saucecode/reddit-thread-ripper/blob/master/ripper.py>this code</a>. Give it a thread, wait a bit (for such a large thread), get JSON.</p>
<p>You could keep that as a JSON file, but I wanted to be sneaky/weird and put it straight in the script. It&rsquo;s a fair chunk of data with a number of weird characters, so storing it could be tricky&mldr; unless you just <a href=https://en.wikipedia.org/wiki/base64>base64</a> encode the entire thing. You can then store it straight inline and get it all out with <code>data = json.loads(base64.b64decode('W3siYm9keS...'))</code>. It&rsquo;s actually not that unusual of an idea. You see the same thing with inline <code>data:</code> images in webpages or games that directly embed art assets in the compiled file for optimization/distribution reasons.</p>
<p>Next, parsing. In this case, the recommendations thread has one first level response for each of the categories in the bingo, but after that just about any level of response could contain book titles. So what we want is to search the JSON object recursively.</p>
<ul>
<li>For dictionaries, search the &lsquo;body&rsquo; (for text) and &lsquo;replies&rsquo; (for further children)</li>
<li>For lists, search all entries (lists of replies)</li>
<li>For strings (bodies), search the text (case insensitive)</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> base64
<span style=color:#f92672>import</span> json
<span style=color:#f92672>import</span> sys

data <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(base64<span style=color:#f92672>.</span>b64decode(<span style=color:#e6db74>&#39;W3siYm9keS...&#39;</span>))
    
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>search</span>(key, data, path <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>):
    path <span style=color:#f92672>=</span> path <span style=color:#f92672>or</span> []
    
    <span style=color:#66d9ef>if</span> isinstance(data, list):
        <span style=color:#66d9ef>for</span> i, child <span style=color:#f92672>in</span> enumerate(data):
            <span style=color:#66d9ef>yield from</span> search(key, child, path)
    <span style=color:#66d9ef>elif</span> isinstance(data, dict):
        <span style=color:#66d9ef>if</span> body <span style=color:#f92672>:=</span> data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;body&#39;</span>):
            <span style=color:#66d9ef>yield from</span> search(key, body, path)
            <span style=color:#66d9ef>yield from</span> search(key, data<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;replies&#39;</span>), path <span style=color:#f92672>+</span> [body])
    <span style=color:#66d9ef>elif</span> isinstance(data, str):
        <span style=color:#66d9ef>if</span> key<span style=color:#f92672>.</span>lower() <span style=color:#f92672>in</span> data<span style=color:#f92672>.</span>lower():
            <span style=color:#66d9ef>yield</span> path <span style=color:#f92672>+</span> [data]

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>top_level_search</span>(key):
    results <span style=color:#f92672>=</span> set()
    <span style=color:#66d9ef>for</span> result <span style=color:#f92672>in</span> search(key, data):
        results<span style=color:#f92672>.</span>add(result[<span style=color:#ae81ff>0</span>])
    <span style=color:#66d9ef>return</span> list(sorted(results))

<span style=color:#66d9ef>for</span> arg <span style=color:#f92672>in</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>:]:
    print(arg)
    <span style=color:#66d9ef>for</span> result <span style=color:#f92672>in</span> top_level_search(arg):
        print(result)
    print()
</code></pre></div><p>I really do love generators in this case, with <code>yield from</code>. You can recursively scan through the entire structure and just sort of return a flat list for free. In this case, I&rsquo;m keeping track of the <code>path</code> through the nodes that I took to get to a specific point, although I&rsquo;m only ending up returning the <code>top_level_search</code> for each thread (I did the whole path at first, which was neat).</p>
<p>And as a result:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python3 ~/Dropbox/book-bingo.py <span style=color:#e6db74>&#39;Six Wakes&#39;</span>

Six Wakes
**Mystery Plot** <span style=color:#ae81ff>\-</span> The main plot of the book centers around solving a mystery. **HARD MODE:** Not a primary world Urban Fantasy <span style=color:#f92672>(</span>secondary world urban fantasy is okay!<span style=color:#f92672>)</span>

$ python3 ~/Dropbox/book-bingo.py <span style=color:#e6db74>&#39;Annihilation&#39;</span>

Annihilation
**First Contact** <span style=color:#ae81ff>\-</span> From Wikipedia:  Science Fiction about the first meeting between humans and extraterrestrial life, or of any sentient species<span style=color:#960050;background-color:#1e0010>&#39;</span> first encounter with another one, given they are from different planets or natural satellites. **HARD MODE:** War does not break out as a result of contact.
**First Person POV** <span style=color:#ae81ff>\-</span> defined as:  a literary style in which the narrative is told from the perspective of a narrator speaking directly about themselves. <span style=color:#f92672>[</span>Link <span style=color:#66d9ef>for</span> examples.<span style=color:#f92672>](</span>https://examples.yourdictionary.com/examples-of-point-of-view.html<span style=color:#f92672>)</span> **HARD MODE:**  There is more than one perspective, but each perspective is written in First Person.
**Forest Setting** <span style=color:#ae81ff>\-</span>  This setting must be used be <span style=color:#66d9ef>for</span> a good portion of the book. **HARD MODE:** The entire book takes place in this setting.
**Mystery Plot** <span style=color:#ae81ff>\-</span> The main plot of the book centers around solving a mystery. **HARD MODE:** Not a primary world Urban Fantasy <span style=color:#f92672>(</span>secondary world urban fantasy is okay!<span style=color:#f92672>)</span>
</code></pre></div><p>Pretty handy!</p></div>
</article></div>
</div><footer id=page-footer role=contentinfo>
<nav id=footer-navigation role=navigation class=ribbon>
<ul class=main-navigation>
<li><a href=/archive-by-date/>All posts: By Date</a></li>
<li><a href=/archive-by-tag/>All posts: By Tag</a></li>
<li>
<a href=/atom.xml>
RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
</sup>
</a>
</li><li>
<a href=/programming/atom.xml>
RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
</sup>
</a>
</li></ul>
</nav>
<div id=page-footer-content>
<div class=legal>
<p>
All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US>
<img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png>
</a>
</p>
<p>
Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a>
</p>
</div>
</div>
</footer>
</div><script defer src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script>
<script defer src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin=anonymous></script>
<script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js integrity=sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h crossorigin=anonymous></script>
<script defer src=https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script defer>mermaid.initialize({startOnLoad:!0,securityLevel:'loose'})</script>
<script defer src=/custom.js></script>
</body>
</html>