<!doctype html><html>
<head>
<title>AoC 2021 Day 3: Binary Contraption â€“ jverkamp.com</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css integrity=sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous>
<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel=stylesheet>
<link rel=stylesheet href=/custom.css defer>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script>
</head>
<body>
<div id=wrapper><header id=page-header role=banner>
<h1><a href=/>JP's Blog</a></h1>
<ul id=page-header-links>
<li>
<a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a>
</li>
<li>
<form action=//www.google.com/search method=get onsubmit="(function(a){a.q.value='site:blog.jverkamp.com '+a.qfront.value})(this)" class="navbar-form navbar-right" role=search _lpchecked=1>
<div class=form-group>
<input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button>
</div>
</form>
</li>
</ul>
<nav id=header-navigation role=navigation class=ribbon>
<ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li>
</ul>
</nav>
</header>
<div id=page-content-wrapper>
<div id=page-content><article>
<header>
<h1 class=entry-title>AoC 2021 Day 3: Binary Contraption</h1>
<div class=entry-meta><span class=entry-date>2021-12-03</span>
</div>
<div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li>
<a class=taxonomy-key href=/programming/languages/>Languages</a>
<ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/12/02/aoc-2021-day-2-submarine-simulator/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2021/12/04/aoc-2021-day-4-his-name-oh/ class=next-link></a></li></ul>
</li><li>
<a class=taxonomy-key href=/programming/sources/>Sources</a>
<ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/12/02/aoc-2021-day-2-submarine-simulator/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2021/12/04/aoc-2021-day-4-his-name-oh/ class=next-link></a></li></ul>
</li><li>
<a class=taxonomy-key href=/programming/topics/>Topics</a>
<ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/09/27/large-scale-asynchronous-dns-scans/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/bitfields>Bitfields</a></li></ul>
</li><li>
<a class=taxonomy-key href=/series/>Series</a>
<ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/12/02/aoc-2021-day-2-submarine-simulator/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2021>Advent of Code 2021</a><a href=https://blog.jverkamp.com/2021/12/04/aoc-2021-day-4-his-name-oh/ class=next-link></a></li></ul>
</li><li><a class=taxonomy-key href=/programming>programming</a>
<ul>
<li><a href=https://blog.jverkamp.com/2021/12/02/aoc-2021-day-2-submarine-simulator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/12/04/aoc-2021-day-4-his-name-oh/ class=next-link>Next</a></ul>
</li><li><a class=taxonomy-key href=/>All Posts</a>
<ul>
<li><a href=https://blog.jverkamp.com/2021/12/03/writing-an-interpreter-in-go/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/12/03/hellblazer-volume-6-bloodlines/ class=next-link>Next</a></ul>
</li></ul>
</div>
</div>
</header>
<div class=entry-content><h3 id=source-binary-diagnostichttpsadventofcodecom2021day3>Source: <a href=https://adventofcode.com/2021/day/3>Binary Diagnostic</a></h3>
<h4 id=part-1-given-a-list-of-binary-numbers-calculate-gamma-such-that-each-bit-is-the-most-common-bit-in-that-position-in-the-input-and-epsilon-which-is-the-binary-inverse-of-gamma-return-the-product><strong>Part 1:</strong> Given a list of binary numbers, calculate gamma such that each bit is the most common bit in that position in the input and epsilon which is the binary inverse of gamma. Return the product.</h4>
<p>I feel like this one could have been expressed a bit more elegantly, but I think the point is still clear enough:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>part1</span>(lines: typer<span style=color:#f92672>.</span>FileText):
    <span style=color:#75715e># Keep track of how many lines we counted total and just the number of ones</span>
    counter <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
    one_counts <span style=color:#f92672>=</span> []

    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines:
        line <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>strip()
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> line:
            <span style=color:#66d9ef>continue</span>

        counter <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>

        <span style=color:#75715e># If we don&#39;t have an initalized counts, start with &#39;0&#39; or &#39;1&#39;</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> one_counts:
            one_counts <span style=color:#f92672>=</span> list(map(int, line))

        <span style=color:#75715e># Otherwise, add for any ones</span>
        <span style=color:#66d9ef>else</span>:
            <span style=color:#66d9ef>for</span> i, bit <span style=color:#f92672>in</span> enumerate(line):
                <span style=color:#66d9ef>if</span> int(bit) <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
                    one_counts[i] <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>

    <span style=color:#75715e># Recombine into a binary number, that is the gamma rate</span>
    <span style=color:#75715e># The epsilon rate is the inverse</span>
    gamma <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(
        <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#66d9ef>if</span> bit <span style=color:#f92672>&gt;</span> counter <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;0&#39;</span>
        <span style=color:#66d9ef>for</span> bit <span style=color:#f92672>in</span> one_counts
    )
    epsilon <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(
        <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#66d9ef>if</span> bit <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;0&#39;</span>
        <span style=color:#66d9ef>for</span> bit <span style=color:#f92672>in</span> gamma
    )

    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>gamma<span style=color:#e6db74>=}</span><span style=color:#e6db74>=</span><span style=color:#e6db74>{</span>int(gamma, <span style=color:#ae81ff>2</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>epsilon<span style=color:#e6db74>=}</span><span style=color:#e6db74>=</span><span style=color:#e6db74>{</span>int(epsilon, <span style=color:#ae81ff>2</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>, product=</span><span style=color:#e6db74>{</span>int(gamma, <span style=color:#ae81ff>2</span>)<span style=color:#f92672>*</span>int(epsilon, <span style=color:#ae81ff>2</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</code></pre></div><p>In this case, we&rsquo;re going to keep a running count of the number of ones in each position in <code>one_counts</code> (we have to initialize the first time through). Most of the loop counts that using <code>enumerate</code> to get the positions.</p>
<p>Then when we&rsquo;re done, if the number of ones is greater than half the number of inputs, <code>1</code> was more common. Otherwise, <code>0</code>. Turn those back from binary to integers with <code>int(bits, 2)</code> and multiply and we&rsquo;re done.</p>
<p>For my particular input:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python3 binary-contraption.py part1 input.txt
gamma<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;100100101010&#39;</span><span style=color:#f92672>=</span>2346, epsilon<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;011011010101&#39;</span><span style=color:#f92672>=</span>1749, product<span style=color:#f92672>=</span><span style=color:#ae81ff>4103154</span>
</code></pre></div><h4 id=part-2-given-a-list-of-binary-numbers-repeatedly-filter-the-list-such-that-in-iteration-i-only-numbers-with-the-mostleast-common-bit-in-that-position-of-numbers-remaining-is-kept-after-each-set-has-been-reduced-to-one-number-return-the-product-of-the-mostleast-values><strong>Part 2:</strong> Given a list of binary numbers repeatedly filter the list such that in iteration <code>i</code>, only numbers with the most/least common bit in that position of numbers remaining is kept. After each set has been reduced to one number, return the product of the most/least values.</h4>
<p>That&rsquo;s a bit confusingly worded, but as an example, consider if, after 3 iterations, we have the list:</p>
<ul>
<li><code>00100</code></li>
<li><code>11110</code></li>
<li><code>10110</code></li>
<li><code>10111</code></li>
<li><code>10101</code></li>
</ul>
<p>We&rsquo;re on the 4th iteration, so the most common 4th bit is <code>1</code>. If we&rsquo;re evaluating &lsquo;most&rsquo;, keep the middle 3 values. If we&rsquo;re evaluating the least, keep only the first and last.</p>
<p>Full code:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>part2</span>(lines: typer<span style=color:#f92672>.</span>FileText):
    <span style=color:#75715e># Load the entire file into memory this time</span>
    lines <span style=color:#f92672>=</span> [
        line<span style=color:#f92672>.</span>strip()
        <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines
        <span style=color:#66d9ef>if</span> line<span style=color:#f92672>.</span>strip()
    ]

    potential_generators <span style=color:#f92672>=</span> copy<span style=color:#f92672>.</span>copy(lines)
    potential_scrubbers <span style=color:#f92672>=</span> copy<span style=color:#f92672>.</span>copy(lines)

    <span style=color:#75715e># Helper to find the most/least common bit in a given position from a given list</span>
    <span style=color:#75715e># Note, the &gt;= here is necessary to break ties (resulting in 1 for most common, 0 for least)</span>
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>most_common</span>(data, position):
        one_count <span style=color:#f92672>=</span> sum(
            <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>if</span> (line[position] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;1&#39;</span>) <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>0</span>
            <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> data
        )
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#66d9ef>if</span> (one_count <span style=color:#f92672>&gt;=</span> len(data) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;0&#39;</span>

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>least_common</span>(data, position):
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#66d9ef>if</span> most_common(data, position) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#66d9ef>else</span> <span style=color:#e6db74>&#39;0&#39;</span>

    <span style=color:#75715e># Helper to filter an iterable so that lines with line[position] = value are kept</span>
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>filter_position_equals</span>(data, position, value):
        <span style=color:#66d9ef>return</span> list(filter(<span style=color:#66d9ef>lambda</span> line: line[position] <span style=color:#f92672>==</span> value, data))

    <span style=color:#75715e># Iterate through the bits</span>
    <span style=color:#66d9ef>for</span> position <span style=color:#f92672>in</span> range(len(lines[<span style=color:#ae81ff>0</span>])):
        <span style=color:#66d9ef>if</span> len(potential_generators) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>:
            potential_generators <span style=color:#f92672>=</span> filter_position_equals(
                potential_generators,
                position,
                most_common(potential_generators, position)
            )

        <span style=color:#66d9ef>if</span> len(potential_scrubbers) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>:
            potential_scrubbers <span style=color:#f92672>=</span> filter_position_equals(
                potential_scrubbers,
                position,
                least_common(potential_scrubbers, position)
            )

    generator <span style=color:#f92672>=</span> int(potential_generators[<span style=color:#ae81ff>0</span>], <span style=color:#ae81ff>2</span>)
    scrubber <span style=color:#f92672>=</span> int(potential_scrubbers[<span style=color:#ae81ff>0</span>], <span style=color:#ae81ff>2</span>)

    print(
        <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>potential_generators<span style=color:#e6db74>=}</span><span style=color:#e6db74>=</span><span style=color:#e6db74>{</span>generator<span style=color:#e6db74>}</span><span style=color:#e6db74>, </span><span style=color:#e6db74>{</span>potential_scrubbers<span style=color:#e6db74>=}</span><span style=color:#e6db74>=</span><span style=color:#e6db74>{</span>scrubber<span style=color:#e6db74>}</span><span style=color:#e6db74>, product=</span><span style=color:#e6db74>{</span>generator<span style=color:#f92672>*</span>scrubber<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</code></pre></div><p>They are getting a bit longer, aren&rsquo;t they? Fun though!</p>
<p>There was a gotcha (as mentioned in the comment) on what to do if you have an even number of current values with equal number of 1s and 0s. In that case, it&rsquo;s spelled out in the full problem statement: on a tie, use 1 for most common and 0 for least.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ python3 binary-contraption.py part2 input.txt
potential_generators<span style=color:#f92672>=[</span><span style=color:#e6db74>&#39;110101000111&#39;</span><span style=color:#f92672>]=</span>3399, potential_scrubbers<span style=color:#f92672>=[</span><span style=color:#e6db74>&#39;010011100001&#39;</span><span style=color:#f92672>]=</span>1249, product<span style=color:#f92672>=</span><span style=color:#ae81ff>4245351</span>
</code></pre></div><h4 id=timing>Timing</h4>
<p>Timing wise, we&rsquo;re still in the basically instant camp:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>--- Day 3: Binary Diagnostic ---

$ python3 binary-contraption.py part1 input.txt
gamma<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;100100101010&#39;</span><span style=color:#f92672>=</span>2346, epsilon<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;011011010101&#39;</span><span style=color:#f92672>=</span>1749, product<span style=color:#f92672>=</span><span style=color:#ae81ff>4103154</span>
<span style=color:#75715e># time 34395958ns / 0.03s</span>

$ python3 binary-contraption.py part2 input.txt
potential_generators<span style=color:#f92672>=[</span><span style=color:#e6db74>&#39;110101000111&#39;</span><span style=color:#f92672>]=</span>3399, potential_scrubbers<span style=color:#f92672>=[</span><span style=color:#e6db74>&#39;010011100001&#39;</span><span style=color:#f92672>]=</span>1249, product<span style=color:#f92672>=</span><span style=color:#ae81ff>4245351</span>
<span style=color:#75715e># time 35739667ns / 0.04s</span>
</code></pre></div></div>
</article></div>
</div><footer id=page-footer role=contentinfo>
<nav id=footer-navigation role=navigation class=ribbon>
<ul class=main-navigation>
<li><a href=/archive-by-date/>All posts: By Date</a></li>
<li><a href=/archive-by-tag/>All posts: By Tag</a></li>
<li>
<a href=/atom.xml>
RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
</sup>
</a>
</li><li>
<a href=/programming/atom.xml>
RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
</sup>
</a>
</li></ul>
</nav>
<div id=page-footer-content>
<div class=legal>
<p>
All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US>
<img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png>
</a>
</p>
<p>
Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a>
</p>
</div>
</div>
</footer>
</div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js integrity=sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin=anonymous></script>
<script src=/custom.js></script>
</body>
</html>