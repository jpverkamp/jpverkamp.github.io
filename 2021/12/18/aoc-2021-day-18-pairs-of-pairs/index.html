<!DOCTYPE html>
<html onclick >
<head>
    <title>AoC 2021 Day 18: Pairs of Pairs â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">AoC 2021 Day 18: Pairs of Pairs</h1>

        <div class="entry-meta"><span class="entry-date">2021-12-18</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/17/aoc-2021-day-17-pew-pewinator/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2021/12/19/aoc-2021-day-19-point-matchinator/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/17/aoc-2021-day-17-pew-pewinator/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a><a href="https://blog.jverkamp.com/2021/12/19/aoc-2021-day-19-point-matchinator/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/17/aoc-2021-day-17-pew-pewinator/" class="previous-link"></a><a class="taxonomy-value" href="/series/advent-of-code-2021">Advent of Code 2021</a><a href="https://blog.jverkamp.com/2021/12/19/aoc-2021-day-19-point-matchinator/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2021/12/17/aoc-2021-day-17-pew-pewinator/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2021/12/19/aoc-2021-day-19-point-matchinator/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2021/12/17/aoc-2021-day-17-pew-pewinator/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2021/12/19/star-wars-episode-vi-return-of-the-jedi/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><h3 id="source-snailfishhttpsadventofcodecom2021day18">Source: <a href="https://adventofcode.com/2021/day/18">Snailfish</a></h3>
<h4 id="part-1-given-the-following-definition-of-snailfish-numbers-add-a-series-of-snailfish-numbers-and-return-the-magnitude-of-the-result"><strong>Part 1:</strong> Given the following definition of Snailfish numbers, add a series of Snailfish numbers and return the magnitude of the result.</h4>
<ul>
<li>A <code>Snailfish</code> number is defined as a pair <span class="latex-inline">\langle a, b \rangle</span>
 where <code>a</code> and <code>b</code> can either by integers or nested <code>Snailfish</code> number</li>
<li>To add two <code>Snailfish</code> numbers, <span class="latex-inline">c &#43; d = \langle c, d \rangle</span>
</li>
<li>To reduce a <code>Snailfish</code> number to simplest form:
<ul>
<li>If there are any pairs (of integers <span class="latex-inline">\langle e, f \rangle</span>
) nested 5+ levels deep, <code>explode</code> the leftmost one
<ul>
<li><code>e</code> is added to the <em>rightmost</em> node <em>left</em> of the exploded pair (if possible)</li>
<li><code>f</code> is added to the <em>leftmost</em> node <em>right</em> of the exploded pair (if possible)</li>
<li>Replace the original pair with a <code>0</code> (I missed this for a while&hellip;)</li>
</ul>
</li>
<li>If there are no such pairs and there is at least one integer <code>g</code> greater than or equal to 10, <code>split</code> it into a pair <span class="latex-inline">\langle h, i \rangle</span>
 such that <span class="latex-inline">h = \left \lfloor \frac{g}{2} \right \rfloor, i = \left \lceil \frac{g}{2} \right \rceil</span>
.</li>
</ul>
</li>
<li>The magnitude of <span class="latex-inline">|\langle j, k \rangle| = 3|j|&#43;2|k|</span>
</li>
</ul>
<p>Yeah&hellip; that took a bit to figure out.</p>
<p>To just parse the numbers, do addition, and do <code>split</code>, the most natural data structure is going to be a tree:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@dataclass</span>(frozen<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Snailfish</span>():
    left: Union[int, <span style="color:#e6db74">&#39;Snailfish&#39;</span>]
    right: Union[int, <span style="color:#e6db74">&#39;Snailfish&#39;</span>]

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read</span>(text: TextIO) <span style="color:#f92672">-&gt;</span> Optional[Union[int, <span style="color:#e6db74">&#39;Snailfish&#39;</span>]]:
        <span style="color:#e6db74">&#39;&#39;&#39;Read a snailfish from the given filelike object&#39;&#39;&#39;</span>

        c <span style="color:#f92672">=</span> text<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> c<span style="color:#f92672">.</span>isdigit() <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> c <span style="color:#f92672">in</span> <span style="color:#e6db74">&#39;[&#39;</span>:
            c <span style="color:#f92672">=</span> text<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1</span>)

        <span style="color:#66d9ef">if</span> c <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;[&#39;</span>:
            left <span style="color:#f92672">=</span> Snailfish<span style="color:#f92672">.</span>read(text)
            right <span style="color:#f92672">=</span> Snailfish<span style="color:#f92672">.</span>read(text)

            <span style="color:#66d9ef">assert</span> left <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None
            <span style="color:#66d9ef">assert</span> right <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None

            <span style="color:#66d9ef">return</span> Snailfish(left, right)

        <span style="color:#66d9ef">elif</span> c<span style="color:#f92672">.</span>isdigit():
            the_once_and_future_number <span style="color:#f92672">=</span> []

            <span style="color:#66d9ef">while</span> c<span style="color:#f92672">.</span>isdigit():
                the_once_and_future_number<span style="color:#f92672">.</span>append(c)
                c <span style="color:#f92672">=</span> text<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1</span>)

            <span style="color:#66d9ef">assert</span>(c <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#f92672">or</span> c <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;]&#39;</span>)

            <span style="color:#66d9ef">return</span> int(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(the_once_and_future_number))

        <span style="color:#66d9ef">return</span> None

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reduce</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Snailfish&#39;</span>:
        <span style="color:#e6db74">&#39;&#39;&#39;Convert this snailfish to minimum form using the result for explosing and splitting.&#39;&#39;&#39;</span>

        <span style="color:#75715e"># TODO</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">magnitude</span>(self) <span style="color:#f92672">-&gt;</span> int:
        <span style="color:#e6db74">&#39;&#39;&#39;Calculate the magnitude of a snailfish number.&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(sf: Union[int, <span style="color:#e6db74">&#39;Snailfish&#39;</span>]) <span style="color:#f92672">-&gt;</span> int:
            <span style="color:#66d9ef">if</span> isinstance(sf, int):
                <span style="color:#66d9ef">return</span> sf
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> f(sf<span style="color:#f92672">.</span>left) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> f(sf<span style="color:#f92672">.</span>right)

        <span style="color:#66d9ef">return</span> f(self)

    <span style="color:#66d9ef">def</span> __add__(self, other):
        <span style="color:#e6db74">&#39;&#39;&#39;Add two Snailfish by making a larger pair and then reducing it.&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">return</span> Snailfish(self, other)<span style="color:#f92672">.</span>reduce()

    <span style="color:#66d9ef">def</span> __repr__(self):
        <span style="color:#66d9ef">return</span> f<span style="color:#e6db74">&#39;{{{self.left}, {self.right}}}&#39;</span>
</code></pre></div><p>But&hellip; it&rsquo;s really quite tricky to use a tree and deal with exploding. You can probably recur up the tree and back down to find the <em>rightmost left node</em>&hellip; but why? Instead, we&rsquo;re going to swap back and forth to another similar data structure: a depthlist (is there another name for this?). For each leaf node / integer value in the <code>Snailfish</code> tree, represent that number as a pair <code>(value, depth)</code>. So</p>
<p><span class="latex-inline">\langle \langle 1, \langle 2, \langle 3, 4 \rangle \rangle \rangle, 5 \rangle</span>
 would be <code>[(1, 2), (2, 3), (3, 4), (4, 4), (5, 1)]</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@dataclass</span>(frozen<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Snailfish</span>():
    <span style="color:#f92672">...</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_depthlist</span>(self) <span style="color:#f92672">-&gt;</span> List[Tuple[int, int]]:
        <span style="color:#e6db74">&#39;&#39;&#39;Convert to list of (value, depth).&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">g</span>(sf: Union[int, <span style="color:#e6db74">&#39;Snailfish&#39;</span>], depth: int) <span style="color:#f92672">-&gt;</span> Generator[Tuple[int, int], None, None]:
            <span style="color:#66d9ef">if</span> isinstance(sf, int):
                <span style="color:#66d9ef">yield</span> (sf, depth)
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">yield</span> <span style="color:#f92672">from</span> g(sf<span style="color:#f92672">.</span>left, depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
                <span style="color:#66d9ef">yield</span> <span style="color:#f92672">from</span> g(sf<span style="color:#f92672">.</span>right, depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)

        <span style="color:#66d9ef">return</span> list(g(self, <span style="color:#ae81ff">0</span>))
</code></pre></div><p>Converting back is a bit trickier, but actually similar to parsing (repeatedly combine pairs at the same depth until everything is combined):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@dataclass</span>(frozen<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Snailfish</span>():
    <span style="color:#f92672">...</span>

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">from_depthlist</span>(dls: List[Tuple[int, int]]) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Snailfish&#39;</span>:
        <span style="color:#e6db74">&#39;&#39;&#39;Convert from a list of (value, depth).&#39;&#39;&#39;</span>

        <span style="color:#75715e"># To make typing happy, copy to a list that can have either</span>
        mixedls: List[Tuple[Union[int, <span style="color:#e6db74">&#39;Snailfish&#39;</span>], int]] <span style="color:#f92672">=</span> [
            (value, depth)
            <span style="color:#66d9ef">for</span> (value, depth)
            <span style="color:#f92672">in</span> dls
        ]

        <span style="color:#66d9ef">while</span> len(mixedls) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
            <span style="color:#66d9ef">for</span> index, ((left, left_depth), (right, right_depth)) <span style="color:#f92672">in</span> enumerate(zip(mixedls, mixedls[<span style="color:#ae81ff">1</span>:])):
                <span style="color:#66d9ef">if</span> left_depth <span style="color:#f92672">==</span> right_depth:
                    mixedls[index] <span style="color:#f92672">=</span> (Snailfish(left, right), left_depth <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
                    <span style="color:#66d9ef">del</span> mixedls[index<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]

                    <span style="color:#66d9ef">break</span>

        <span style="color:#66d9ef">assert</span> isinstance(mixedls[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>], Snailfish)
        <span style="color:#66d9ef">return</span> mixedls[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
</code></pre></div><p>Using this data structure, it&rsquo;s much easier to deal with <code>explode</code>:</p>
<ul>
<li>Find the first pair of numbers with the same depth (<code>4</code> in this case) that are deep enough</li>
<li>Move the two values over one each</li>
<li>Add a <code>0</code> at <code>depth-1</code></li>
</ul>
<p>And splitting is just as easy:</p>
<ul>
<li>Find the value to split, replace it with two nodes (ceiling and floor of division by 2)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@dataclass</span>(frozen<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Snailfish</span>():
    <span style="color:#f92672">...</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reduce</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Snailfish&#39;</span>:
        <span style="color:#e6db74">&#39;&#39;&#39;Convert this snailfish to minimum form using the result for explosing and splitting.&#39;&#39;&#39;</span>

        <span style="color:#75715e"># Much easier to work with mutable depthlists...</span>
        dls <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>to_depthlist()

        reducing <span style="color:#f92672">=</span> True
        <span style="color:#66d9ef">while</span> reducing:
            reducing <span style="color:#f92672">=</span> False
            logging<span style="color:#f92672">.</span>debug(f<span style="color:#e6db74">&#39;Reducing: dls={dls}, sf={Snailfish.from_depthlist(dls)}&#39;</span>)

            <span style="color:#75715e"># Check for any pairs that needs exploding</span>
            <span style="color:#66d9ef">for</span> index, (value, depth) <span style="color:#f92672">in</span> enumerate(dls):
                <span style="color:#66d9ef">if</span> depth <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">and</span> index <span style="color:#f92672">&lt;</span> len(dls) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">and</span> depth <span style="color:#f92672">==</span> dls[index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>]:
                    logging<span style="color:#f92672">.</span>debug(f<span style="color:#e6db74">&#39; - Exploding at {index=} with {value=} and {depth=}&#39;</span>)

                    prefix <span style="color:#f92672">=</span> dls[:index]
                    infix <span style="color:#f92672">=</span> [(<span style="color:#ae81ff">0</span>, depth<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)]
                    suffix <span style="color:#f92672">=</span> dls[index<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>:]

                    <span style="color:#75715e"># Increase the previous value by one (if it exists)</span>
                    <span style="color:#66d9ef">if</span> prefix:
                        prefix[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (prefix[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> value, prefix[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>])

                    <span style="color:#75715e"># Increase the next value by one (if it exists)</span>
                    <span style="color:#66d9ef">if</span> suffix:
                        suffix[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (suffix[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> dls[index<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>], suffix[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>])

                    dls <span style="color:#f92672">=</span> prefix <span style="color:#f92672">+</span> infix <span style="color:#f92672">+</span> suffix

                    reducing <span style="color:#f92672">=</span> True
                    <span style="color:#66d9ef">break</span>

            <span style="color:#66d9ef">if</span> reducing:
                <span style="color:#66d9ef">continue</span>

            <span style="color:#75715e"># If not exploding, check for any value that needs splitting</span>
            <span style="color:#66d9ef">for</span> index, (value, depth) <span style="color:#f92672">in</span> enumerate(dls):
                <span style="color:#66d9ef">if</span> value <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">10</span>:
                    logging<span style="color:#f92672">.</span>debug(f<span style="color:#e6db74">&#39; - Splitting at {index=} with {value=}&#39;</span>)

                    dls <span style="color:#f92672">=</span> (
                        dls[:index]
                        <span style="color:#f92672">+</span> [
                            (math<span style="color:#f92672">.</span>floor(value <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>), depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),
                            (math<span style="color:#f92672">.</span>ceil(value <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>), depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),
                        ]
                        <span style="color:#f92672">+</span> dls[index<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:]
                    )

                    reducing <span style="color:#f92672">=</span> True
                    <span style="color:#66d9ef">break</span>

        <span style="color:#66d9ef">return</span> Snailfish<span style="color:#f92672">.</span>from_depthlist(dls)
</code></pre></div><p>It&rsquo;s a bit messy, but it works great.</p>
<p>And now that we have all that&hellip; we can actually do the problem.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):

    sum: Optional[Snailfish] <span style="color:#f92672">=</span> None

    <span style="color:#66d9ef">while</span> sf :<span style="color:#f92672">=</span> Snailfish<span style="color:#f92672">.</span>read(file):
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;Adding: {sf} to {sum}&#39;</span>)
        <span style="color:#66d9ef">assert</span> isinstance(sf, Snailfish)

        <span style="color:#66d9ef">if</span> sum <span style="color:#f92672">is</span> None:
            sum <span style="color:#f92672">=</span> sf
        <span style="color:#66d9ef">else</span>:
            sum <span style="color:#f92672">+=</span> sf

    <span style="color:#66d9ef">assert</span> sum <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None

    logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;Final result: {sum}&#39;</span>)
    <span style="color:#66d9ef">print</span>(sum<span style="color:#f92672">.</span>magnitude())
</code></pre></div><p>Neat:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pairs-of-pairs.py part1 input.txt
<span style="color:#ae81ff">4433</span>
<span style="color:#75715e"># time 443584917ns / 0.44s</span>
</code></pre></div><p>That was a &hellip; very strange/convoluted problem, but it was an interesting example of why data structures (and being able to convert between one another) is worthwhile.</p>
<h4 id="part-2-find-the-pair-of-snailfish-numbers-in-your-input-with-the-largest-magnitude-of-their-sums"><strong>Part 2:</strong> Find the pair of Snailfish numbers in your input with the largest magnitude of their sums.</h4>
<p>I&rsquo;m not sure there&rsquo;s a better way that just brute forcing it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part2</span>(file: typer<span style="color:#f92672">.</span>FileText):

    sfes: List[Snailfish] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">while</span> sf :<span style="color:#f92672">=</span> Snailfish<span style="color:#f92672">.</span>read(file):
        <span style="color:#66d9ef">assert</span> isinstance(sf, Snailfish)
        sfes<span style="color:#f92672">.</span>append(sf)

    <span style="color:#66d9ef">print</span>(max(
        (sf1 <span style="color:#f92672">+</span> sf2)<span style="color:#f92672">.</span>magnitude()
        <span style="color:#66d9ef">for</span> sf1 <span style="color:#f92672">in</span> sfes
        <span style="color:#66d9ef">for</span> sf2 <span style="color:#f92672">in</span> sfes
        <span style="color:#66d9ef">if</span> sf1 <span style="color:#f92672">!=</span> sf2
    ))
</code></pre></div><p>And it works fine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pairs-of-pairs.py part2 input.txt
<span style="color:#ae81ff">4559</span>
<span style="color:#75715e"># time 5653670916ns / 5.65s</span>
</code></pre></div><p>It&rsquo;s a bit slower than I&rsquo;d like&hellip; but I have spent far more than enough time on this problem&hellip;</p></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
