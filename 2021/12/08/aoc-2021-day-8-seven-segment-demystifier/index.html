<!DOCTYPE html>
<html onclick >
<head>
    <title>AoC 2021 Day 8: Seven Segment Demystifier â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">AoC 2021 Day 8: Seven Segment Demystifier</h1>

        <div class="entry-meta"><span class="entry-date">2021-12-08</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a><a href="https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/algorithms">Algorithms</a><a href="https://blog.jverkamp.com/2021/12/12/aoc-2021-day-12-submarine-spider/" class="next-link"></a></li><li><a class="taxonomy-value" href="/programming/topics/seven-segment-displays">Seven Segment Displays</a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/" class="previous-link"></a><a class="taxonomy-value" href="/series/advent-of-code-2021">Advent of Code 2021</a><a href="https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2021/12/08/an-alchemy-of-masques-and-mirrors/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><h3 id="source-seven-segment-searchhttpsadventofcodecom2021day8">Source: <a href="https://adventofcode.com/2021/day/8">Seven Segment Search</a></h3>
<h4 id="part-1-simulate-a-hahahugoshortcode-s0-hbhb-where-you-do-not-know-which-input-wire-controls-which-segment-given-the-wires-used-in-all-ten-digits-and-four-output-digits-count-how-many-times-1-4-7-and-8-are-outputted"><strong>Part 1:</strong> Simulate a <a href="https://en.wikipedia.org/wiki/seven%20segment%20displey">seven segment displey</a> where you do not know which input wire controls which segment. Given the wires used in all ten digits and four output digits, count how many times 1, 4, 7, and 8 are outputted.</h4>
<p>This one took me <em>far</em> longer to work out than I&rsquo;d care to admit. And it wasn&rsquo;t at all because I had the wrong approach (I went for brute force again), but rather because I had <em>mistyped one character</em> in my input. Bah humbug. That&rsquo;s why you write tests&hellip; Oy.</p>
<p>Like I mentioned, I&rsquo;m just going to try to brute force this problem. It will be slower than using their advice (the advice being that there is always 1 input with two segments (one) and 1 with 3 (seven). Instead, brute forcing all ten digits makes for much cleaner code. First, let&rsquo;s set up some constants:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Seven segment display</span>
<span style="color:#75715e">#   0:      1:      2:      3:      4:</span>
<span style="color:#75715e">#  aaaa    ....    aaaa    aaaa    ....</span>
<span style="color:#75715e"># b    c  .    c  .    c  .    c  b    c</span>
<span style="color:#75715e"># b    c  .    c  .    c  .    c  b    c</span>
<span style="color:#75715e">#  ....    ....    dddd    dddd    dddd</span>
<span style="color:#75715e"># e    f  .    f  e    .  .    f  .    f</span>
<span style="color:#75715e"># e    f  .    f  e    .  .    f  .    f</span>
<span style="color:#75715e">#  gggg    ....    gggg    gggg    ....</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#   5:      6:      7:      8:      9:</span>
<span style="color:#75715e">#  aaaa    aaaa    aaaa    aaaa    aaaa</span>
<span style="color:#75715e"># b    .  b    .  .    c  b    c  b    c</span>
<span style="color:#75715e"># b    .  b    .  .    c  b    c  b    c</span>
<span style="color:#75715e">#  dddd    dddd    ....    dddd    dddd</span>
<span style="color:#75715e"># .    f  e    f  .    f  e    f  .    f</span>
<span style="color:#75715e"># .    f  e    f  .    f  e    f  .    f</span>
<span style="color:#75715e">#  gggg    gggg    ....    gggg    gggg</span>

SEGMENTS <span style="color:#f92672">=</span> [
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
]

ALPHABET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;abcdefg&#39;</span>
MAPPINGS <span style="color:#f92672">=</span> [
    dict(zip(ALPHABET, ordering))
    <span style="color:#66d9ef">for</span> ordering <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>permutations(ALPHABET)
]
</code></pre></div><p>The <code>SEGMENTS</code> define a set of correctly labeled wires goes to each segment (in order). So <code>0</code> uses all of them but <code>d</code>, <code>1</code> uses only <code>c</code> and <code>f</code>, etc.</p>
<p><code>MAPPINGS</code> is a neat trick. Using <code><a href="https://docs.python.org/3/search.html?q=itertools.permutations">itertools.permutations</a></code>
, we can generate all possible arrangements of the 7 letters in <code>ALPHABET</code>. We then zip each <code>ordering</code> up with <code>ALPHABET</code>, convert to a <code>dict</code> and we have a conversion. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> MAPPINGS[<span style="color:#ae81ff">286</span>]
{<span style="color:#e6db74">&#39;a&#39;</span>: <span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>: <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>: <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>: <span style="color:#e6db74">&#39;g&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>: <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>: <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>: <span style="color:#e6db74">&#39;e&#39;</span>}
<span style="color:#f92672">&gt;&gt;&gt;</span> MAPPINGS[<span style="color:#ae81ff">286</span>][<span style="color:#e6db74">&#39;a&#39;</span>]
<span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> MAPPINGS[<span style="color:#ae81ff">286</span>][<span style="color:#e6db74">&#39;g&#39;</span>]
<span style="color:#e6db74">&#39;e&#39;</span>
</code></pre></div><p>In this case, input wire <code>a</code> maps to output <code>a</code>, but <code>g</code> maps to <code>e</code>, etc.</p>
<p>Okay. Fun part. For each input, we have all ten digits, with the input wires that makes those up, but we don&rsquo;t know which mapping matches. But we do know if a <code>mapping</code> is valid, it will have to turn each of those ten inputs into one of the possible <code>SEGMENTS</code>. So we can do this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load</span>(file: TextIO) <span style="color:#f92672">-&gt;</span> Generator[List[int], None, None]:
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    Load an input file with a scrambled set of 7 segment displays than 4 output digits.&#39;&#39;&#39;</span>

    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file:
        raw_inputs, raw_outputs <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; | &#39;</span>)
        inputs <span style="color:#f92672">=</span> [set(input) <span style="color:#66d9ef">for</span> input <span style="color:#f92672">in</span> raw_inputs<span style="color:#f92672">.</span>split()]
        outputs <span style="color:#f92672">=</span> [set(output) <span style="color:#66d9ef">for</span> output <span style="color:#f92672">in</span> raw_outputs<span style="color:#f92672">.</span>split()]

        <span style="color:#66d9ef">for</span> mapping <span style="color:#f92672">in</span> MAPPINGS:
            <span style="color:#66d9ef">if</span> any(
                {mapping[v] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> input} <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> SEGMENTS
                <span style="color:#66d9ef">for</span> input <span style="color:#f92672">in</span> inputs
            ):
                <span style="color:#66d9ef">continue</span>

            <span style="color:#66d9ef">yield</span> [
                SEGMENTS<span style="color:#f92672">.</span>index({mapping[v] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> output})
                <span style="color:#66d9ef">for</span> output <span style="color:#f92672">in</span> outputs
            ]
</code></pre></div><p>We&rsquo;ll take the input (which looks like <code>acedgfb cdfbe gcdfa fbcad dab cefabd cdfgeb eafb cagedb ab | cdfeb fcadb cdfeb cdbaf</code>), split the input and output, and then go through each <code>mapping</code>. The line <code>{mapping[v] for v in input}</code> creates the output given the mapping, so we apply that to every <code>input</code> in <code>inputs</code> and check for any <em>not</em> in <code>SEGMENTS</code>. If that&rsquo;s the case, the mapping isn&rsquo;t valid, so skip it. We should have exactly 1 mapping that&rsquo;s valid, so decode the outputs (using that same mapping) and <code>yield</code> the resulting digits.</p>
<p>I expect that&rsquo;s overkill / already implementing part 2&hellip; but that&rsquo;s okay!</p>
<p>Since we have the digits, count up the 1, 4, 7, and 8 (they&rsquo;re the easiest to determine).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):
    <span style="color:#66d9ef">print</span>(sum(
        <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> digit <span style="color:#f92672">in</span> (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>) <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
        <span style="color:#66d9ef">for</span> digits <span style="color:#f92672">in</span> load(file)
        <span style="color:#66d9ef">for</span> digit <span style="color:#f92672">in</span> digits
    ))
</code></pre></div><p>Yeah&hellip; that&rsquo;s it!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 seven-segment-demystifier.py part1 input.txt
<span style="color:#ae81ff">349</span>
</code></pre></div><h4 id="part-2-calculate-the-sum-of-all-of-the-4-digit-output-numbers"><strong>Part 2:</strong> Calculate the sum of all of the 4 digit output numbers.</h4>
<p>Yeah&hellip; in brute forcing the entire problem rather than just solving the &lsquo;easy&rsquo; 4 digits, this is already done:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part2</span>(file: typer<span style="color:#f92672">.</span>FileText):
    <span style="color:#66d9ef">print</span>(sum(
        int(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(str(digit) <span style="color:#66d9ef">for</span> digit <span style="color:#f92672">in</span> digits))
        <span style="color:#66d9ef">for</span> digits <span style="color:#f92672">in</span> load(file)
    ))
</code></pre></div><p>So easy!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 seven-segment-demystifier.py part2 input.txt
<span style="color:#ae81ff">1070957</span>
</code></pre></div><h4 id="testing">Testing</h4>
<p>So. The error I originally had was that I was missing one segment for the <code>zero</code>. That meant that there was never a mapping that worked. In order to debug that, I ended up writing this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">if</span> any(
    any(
        mapping[letter] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> dst
        <span style="color:#66d9ef">for</span> letter <span style="color:#f92672">in</span> src
    )
    <span style="color:#66d9ef">for</span> src, dst <span style="color:#f92672">in</span> [(<span style="color:#e6db74">&#39;ab&#39;</span>, <span style="color:#e6db74">&#39;cf&#39;</span>), (<span style="color:#e6db74">&#39;dab&#39;</span>, <span style="color:#e6db74">&#39;acf&#39;</span>), (<span style="color:#e6db74">&#39;eafb&#39;</span>, <span style="color:#e6db74">&#39;bcdf&#39;</span>)]
):
    <span style="color:#66d9ef">continue</span>

<span style="color:#66d9ef">print</span>(mapping)
failed <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> input <span style="color:#f92672">in</span> inputs:
    mapped_input <span style="color:#f92672">=</span> {mapping[v] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> input}
    <span style="color:#66d9ef">if</span> mapped_input <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> SEGMENTS:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;failed&#39;</span>, input, <span style="color:#e6db74">&#39;-&gt;&#39;</span>, mapped_input)
        failed <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;failed&#39;</span>, failed)
<span style="color:#66d9ef">print</span>()
</code></pre></div><p>That way, I&rsquo;m basically solving the faster mode (see below) for the single example given above (with one being <code>ab -&gt; cv</code>, seven being <code>dab -&gt; acf</code>, and the rest as such). That way when I printed it out&hellip; I found the single number failing. Oy vey. Anyways!</p>
<h4 id="timing">Timing</h4>
<p>So&hellip; this is where it&rsquo;s starting to get a bit slower:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">--- Day 8: Seven Segment Search ---

$ python3 seven-segment-demystifier.py part1 input.txt
<span style="color:#ae81ff">349</span>
<span style="color:#75715e"># time 753413083ns / 0.75s</span>

$ python3 seven-segment-demystifier.py part2 input.txt
<span style="color:#ae81ff">1070957</span>
<span style="color:#75715e"># time 845831292ns / 0.85s</span>
</code></pre></div><p>Still under a second&hellip; so fast enough. But I wonder if that could be optimized a bit by using the tricks they mentioned.</p>
<p>For example, if you have the input:</p>
<p><code>acedgfb cdfbe gcdfa fbcad dab cefabd cdfgeb eafb cagedb ab</code></p>
<ul>
<li>You know that <code>ab</code> is a one (it&rsquo;s the only one with two segments) and maps to <code>cf</code>.</li>
<li>Likewise, you know <code>dab</code> is seven and maps to <code>acf</code>.</li>
<li>Between the two, that means that the top segment has to be the input: <code>d</code>, output: <code>a</code> (it&rsquo;s the only one not in both).</li>
</ul>
<p>So one part of the mapping (<code>d -&gt; a</code>) is set and another two <code>a/b -&gt; c/f</code> has only two remaining options. That reduces the number of possible permutations from <span class="latex-inline">P(7, 7) = 5040</span>
 to <span class="latex-inline">P(2, 2) * P(4, 4) = 48</span>
! That&rsquo;s amazing and probably worth it.</p>
<p>Okay, let&rsquo;s write a more complicated (but faster) load function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load2</span>(file: TextIO) <span style="color:#f92672">-&gt;</span> Generator[List[int], None, None]:
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    Load an input file with a scrambled set of 7 segment displays than 4 output digits.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Use the fact that there&#39;s only 1 possibility for one, 1 (overlapping) for seven to limit the number of permutations from 5040 to 48. 
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>

    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file:
        raw_inputs, raw_outputs <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; | &#39;</span>)
        inputs <span style="color:#f92672">=</span> [set(input) <span style="color:#66d9ef">for</span> input <span style="color:#f92672">in</span> raw_inputs<span style="color:#f92672">.</span>split()]
        outputs <span style="color:#f92672">=</span> [set(output) <span style="color:#66d9ef">for</span> output <span style="color:#f92672">in</span> raw_outputs<span style="color:#f92672">.</span>split()]

        <span style="color:#66d9ef">for</span> input <span style="color:#f92672">in</span> inputs:
            <span style="color:#66d9ef">if</span> len(input) <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
                one <span style="color:#f92672">=</span> input
            <span style="color:#66d9ef">elif</span> len(input) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
                seven <span style="color:#f92672">=</span> input

        <span style="color:#75715e"># The output that is in seven but not one maps to a</span>
        <span style="color:#75715e"># I wish there were a better way to get the only value out of a set</span>
        mapping <span style="color:#f92672">=</span> {
            list(seven<span style="color:#f92672">.</span>difference(one))[<span style="color:#ae81ff">0</span>]: <span style="color:#e6db74">&#39;a&#39;</span>
        }

        <span style="color:#75715e"># The other two values in one have to map to c and f</span>
        <span style="color:#66d9ef">for</span> one_permutation <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>permutations(one):
            mapping<span style="color:#f92672">.</span>update(dict(zip(one_permutation, <span style="color:#e6db74">&#39;cf&#39;</span>)))

            <span style="color:#75715e"># And all the values not in seven permute the last output</span>
            <span style="color:#66d9ef">for</span> rest_permutation <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>permutations(set(<span style="color:#e6db74">&#39;abcdefg&#39;</span>) <span style="color:#f92672">-</span> seven):
                mapping<span style="color:#f92672">.</span>update(dict(zip(rest_permutation, <span style="color:#e6db74">&#39;bedg&#39;</span>)))

                <span style="color:#66d9ef">if</span> any(
                    {mapping[v] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> input} <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> SEGMENTS
                    <span style="color:#66d9ef">for</span> input <span style="color:#f92672">in</span> inputs
                ):
                    <span style="color:#66d9ef">continue</span>

                <span style="color:#66d9ef">yield</span> [
                    SEGMENTS<span style="color:#f92672">.</span>index({mapping[v] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> output})
                    <span style="color:#66d9ef">for</span> output <span style="color:#f92672">in</span> outputs
                ]
</code></pre></div><p>So we&rsquo;re going to still iterate through the mappings, but generate them in three parts. The value that&rsquo;s in seven but not one (the initial <code>mapping</code>), the <code>one_permutation</code> of values only in one and the <code>rest_permutation</code> of the 4 values not in seven.</p>
<p>One bit of weirdness is that I&rsquo;m always using the mutation&rsquo;y <code>dict.update</code> function. That modifies the dictionary, which you think would mess things up&hellip; but turns out it can&rsquo;t. We are always using permutations of the same two/four values, so always overwriting in each iteration. Good times!</p>
<p>In order to hook this up, I used a <a href="https://typer.tiangolo.com/tutorial/commands/callback/">typer callback</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@app.callback</span>()
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">useLoad2</span>(fast: bool <span style="color:#f92672">=</span> False):
    <span style="color:#66d9ef">global</span> load, load2

    <span style="color:#66d9ef">if</span> fast:
        load <span style="color:#f92672">=</span> load2
</code></pre></div><p>That&rsquo;s actually surprisingly simple&hellip; Does it work?</p>
<p>``bash
&mdash; Day 8: Seven Segment Search &mdash;</p>
<p>$ python3 seven-segment-demystifier.py part1 input.txt
349</p>
<h1 id="time-737720459ns--074s">time 737720459ns / 0.74s</h1>
<p>$ python3 seven-segment-demystifier.py part2 input.txt
1070957</p>
<h1 id="time-728406083ns--073s">time 728406083ns / 0.73s</h1>
<p>$ python3 seven-segment-demystifier.py &ndash;fast part1 input.txt
349</p>
<h1 id="time-49562583ns--005s">time 49562583ns / 0.05s</h1>
<p>$ python3 seven-segment-demystifier.py &ndash;fast part2 input.txt
1070957</p>
<h1 id="time-49386709ns--005s">time 49386709ns / 0.05s</h1>
<pre><code>
Heck yes it does. That's an order of magnitude speedup! And I would argue the code is not *that* much worse (although it *is* worse). Cool times. </code></pre></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
