<!doctype html><html><head><title>AoC 2021 Day 8: Seven Segment Demystifier â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.982c2d7bb434b4cf8b19c2cf38ef7e7f7162ddbed610e5bdddbb937001e26574.js integrity="sha256-mCwte7Q0tM+LGcLPOO9+f3Fi3b7WEOW93buTcAHiZXQ=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.e0e68b86dea32185ab89b0b9cc01649107cc6b0be3290c8c7b13c716bc0dabfa.css integrity="sha256-4OaLht6jIYWribC5zAFkkQfMawvjKQyMexPHFrwNq/o="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>AoC 2021 Day 8: Seven Segment Demystifier</h1><div class=entry-meta><span class=entry-date>2021-12-08</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/08/18/solving-snakebird/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/algorithms>Algorithms</a><a href=https://blog.jverkamp.com/2021/12/12/aoc-2021-day-12-submarine-spider/ class=next-link></a></li><li><a class=taxonomy-value href=/programming/topics/seven-segment-displays>Seven Segment Displays</a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2021>Advent of Code 2021</a><a href=https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2021/12/08/an-alchemy-of-masques-and-mirrors/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><h3 id=source-seven-segment-searchhttpsadventofcodecom2021day8>Source: <a href=https://adventofcode.com/2021/day/8 target=_blank rel=noopener>Seven Segment Search</a></h3><h4 id=part-1-simulate-a-wikiseven-segment-displey-where-you-do-not-know-which-input-wire-controls-which-segment-given-the-wires-used-in-all-ten-digits-and-four-output-digits-count-how-many-times-1-4-7-and-8-are-outputted><strong>Part 1:</strong> Simulate a <a href=https://en.wikipedia.org/wiki/seven%20segment%20displey>seven segment displey</a> where you do not know which input wire controls which segment. Given the wires used in all ten digits and four output digits, count how many times 1, 4, 7, and 8 are outputted.</h4><p>This one took me <em>far</em> longer to work out than I&rsquo;d care to admit. And it wasn&rsquo;t at all because I had the wrong approach (I went for brute force again), but rather because I had <em>mistyped one character</em> in my input. Bah humbug. That&rsquo;s why you write tests&mldr; Oy.</p><p>Like I mentioned, I&rsquo;m just going to try to brute force this problem. It will be slower than using their advice (the advice being that there is always 1 input with two segments (one) and 1 with 3 (seven). Instead, brute forcing all ten digits makes for much cleaner code. First, let&rsquo;s set up some constants:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Seven segment display</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   0:      1:      2:      3:      4:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  aaaa    ....    aaaa    aaaa    ....</span>
</span></span><span style=display:flex><span><span style=color:#75715e># b    c  .    c  .    c  .    c  b    c</span>
</span></span><span style=display:flex><span><span style=color:#75715e># b    c  .    c  .    c  .    c  b    c</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  ....    ....    dddd    dddd    dddd</span>
</span></span><span style=display:flex><span><span style=color:#75715e># e    f  .    f  e    .  .    f  .    f</span>
</span></span><span style=display:flex><span><span style=color:#75715e># e    f  .    f  e    .  .    f  .    f</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  gggg    ....    gggg    gggg    ....</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   5:      6:      7:      8:      9:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  aaaa    aaaa    aaaa    aaaa    aaaa</span>
</span></span><span style=display:flex><span><span style=color:#75715e># b    .  b    .  .    c  b    c  b    c</span>
</span></span><span style=display:flex><span><span style=color:#75715e># b    .  b    .  .    c  b    c  b    c</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  dddd    dddd    ....    dddd    dddd</span>
</span></span><span style=display:flex><span><span style=color:#75715e># .    f  e    f  .    f  e    f  .    f</span>
</span></span><span style=display:flex><span><span style=color:#75715e># .    f  e    f  .    f  e    f  .    f</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  gggg    gggg    ....    gggg    gggg</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SEGMENTS <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;e&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;e&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;e&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;e&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>},
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ALPHABET <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;abcdefg&#39;</span>
</span></span><span style=display:flex><span>MAPPINGS <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    dict(zip(ALPHABET, ordering))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> ordering <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>permutations(ALPHABET)
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>The <code>SEGMENTS</code> define a set of correctly labeled wires goes to each segment (in order). So <code>0</code> uses all of them but <code>d</code>, <code>1</code> uses only <code>c</code> and <code>f</code>, etc.</p><p><code>MAPPINGS</code> is a neat trick. Using <code><a href="https://docs.python.org/3/search.html?q=itertools.permutations">itertools.permutations</a></code>
, we can generate all possible arrangements of the 7 letters in <code>ALPHABET</code>. We then zip each <code>ordering</code> up with <code>ALPHABET</code>, convert to a <code>dict</code> and we have a conversion. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> MAPPINGS[<span style=color:#ae81ff>286</span>]
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;a&#39;</span>: <span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>: <span style=color:#e6db74>&#39;d&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>: <span style=color:#e6db74>&#39;c&#39;</span>, <span style=color:#e6db74>&#39;d&#39;</span>: <span style=color:#e6db74>&#39;g&#39;</span>, <span style=color:#e6db74>&#39;e&#39;</span>: <span style=color:#e6db74>&#39;f&#39;</span>, <span style=color:#e6db74>&#39;f&#39;</span>: <span style=color:#e6db74>&#39;b&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>: <span style=color:#e6db74>&#39;e&#39;</span>}
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> MAPPINGS[<span style=color:#ae81ff>286</span>][<span style=color:#e6db74>&#39;a&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;a&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> MAPPINGS[<span style=color:#ae81ff>286</span>][<span style=color:#e6db74>&#39;g&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;e&#39;</span>
</span></span></code></pre></div><p>In this case, input wire <code>a</code> maps to output <code>a</code>, but <code>g</code> maps to <code>e</code>, etc.</p><p>Okay. Fun part. For each input, we have all ten digits, with the input wires that makes those up, but we don&rsquo;t know which mapping matches. But we do know if a <code>mapping</code> is valid, it will have to turn each of those ten inputs into one of the possible <code>SEGMENTS</code>. So we can do this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load</span>(file: TextIO) <span style=color:#f92672>-&gt;</span> Generator[List[int], <span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>]:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Load an input file with a scrambled set of 7 segment displays than 4 output digits.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> file:
</span></span><span style=display:flex><span>        raw_inputs, raw_outputs <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39; | &#39;</span>)
</span></span><span style=display:flex><span>        inputs <span style=color:#f92672>=</span> [set(input) <span style=color:#66d9ef>for</span> input <span style=color:#f92672>in</span> raw_inputs<span style=color:#f92672>.</span>split()]
</span></span><span style=display:flex><span>        outputs <span style=color:#f92672>=</span> [set(output) <span style=color:#66d9ef>for</span> output <span style=color:#f92672>in</span> raw_outputs<span style=color:#f92672>.</span>split()]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> mapping <span style=color:#f92672>in</span> MAPPINGS:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> any(
</span></span><span style=display:flex><span>                {mapping[v] <span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> input} <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> SEGMENTS
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> input <span style=color:#f92672>in</span> inputs
</span></span><span style=display:flex><span>            ):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>yield</span> [
</span></span><span style=display:flex><span>                SEGMENTS<span style=color:#f92672>.</span>index({mapping[v] <span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> output})
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> output <span style=color:#f92672>in</span> outputs
</span></span><span style=display:flex><span>            ]
</span></span></code></pre></div><p>We&rsquo;ll take the input (which looks like <code>acedgfb cdfbe gcdfa fbcad dab cefabd cdfgeb eafb cagedb ab | cdfeb fcadb cdfeb cdbaf</code>), split the input and output, and then go through each <code>mapping</code>. The line <code>{mapping[v] for v in input}</code> creates the output given the mapping, so we apply that to every <code>input</code> in <code>inputs</code> and check for any <em>not</em> in <code>SEGMENTS</code>. If that&rsquo;s the case, the mapping isn&rsquo;t valid, so skip it. We should have exactly 1 mapping that&rsquo;s valid, so decode the outputs (using that same mapping) and <code>yield</code> the resulting digits.</p><p>I expect that&rsquo;s overkill / already implementing part 2&mldr; but that&rsquo;s okay!</p><p>Since we have the digits, count up the 1, 4, 7, and 8 (they&rsquo;re the easiest to determine).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>part1</span>(file: typer<span style=color:#f92672>.</span>FileText):
</span></span><span style=display:flex><span>    print(sum(
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>if</span> digit <span style=color:#f92672>in</span> (<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>8</span>) <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> digits <span style=color:#f92672>in</span> load(file)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> digit <span style=color:#f92672>in</span> digits
</span></span><span style=display:flex><span>    ))
</span></span></code></pre></div><p>Yeah&mldr; that&rsquo;s it!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python3 seven-segment-demystifier.py part1 input.txt
</span></span><span style=display:flex><span><span style=color:#ae81ff>349</span>
</span></span></code></pre></div><h4 id=part-2-calculate-the-sum-of-all-of-the-4-digit-output-numbers><strong>Part 2:</strong> Calculate the sum of all of the 4 digit output numbers.</h4><p>Yeah&mldr; in brute forcing the entire problem rather than just solving the &rsquo;easy&rsquo; 4 digits, this is already done:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>part2</span>(file: typer<span style=color:#f92672>.</span>FileText):
</span></span><span style=display:flex><span>    print(sum(
</span></span><span style=display:flex><span>        int(<span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(str(digit) <span style=color:#66d9ef>for</span> digit <span style=color:#f92672>in</span> digits))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> digits <span style=color:#f92672>in</span> load(file)
</span></span><span style=display:flex><span>    ))
</span></span></code></pre></div><p>So easy!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python3 seven-segment-demystifier.py part2 input.txt
</span></span><span style=display:flex><span><span style=color:#ae81ff>1070957</span>
</span></span></code></pre></div><h4 id=testing>Testing</h4><p>So. The error I originally had was that I was missing one segment for the <code>zero</code>. That meant that there was never a mapping that worked. In order to debug that, I ended up writing this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> any(
</span></span><span style=display:flex><span>    any(
</span></span><span style=display:flex><span>        mapping[letter] <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> dst
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> letter <span style=color:#f92672>in</span> src
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> src, dst <span style=color:#f92672>in</span> [(<span style=color:#e6db74>&#39;ab&#39;</span>, <span style=color:#e6db74>&#39;cf&#39;</span>), (<span style=color:#e6db74>&#39;dab&#39;</span>, <span style=color:#e6db74>&#39;acf&#39;</span>), (<span style=color:#e6db74>&#39;eafb&#39;</span>, <span style=color:#e6db74>&#39;bcdf&#39;</span>)]
</span></span><span style=display:flex><span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(mapping)
</span></span><span style=display:flex><span>failed <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> input <span style=color:#f92672>in</span> inputs:
</span></span><span style=display:flex><span>    mapped_input <span style=color:#f92672>=</span> {mapping[v] <span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> input}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> mapped_input <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> SEGMENTS:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#39;failed&#39;</span>, input, <span style=color:#e6db74>&#39;-&gt;&#39;</span>, mapped_input)
</span></span><span style=display:flex><span>        failed <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;failed&#39;</span>, failed)
</span></span><span style=display:flex><span>print()
</span></span></code></pre></div><p>That way, I&rsquo;m basically solving the faster mode (see below) for the single example given above (with one being <code>ab -> cv</code>, seven being <code>dab -> acf</code>, and the rest as such). That way when I printed it out&mldr; I found the single number failing. Oy vey. Anyways!</p><h4 id=timing>Timing</h4><p>So&mldr; this is where it&rsquo;s starting to get a bit slower:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--- Day 8: Seven Segment Search ---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ python3 seven-segment-demystifier.py part1 input.txt
</span></span><span style=display:flex><span><span style=color:#ae81ff>349</span>
</span></span><span style=display:flex><span><span style=color:#75715e># time 753413083ns / 0.75s</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ python3 seven-segment-demystifier.py part2 input.txt
</span></span><span style=display:flex><span><span style=color:#ae81ff>1070957</span>
</span></span><span style=display:flex><span><span style=color:#75715e># time 845831292ns / 0.85s</span>
</span></span></code></pre></div><p>Still under a second&mldr; so fast enough. But I wonder if that could be optimized a bit by using the tricks they mentioned.</p><p>For example, if you have the input:</p><p><code>acedgfb cdfbe gcdfa fbcad dab cefabd cdfgeb eafb cagedb ab</code></p><ul><li>You know that <code>ab</code> is a one (it&rsquo;s the only one with two segments) and maps to <code>cf</code>.</li><li>Likewise, you know <code>dab</code> is seven and maps to <code>acf</code>.</li><li>Between the two, that means that the top segment has to be the input: <code>d</code>, output: <code>a</code> (it&rsquo;s the only one not in both).</li></ul><p>So one part of the mapping (<code>d -> a</code>) is set and another two <code>a/b -> c/f</code> has only two remaining options. That reduces the number of possible permutations from <span class=latex-inline>P(7, 7) = 5040</span>
to <span class=latex-inline>P(2, 2) * P(4, 4) = 48</span>
! That&rsquo;s amazing and probably worth it.</p><p>Okay, let&rsquo;s write a more complicated (but faster) load function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load2</span>(file: TextIO) <span style=color:#f92672>-&gt;</span> Generator[List[int], <span style=color:#66d9ef>None</span>, <span style=color:#66d9ef>None</span>]:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Load an input file with a scrambled set of 7 segment displays than 4 output digits.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Use the fact that there&#39;s only 1 possibility for one, 1 (overlapping) for seven to limit the number of permutations from 5040 to 48. 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> file:
</span></span><span style=display:flex><span>        raw_inputs, raw_outputs <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39; | &#39;</span>)
</span></span><span style=display:flex><span>        inputs <span style=color:#f92672>=</span> [set(input) <span style=color:#66d9ef>for</span> input <span style=color:#f92672>in</span> raw_inputs<span style=color:#f92672>.</span>split()]
</span></span><span style=display:flex><span>        outputs <span style=color:#f92672>=</span> [set(output) <span style=color:#66d9ef>for</span> output <span style=color:#f92672>in</span> raw_outputs<span style=color:#f92672>.</span>split()]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> input <span style=color:#f92672>in</span> inputs:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> len(input) <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>                one <span style=color:#f92672>=</span> input
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> len(input) <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>                seven <span style=color:#f92672>=</span> input
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># The output that is in seven but not one maps to a</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># I wish there were a better way to get the only value out of a set</span>
</span></span><span style=display:flex><span>        mapping <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            list(seven<span style=color:#f92672>.</span>difference(one))[<span style=color:#ae81ff>0</span>]: <span style=color:#e6db74>&#39;a&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># The other two values in one have to map to c and f</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> one_permutation <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>permutations(one):
</span></span><span style=display:flex><span>            mapping<span style=color:#f92672>.</span>update(dict(zip(one_permutation, <span style=color:#e6db74>&#39;cf&#39;</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># And all the values not in seven permute the last output</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> rest_permutation <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>permutations(set(<span style=color:#e6db74>&#39;abcdefg&#39;</span>) <span style=color:#f92672>-</span> seven):
</span></span><span style=display:flex><span>                mapping<span style=color:#f92672>.</span>update(dict(zip(rest_permutation, <span style=color:#e6db74>&#39;bedg&#39;</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> any(
</span></span><span style=display:flex><span>                    {mapping[v] <span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> input} <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> SEGMENTS
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> input <span style=color:#f92672>in</span> inputs
</span></span><span style=display:flex><span>                ):
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>yield</span> [
</span></span><span style=display:flex><span>                    SEGMENTS<span style=color:#f92672>.</span>index({mapping[v] <span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> output})
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> output <span style=color:#f92672>in</span> outputs
</span></span><span style=display:flex><span>                ]
</span></span></code></pre></div><p>So we&rsquo;re going to still iterate through the mappings, but generate them in three parts. The value that&rsquo;s in seven but not one (the initial <code>mapping</code>), the <code>one_permutation</code> of values only in one and the <code>rest_permutation</code> of the 4 values not in seven.</p><p>One bit of weirdness is that I&rsquo;m always using the mutation&rsquo;y <code>dict.update</code> function. That modifies the dictionary, which you think would mess things up&mldr; but turns out it can&rsquo;t. We are always using permutations of the same two/four values, so always overwriting in each iteration. Good times!</p><p>In order to hook this up, I used a <a href=https://typer.tiangolo.com/tutorial/commands/callback/ target=_blank rel=noopener>typer callback</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@app.callback</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>useLoad2</span>(fast: bool <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>global</span> load, load2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> fast:
</span></span><span style=display:flex><span>        load <span style=color:#f92672>=</span> load2
</span></span></code></pre></div><p>That&rsquo;s actually surprisingly simple&mldr; Does it work?</p><p>``bash
&mdash; Day 8: Seven Segment Search &mdash;</p><p>$ python3 seven-segment-demystifier.py part1 input.txt
349</p><h1 id=time-737720459ns--074s>time 737720459ns / 0.74s</h1><p>$ python3 seven-segment-demystifier.py part2 input.txt
1070957</p><h1 id=time-728406083ns--073s>time 728406083ns / 0.73s</h1><p>$ python3 seven-segment-demystifier.py &ndash;fast part1 input.txt
349</p><h1 id=time-49562583ns--005s>time 49562583ns / 0.05s</h1><p>$ python3 seven-segment-demystifier.py &ndash;fast part2 input.txt
1070957</p><h1 id=time-49386709ns--005s>time 49386709ns / 0.05s</h1><pre tabindex=0><code>
Heck yes it does. That&#39;s an order of magnitude speedup! And I would argue the code is not *that* much worse (although it *is* worse). Cool times. 
</code></pre></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>