<!DOCTYPE html>
<html onclick >
<head>
    <title>AoC 2021 Day 14: Polymerizationinator â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">AoC 2021 Day 14: Polymerizationinator</h1>

        <div class="entry-meta"><span class="entry-date">2021-12-14</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/13/aoc-2021-day-13-foldinator/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2021/12/15/aoc-2021-day-15-low-ceiling-simulator/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/13/aoc-2021-day-13-foldinator/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a><a href="https://blog.jverkamp.com/2021/12/15/aoc-2021-day-15-low-ceiling-simulator/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2021/12/13/aoc-2021-day-13-foldinator/" class="previous-link"></a><a class="taxonomy-value" href="/series/advent-of-code-2021">Advent of Code 2021</a><a href="https://blog.jverkamp.com/2021/12/15/aoc-2021-day-15-low-ceiling-simulator/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2021/12/13/aoc-2021-day-13-foldinator/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2021/12/15/aoc-2021-day-15-low-ceiling-simulator/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2021/12/13/aoc-2021-day-13-foldinator/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2021/12/14/worldbinder/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><h3 id="source-extended-polymerizationhttpsadventofcodecom2021day14">Source: <a href="https://adventofcode.com/2021/day/14">Extended Polymerization</a></h3>
<h4 id="part-1-given-a-complete-function-fa-b---c-where-any-string-ab-becomes-acb-and-an-input-string-apply-the-function-at-the-same-time-to-every-overlapping-pair-of-letters-repeat-this-time-times-report-the-difference-in-counts-between-the-most-and-least-common-letters-in-the-final-situation"><strong>Part 1:</strong> Given a complete function <code>f(a, b) -&gt; c</code> where any string <code>ab</code> becomes <code>acb</code> and an input string, apply the function at the same time to every (overlapping) pair of letters. Repeat this time times. Report the difference in counts between the most and least common letters in the final situation.</h4>
<p>Okay. First try, let&rsquo;s just solve this directly. Although, since we know that we&rsquo;re going to be inserting into the middle of the list constantly, we can be slightly more efficient by using a <a href="https://en.wikipedia.org/wiki/linked%20list">linked list</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
PolyMap <span style="color:#f92672">=</span> Mapping[Tuple[str, str], str]


<span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Node</span>(Iterable):
    value: str
    next: Optional[<span style="color:#e6db74">&#39;Node&#39;</span>]

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expand_via</span>(self, map: PolyMap) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Node&#39;</span>:
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>next <span style="color:#f92672">is</span> None:
            <span style="color:#66d9ef">return</span> self

        <span style="color:#66d9ef">for</span> a, b <span style="color:#f92672">in</span> zip(self, self<span style="color:#f92672">.</span>next):
            <span style="color:#66d9ef">if</span> (a<span style="color:#f92672">.</span>value, b<span style="color:#f92672">.</span>value) <span style="color:#f92672">in</span> map:
                a<span style="color:#f92672">.</span>next <span style="color:#f92672">=</span> Node(map[a<span style="color:#f92672">.</span>value, b<span style="color:#f92672">.</span>value], b)

        <span style="color:#66d9ef">return</span> self

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">from_iter</span>(iter: Iterable) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Node&#39;</span>:
        head <span style="color:#f92672">=</span> None
        previous <span style="color:#f92672">=</span> None

        <span style="color:#66d9ef">for</span> el <span style="color:#f92672">in</span> iter:
            n <span style="color:#f92672">=</span> Node(el, None)

            <span style="color:#66d9ef">if</span> previous:
                previous<span style="color:#f92672">.</span>next <span style="color:#f92672">=</span> n
            <span style="color:#66d9ef">else</span>:
                head <span style="color:#f92672">=</span> n

            previous <span style="color:#f92672">=</span> n

        <span style="color:#66d9ef">return</span> head

    <span style="color:#66d9ef">def</span> __iter__(self):
        self<span style="color:#f92672">.</span>iter_node <span style="color:#f92672">=</span> self
        <span style="color:#66d9ef">return</span> self

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__next__</span>(self):
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>iter_node:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">StopIteration</span>

        result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>iter_node
        self<span style="color:#f92672">.</span>iter_node <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>iter_node<span style="color:#f92672">.</span>next
        <span style="color:#66d9ef">return</span> result

    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(self)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load</span>(file: TextIO) <span style="color:#f92672">-&gt;</span> Tuple[Node, PolyMap]:

    ls <span style="color:#f92672">=</span> Node<span style="color:#f92672">.</span>from_iter(file<span style="color:#f92672">.</span>readline()<span style="color:#f92672">.</span>strip())
    file<span style="color:#f92672">.</span>readline()

    map <span style="color:#f92672">=</span> {
        (line[<span style="color:#ae81ff">0</span>], line[<span style="color:#ae81ff">1</span>]): line[<span style="color:#ae81ff">6</span>]
        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file
    }

    <span style="color:#66d9ef">return</span> ls, map

</code></pre></div><p>Okay, there are basically three interesting parts here.</p>
<ul>
<li>
<p>First, the <code>from_iter</code> function. That will take any <code>iterable</code> and make a linked list out of it, returning the head of that list. It does this by creating each Node in turn and attaching it to the previously created node.</p>
</li>
<li>
<p>Next, the <code>__iter__</code> and <code>__next__</code> functions. Together, these make <code>Node</code> iterable, so that we can do things like <code>for n in ls: ...</code> where <code>ls</code> is the head of a linked list.</p>
</li>
<li>
<p>Finally, <code>expand_via</code>. That will take in a mapping of pairs to a single character and expand the current linked list with it. Specifically, for any characters <code>a</code> and <code>b</code> in the linked list, insert a new node between them with value <code>map[a, b]</code>. Pretty cool right?</p>
</li>
<li>
<p>While we&rsquo;re at it, add a function to <code>load</code> the puzzle definitions from a file: the initial linked list (a string is iterable) and the series of mappings. They&rsquo;re always single characters in a set format, so we can hardcode where they are in the string. Perfect? No. Workable for now, sure.</p>
</li>
</ul>
<p>With all that, we can write a direct solution to the puzzle:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#a6e22e">@app.command</span>()
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">direct</span>(file: typer<span style="color:#f92672">.</span>FileText, steps: int):
    ls, map <span style="color:#f92672">=</span> load(file)

    <span style="color:#f92672">import</span> time
    start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()

    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(steps):
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;Generation {i} calculate after {time.time() - start:02f} sec, has {len(list(ls))} elements&#39;</span>)
        ls<span style="color:#f92672">.</span>expand_via(map)

    counts <span style="color:#f92672">=</span> Counter(n<span style="color:#f92672">.</span>value <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> ls)
    logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{counts=}&#39;</span>)

    most, _ <span style="color:#f92672">=</span> max((qty, c) <span style="color:#66d9ef">for</span> (c, qty) <span style="color:#f92672">in</span> counts<span style="color:#f92672">.</span>items())
    least, _ <span style="color:#f92672">=</span> min((qty, c) <span style="color:#66d9ef">for</span> (c, qty) <span style="color:#f92672">in</span> counts<span style="color:#f92672">.</span>items())

    <span style="color:#66d9ef">print</span>(most <span style="color:#f92672">-</span> least)
</code></pre></div><p>(There&rsquo;s a reason I named this <code>direct</code> rather than <code>part1</code>)</p>
<p>It actually works great:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">10</span>
<span style="color:#ae81ff">2797</span>
</code></pre></div><p>So that&rsquo;s all she wrote, right?</p>
<p>Well&hellip;</p>
<h4 id="part-2-do-the-same-for-40-iterations-instead-of-10"><strong>Part 2:</strong> Do the same for 40 iterations (instead of 10).</h4>
<p>Okay. We have a problem.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">10</span>
<span style="color:#ae81ff">2797</span>
<span style="color:#75715e"># time 76895250ns / 0.08s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">11</span>
<span style="color:#ae81ff">5437</span>
<span style="color:#75715e"># time 77964125ns / 0.08s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">12</span>
<span style="color:#ae81ff">10672</span>
<span style="color:#75715e"># time 123601208ns / 0.12s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">13</span>
<span style="color:#ae81ff">21340</span>
<span style="color:#75715e"># time 212642208ns / 0.21s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">14</span>
<span style="color:#ae81ff">42836</span>
<span style="color:#75715e"># time 409988583ns / 0.41s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">15</span>
<span style="color:#ae81ff">85972</span>
<span style="color:#75715e"># time 795902958ns / 0.80s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">16</span>
<span style="color:#ae81ff">172844</span>
<span style="color:#75715e"># time 1567806500ns / 1.57s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">17</span>
<span style="color:#ae81ff">347059</span>
<span style="color:#75715e"># time 3146193833ns / 3.15s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">18</span>
<span style="color:#ae81ff">696285</span>
<span style="color:#75715e"># time 6848070667ns / 6.85s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">19</span>
<span style="color:#ae81ff">1395343</span>
<span style="color:#75715e"># time 12827071459ns / 12.83s</span>

$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">20</span>
<span style="color:#ae81ff">2793845</span>
<span style="color:#75715e"># time 35055311792ns / 35.06s</span>
</code></pre></div><p>It&rsquo;s quick enough at small problems, but as they mentioned in the problem, it grows exponentially. Each iteration we add roughly doubles the time. And we&rsquo;re already up to 35 seconds after just 20. To double that another 20 times&hellip; we&rsquo;re talking a runtime of roughly a year. I&rsquo;m&hellip; not going to wait that long. Instead, let&rsquo;s try something totally different. Rather than actually calculate the strings, we&rsquo;re going to recursively calculate how <em>many</em> of each value there are for any given pair of letters and how far we still need to split them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">recursive</span>(file: typer<span style="color:#f92672">.</span>FileText, steps: int):
    ls, map <span style="color:#f92672">=</span> load(file)

    <span style="color:#75715e"># Recursively count all elements that will be returned from the character pair a,b at depth</span>
    <span style="color:#75715e"># This will use the mapping specified in map above</span>
    <span style="color:#75715e"># This will recur depth += 1 each time until depth = steps (so will always terminate)</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">count</span>(a, b, depth):
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * depth} &gt; count({a}, {b}, {depth})&#39;</span>)

        <span style="color:#66d9ef">if</span> depth <span style="color:#f92672">==</span> steps:
            result <span style="color:#f92672">=</span> {a: <span style="color:#ae81ff">1</span>}
        <span style="color:#66d9ef">else</span>:
            result <span style="color:#f92672">=</span> {}

            <span style="color:#66d9ef">for</span> left, right <span style="color:#f92672">in</span> [(a, map[a, b]), (map[a, b], b)]:
                <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> count(left, right, depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>items():
                    result[k] <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>get(k, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span> v

        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * depth} &lt; count({a}, {b}, {depth}) = {result}&#39;</span>)
        <span style="color:#66d9ef">return</span> result

    <span style="color:#75715e"># Recursively figure out the counts for each pair of elements</span>
    <span style="color:#75715e"># The rightmost element is never counted, so add it at the end</span>
    counts: MutableMapping[str, int] <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">if</span> ls<span style="color:#f92672">.</span>next <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        <span style="color:#66d9ef">for</span> a, b <span style="color:#f92672">in</span> zip(ls, ls<span style="color:#f92672">.</span>next):
            <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> count(a<span style="color:#f92672">.</span>value, b<span style="color:#f92672">.</span>value, <span style="color:#ae81ff">0</span>)<span style="color:#f92672">.</span>items():
                counts[k] <span style="color:#f92672">=</span> counts<span style="color:#f92672">.</span>get(k, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span> v
        counts[b<span style="color:#f92672">.</span>value] <span style="color:#f92672">=</span> counts<span style="color:#f92672">.</span>get(b<span style="color:#f92672">.</span>value, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>

    logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{counts=}&#39;</span>)

    most, _ <span style="color:#f92672">=</span> max((qty, c) <span style="color:#66d9ef">for</span> (c, qty) <span style="color:#f92672">in</span> counts<span style="color:#f92672">.</span>items())
    least, _ <span style="color:#f92672">=</span> min((qty, c) <span style="color:#66d9ef">for</span> (c, qty) <span style="color:#f92672">in</span> counts<span style="color:#f92672">.</span>items())

    <span style="color:#66d9ef">print</span>(most <span style="color:#f92672">-</span> least)
</code></pre></div><p>The entire strength of this function is the <code>count</code> helper function. Like I said (both above and in the comment), this will take a pair of letters (the <code>a</code> and <code>b</code>) and a current depth and it will guarantee that it will return the total count of each letter in the final output between that <code>a</code> and <code>b</code> (including the <code>a</code>, but not the <code>b</code>, I&rsquo;ll come back to that).</p>
<p>With that guarantee, that means that we can use the function recursively. We know that if we have <code>count(a, b, 1)</code> and the mapping <code>map[a, b] = c</code>, that means that we can guarantee:</p>
<div class="latex-block">
count(a, b, n) = count(a, map(a, b), n+1) + count(map(a, b), b, n+1)
</div>

<p>Since <code>n</code> is always increasing and we have a base case of <code>n</code> = the final depth, our recursion is guaranteed to terminate.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">15</span>
<span style="color:#ae81ff">85972</span>
<span style="color:#75715e"># time 800473667ns / 0.80s</span>

$ python3 polymerizationinator.py recursive input.txt <span style="color:#ae81ff">15</span>
<span style="color:#ae81ff">85972</span>
<span style="color:#75715e"># time 2147194583ns / 2.15s</span>
</code></pre></div><p>Yay! It gives me the same answer. But&hellip; it&rsquo;s slower. Turns out, the linked list solution is actually pretty fast and we&rsquo;re paying a <em>lot</em> for each recursive function call (relatively speaking).</p>
<p><em>BUT</em> (and you knew there would be a but, otherwise, why would I be writing this in the first place?), we can do better:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> cache


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">recursive</span>(file: typer<span style="color:#f92672">.</span>FileText, steps: int):
    ls, map <span style="color:#f92672">=</span> load(file)

    <span style="color:#75715e"># Recursively count all elements that will be returned from the character pair a,b at depth</span>
    <span style="color:#75715e"># This will use the mapping specified in map above</span>
    <span style="color:#75715e"># This will recur depth += 1 each time until depth = steps (so will always terminate)</span>
    <span style="color:#75715e"># The @cache will make sure that we only recalculate a given a/b/depth triple once</span>
    <span style="color:#a6e22e">@cache</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">count</span>(a, b, depth):
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * depth} &gt; count({a}, {b}, {depth})&#39;</span>)

        <span style="color:#f92672">...</span>

    <span style="color:#f92672">...</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> python3 polymerizationinator<span style="color:#f92672">.</span>py recursive input<span style="color:#f92672">.</span>txt <span style="color:#ae81ff">15</span>
<span style="color:#ae81ff">85972</span>
<span style="color:#75715e"># time 2147194583ns / 2.15s</span>

<span style="color:#960050;background-color:#1e0010">$</span> python3 polymerizationinator<span style="color:#f92672">.</span>py <span style="color:#f92672">--</span>cache recursive input<span style="color:#f92672">.</span>txt <span style="color:#ae81ff">15</span>
<span style="color:#ae81ff">85972</span>
<span style="color:#75715e"># time 43858541ns / 0.04s</span>
</code></pre></div><p>Now <em>that</em> is what I&rsquo;m talking about.</p>
<p>So what in the world just happened? Well, when we&rsquo;re recursively building up all of these counts, we&rsquo;re going to run into <code>count(a, b, n)</code> more than once in the same layer. Especially as the sequence gets longer and longer, there are going to be <em>many</em> duplicates. And what&rsquo;s more, once you hit one of those cases, <em>all</em> of the recursive calls from that point on will be the same. What <code>cache</code> does is tell the computer to calculate a given answer (for input <code>a, b, depth</code>) <em>once</em> and store (<a href="https://en.wikipedia.org/wiki/memoize">memoize</a>) the answer. So we only have to do each branch once. This cuts out a <em>huge</em> amount of work.</p>
<p>And&hellip; it lets us run the full 40 <em>really</em> quickly:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 polymerizationinator.py --cache recursive input.txt <span style="color:#ae81ff">40</span>
<span style="color:#ae81ff">2926813379532</span>
<span style="color:#75715e"># time 50570625ns / 0.05s</span>
</code></pre></div><p>A bit less than a year, no?</p>
<p>I love problems like this. Most of the time, optimization doesn&rsquo;t really matter. For example, if you know you&rsquo;re never going to run this simulation more than 10-15 generations. But every once in a while, you bump into a truly exponential function and have to run it long enough for it to explode. Then things get interesting. And that&rsquo;s when knowing about things like recursion and memoization come in very handy.</p>
<p>Cool, right?</p>
<p>Or right. Coming back to <em>that</em> thing. Why do we only add <code>b</code> at the end outside of the recursion? Because we&rsquo;re always overlapping. So when you go from <code>ababab</code> (where <code>ab -&gt; c</code> and <code>ba -&gt; d</code>), you&rsquo;re going to have recursive calls generating <code>acb</code>, <code>bda</code>, <code>acb</code>, <code>bda</code>, <code>acb</code>. Each time, the last character of one is the first of the next, so we can&rsquo;t count that or we&rsquo;ll end up overcounting. <em>But</em> that means we never do count the last <code>b</code> of the last <code>acb</code> (the only one that doesn&rsquo;t overlap).</p>
<p>As they say, there are two hard things in computer science: caching, naming things, and off by one errors.</p>
<p>Pretty sure I managed to hit all of them in this post!</p></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
