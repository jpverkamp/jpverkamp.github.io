<!doctype html><html><head><title>Prevent JavaScript links by parsing URLs – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Prevent JavaScript links by parsing URLs</h1><div class=entry-meta><span class=entry-date>2019-05-02</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/10/migrating-to-hugo/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/go>Go</a><a href=https://blog.jverkamp.com/2021/01/27/a-tabbed-view-for-hugo/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/07/22/parsing-human-readable-times/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/php>PHP</a></li><li><a href=https://blog.jverkamp.com/2019/04/27/tiny-helper-scripts-for-command-line-mysql/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2020/06/10/observation-server/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2019/04/30/forcing-secure-cookies-behind-an-elb-in-ruby/rails/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/ruby>Ruby</a><a href=https://blog.jverkamp.com/2020/01/16/rackcors-configuration-tricks/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2019/04/30/forcing-secure-cookies-behind-an-elb-in-ruby/rails/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/security>Security</a><a href=https://blog.jverkamp.com/2020/01/16/rackcors-configuration-tricks/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2019/04/30/forcing-secure-cookies-behind-an-elb-in-ruby/rails/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2019/05/07/work-on-a-quick-script-for-context-switching/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2019/04/30/forcing-secure-cookies-behind-an-elb-in-ruby/rails/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2019/05/02/harbinger/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>If you have a website that allows users to submit URLs, one of the (many many) things people will try to do to break your site is to submit URLs that use the <code>javascript:</code> protocol (rather than the more expected <code>http:</code> or <code>https:</code>). This is almost never something that you want, since it allows users to submit essentially arbitrary code that other users will run on click in the context of your domain (<a href=https://en.wikipedia.org/wiki/same%20origin%20policy>same origin policy</a>).</p><p>So how do you fix it?</p><p>First thought would be to try to check the protocol:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>url</span>) =&gt; <span style=color:#f92672>!</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/^javascript:/</span>)
</span></span><span style=display:flex><span>[Function<span style=color:#f92672>:</span> <span style=color:#a6e22e>safe_url</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;http://www.example.com&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;javascript:alert(1)&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>false</span>
</span></span></code></pre></div><p>Unfortunately, that&rsquo;s easy enough to bypass:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;Javascript:alert(1)&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>So we make the test case insensitive:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>url</span>) =&gt; <span style=color:#f92672>!</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/^javascript/i</span>)
</span></span><span style=display:flex><span>[Function<span style=color:#f92672>:</span> <span style=color:#a6e22e>safe_url</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;Javascript:alert(1)&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>false</span>
</span></span></code></pre></div><p>But we can still bypass that (note the leading space):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39; javascript:alert(1)&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>It turns out that most browsers are fairly accepting in trying to guess what a developer meant. They&rsquo;ll just trim off the space and run it. You can&rsquo;t just detect the word <code>javascript</code> anywhere though, since this is still perfectly runnable by browsers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39; &amp;#14;  javascript:alert(1)&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>Long story short, there are a great many ways to bypass regular expression based filters. At least in my opinion, you&rsquo;re far better off not trying that way at all. Instead, use the built in functionality of your language to parse the URL and then use that to check the protocol. There are still a few gotchas (mostly in relative URLs if you want to allow those and protocol relative URLs starting with <code>//...</code>). How would you implement something like that?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#e6db74>&#39;javascript:alert(1)&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>URL</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>href</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;javascript:alert(1)&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>origin</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;null&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;javascript:&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>host</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hostname</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pathname</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;alert(1)&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>search</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>searchParams</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>URLSearchParams</span> {},
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>hash</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>url</span>) =&gt; { <span style=color:#a6e22e>u</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>url</span>); <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>protocol</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;http:&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>protocol</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;https:&#39;</span> }
</span></span><span style=display:flex><span>[Function<span style=color:#f92672>:</span> <span style=color:#a6e22e>safe_url</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;http://www.example.com&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;HTTPS://www.example.com&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39; javascript://www.example.com&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>false</span>
</span></span></code></pre></div><p>Seems pretty good. Downside is that it blows up on protocol relative and relative URLs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;//www.example.com&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>Thrown</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>{ <span style=color:#a6e22e>TypeError</span> [<span style=color:#a6e22e>ERR_INVALID_URL</span>]<span style=color:#f92672>:</span> <span style=color:#a6e22e>Invalid</span> <span style=color:#a6e22e>URL</span><span style=color:#f92672>:</span> <span style=color:#75715e>//www.example.com
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>at</span> <span style=color:#a6e22e>onParseError</span> (<span style=color:#a6e22e>internal</span><span style=color:#f92672>/</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>js</span><span style=color:#f92672>:</span><span style=color:#ae81ff>241</span><span style=color:#f92672>:</span><span style=color:#ae81ff>17</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>at</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span> (<span style=color:#a6e22e>internal</span><span style=color:#f92672>/</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>js</span><span style=color:#f92672>:</span><span style=color:#ae81ff>319</span><span style=color:#f92672>:</span><span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>at</span> <span style=color:#a6e22e>safe_url</span> (<span style=color:#a6e22e>repl</span><span style=color:#f92672>:</span><span style=color:#ae81ff>1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>27</span>) <span style=color:#a6e22e>input</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;//www.example.com&#39;</span> }
</span></span></code></pre></div><p>If you don&rsquo;t want to support those, that&rsquo;s fine. Otherwise, you might need another trick:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;a&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>a</span><span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>​</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/a&gt;​</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;javascript:alert(1)&#39;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;javascript:alert(1)&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>protocol</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;javascript:&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;//www.example.com&#39;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;//www.example.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/relative&#39;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/relative&#34;</span>
</span></span></code></pre></div><p>And in those cases, it will pick up the protocol (and host in the latter case) of the site you&rsquo;re running in. This may or may not (probably won&rsquo;t) work with server side JavaScript though.</p><p>So, let&rsquo;s say you want to filter to only allow absolute URLs with <code>http</code> or <code>https</code> protocol. How do you do that in various languages?</p><p>JavaScript:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#a6e22e>url</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>href</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>protocol</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;http&#39;</span> <span style=color:#a6e22e>or</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>protocol</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;https&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Ruby:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>safe_url</span>(url)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>        parsed_url <span style=color:#f92672>=</span> <span style=color:#66d9ef>URI</span><span style=color:#f92672>.</span>parse(url)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;http&#39;</span>, <span style=color:#e6db74>&#39;https&#39;</span><span style=color:#f92672>].</span>include?(parsed_url)<span style=color:#f92672>.</span>scheme)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>rescue</span> <span style=color:#66d9ef>URI</span><span style=color:#f92672>::</span><span style=color:#66d9ef>InvalidURIError</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Go:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>safeUrl</span>(<span style=color:#a6e22e>url</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>parsedURL</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>parsedURL</span>.<span style=color:#a6e22e>Scheme</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;http&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>parsedURL</span>.<span style=color:#a6e22e>Scheme</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;https&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>PHP:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># PHP
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>safe_url</span>($url) {
</span></span><span style=display:flex><span>    $parsed <span style=color:#f92672>=</span> <span style=color:#a6e22e>parse_url</span>($url);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $parsed[<span style=color:#e6db74>&#39;scheme&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;http&#39;</span> <span style=color:#66d9ef>or</span> $parsed[<span style=color:#e6db74>&#39;scheme&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;https&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Python(3):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>safeUrl</span>(url):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> urllib<span style=color:#f92672>.</span>parse<span style=color:#f92672>.</span>urlparse(url)<span style=color:#f92672>.</span>scheme <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;http&#39;</span>, <span style=color:#e6db74>&#39;https&#39;</span>]
</span></span></code></pre></div><p>And believe it or not&mldr; I have used a (slightly more complicated) variation of each and every single one of those in production code. Sometimes you realize just how much of a programming polygot you have to be to do security work&mldr;</p><p>Fun times.</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>