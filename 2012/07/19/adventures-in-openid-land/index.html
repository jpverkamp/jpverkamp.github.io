<!doctype html><html><head><title>Adventures in OpenID land – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Adventures in OpenID land</h1><div class=entry-meta><span class=entry-date>2012-07-19</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/languages/css>CSS</a><a href=https://blog.jverkamp.com/2012/07/20/openid-part-2/ class=next-link></a></li><li><a class=taxonomy-value href=/programming/languages/html>HTML</a><a href=https://blog.jverkamp.com/2012/07/20/openid-part-2/ class=next-link></a></li><li><a class=taxonomy-value href=/programming/languages/php>PHP</a><a href=https://blog.jverkamp.com/2012/07/20/openid-part-2/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/topics/web-development>Web Development</a><a href=https://blog.jverkamp.com/2012/07/20/openid-part-2/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2012/07/04/analyzing-the-dice-game/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2012/07/20/openid-part-2/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2012/07/04/analyzing-the-dice-game/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2012/07/20/openid-part-2/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Today I started working on a little webapp. It&rsquo;s mostly to get me back in practice writing website code, but it does hopefully have the side effect of being useful. More on that later though, perhaps when it&rsquo;s actually working.</p><p>In any case, the first thing that I wanted to do for this app was to set up some sort of authentication system. Since I don&rsquo;t have HTTPS set up at the moment with my webhost (<a title="Dreamhost Homepage" href=http://dreamhost.com/>Dreamhost</a>; they really are pretty good to work with and far better than my previous host) and it doesn&rsquo;t really make as much sense to send passwords in plaintext over the network, I decided to go ahead and give OpenID a try. Granted, it&rsquo;s still sending the authentication information in plaintext for at least part of the trip, but it&rsquo;s still something that I think is worth learning.</p><p>Since the backend of the website is written in PHP (I generally use Python for prototyping, but I have to admit that it&rsquo;s easier to just hammer out webpages  in PHP) so the first place that a simple web search landed me was <a title="Getting Started with OpenID and PHP" href=http://devzone.zend.com/1254/getting-started-with-openid-and-php/>this article</a> on DevZone, using <a title="Janrain's OpenID Library" href=http://janrain.com/openid-enabled/>Janrain&rsquo;s OpenID library</a>. I downloaded everything&mldr; and immediately ran into a roadblock. Turns out in hindsight, I wasn&rsquo;t actually sure how OpenID works, so just mashing the code into my own wasn&rsquo;t going as well as I&rsquo;d hoped.</p><p>Off to <a href=https://en.wikipedia.org/wiki/Openid>Wikipedia</a>!</p><p>It turns out that OpenID basically works like this:</p><figure><img src=/embeds/2012/openid.png></figure><p>(<a href=https://en.wikipedia.org/wiki/File:OpenIDvs.Pseudo-AuthenticationusingOAuth.svg>source</a>, <a title="CC0 1.0 Universal (CC0 1.0)  Public Domain Dedication" href=http://creativecommons.org/publicdomain/zero/1.0/deed.en>license: CC0 1.0</a>)</p><p>So basically there were a number of redirects going on behind the scenes that I was having issues setting up, partially due to the relative complexity of the library that I was using. Looking around on the Internet, I found that I wasn&rsquo;t alone in thinking that the library that I was using was particularly powerful, but also a bit more complicated to get started with. So I went in search of a new library and eventually came across <a title="LightOpenID on Google Code" href=http://code.google.com/p/lightopenid/>LightOpenID</a>, with the promise that I could " code a functional client in less than ten lines of code". So off I went!</p><p>And really, it was only a tiny bit more than ten lines of code, based on the response to <a title="StackOverflow: Log-in the user with LightOpenID" href=http://stackoverflow.com/questions/3995011/log-in-the-user-with-lightopenid>this StackOverflow question</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$openid <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>LightOpenID</span>(<span style=color:#e6db74>&#39;http://example.com/&#39;</span>);
</span></span><span style=display:flex><span>$openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>returnURL</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://example.com/&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Login via google
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;login-google&#39;</span>])) {
</span></span><span style=display:flex><span>        $_SESSION[<span style=color:#e6db74>&#39;provider&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Google&#39;</span>;
</span></span><span style=display:flex><span>        $openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identity</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://www.google.com/accounts/o8/id&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Location: &#39;</span> <span style=color:#f92672>.</span> $openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>authUrl</span>());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// We&#39;re returning from a login attempt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>elseif</span> ($openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validate</span>()) {
</span></span><span style=display:flex><span>        $_SESSION[<span style=color:#e6db74>&#39;openid&#39;</span>] <span style=color:#f92672>=</span> $openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identity</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>That was easy. Next thing to get settled was what do I do with this information now that I have it? Well, the first problem is that the OpenID identifiers are kind of long winded. As an example, my OpenID from Google is 80 characters long, of which 39 are (as far as I can tell) the unique part of the ID. I could probably pull off just those 39 characters and that would be reasonable, but I wanted another solution.</p><p>Lo and behold, I can get the user&rsquo;s email address using only 3 more lines of code, one to add the request and two to process it when I get the response back:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$openid <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>LightOpenID</span>(<span style=color:#e6db74>&#39;http://example.com/&#39;</span>);
</span></span><span style=display:flex><span>$openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>required</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;contact/email&#39;</span>);
</span></span><span style=display:flex><span>$openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>returnURL</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://example.com/&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Login via google
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;login-google&#39;</span>])) {
</span></span><span style=display:flex><span>        $_SESSION[<span style=color:#e6db74>&#39;provider&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Google&#39;</span>;
</span></span><span style=display:flex><span>        $openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identity</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;https://www.google.com/accounts/o8/id&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Location: &#39;</span> <span style=color:#f92672>.</span> $openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>authUrl</span>());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// We&#39;re returning from a login attempt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>elseif</span> ($openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validate</span>()) {
</span></span><span style=display:flex><span>	$attrs <span style=color:#f92672>=</span> $openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAttributes</span>();
</span></span><span style=display:flex><span>	$_SESSION[<span style=color:#e6db74>&#39;id&#39;</span>] <span style=color:#f92672>=</span> $attrs[<span style=color:#e6db74>&#39;contact/email&#39;</span>];
</span></span><span style=display:flex><span>        $_SESSION[<span style=color:#e6db74>&#39;openid&#39;</span>] <span style=color:#f92672>=</span> $openid<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identity</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I think this will also be helpful in the future as I can use it for this particular project to send out reports to the user whenever they might want them and use it for a sort of sharing system where users can share information with others based on their email address.</p><p>So two problems solved and everything seems peachy. So far I have it working with both Google and Yahoo, although adding more should be pretty much trivial. Not too bad for only an hour or so of work.</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>