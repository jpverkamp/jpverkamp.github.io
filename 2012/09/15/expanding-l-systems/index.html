<!DOCTYPE html>
<html>
<head>
    <title>Expanding L-systems – jverkamp.com</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Expanding L-systems</h1>

        <div class="entry-meta"><span class="entry-date">2012-09-15</span>
            </div><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/09/13/optimizing-voronoi/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a><a href="https://blog.jverkamp.com/2012/09/16/a-needle-in-a-pi-stack/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/09/13/optimizing-voronoi/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/09/16/a-needle-in-a-pi-stack/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/09/14/a-sea-of-stars-ch.-6-greetings/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/09/16/a-needle-in-a-pi-stack/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</header>

	<div class="entry-content"><p>An <a href="https://en.wikipedia.org/wiki/L-systems">L-system</a> is essentially a set of rewriting rules that turns a simple set of rules into a complex pattern. They&rsquo;re generally used for generating self-similar fractals, including plant life, but I&rsquo;ve also seen them used in programming languages research where they can generate valid programs given the grammar of a language. They&rsquo;re also rather similar to <a href="https://blog.jverkamp.com/2012/04/13/wombat-ide-turtle-graphics/">turtle graphics</a> in that many of the sample graphics that I&rsquo;ve <a href="https://blog.jverkamp.com/2012/04/13/wombat-ide-turtle-graphics/">generated in the past</a> are based directly off the <a href="https://en.wikipedia.org/wiki/L-systems">L-systems page</a> on Wikipedia. So this time I&rsquo;ve decided to work on a relatively simple macro that can be used to expand simple L-systems.</p>

<p>The basic idea is that you want to take a set of rules and expand them. Let&rsquo;s start with with one designed to model algae growth from Lindenmayer himself (that&rsquo;s the L in L-system for anyone that didn&rsquo;t already know and hasn&rsquo;t clicked the links up above):</p>

<pre><code>**variables** : A B
**constants** : none
**start**     : A
**rules**     : (A → AB), (B → A)
</code></pre>

<p>And a simple demonstration for how we might run that with the system I&rsquo;ve developed:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>algae  <span style="color:#75715e">; an l-system is a one variable function (# of iterations)</span>
  (l-system a  <span style="color:#75715e">; create a new l-system starting at a</span>
    [a -&gt; a b] <span style="color:#75715e">; bind a set of rules, each expanding a single non-terminal</span>
    [b -&gt; a]))

~ (algae <span style="color:#ae81ff">1</span>)
 (a b)

~ (algae <span style="color:#ae81ff">2</span>)
 (a b a)

~ (algae <span style="color:#ae81ff">3</span>)
 (a b a a b)

~ (algae <span style="color:#ae81ff">4</span>)
 (a b a a b a b a)</code></pre></div>
<p>Or perhaps a slightly more complicated method that we can use to generate the same fern graphics that I&rsquo;ve shown before with turtle graphics. This one also shows off the ability to generate nested structures inline. In the second rule, you can see several levels of nesting, all of which show up in the final result:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>fern
  (l-system x
    [f -&gt; f f]
    [x -&gt; f - [[x] + x] + f [+ f x] - x]))

~ (fern <span style="color:#ae81ff">2</span>)
 (f f - ((f - ((x) + x) + f (+ f x) - x)) (+)
 (f - ((x) + x) + f (+ f x) - x) + f f (+) (f f)
 (f - ((x) + x) + f (+ f x) - x) - f - ((x) + x) + f (+ f x)
 - x)</code></pre></div>
<p>Okay, enough demonstration, let&rsquo;s actually get to the heart of the code. Essentially, it&rsquo;s a single macro with two interlocking parts running inside. <code>deep-map</code> is a modified version of <code>map</code> that digs into nested lists while <code>expand</code> actually does the bulk of the work. I think my favorite part of the code is the call to <code>assoc</code> in the bottom. With that, the structure of the 2nd and later arguments to the macro really come in handy. It&rsquo;s times like these that Scheme&rsquo;s treatment of code as data and data as code really shine through.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define-syntax </span>l-system
  (<span style="color:#66d9ef">syntax-rules </span>(-&gt;)
    [(l-system init rules <span style="color:#f92672">...</span>)
     (<span style="color:#66d9ef">lambda </span>(n)

       (<span style="color:#66d9ef">define </span>(deep-map proc ls)
         (cond
           [(null? ls) <span style="color:#f92672">&#39;</span>()]
           [(pair? (car ls))
            (cons (deep-map proc (car ls))
                  (deep-map proc (cdr ls)))]
           [else
            (cons (proc (car ls))
                  (deep-map proc (cdr ls)))]))

       (<span style="color:#66d9ef">define </span>(expand n ls)
         (<span style="color:#66d9ef">if </span>(zero? n)
             ls
             (apply append
               (deep-map
                 (<span style="color:#66d9ef">lambda </span>(x)
                   (<span style="color:#66d9ef">let </span>([result (assoc x <span style="color:#f92672">&#39;</span>(rules <span style="color:#f92672">...</span>))])
                     (<span style="color:#66d9ef">if </span>result
                         (expand (sub1 n) (cddr result))
                         (list x))))
                 ls))))

       (expand n <span style="color:#f92672">&#39;</span>(init)))]))</code></pre></div>
<p>And that&rsquo;s all there is to it. There are a number of other features that I&rsquo;d optimally like to add (conditional/branching outputs being one) but for a short bit of work, I don&rsquo;t think it&rsquo;s a half bad piece of code.</p>

<p>If you&rsquo;d like to download the full source code (with examples), you can do so here: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/l-system.ss" title="l-system source">l-system source</a></p></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Expanding L-systems";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2012\/09\/15\/expanding-l-systems\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="/custom.js" defer></script>
</body>
</html>
