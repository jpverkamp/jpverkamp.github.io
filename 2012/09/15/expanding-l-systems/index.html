<!doctype html><html><head><title>Expanding L-systems – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script defer src=/jquery_6894410585563545744.min.cc1cade18c999752b7befe111634889dca8d89b24923775954ecebc68c54fcd3.js integrity="sha256-zByt4YyZl1K3vv4RFjSIncqNibJJI3dZVOzrxoxU/NM="></script>
<script defer src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg="></script>
<script defer src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM="></script>
<script defer src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY="></script>
<script defer src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90="></script>
<script defer src=/custom.js></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="></script><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="></script><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="></script><link rel=stylesheet href=/css_4780214198035419921.min.7cfac95bdd962d85ceec560e50fe7b04c44b58a76e5202006ef36ca8c0a7d836.css integrity="sha256-fPrJW92WLYXO7FYOUP57BMRLWKduUgIAbvNsqMCn2DY="></script><link rel=stylesheet href=/custom.css><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>Expanding L-systems</h1><div class=entry-meta><span class=entry-date>2012-09-15</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2012/09/13/optimizing-voronoi/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2012/09/16/a-needle-in-a-pi-stack/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2012/09/13/optimizing-voronoi/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2012/09/16/a-needle-in-a-pi-stack/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2012/09/14/a-sea-of-stars-ch.-6-greetings/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2012/09/16/a-needle-in-a-pi-stack/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>An <a href=https://en.wikipedia.org/wiki/L-systems>L-system</a> is essentially a set of rewriting rules that turns a simple set of rules into a complex pattern. They&rsquo;re generally used for generating self-similar fractals, including plant life, but I&rsquo;ve also seen them used in programming languages research where they can generate valid programs given the grammar of a language. They&rsquo;re also rather similar to <a href=https://blog.jverkamp.com/2012/04/13/wombat-ide-turtle-graphics/>turtle graphics</a> in that many of the sample graphics that I&rsquo;ve <a href=https://blog.jverkamp.com/2012/04/13/wombat-ide-turtle-graphics/>generated in the past</a> are based directly off the <a href=https://en.wikipedia.org/wiki/L-systems>L-systems page</a> on Wikipedia. So this time I&rsquo;ve decided to work on a relatively simple macro that can be used to expand simple L-systems.</p><p>The basic idea is that you want to take a set of rules and expand them. Let&rsquo;s start with with one designed to model algae growth from Lindenmayer himself (that&rsquo;s the L in L-system for anyone that didn&rsquo;t already know and hasn&rsquo;t clicked the links up above):</p><pre tabindex=0><code>**variables** : A B
**constants** : none
**start**     : A
**rules**     : (A → AB), (B → A)
</code></pre><p>And a simple demonstration for how we might run that with the system I&rsquo;ve developed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>algae  <span style=color:#75715e>; an l-system is a one variable function (# of iterations)</span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>l-system</span> a  <span style=color:#75715e>; create a new l-system starting at a</span>
</span></span><span style=display:flex><span>    [a -&gt; a b] <span style=color:#75715e>; bind a set of rules, each expanding a single non-terminal</span>
</span></span><span style=display:flex><span>    [b -&gt; a]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~ (<span style=color:#a6e22e>algae</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>a</span> b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~ (<span style=color:#a6e22e>algae</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>a</span> b a)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~ (<span style=color:#a6e22e>algae</span> <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>a</span> b a a b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~ (<span style=color:#a6e22e>algae</span> <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>a</span> b a a b a b a)
</span></span></code></pre></div><p>Or perhaps a slightly more complicated method that we can use to generate the same fern graphics that I&rsquo;ve shown before with turtle graphics. This one also shows off the ability to generate nested structures inline. In the second rule, you can see several levels of nesting, all of which show up in the final result:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>fern
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>l-system</span> x
</span></span><span style=display:flex><span>    [f -&gt; f f]
</span></span><span style=display:flex><span>    [x -&gt; f - [[x] + x] + f [+ f x] - x]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~ (<span style=color:#a6e22e>fern</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>f</span> f - ((<span style=color:#a6e22e>f</span> - ((<span style=color:#a6e22e>x</span>) + x) + f (+ f x) - x)) (<span style=color:#a6e22e>+</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>f</span> - ((<span style=color:#a6e22e>x</span>) + x) + f (+ f x) - x) + f f (<span style=color:#a6e22e>+</span>) (<span style=color:#a6e22e>f</span> f)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>f</span> - ((<span style=color:#a6e22e>x</span>) + x) + f (+ f x) - x) - f - ((<span style=color:#a6e22e>x</span>) + x) + f (+ f x)
</span></span><span style=display:flex><span> - x)
</span></span></code></pre></div><p>Okay, enough demonstration, let&rsquo;s actually get to the heart of the code. Essentially, it&rsquo;s a single macro with two interlocking parts running inside. <code>deep-map</code> is a modified version of <code>map</code> that digs into nested lists while <code>expand</code> actually does the bulk of the work. I think my favorite part of the code is the call to <code>assoc</code> in the bottom. With that, the structure of the 2nd and later arguments to the macro really come in handy. It&rsquo;s times like these that Scheme&rsquo;s treatment of code as data and data as code really shine through.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define-syntax </span>l-system
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>syntax-rules </span>(<span style=color:#a6e22e>-&gt;</span>)
</span></span><span style=display:flex><span>    [(<span style=color:#a6e22e>l-system</span> init rules <span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>n</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>deep-map</span> proc ls)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>           [(null? ls) <span style=color:#f92672>&#39;</span>()]
</span></span><span style=display:flex><span>           [(pair? (car ls))
</span></span><span style=display:flex><span>            (cons (<span style=color:#a6e22e>deep-map</span> proc (car ls))
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>deep-map</span> proc (cdr ls)))]
</span></span><span style=display:flex><span>           [else
</span></span><span style=display:flex><span>            (cons (<span style=color:#a6e22e>proc</span> (car ls))
</span></span><span style=display:flex><span>                  (<span style=color:#a6e22e>deep-map</span> proc (cdr ls)))]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>expand</span> n ls)
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(zero? n)
</span></span><span style=display:flex><span>             ls
</span></span><span style=display:flex><span>             (apply append
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>deep-map</span>
</span></span><span style=display:flex><span>                 (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>x</span>)
</span></span><span style=display:flex><span>                   (<span style=color:#66d9ef>let </span>([result (assoc x <span style=color:#f92672>&#39;</span>(rules <span style=color:#f92672>...</span>))])
</span></span><span style=display:flex><span>                     (<span style=color:#66d9ef>if </span>result
</span></span><span style=display:flex><span>                         (<span style=color:#a6e22e>expand</span> (<span style=color:#a6e22e>sub1</span> n) (cddr result))
</span></span><span style=display:flex><span>                         (list x))))
</span></span><span style=display:flex><span>                 ls))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       (<span style=color:#a6e22e>expand</span> n <span style=color:#f92672>&#39;</span>(init)))]))
</span></span></code></pre></div><p>And that&rsquo;s all there is to it. There are a number of other features that I&rsquo;d optimally like to add (conditional/branching outputs being one) but for a short bit of work, I don&rsquo;t think it&rsquo;s a half bad piece of code.</p><p>If you&rsquo;d like to download the full source code (with examples), you can do so here: <a href=https://github.com/jpverkamp/small-projects/blob/master/blog/l-system.ss title="l-system source">l-system source</a></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>