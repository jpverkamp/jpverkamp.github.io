<!doctype html><html><head><title>n-queens in 18 lines of code â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>n-queens in 18 lines of code</h1><div class=entry-meta><span class=entry-date>2012-09-24</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2012/09/19/a-piece-of-the-abc-conjecture/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2012/10/07/three-ways-to-write-expressions/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/topics/backtracking>Backtracking</a><a href=https://blog.jverkamp.com/2012/10/14/dodgsons-doublets/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2012/09/20/playing-with-loaded-dice/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/mathematics>Mathematics</a><a href=https://blog.jverkamp.com/2012/09/26/line-art-with-an-html5-canvas/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2012/09/22/sampling-stdin/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2012/09/26/line-art-with-an-html5-canvas/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2012/09/23/herman/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2012/09/25/a-sea-of-stars-ch.-9-lies/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>One of the rites of passage for computer scientists it seems is to solve the <a href=https://en.wikipedia.org/wiki/N-queens>Eight Queens Problem</a>&ndash;where you must place 8 queens on a chessboard so that no pair of queens is attacking each other. Even better is when you can expand that to the n-queens problem with n queens on an n by n chessboard. After finding it again in older posts on both <a href=http://programmingpraxis.com/2010/06/11/n-queens/ title="Programming Praxis: N-Queens">Programming Praxis</a> and <a href=http://www.datagenetics.com/blog/august42012/index.html title="DataGenetics: Eight Queens">DataGenetics</a>, I decided to go ahead and take a crack at it and I think the solution is pretty straight forward.</p><p>The most boring obvious solution would be to simply try every possible solution. For an 8x8 board, that turns out to be <span class=latex-inline>\binom{8*8}{8} \approx 4.4e9</span>
or 4.4 billion. That&rsquo;s a fair few, but still entirely doable without too much effort. You can do a little better by restricting the solutions to exactly one queen per row and column. That reduces the number of necessary combinations all of the way down to <span class=latex-inline>8! = 40,320</span>
combinations. Much better, but it still seems like we should be able to do better.</p><p>Finally, we&rsquo;re at the solution hat I actually used: a simple backtracking model. Start by placing a queen in the first row and column. Then, for each row after that, place a queen in the first column that is available. If you ever get into a position where that just isn&rsquo;t possible, back up through the decisions you made, undoing them one at a time and trying the next column instead. Eventually, you might get all the way back to that original first row and column choice if it&rsquo;s not possible to place a queen in the corner and still solve the problem (that&rsquo;s not actually true, there are actually four such solutions for an 8x8 board).</p><p>For this particular algorithm, Scheme is a natural choice as the backtracking algorithm is a direct analogue to recursion. You can use the nested function calls to keep track of how far you have to back up, which makes it rather nice. For this particular implementation, the goal is to return all valid solutions as a list of row,column points.</p><p>In any case, here&rsquo;s my code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>queens</span> n)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>loop ([queens <span style=color:#f92672>&#39;</span>()] [row <span style=color:#ae81ff>0</span>] [col <span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>      [(= row n) (list queens)]
</span></span><span style=display:flex><span>      [(= col n) <span style=color:#f92672>&#39;</span>()]
</span></span><span style=display:flex><span>      [else
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>let </span>([new-queen (list row col)])
</span></span><span style=display:flex><span>         (<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>any?</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>old-queen</span>)
</span></span><span style=display:flex><span>                     (<span style=color:#66d9ef>or </span>(= (car old-queen) (car new-queen))
</span></span><span style=display:flex><span>                         (= (cadr old-queen) (cadr new-queen))
</span></span><span style=display:flex><span>                         (= <span style=color:#ae81ff>1</span> (abs (/ (- (cadr old-queen) (cadr new-queen))
</span></span><span style=display:flex><span>                                      (- (car old-queen) (car new-queen)))))))
</span></span><span style=display:flex><span>               queens)
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>loop</span> queens row (+ col <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>append</span>
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>loop</span> (cons new-queen queens) (+ row <span style=color:#ae81ff>1</span>) <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>loop</span> queens row (+ col <span style=color:#ae81ff>1</span>)))))])))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>any?</span> ? l) (not (null? (<span style=color:#a6e22e>filter</span> ? l))))
</span></span></code></pre></div><p>Simple enough, although there are a few potential gotchas:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>[(= row n) (list queens)]
</span></span><span style=display:flex><span>[(= col n) <span style=color:#f92672>&#39;</span>()]
</span></span></code></pre></div><p>The first two <code>cond</code> cases are for running off the edges. If you&rsquo;ve run off the last row that means you&rsquo;ve successfully placed a queen in every row of the board so you should return the list of queens thus far. It&rsquo;s wrapped in another call to <code>list</code> as the expected solution is a list of solutions, not just a single solution. The second case is for running off of a column. If you get here, that means that you&rsquo;ve tried every solution in this particular row and either branched to look for more valid solutions or you&rsquo;re done and there aren&rsquo;t any. In either case, you just want an empty set of solutions for this branch.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>any?</span> (<span style=color:#66d9ef>lambda </span>(<span style=color:#a6e22e>old-queen</span>)
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>or </span>(= (car old-queen) (car new-queen))
</span></span><span style=display:flex><span>            (= (cadr old-queen) (cadr new-queen))
</span></span><span style=display:flex><span>            (= <span style=color:#ae81ff>1</span> (abs (/ (- (cadr old-queen) (cadr new-queen))
</span></span><span style=display:flex><span>                         (- (car old-queen) (car new-queen)))))))
</span></span><span style=display:flex><span>  queens)
</span></span></code></pre></div><p>The next interesting bit of code uses the <code>any?</code> function I&rsquo;ve shown several times before to ask if there is any <code>old-queen</code> in <code>queens</code> that is in the same row, column, or diagonal (respectively) as the <code>new-queen</code> that we&rsquo;re trying to place. I&rsquo;ll admit that the code is a bit messy here and it was originally factored out into three helper functions, but since they&rsquo;re only used once, I went ahead and inlined them.</p><p>The rest is just the branching possibilities. If the <code>any?</code> returns <code>#t</code>, that means there is already a queen that can attack this square so just try the next column. If it doesn&rsquo;t return <code>#t</code> though, that means that we could place a queen here. So what we do is branch by first checking for any solutions starting in the next row that have the new queen in them and then checking for any solutions still in this row without the new queen. Stick the two lists together and we have our overall solution. Recursion is awesome.</p><p>Here is an example run showing the 10 solutions to the 5-queens problem:</p><pre tabindex=0><code>~ (queens 5)
 (((4 3) (3 1) (2 4) (1 2) (0 0))
  ((4 2) (3 4) (2 1) (1 3) (0 0))
  ((4 4) (3 2) (2 0) (1 3) (0 1))
  ((4 3) (3 0) (2 2) (1 4) (0 1))
  ((4 4) (3 1) (2 3) (1 0) (0 2))
  ((4 0) (3 3) (2 1) (1 4) (0 2))
  ((4 1) (3 4) (2 2) (1 0) (0 3))
  ((4 0) (3 2) (2 4) (1 1) (0 3))
  ((4 2) (3 0) (2 3) (1 1) (0 4))
  ((4 1) (3 3) (2 0) (1 2) (0 4)))
</code></pre><p>Also, for those interested, I ran my code against the first several values for n:</p><table><thead><tr><th>n</th><th>solutions</th><th>time (sec)</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>0</td></tr><tr><td>2</td><td>0</td><td>0</td></tr><tr><td>3</td><td>0</td><td>0</td></tr><tr><td>4</td><td>2</td><td>0</td></tr><tr><td>5</td><td>10</td><td>0</td></tr><tr><td>6</td><td>4</td><td>0.001</td></tr><tr><td>7</td><td>40</td><td>0.003</td></tr><tr><td>8</td><td>92</td><td>0.019</td></tr><tr><td>9</td><td>352</td><td>0.102</td></tr><tr><td>10</td><td>724</td><td>0.549</td></tr><tr><td>11</td><td>2680</td><td>3.031</td></tr><tr><td>12</td><td>14200</td><td>19.282</td></tr><tr><td>13</td><td>73712</td><td>132.300</td></tr></tbody></table><p>All in all, a fun little problem. I&rsquo;m tempted to try for some of the more interesting possible algorithms for this at some point. For example I was toying with the idea of using a genetic algorithm to solve it, although I have a feeling that there is too much repetitiveness and symmetry to the solution space for that to be an effective method. Still, it could be interesting.</p><p>If you&rsquo;d like, you can download the source here: <a href=https://github.com/jpverkamp/small-projects/blob/master/blog/n-queens.ss title="n-queens source code">n queens source</a></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>