<!DOCTYPE html>
<html onclick >
<head>
    <title>Generating Voronoi diagrams â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Generating Voronoi diagrams</h1>

        <div class="entry-meta"><span class="entry-date">2012-09-09</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/08/31/wombat-ide-the-return-of-screen-sharing/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/java">Java</a><a href="https://blog.jverkamp.com/2012/09/10/fun-with-turtle-graphics-and-stars/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2012/09/08/the-first-two-problems/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a><a href="https://blog.jverkamp.com/2012/09/10/fun-with-turtle-graphics-and-stars/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/09/08/the-first-two-problems/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/09/10/fun-with-turtle-graphics-and-stars/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/09/08/the-first-two-problems/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/09/10/fun-with-turtle-graphics-and-stars/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><p>I was playing with <a href="https://blog.jverkamp.com/2012/02/18/wombat-ide-updated-tree-and-image-libraries/">image library</a> and started to think about more ways that I could generate images. One idea that came to mind was to generate a bunch of colored points on the image and then color every other pixel based on which seed point was closest. Turns out, that&rsquo;s exactly what a <a href="https://en.wikipedia.org/wiki/Voronoi%20diagram">Voronoi diagram</a>is&hellip; The Wikipedia article at least says that Voronoi diagrams can be traced back at least to <a href="https://en.wikipedia.org/wiki/Descartes">Descartes</a>in 1644, so I guess at least I&rsquo;m in good company. ðŸ˜„</p>

<p>Anyways, the code is actually really simple, given the <code>(c211 image)</code> library&rsquo;s <code>make-image</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; fill an rs x cs by coloring each point based on:</span>
<span style="color:#75715e">; the color in cls associated with the closest point in pts</span>
<span style="color:#75715e">; calculate all of the distances, sort for smallest, use that one</span>
(<span style="color:#66d9ef">define </span>(fill dist rs cs pts cls)
  (make-image rs cs
    (<span style="color:#66d9ef">lambda </span>(r c)
      (cadar
        (sort
          (<span style="color:#66d9ef">lambda </span>(pc1 pc2) (&lt; (car pc1) (car pc2)))
          (map (<span style="color:#66d9ef">lambda </span>(pt cl)
                 (list
                       (dist (list r c) pt) cl)) pts cls))))))</code></pre></div>
<p>Yeah. That&rsquo;s it. It&rsquo;s a little more complicated as you need to give it a distance function. Here&rsquo;s the boring everyday distance function that you&rsquo;re probably familiar with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; distance function</span>
(<span style="color:#66d9ef">define </span>(distance p1 p2)
  (expt (+ (expt (- (car p1) (car p2)) <span style="color:#ae81ff">2</span>)
           (expt (- (cadr p1) (cadr p2)) <span style="color:#ae81ff">2</span>))
    <span style="color:#ae81ff">0.5</span>))</code></pre></div>
<p>And if you generate a random collection of starting points and colors, you might a Voronoi diagram that looks an awful lot like this one:</p>

<figure>
    <img src="/embeds/2012/voronoi-distance.png"/> 
</figure>


<p>But what&rsquo;s really interesting (at least to me) is when you start using different distance functions. For example, if you instead use Manhattan / taxicab distance (with the same points), you get something more like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; manhattan distance function</span>
(<span style="color:#66d9ef">define </span>(manhattan p1 p2)
  (+ (abs (- (car p1) (car p2))) (abs (- (cadr p1) (cadr p2)))))</code></pre></div>
<figure>
    <img src="/embeds/2012/voronoi-manhattan.png"/> 
</figure>


<p>Basically, you get a lot more straight lines at 45 and 90 intervals rather than the more varied angles in the original.</p>

<p>As another function, what if you take the standard distance function but rather than squaring and then taking the square root, you use fourth powers:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; take a quartic instead of a square</span>
(<span style="color:#66d9ef">define </span>(quartic p1 p2)
  (expt (+ (expt (- (car p1) (car p2)) <span style="color:#ae81ff">4</span>)
           (expt (- (cadr p1) (cadr p2)) <span style="color:#ae81ff">4</span>))
    <span style="color:#ae81ff">0.25</span>))</code></pre></div>
<figure>
    <img src="/embeds/2012/voronoi-quartic.png"/> 
</figure>


<p>Same sort of thing as the original distance function, but you get a little more bowing and curving than the straight distance allows. Mostly out of curiosity, I&rsquo;ll leave it as an exercise for why I jumped from 2nd powers to 4th. <span class="spoiler">It turns out that odd powers do strange things to signs. </span>
</p>

<p>Finally, what if you invert the distance function with a simple 1/n? Or perhaps you just negate the distance function, weighting points further rather than closer. You might get something like this (with the <code>/0</code> function designed to ignore dividing by 0):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; a very special division that can divide by 0 ðŸ˜„</span>
(<span style="color:#66d9ef">define </span>(/0 a b) (<span style="color:#66d9ef">if </span>(= b <span style="color:#ae81ff">0</span>) <span style="color:#ae81ff">1</span>e9 (/ a b)))

<span style="color:#75715e">; use some strange negative power</span>
(<span style="color:#66d9ef">define </span>(inverse p1 p2)
  (+ (/0 <span style="color:#ae81ff">1</span> (abs (- (car p1) (car p2)))) (/0 <span style="color:#ae81ff">1</span> (abs (- (cadr p1) (cadr p2))))))

<span style="color:#75715e">; negative distance</span>
(<span style="color:#66d9ef">define </span>(ndist p1 p2)
  (- (distance p1 p2)))</code></pre></div>
<figure>
    <img src="/embeds/2012/voronoi-inverse.png"/> 
</figure>


<figure>
    <img src="/embeds/2012/voronoi-ndist.png"/> 
</figure>


<p>Now rather than choosing the closet point, you&rsquo;re essentially choosing the furthest. It gets a little more complicated if the fraction you&rsquo;re dealing with is under 1, but since we&rsquo;re dealing with whole numbers of pixels that really didn&rsquo;t come up.</p>

<p>Or what if you do something similar to Manhattan distance function, but instead of adding the two, you multiply them? What if you just take the bigger of the two? The smaller?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; multiply the differences</span>
(<span style="color:#66d9ef">define </span>(mul/min/max-xy p1 p2)
  (*/min/max (abs (- (car p1) (car p2))) (abs (- (cadr p1) (cadr p2)))))</code></pre></div>
<figure>
    <img src="/embeds/2012/voronoi-mul-xy.png"/> 
</figure>


<figure>
    <img src="/embeds/2012/voronoi-max-xy.png"/> 
</figure>


<figure>
    <img src="/embeds/2012/voronoi-min-xy.png"/> 
</figure>


<p>All sorts of interesting patterns there when the minimum (or the dominant factor in a multiplication) switches from one axis to the other. Neat stuff.</p>

<p>Anyways, does anyone have a different distance function that does something interesting? Feel free to leave a comment below. You can either generate the images yourself in Wombat or just leave the code and I&rsquo;ll run it for you.</p>

<p>If you&rsquo;d like to download the source code, you can do so here: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/voronoi.ss" title="voronoi source">voronoi source</a></p>

<p><strong>Update:</strong> Here are the images reference in my comment below:</p>

<ul>
<li>Using the original algorithm:<br />
<figure>
    <img src="/embeds/2012/voronoi-comment-original.png"/> 
</figure>
</li>
<li>Using normalized coordinates:<br />
<figure>
    <img src="/embeds/2012/voronoi-comment-normalized.png"/> 
</figure>
</li>
</ul>

<p><strong>Update:</strong> For the second comment (working in degrees), I actually rewrote the code to work in Racket, since I&rsquo;m far more familiar with that:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(require images/flomap)

(struct pt (x y))
(struct cpt pt (c))

(<span style="color:#66d9ef">define </span>(voronoi width height distance seeds)
  (flomap-&gt;bitmap
   (build-flomap*
    <span style="color:#ae81ff">3</span> width height
    (Î» (x y)
      (call-with-values
       (thunk
        (for/fold ([min-distance +inf<span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>] [min-color <span style="color:#66d9ef">#f</span>])
                  ([seed (in-list seeds)])
          (<span style="color:#66d9ef">define </span>new-distance (distance (pt x y) seed))
          (<span style="color:#66d9ef">if </span>(&lt; new-distance min-distance)
              (values new-distance (cpt-c seed))
              (values min-distance min-color))))
       (Î» (distance color) color))))))

(<span style="color:#66d9ef">define </span>(random-seeds width height count)
  (for/list ([i (in-range count)])
    (cpt (random width) (random height)
         (vector (random) (random) (random)))))</code></pre></div>
<p>That lets us translate your new function fairly easily (although the offsets are a little interesting):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(voronoi
 <span style="color:#ae81ff">160</span> <span style="color:#ae81ff">40</span>
 (Î» (pt1 pt2)
   <span style="color:#75715e">; Unpack points</span>
   (match-define (pt x1^ y1^) pt1)
   (match-define (pt x2^ y2^) pt2)

   <span style="color:#75715e">; Rescale to the range [20, 80] and [40, 80]</span>
   (<span style="color:#66d9ef">define </span>x1 (+ x1^ <span style="color:#ae81ff">20</span>))
   (<span style="color:#66d9ef">define </span>y1 (+ y1^ <span style="color:#ae81ff">40</span>))
   (<span style="color:#66d9ef">define </span>x2 (+ x2^ <span style="color:#ae81ff">20</span>))
   (<span style="color:#66d9ef">define </span>y2 (+ y2^ <span style="color:#ae81ff">40</span>))

   (sqrt (+ (sqr (- (* x1 (cos (degrees-&gt;radians y1)))
                    (* x2 (cos (degrees-&gt;radians y2)))))
            (sqr (- y1 y2)))))

 (random-seeds <span style="color:#ae81ff">160</span> <span style="color:#ae81ff">40</span> <span style="color:#ae81ff">10</span>))</code></pre></div>
<p>Here are a few examples:</p>

<figure>
    <img src="/embeds/2012/voronoi-comment-degree-1.png"/> 
</figure>


<figure>
    <img src="/embeds/2012/voronoi-comment-degree-2.png"/> 
</figure>


<p>That&rsquo;s really cool. They sort of look like scales!</p>

<p>If you relax the range and let it go a full circle (x and y both ranging from 0 to 360), you get this:</p>

<figure>
    <img src="/embeds/2012/voronoi-comment-degree-full.png"/> 
</figure>


<p>Not quite scales any more, but there is a lot of neat structure in there.</p></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Generating Voronoi diagrams";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2012\/09\/09\/generating-voronoi-diagrams\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="/custom.js" defer></script>
</body>
</html>
