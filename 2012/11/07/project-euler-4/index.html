<!DOCTYPE html>
<html>
<head>
    <title>Project Euler 4 – jverkamp.com</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Project Euler 4</h1>

        <div class="entry-meta"><span class="entry-date">2012-11-07</span>
            </div><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/11/04/project-euler-2/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/racket">Racket</a><a href="https://blog.jverkamp.com/2012/11/08/project-euler-5/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2012/11/04/project-euler-2/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a><a href="https://blog.jverkamp.com/2012/11/08/project-euler-5/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/11/05/project-euler-3/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/project-euler">Project Euler</a><a href="https://blog.jverkamp.com/2012/11/08/project-euler-5/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/11/04/project-euler-2/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/mathematics">Mathematics</a><a href="https://blog.jverkamp.com/2012/11/08/project-euler-5/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/11/05/project-euler-3/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/11/08/project-euler-5/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/11/07/confession-day-6/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/11/08/confession-day-7/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</header>

	<div class="entry-content"><blockquote>
<p>A palindromic number reads the same both ways. The largest palindrome made from the product of two 2-digit numbers is 9009 = 91 x 99.</p>

<p>Find the largest palindrome made from the product of two 3-digit numbers.
&ndash; <cite><a href="http://projecteuler.net/problem=4">PROJECT EULER #4</a></cite></p>
</blockquote>

<p>The idea behind solving this problem in the brute force is relatively straight forward, just multiple every pair of three digit numbers, recording the best product (that is also a palindrome) as you go.</p>

<p>First, we need a way to split a number into it&rsquo;s digits. It turns out that this will be useful for several of the problems that we&rsquo;ll have to do on Project Euler, so at some point, I&rsquo;m going to want to extract this out into a shared library (along with many of the prime functions I&rsquo;ve already used). The idea is simple though. If you have any number, the list of digits in the number is equivalent to the last digit (the remainder of the number divided by 10) concatenated with the rest of the digits (integer division by 10). Then at the end, you can reverse the list and you&rsquo;re good:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; return a list of the digits of n</span>
(<span style="color:#66d9ef">define </span>(digits n)
  (reverse
   (<span style="color:#66d9ef">let </span>loop ([n n])
     (cond
       [(&lt; n <span style="color:#ae81ff">10</span>) (list n)]
       [else
        (cons (remainder n <span style="color:#ae81ff">10</span>)
              (loop (quotient n <span style="color:#ae81ff">10</span>)))]))))</code></pre></div>
<p>Optimally though, we&rsquo;d like to be able to do that without the <code>reverse</code>. In all of the cases that we&rsquo;re working on here, we&rsquo;re only reversing the elements of a four element list, so the run-time is negligible, but if we&rsquo;re hoping to put it in a library than it we should at least look into some minor optimizations.</p>

<p>The answer in this case, is to make the function <a href="https://en.wikipedia.org/wiki/tail%20recursive">tail recursive</a>. What that means in theory is that you never have any work waiting for you when you return from a function call so you can actually skip through several stack frames all at the same time (or never store them in the first place). Scheme and by extension Racket guarantees that tail calls will optimized, which is actually one of the reasons that recursive code in Schemes works just as well (and in many cases compile to nearly identical code) as loops in iterative languages such as C or Java.</p>

<p>What that means in practice though, is that if you have a problem where you need to use <code>reverse</code> to get the answer that you were expecting, in all likelihood, you want to use tail recursive (if you weren&rsquo;t already) or remove the tail recursive you have (if you were). Instead, you&rsquo;ll often find that keeping an accumulator list that you can build up as you&rsquo;re going is more helpful. In this case:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; return a list of the digits of n</span>
(<span style="color:#66d9ef">define </span>(digits n)
  (<span style="color:#66d9ef">let </span>loop ([n n] [ls <span style="color:#f92672">&#39;</span>()])
    (cond
      [(&lt; n <span style="color:#ae81ff">10</span>) (cons n ls)]
      [<span style="color:#66d9ef">else </span>(loop (quotient n <span style="color:#ae81ff">10</span>)
                  (cons (remainder n <span style="color:#ae81ff">10</span>) ls))])))</code></pre></div>
<p>So instead of using returning from a function to build up the resulting list, we build it in a parameter to <code>loop</code>, returning it directly at the end. The result is exactly the same, although with crazy huge numbers there should be a performance boost. It&rsquo;s primarily from making use of the tail call optimization, but there&rsquo;s also a bit from not needing to use <code>reverse</code>.</p>

<p>Back to the original problem though, the next step is to determine when a number is a palindrome. Since we can already generate lists of numbers, that becomes the problem of if we can determine if a list is a palindrome. And what is a palindrome, other than something that reads that same forwards and backwards? Well, that&rsquo;s exactly what we need to solve this problem.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; test if a number is a palindrome</span>
(<span style="color:#66d9ef">define </span>(palindrome? n)
  (equal? (digits n)
          (reverse (digits n))))</code></pre></div>
<p>With that, we can actually approach the problem that we started with. We&rsquo;ll start with the direct solution that I mentioned earlier, just trying all possible combinations and remembering the largest one:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; find the largest product of n digit numbers that&#39;s a palindrome</span>
(<span style="color:#66d9ef">define </span>(largest-palindrome-product digits)
  (<span style="color:#66d9ef">define </span>lo (expt <span style="color:#ae81ff">10</span> (- digits <span style="color:#ae81ff">1</span>)))
  (<span style="color:#66d9ef">define </span>hi (expt <span style="color:#ae81ff">10</span> digits))
  (for*/fold ([best <span style="color:#ae81ff">0</span>])
             ([x (in-range lo hi)]
              [y (in-range x hi)]
              <span style="color:#f92672">#</span>:when (palindrome? (* x y)))
    (max best (* x y))))</code></pre></div>
<p>The strength of this solution comes from the <code>for*/fold</code> macro which is similar to the other <code>for</code> macros we&rsquo;ve used previously, except this time there are two sets of parameters. In addition to the normal looping parameters (<code>x</code> and <code>y</code>), there&rsquo;s a new variable <code>best</code>. What this does is to basically work as an accumulator, like we were working with earlier. For each iteration of the function, whatever the body returns becomes the new value of <code>best</code>. So in this case, we&rsquo;re going to find the maximum product.</p>

<p>Another intricacy that I may not have previously mentioned is the <code>*</code> in <code>for*/fold</code>. What that means is that we&rsquo;re actually creating nested <code>for</code> loops, similar to how <code>let*</code> turns into nested calls to <code>let</code>. So the code above is actually equivalent to something more like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(for/fold ([best <span style="color:#ae81ff">0</span>])
          ([x (in-range lo hi)])
  (max best
       (for/fold ([inner-best <span style="color:#ae81ff">0</span>])
                 ([y (in-range x hi)]
                  <span style="color:#f92672">#</span>:when (palindrome? (* x y)))
         (max inner-best (* x y)))))</code></pre></div>
<p><em>Note: I&rsquo;m not actually sure that&rsquo;s what Racket would produce, but at least this would be equivalent code if <code>for*/fold</code> were not available.</em></p>

<p>In any case, either version should do what we want, so let&rsquo;s try it out:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (time (largest-palindrome-product <span style="color:#ae81ff">3</span>))
cpu time: <span style="color:#ae81ff">1154</span> real time: <span style="color:#ae81ff">1145</span> gc time: <span style="color:#ae81ff">188</span>
<span style="color:#ae81ff">906609</span></code></pre></div>
<p>And there you have it. The largest palindrome product of two three digit numbers is 906,609. A second is still pretty slow, but we can boost that slightly, as there&rsquo;s another solution that I want to look into. Think of this. We are trying to generate a palindrome <code>abccba</code> (where any of those numbers might be repeats). That could alternatively be written as:</p>

<pre><code>`100000a + 10000b + 1000c + 100c + 10b + a
= 100001a + 10010b + 1100c
= 11(9091a + 910b + 100c)`
</code></pre>

<p>Since 11 is prime, this tells us that at least one of the numbers must be divisible by 11. So we can revise the earlier code to only use multiples of 11 for the first number (although we lose the general solution):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; find the largest product of 3-digit numbers that&#39;s a palindrome</span>
(<span style="color:#66d9ef">define </span>(faster-largest-palindrome-product)
  (for*/fold ([best <span style="color:#ae81ff">0</span>])
             ([x (in-range <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">1000</span> <span style="color:#ae81ff">11</span>)]
              [y (in-range x <span style="color:#ae81ff">1000</span>)]
              <span style="color:#f92672">#</span>:when (palindrome? (* x y)))
    (max best (* x y))))</code></pre></div>
<p>And run it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (time (faster-largest-palindrome-product))
cpu time: <span style="color:#ae81ff">156</span> real time: <span style="color:#ae81ff">156</span> gc time: <span style="color:#ae81ff">62</span>
<span style="color:#ae81ff">906609</span></code></pre></div>
<p>That got us about an order of magnitude (which makes sense as we&rsquo;re jumping by an order of magnitude more), but let&rsquo;s see if we can&rsquo;t do better yet.</p>

<p>Consider the product we&rsquo;re working with, <code>(100a + 10b + c)(100d + 10e + f)</code>, which expands to:</p>

<pre><code>`                   100cd + 10ce + cf +
          1000bd + 100be + 10bf +
10000ad + 1000ae + 100af
`
</code></pre>

<p>If we start with the assumption that the first digit of the number is 9 (we can go back and change this later if it doesn&rsquo;t work out), then the last digit is also 9, so <code>cf = 9</code>. The only possible pairs of digits that multiply to 9 are <code>1/9</code>, <code>3/3</code>, and <code>7/7</code>. That at least gives us that both numbers are going to be odd, so we&rsquo;ll make that assumption:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; find the largest product of 3-digit numbers that&#39;s a palindrome</span>
(<span style="color:#66d9ef">define </span>(fastest-largest-palindrome-product)
  (for*/fold ([best <span style="color:#ae81ff">0</span>])
             ([x (in-range <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">1000</span> <span style="color:#ae81ff">22</span>)]
              [y (in-range x <span style="color:#ae81ff">1000</span> <span style="color:#ae81ff">2</span>)]
              <span style="color:#f92672">#</span>:when (palindrome? (* x y)))
    (max best (* x y))))</code></pre></div>
<p>This should buy us about another 4x speedup as we&rsquo;re cutting out even numbers on each of the two loops.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (time (fastest-largest-palindrome-product))
cpu time: <span style="color:#ae81ff">32</span> real time: <span style="color:#ae81ff">26</span> gc time: <span style="color:#ae81ff">0</span>
<span style="color:#ae81ff">906609</span></code></pre></div>
<p>And there you have it. With some simple linear algebra (barely even deserving of the name), we cut the runtime from 1154 ms down to 32 ms, for a speedup of approximately 35x. That&rsquo;s none too shabby at all. It&rsquo;s always something to keep in the back of your mind.</p>

<p>Although on the flip side, in real life, it&rsquo;s don&rsquo;t get carried away with <a href="https://en.wikipedia.org/wiki/Premature%20optimization#When%20to%20optimize">premature optimization</a>. As Donald Knuth once said, <em>premature optimization is the root of all evil</em>. 😄</p>

<p>As always, you can download my code for this or any Project Euler problem I’ve uploaded <a href="https://github.com/jpverkamp/small-projects/tree/master/project-euler" title="GitHub: jpverkamp: Project Euler">here</a>.</p></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Project Euler 4";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2012\/11\/07\/project-euler-4\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="/custom.js" defer></script>
</body>
</html>
