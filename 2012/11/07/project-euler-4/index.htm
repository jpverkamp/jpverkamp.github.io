<!DOCTYPE html>
<html>
<head>
        
        

        <title>Project Euler #4 | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

        <script src="//code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js"></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/obsidian.css" />
        <script src="/highlight/highlight.pack.js"></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" />
        <script src="/custom.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="http://blog.jverkamp.com/feed/" />
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://blog.jverkamp.com"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="http://blog.jverkamp.com/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/archives/2004">2004</a></li><li><a href="http://blog.jverkamp.com/category/archives/2005">2005</a></li><li><a href="http://blog.jverkamp.com/category/archives/2006">2006</a></li><li><a href="http://blog.jverkamp.com/category/archives/2007">2007</a></li><li><a href="http://blog.jverkamp.com/category/archives/2008">2008</a></li><li><a href="http://blog.jverkamp.com/category/archives/2009">2009</a></li><li><a href="http://blog.jverkamp.com/category/archives/2010">2010</a></li><li><a href="http://blog.jverkamp.com/category/archives/2011">2011</a></li><li><a href="http://blog.jverkamp.com/category/archives/2012">2012</a></li><li><a href="http://blog.jverkamp.com/category/archives/2013">2013</a></li><li><a href="http://blog.jverkamp.com/category/archives/2014">2014</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="http://blog.jverkamp.com/category/other/cooking">Cooking</a></li><li><a href="http://blog.jverkamp.com/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/photography/dp-challenge">DP Challenge</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosets">Photosets</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/programming/by-language">By Language</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-project">By Project</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-source">By Source</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/research/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/writing/by-genre">By Genre</a></li><li><a href="http://blog.jverkamp.com/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="http://blog.jverkamp.com/category/writing/novels">Novels</a></li><li><a href="http://blog.jverkamp.com/category/writing/other">Other</a></li><li><a href="http://blog.jverkamp.com/category/writing/short-stories">Short Stories</a></li></ul></li></ul>

      <form action="http://www.google.com/search" method="get" onSubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input name="q" type="hidden" />
          <input name="qfront" type="text" class="form-control" placeholder="Search" />
          <button type="submit" class="btn btn-default" value="Search">Search</button>
        </p>
      </form>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Project Euler #4</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2012-11-07"><span class="year">2012</span> <span class="month">Nov</span> <span class="day">7</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="http://blog.jverkamp.com/category/programming/by-source/project-euler">Project Euler</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/scheme">Scheme</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/mathematics">Mathematics</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/racket">Racket</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <blockquote>A palindromic number reads the same both ways. The largest palindrome made from the product of two 2-digit numbers is 9009 = 91 x 99.

Find the largest palindrome made from the product of two 3-digit numbers.
-- <cite><a href="http://projecteuler.net/problem=4">PROJECT EULER #4</a></cite></blockquote>
<!--more-->
<p>The idea behind solving this problem in the brute force is relatively straight forward, just multiple every pair of three digit numbers, recording the best product (that is also a palindrome) as you go.</p>
<p>First, we need a way to split a number into it's digits. It turns out that this will be useful for several of the problems that we'll have to do on Project Euler, so at some point, I'm going to want to extract this out into a shared library (along with many of the prime functions I've already used). The idea is simple though. If you have any number, the list of digits in the number is equivalent to the last digit (the remainder of the number divided by 10) concatenated with the rest of the digits (integer division by 10). Then at the end, you can reverse the list and you're good:</p>
<pre class="scheme"><code>; return a list of the digits of n
(define (digits n)
  (reverse
   (let loop ([n n])
     (cond
       [(&lt; n 10) (list n)]
       [else
        (cons (remainder n 10)
              (loop (quotient n 10)))]))))</code></pre>
<p>Optimally though, we'd like to be able to do that without the <code>reverse</code>. In all of the cases that we're working on here, we're only reversing the elements of a four element list, so the run-time is negligible, but if we're hoping to put it in a library than it we should at least look into some minor optimizations.</p>
<p>The answer in this case, is to make the function <a href="https://en.wikipedia.org/wiki/tail_recursive">tail recursive</a>. What that means in theory is that you never have any work waiting for you when you return from a function call so you can actually skip through several stack frames all at the same time (or never store them in the first place). Scheme and by extension Racket guarantees that tail calls will optimized, which is actually one of the reasons that recursive code in Schemes works just as well (and in many cases compile to nearly identical code) as loops in iterative languages such as C or Java.</p>
<p>What that means in practice though, is that if you have a problem where you need to use <code>reverse</code> to get the answer that you were expecting, in all likelihood, you want to use tail recursive (if you weren't already) or remove the tail recursive you have (if you were). Instead, you'll often find that keeping an accumulator list that you can build up as you're going is more helpful. In this case:</p>
<pre class="scheme"><code>; return a list of the digits of n
(define (digits n)
  (let loop ([n n] [ls '()])
    (cond
      [(&lt; n 10) (cons n ls)]
      [else (loop (quotient n 10)
                  (cons (remainder n 10) ls))])))</code></pre>
<p>So instead of using returning from a function to build up the resulting list, we build it in a parameter to <code>loop</code>, returning it directly at the end. The result is exactly the same, although with crazy huge numbers there should be a performance boost. It's primarily from making use of the tail call optimization, but there's also a bit from not needing to use <code>reverse</code>.</p>
<p>Back to the original problem though, the next step is to determine when a number is a palindrome. Since we can already generate lists of numbers, that becomes the problem of if we can determine if a list is a palindrome. And what is a palindrome, other than something that reads that same forwards and backwards? Well, that's exactly what we need to solve this problem.</p>
<pre class="scheme"><code>; test if a number is a palindrome
(define (palindrome? n)
  (equal? (digits n)
          (reverse (digits n))))</code></pre>
<p>With that, we can actually approach the problem that we started with. We'll start with the direct solution that I mentioned earlier, just trying all possible combinations and remembering the largest one:</p>
<pre class="scheme"><code>; find the largest product of n digit numbers that's a palindrome
(define (largest-palindrome-product digits)
  (define lo (expt 10 (- digits 1)))
  (define hi (expt 10 digits))
  (for*/fold ([best 0])
             ([x (in-range lo hi)]
              [y (in-range x hi)]
              #:when (palindrome? (* x y)))
    (max best (* x y))))</code></pre>
<p>The strength of this solution comes from the <code>for*/fold</code> macro which is similar to the other <code>for</code> macros we've used previously, except this time there are two sets of parameters. In addition to the normal looping parameters (<code>x</code> and <code>y</code>), there's a new variable <code>best</code>. What this does is to basically work as an accumulator, like we were working with earlier. For each iteration of the function, whatever the body returns becomes the new value of <code>best</code>. So in this case, we're going to find the maximum product.</p>
<p>Another intricacy that I may not have previously mentioned is the <code>*</code> in <code>for*/fold</code>. What that means is that we're actually creating nested <code>for</code> loops, similar to how <code>let*</code> turns into nested calls to <code>let</code>. So the code above is actually equivalent to something more like this:</p>
<pre class="scheme"><code>(for/fold ([best 0])
          ([x (in-range lo hi)])
  (max best
       (for/fold ([inner-best 0])
                 ([y (in-range x hi)]
                  #:when (palindrome? (* x y)))
         (max inner-best (* x y)))))</code></pre>
<p><em>Note: I'm not actually sure that's what Racket would produce, but at least this would be equivalent code if <code>for*/fold</code> were not available.</em></p>
<p>In any case, either version should do what we want, so let's try it out:</p>
<pre class="scheme"><code>&gt; (time (largest-palindrome-product 3))
cpu time: 1154 real time: 1145 gc time: 188
906609</code></pre>
<p>And there you have it. The largest palindrome product of two three digit numbers is 906,609. A second is still pretty slow, but we can boost that slightly, as there's another solution that I want to look into. Think of this. We are trying to generate a palindrome <code>abccba</code> (where any of those numbers might be repeats). That could alternatively be written as:</p>
<pre>`100000a + 10000b + 1000c + 100c + 10b + a
= 100001a + 10010b + 1100c
= 11(9091a + 910b + 100c)`</pre>
<p>Since 11 is prime, this tells us that at least one of the numbers must be divisible by 11. So we can revise the earlier code to only use multiples of 11 for the first number (although we lose the general solution):</p>
<pre class="scheme"><code>; find the largest product of 3-digit numbers that's a palindrome
(define (faster-largest-palindrome-product)
  (for*/fold ([best 0])
             ([x (in-range 11 1000 11)]
              [y (in-range x 1000)]
              #:when (palindrome? (* x y)))
    (max best (* x y))))</code></pre>
<p>And run it:</p>
<pre class="scheme"><code>&gt; (time (faster-largest-palindrome-product))
cpu time: 156 real time: 156 gc time: 62
906609</code></pre>
<p>That got us about an order of magnitude (which makes sense as we're jumping by an order of magnitude more), but let's see if we can't do better yet.</p>
<p>Consider the product we're working with, <code>(100a + 10b + c)(100d + 10e + f)</code>, which expands to:</p>
<pre>`                   100cd + 10ce + cf +
          1000bd + 100be + 10bf +
10000ad + 1000ae + 100af
`</pre>
<p>If we start with the assumption that the first digit of the number is 9 (we can go back and change this later if it doesn't work out), then the last digit is also 9, so <code>cf = 9</code>. The only possible pairs of digits that multiply to 9 are <code>1/9</code>, <code>3/3</code>, and <code>7/7</code>. That at least gives us that both numbers are going to be odd, so we'll make that assumption:</p>
<pre class="scheme"><code>; find the largest product of 3-digit numbers that's a palindrome
(define (fastest-largest-palindrome-product)
  (for*/fold ([best 0])
             ([x (in-range 11 1000 22)]
              [y (in-range x 1000 2)]
              #:when (palindrome? (* x y)))
    (max best (* x y))))</code></pre>
<p>This should buy us about another 4x speedup as we're cutting out even numbers on each of the two loops.</p>
<pre class="scheme"><code>&gt; (time (fastest-largest-palindrome-product))
cpu time: 32 real time: 26 gc time: 0
906609</code></pre>
<p>And there you have it. With some simple linear algebra (barely even deserving of the name), we cut the runtime from 1154 ms down to 32 ms, for a speedup of approximately 35x. That's none too shabby at all. It's always something to keep in the back of your mind.</p>
<p>Although on the flip side, in real life, it's don't get carried away with <a href="https://en.wikipedia.org/wiki/premature_optimization">Premature optimization#When to optimize</a>. As Donald Knuth once said, <em>premature optimization is the root of all evil</em>. :)</p>
<p>As always, you can download my code for this or any Project Euler problem I’ve uploaded <a href="https://github.com/jpverkamp/small-projects/tree/master/project-euler" title="GitHub: jpverkamp: Project Euler">here</a>.</p>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Project Euler #4";
var disqus_url = "http://blog.jverkamp.com/2012/11/07/project-euler-4/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2012/11/07/confession-day-6">← Confession - Day 6</a></li><li><a href="http://blog.jverkamp.com/category/archives">Archives</a></li><li><a href="http://blog.jverkamp.com/2012/11/08/confession-day-7">Confession - Day 7 →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2012/11/05/project-euler-3">← Project Euler #3</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/2012/11/08/project-euler-5">Project Euler #5 →</a></li></ul></nav>

                <div class="legal">
                        <a href="http://blog.jverkamp.com/feed/atom.xml">feed <img style="border: 0;" src="http://blog.jverkamp.com/rss.png" /></a><br />
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="http://directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53688146-1', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>