<!DOCTYPE html>
<html onclick >
<head>
    <title>Nested Primes â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Nested Primes</h1>

        <div class="entry-meta"><span class="entry-date">2012-12-22</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/12/14/narcissistic-numbers/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/racket">Racket</a><a href="https://blog.jverkamp.com/2012/12/30/a-brainfk-interpreter/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2012/12/14/narcissistic-numbers/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a><a href="https://blog.jverkamp.com/2012/12/31/parallel-bf/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/12/14/narcissistic-numbers/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/programming-praxis">Programming Praxis</a><a href="https://blog.jverkamp.com/2013/01/02/happy-new-year/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/11/29/one-billion-primes-segmented-sieve/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/prime-numbers">Prime Numbers</a><a href="https://blog.jverkamp.com/2013/09/14/diffie-hellman-key-exchange/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/12/18/ludum-dare-25-first-favorites/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/12/30/a-brainfk-interpreter/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/12/22/confession-day-51/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/12/23/confession-day-52/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><p><a href="http://programmingpraxis.com/2012/12/21/building-primes/" title="Building Primes">Yesterday&rsquo;s post</a> from Programming Praxis poses an interesting problem: find the largest primeÂ <em>n</em> such that the result of repeatedly removing each digit ofÂ <em>n</em> from left to right is also always prime.</p>

<p>For example, 6317 would be such a number, as not only is it prime, but so are 317, 17, and 7.</p>

<p>This is actually a surprisingly straightforward problem, if instead of starting at the largest such number and checking to make sure that each part along the way is prime, you start with the single digit primes (2, 3, 5, and 7) and repeatedly add on numbers to the left so long as they are prime.</p>

<p>For example, 3 would become 13, 23, 43, 53, 73, and 83. 13 in turn would become 113, 313, and 613. It turns out though that this list doesn&rsquo;t grow unbounded. Eventually each branch will terminate (a proof for why this happens would be interesting, but I&rsquo;m not sure how it would work&ndash;or even if such a thing is provable short of proof by enumerating all of the solutions).</p>

<p>Enough on discussion though, it&rsquo;s code time!</p>

<p>(Only Racket today as I&rsquo;m running a bit short on time for my writeup. If anyone would like a Python version as well, let me know in the comments and I&rsquo;ll write one up.)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; find the largest prime such that each number produced by</span>
<span style="color:#75715e">; removing digits from the left side is still prime</span>
<span style="color:#75715e">; #:root - the prime to start at, 0 for all primes</span>
<span style="color:#75715e">; #:limit - the largest prime to check</span>
(<span style="color:#66d9ef">define </span>(largest-nested-prime
         <span style="color:#f92672">#</span>:root [root <span style="color:#ae81ff">0</span>]
         <span style="color:#f92672">#</span>:limit [limit +inf<span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>])
  <span style="color:#75715e">; loop starting at the root</span>
  (<span style="color:#66d9ef">let </span>loop ([n root])
    (cond
      <span style="color:#75715e">; if we&#39;re over the limit, no largest prime</span>
      [(&gt; n limit) <span style="color:#ae81ff">0</span>]
      <span style="color:#75715e">; otherwise, try each prefixed digit while still prime</span>
      [else
       (<span style="color:#66d9ef">define </span>multiplier (expt <span style="color:#ae81ff">10</span> (digits n)))
       <span style="color:#75715e">; use for/fold to emulate what for/max would do</span>
       (for/fold ([best n])
                 ([i (in-range <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">10</span>)]
                  <span style="color:#f92672">#</span>:when (prime? (+ (* multiplier i) n)))
         <span style="color:#75715e">; return the best of the current and the nested</span>
         (max best (loop (+ (* multiplier i) n))))])))</code></pre></div>
<p>That&rsquo;s a whopping 10 lines of code if you remove the comments and collapse the define back into a single line. Not too bad for what it&rsquo;s calculating.</p>

<p>It takes rather a while to run, but eventually you&rsquo;ll get an answer:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (largest-nested-prime)
<span style="color:#ae81ff">357686312646216567629137</span></code></pre></div>
<p>What I&rsquo;m curious about though, is there a better way to do this? I used the trial division method of determining if a number was prime, but I wonder if either a statistical method or perhaps a sieve would work better. Perhaps it&rsquo;ll be something to try one day if I get bored. ðŸ˜„</p>

<p>One additional thing I did was to work out the nested tree structure that you get with something like this. The code is available at <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/nested-primes.rkt" title="GitHub: Nested primes source">GitHub</a>, but here&rsquo;s a sample run just to whet your appetite:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (nested-primes <span style="color:#f92672">#</span>:root <span style="color:#ae81ff">3</span> <span style="color:#f92672">#</span>:limit <span style="color:#ae81ff">1000</span>)
<span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">3</span>
  (<span style="color:#ae81ff">13</span> (<span style="color:#ae81ff">113</span>) (<span style="color:#ae81ff">313</span>) (<span style="color:#ae81ff">613</span>))
  (<span style="color:#ae81ff">23</span> (<span style="color:#ae81ff">223</span>) (<span style="color:#ae81ff">523</span>) (<span style="color:#ae81ff">823</span>))
  (<span style="color:#ae81ff">43</span> (<span style="color:#ae81ff">443</span>) (<span style="color:#ae81ff">643</span>) (<span style="color:#ae81ff">743</span>))
  (<span style="color:#ae81ff">53</span> (<span style="color:#ae81ff">353</span>) (<span style="color:#ae81ff">653</span>) (<span style="color:#ae81ff">853</span>) (<span style="color:#ae81ff">953</span>))
  (<span style="color:#ae81ff">73</span> (<span style="color:#ae81ff">173</span>) (<span style="color:#ae81ff">373</span>) (<span style="color:#ae81ff">673</span>) (<span style="color:#ae81ff">773</span>))
  (<span style="color:#ae81ff">83</span> (<span style="color:#ae81ff">283</span>) (<span style="color:#ae81ff">383</span>) (<span style="color:#ae81ff">683</span>) (<span style="color:#ae81ff">883</span>) (<span style="color:#ae81ff">983</span>)))</code></pre></div>
<p>Here&rsquo;s a nice chart of that:</p>

<figure>
    <img src="/embeds/2012/3-nested-primes.png"/> 
</figure>


<p>My goal is to generate a list of all such primes and make a graph of them all, just to see if there&rsquo;s any sort of visual pattern. I was going to include that in this post, but I have a feeling that code is going to take more than a little time to generate (and actually returning the list directly isn&rsquo;t probably a good idea as that way it all has to exist in memory at the same time). So I&rsquo;ll probably optimize this and post it again later. Graph visualization is fun!</p>

<p>If you&rsquo;d like to download the full code for today&rsquo;s post, you can do so here: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/nested-primes.rkt" title="GitHub: Nested primes source">nested primes source</a></p></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
