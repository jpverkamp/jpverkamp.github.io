<!doctype html><html><head><title>Nested Primes – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.34a34d86b8aae11b989d80a1626629c053029d012419a1993cfb6c12ea175737.css integrity="sha256-NKNNhriq4RuYnYChYmYpwFMCnQEkGaGZPPtsEuoXVzc="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Nested Primes</h1><div class=entry-meta><span class=entry-date>2012-12-22</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2012/12/14/narcissistic-numbers/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2012/12/30/a-brainfk-interpreter/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2012/12/14/narcissistic-numbers/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2012/12/31/parallel-bf/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2012/12/14/narcissistic-numbers/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/programming-praxis>Programming Praxis</a><a href=https://blog.jverkamp.com/2013/01/02/happy-new-year/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2012/11/29/one-billion-primes-segmented-sieve/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/prime-numbers>Prime Numbers</a><a href=https://blog.jverkamp.com/2013/09/14/diffie-hellman-key-exchange/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2012/12/18/ludum-dare-25-first-favorites/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2012/12/30/a-brainfk-interpreter/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2012/12/22/confession-day-51/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2012/12/23/confession-day-52/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p><a href=http://programmingpraxis.com/2012/12/21/building-primes/ title="Building Primes">Yesterday&rsquo;s post</a> from Programming Praxis poses an interesting problem: find the largest prime <em>n</em> such that the result of repeatedly removing each digit of <em>n</em> from left to right is also always prime.</p><p>For example, 6317 would be such a number, as not only is it prime, but so are 317, 17, and 7.</p><p>This is actually a surprisingly straightforward problem, if instead of starting at the largest such number and checking to make sure that each part along the way is prime, you start with the single digit primes (2, 3, 5, and 7) and repeatedly add on numbers to the left so long as they are prime.</p><p>For example, 3 would become 13, 23, 43, 53, 73, and 83. 13 in turn would become 113, 313, and 613. It turns out though that this list doesn&rsquo;t grow unbounded. Eventually each branch will terminate (a proof for why this happens would be interesting, but I&rsquo;m not sure how it would work&ndash;or even if such a thing is provable short of proof by enumerating all of the solutions).</p><p>Enough on discussion though, it&rsquo;s code time!</p><p>(Only Racket today as I&rsquo;m running a bit short on time for my writeup. If anyone would like a Python version as well, let me know in the comments and I&rsquo;ll write one up.)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; find the largest prime such that each number produced by</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; removing digits from the left side is still prime</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; #:root - the prime to start at, 0 for all primes</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; #:limit - the largest prime to check</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>largest-nested-prime</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>#</span>:root [root <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>         <span style=color:#f92672>#</span>:limit [limit +inf<span style=color:#f92672>.</span><span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>  <span style=color:#75715e>; loop starting at the root</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>loop ([n root])
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; if we&#39;re over the limit, no largest prime</span>
</span></span><span style=display:flex><span>      [(&gt; n limit) <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>      <span style=color:#75715e>; otherwise, try each prefixed digit while still prime</span>
</span></span><span style=display:flex><span>      [else
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>define </span>multiplier (expt <span style=color:#ae81ff>10</span> (<span style=color:#a6e22e>digits</span> n)))
</span></span><span style=display:flex><span>       <span style=color:#75715e>; use for/fold to emulate what for/max would do</span>
</span></span><span style=display:flex><span>       (<span style=color:#a6e22e>for/fold</span> ([best n])
</span></span><span style=display:flex><span>                 ([i (<span style=color:#a6e22e>in-range</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>10</span>)]
</span></span><span style=display:flex><span>                  <span style=color:#f92672>#</span>:when (<span style=color:#a6e22e>prime?</span> (+ (* multiplier i) n)))
</span></span><span style=display:flex><span>         <span style=color:#75715e>; return the best of the current and the nested</span>
</span></span><span style=display:flex><span>         (max best (<span style=color:#a6e22e>loop</span> (+ (* multiplier i) n))))])))
</span></span></code></pre></div><p>That&rsquo;s a whopping 10 lines of code if you remove the comments and collapse the define back into a single line. Not too bad for what it&rsquo;s calculating.</p><p>It takes rather a while to run, but eventually you&rsquo;ll get an answer:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>largest-nested-prime</span>)
</span></span><span style=display:flex><span><span style=color:#ae81ff>357686312646216567629137</span>
</span></span></code></pre></div><p>What I&rsquo;m curious about though, is there a better way to do this? I used the trial division method of determining if a number was prime, but I wonder if either a statistical method or perhaps a sieve would work better. Perhaps it&rsquo;ll be something to try one day if I get bored. &#x1f604;</p><p>One additional thing I did was to work out the nested tree structure that you get with something like this. The code is available at <a href=https://github.com/jpverkamp/small-projects/blob/master/blog/nested-primes.rkt title="GitHub: Nested primes source">GitHub</a>, but here&rsquo;s a sample run just to whet your appetite:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>nested-primes</span> <span style=color:#f92672>#</span>:root <span style=color:#ae81ff>3</span> <span style=color:#f92672>#</span>:limit <span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>&#39;</span>(<span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  (<span style=color:#ae81ff>13</span> (<span style=color:#ae81ff>113</span>) (<span style=color:#ae81ff>313</span>) (<span style=color:#ae81ff>613</span>))
</span></span><span style=display:flex><span>  (<span style=color:#ae81ff>23</span> (<span style=color:#ae81ff>223</span>) (<span style=color:#ae81ff>523</span>) (<span style=color:#ae81ff>823</span>))
</span></span><span style=display:flex><span>  (<span style=color:#ae81ff>43</span> (<span style=color:#ae81ff>443</span>) (<span style=color:#ae81ff>643</span>) (<span style=color:#ae81ff>743</span>))
</span></span><span style=display:flex><span>  (<span style=color:#ae81ff>53</span> (<span style=color:#ae81ff>353</span>) (<span style=color:#ae81ff>653</span>) (<span style=color:#ae81ff>853</span>) (<span style=color:#ae81ff>953</span>))
</span></span><span style=display:flex><span>  (<span style=color:#ae81ff>73</span> (<span style=color:#ae81ff>173</span>) (<span style=color:#ae81ff>373</span>) (<span style=color:#ae81ff>673</span>) (<span style=color:#ae81ff>773</span>))
</span></span><span style=display:flex><span>  (<span style=color:#ae81ff>83</span> (<span style=color:#ae81ff>283</span>) (<span style=color:#ae81ff>383</span>) (<span style=color:#ae81ff>683</span>) (<span style=color:#ae81ff>883</span>) (<span style=color:#ae81ff>983</span>)))
</span></span></code></pre></div><p>Here&rsquo;s a nice chart of that:</p><figure><img src=/embeds/2012/3-nested-primes.png></figure><p>My goal is to generate a list of all such primes and make a graph of them all, just to see if there&rsquo;s any sort of visual pattern. I was going to include that in this post, but I have a feeling that code is going to take more than a little time to generate (and actually returning the list directly isn&rsquo;t probably a good idea as that way it all has to exist in memory at the same time). So I&rsquo;ll probably optimize this and post it again later. Graph visualization is fun!</p><p>If you&rsquo;d like to download the full code for today&rsquo;s post, you can do so here: <a href=https://github.com/jpverkamp/small-projects/blob/master/blog/nested-primes.rkt title="GitHub: Nested primes source">nested primes source</a></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>