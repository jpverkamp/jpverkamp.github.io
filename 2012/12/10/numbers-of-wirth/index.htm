<!DOCTYPE html>
<html>
<head>
        
        

        <title>Numbers of Wirth | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" defer></script>
        <script src="//code.jquery.com/ui/1.11.1/jquery-ui.min.js" defer></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" defer />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" defer />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" defer></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" defer />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js" defer></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js" defer></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/obsidian.css" defer />
        <script src="/highlight/highlight.pack.js" defer></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" defer />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js" defer ></script>

        <!-- Pretty pretty fonts -->
        <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Calligraffitti" defer />

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" defer />
        <script src="/custom.js" defer></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/" />
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="//blog.jverkamp.com"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="//blog.jverkamp.com/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/archives/2004">2004</a></li><li><a href="//blog.jverkamp.com/category/archives/2005">2005</a></li><li><a href="//blog.jverkamp.com/category/archives/2006">2006</a></li><li><a href="//blog.jverkamp.com/category/archives/2007">2007</a></li><li><a href="//blog.jverkamp.com/category/archives/2008">2008</a></li><li><a href="//blog.jverkamp.com/category/archives/2009">2009</a></li><li><a href="//blog.jverkamp.com/category/archives/2010">2010</a></li><li><a href="//blog.jverkamp.com/category/archives/2011">2011</a></li><li><a href="//blog.jverkamp.com/category/archives/2012">2012</a></li><li><a href="//blog.jverkamp.com/category/archives/2013">2013</a></li><li><a href="//blog.jverkamp.com/category/archives/2014">2014</a></li><li><a href="//blog.jverkamp.com/category/archives/2015">2015</a></li><li><a href="//blog.jverkamp.com/category/archives/2016">2016</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="//blog.jverkamp.com/category/other/book-reviews">Book Reviews</a></li><li><a href="//blog.jverkamp.com/category/other/cooking">Cooking</a></li><li><a href="//blog.jverkamp.com/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/photography/dp-challenge">DP Challenge</a></li><li><a href="//blog.jverkamp.com/category/photography/photosets">Photosets</a></li><li><a href="//blog.jverkamp.com/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/programming/by-language">By Language</a></li><li><a href="//blog.jverkamp.com/category/programming/by-project">By Project</a></li><li><a href="//blog.jverkamp.com/category/programming/by-source">By Source</a></li><li><a href="//blog.jverkamp.com/category/programming/by-topic">By Topic</a></li><li><a href="//blog.jverkamp.com/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/research/by-topic">By Topic</a></li><li><a href="//blog.jverkamp.com/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/writing/by-genre">By Genre</a></li><li><a href="//blog.jverkamp.com/category/writing/ideas">Ideas</a></li><li><a href="//blog.jverkamp.com/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="//blog.jverkamp.com/category/writing/novels">Novels</a></li><li><a href="//blog.jverkamp.com/category/writing/other">Other</a></li><li><a href="//blog.jverkamp.com/category/writing/short-stories">Short Stories</a></li><li><a href="//blog.jverkamp.com/category/writing/writing-excuses">Writing Excuses</a></li></ul></li></ul>

      <form action="//www.google.com/search" method="get" onSubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input name="q" type="hidden" />
          <input name="qfront" type="text" class="form-control" placeholder="Search" />
          <button type="submit" class="btn btn-default" value="Search">Search</button>
        </p>
      </form>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Numbers of Wirth</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2012-12-10"><span class="year">2012</span> <span class="month">Dec</span> <span class="day">10</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="//blog.jverkamp.com/category/programming">Programming</a></li><li><a href="//blog.jverkamp.com/category/programming/by-source/programming-praxis">Programming Praxis</a></li><li><a href="//blog.jverkamp.com/category/programming/by-language/python">Python</a></li><li><a href="//blog.jverkamp.com/category/programming/by-language/racket">Racket</a></li><li><a href="//blog.jverkamp.com/category/programming/by-language/scheme">Scheme</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <p>Niklaus Wirth gave the following problem back in 1973:</p>
<blockquote>Develop a program that generates in ascending order the least 100 numbers of the set M, where M is defined as follows:

a) The number 1 is in M.

b) If x is in M, then y = 2 * x + 1 and z = 3 * x + 1 are also in M.

c) No other numbers are in M.</blockquote>
<p>(via <a href="http://programmingpraxis.com/2012/12/07/wirth-problem-15-12/" title="Programming Praxis: Wirth Problem 15.12">Programming Praxis</a>)</p>
<p>It's an interesting enough problem, so let's work out a few different ways of doing it.</p>
<!--more-->
<p>First, there's the simple, brute force method. Start by writing a recursive definition to check if a number is a 'Wirth number' by reversing the two equations given in part b of the definition:</p>
<p>In Scheme:</p>
<pre class="scheme"><code>; recursively determine if a number is a wirth number
(define (wirth? n)
  (and (positive? n)
       (integer? n)
       (or (= n 1)
           (wirth? (/ (- n 1) 2))
           (wirth? (/ (- n 1) 3)))))</code></pre>
<p>And Python:</p>
<pre class="python"><code>def is_wirth(n):
        '''Recursively determine if a number is a wirth number'''

        if n &lt; 0 or n != int(n):
                return False
        elif n == 1:
                return True
        else:
                return is_wirth((n - 1) / 2.0) or is_wirth((n - 1) / 3.0)</code></pre>
<p>With something like that, it would be easy enough to write a loop in either language that just starts at 1 and checks every number:</p>
<p>Scheme:</p>
<pre class="scheme"><code>; list the first n wirth numbers
(define (n-wirth n)
  (let loop ([i 1] [cnt 0])
    (cond
      [(= cnt n) '()]
      [(wirth? i) (cons i (loop (+ i 1) (+ cnt 1)))]
      [else (loop (+ i 1) cnt)])))</code></pre>
<p>Python:</p>
<pre class="python"><code>def n_wirth(n):
        '''List the first n wirth numbers'''

        ls = []
        i = 1
        while len(ls) &lt; n:
                if is_wirth(i):
                        ls.append(i)
                i += 1

        return ls</code></pre>
<p>Easy enough, and for the case of <code>n=100</code>, it runs pretty much instantly:</p>
<pre class="scheme"><code>&gt; (time (n-wirth 100))
cpu time: 0 real time: 1 gc time: 0
'(1    3    4    7    9    10   13   15   19   21
  22   27   28   31   39   40   43   45   46   55
  57   58   63   64   67   79   81   82   85   87
  91   93   94   111  115  117  118  121  127  129
  130  135  136  139  159  163  165  166  171  172
  175  183  187  189  190  193  202  223  231  235
  237  238  243  244  247  255  256  259  261  262
  271  273  274  279  280  283  319  327  331  333
  334  343  345  346  351  352  355  364  367  375
  379  381  382  387  388  391  405  406  409  418)</code></pre>
<p>In fact, even until the first 10,000 such numbers it's still pretty fast:</p>
<pre class="scheme"><code>&gt; (time (n-wirth 10000))
cpu time: 670 real time: 700 gc time: 63
'(...)</code></pre>
<p>So why even bother doing better? Because we can!</p>
<p>The next step would be to realize that we're redoing a lot of the work in <code>is_wirth</code> / <code>wirth?</code>. This should look like the perfect opportunity to use memorization, which I just so happen to have posted about both in <a href="//blog.jverkamp.com/2012/09/29/pickles-and-memoization">Python</a> and <a href="//blog.jverkamp.com/2012/10/20/memoization-in-racket">Racket</a>.</p>
<p>Make those changes and run it again:</p>
<pre class="scheme"><code>&gt; (time (n-wirth 10000))
cpu time: 218 real time: 213 gc time: 0
'(...)</code></pre>
<p>Three times faster. None too shabby, particularly for such a relatively small runtime as it is. But there's still at least two (fairly obvious) ways to do it!</p>
<p>The next would be to use generators. This solution got a bit strange, so I only have a Python version. The basic idea is that for any number, we want to be able to generate the two branches of Wirth numbers from that number, merging them as we go. So first, let's start with a function that can merge two generators into a new generator (removing duplicates):</p>
<pre class="python"><code>def merge_generators(g1, g2):
        '''Merge two numeric generators in increasing order.'''

        n1 = g1.next()
        n2 = g2.next()
        while True:
                if n1 &lt; n2:
                        yield n1
                        n1 = g1.next()
                elif n1 &gt; n2:
                        yield n2
                        n2 = g2.next()
                else:
                        yield n1
                        n1 = g1.next()
                        n2 = g2.next()</code></pre>
<p>So for example, if we have generators for multiples of two and three:</p>
<pre class="python"><code>def take(gen, n):
        '''Take the first n items from a generator.'''
        ls = []
        while len(ls) &lt; n:
                ls.append(gen.next())
        return ls

def multiples_of(n):
        '''Return multiples of n, starting at n.'''
        i = n
        while True:
                yield i
                i += n

&gt;&gt;&gt; take(merge_generators(multiples_of(2), multiples_of(3)), 20)
[2, 3, 4, 6, 8, 9, 10, 12, 14, 15, 16, 18, 20, 21, 22, 24, 26, 27, 28, 30]</code></pre>
<p>So how do we put that all together?</p>
<pre class="python"><code>def wirth_gen(n):
        '''A generator for wirth numbers.'''
        yield n
        for i in merge_generators(wirth_gen(2 * n + 1), wirth_gen(3 * n + 1)):
                yield i</code></pre>
<p>So you yield the number that you're at, then you merge the two generators. Straight forward enough. And we can use the <code>take</code> function from above to generate the first <code>n</code>:</p>
<pre class="python"><code>def gen_n_wirth(n):
        '''List the first n wirth numbers using generators'''
        return take(wirth_gen(1), n)</code></pre>
<p>I have to admit, I think that's the most nested generator I've ever written. In practice though, it's faster than either of the previous Racket versions, taking only 160ms to generate the first 10,000 numbers in the sequence.</p>
<p>Two more options and I think I'll call it a day. The first is based pretty much directly on the sieves that I used in my original <a href="//blog.jverkamp.com/2012/11/01/the-sum-of-the-first-billion-primes">billion primes post</a>. Basically, create a list of natural numbers. Starting at the bottom, we'll check off the Wirth numbers, returning them as we go. The only problem is that we don't have a solid upper bound (as we did with the primes). So we'll just ask the user to supply one. Here's the code:</p>
<p>Racket:</p>
<pre class="scheme"><code>; list the first n wirth numbers with a sieve
(define (sieve-n-wirth n sieve-size)
  (define sieve (make-vector sieve-size #f))
  (vector-set! sieve 1 #t)
  (take
   (for/list ([i (in-range sieve-size)]
              #:when (vector-ref sieve i))
     (when (&lt; (+ (* 2 i) 1) sieve-size)
       (vector-set! sieve (+ (* 2 i) 1) #t))
     (when (&lt; (+ (* 3 i) 1) sieve-size)
       (vector-set! sieve (+ (* 3 i) 1) #t))
     i)
   n))</code></pre>
<p>Python:</p>
<pre class="python"><code>def sieve_n_wirth(n, size):
        '''Generate the first n wirth numbers using a sieve.'''

        sieve = [False for i in xrange(size)]
        sieve[1] = True
        ls = []
        for i in xrange(size):
                if sieve[i]:
                        ls.append(i)
                        if 2 * i + 1 &lt; size: sieve[2 * i + 1] = True
                        if 3 * i + 1 &lt; size: sieve[3 * i + 1] = True
                        if len(ls) == n:
                                break
        return ls</code></pre>
<p>And timing:</p>
<pre class="scheme"><code>&gt; (time (sieve-n-wirth 10000))
cpu time: 15 real time: 11 gc time: 0
'(...)</code></pre>
<p>I don't think we're going to beat that time.</p>
<p>Last but not least, priority queues / heaps. The general idea is to let the data structure do the work. Since a heap is designed to let you insert items in any order but only pull them back out in order, it's perfect for the task. You can get heaps in Python from <code>heapq</code> and in Racket from <code>data/heap</code>. Here's how you use it (there's a bit of ugliness to remove duplicates):</p>
<p>Racket:</p>
<pre class="scheme"><code>(require data/heap)

; list the first n wirth numbers with a heap
(define (heap-n-wirth n)
  (define heap (make-heap &lt;))
  (heap-add! heap 1)
  (let loop ([n n])
    (cond
      [(zero? n) '()]
      [else
       (define i (heap-min heap))
       (heap-add! heap (+ (* 2 i) 1))
       (heap-add! heap (+ (* 3 i) 1))
       (let loop () ; remove duplicates
         (when (= i (heap-min heap))
           (heap-remove-min! heap)
           (loop)))
       (cons i (loop (- n 1)))])))</code></pre>
<p>Python:</p>
<pre class="python"><code>from heapq import heappop, heappush

def heap_n_wirth(n):
        '''Generate the first n wirth numbers using a heap.'''

        ls = []
        heap = []
        heappush(heap, 1)
        while len(ls) &lt; n:
                i = heappop(heap)
                if not i in ls:
                        ls.append(i)
                        heappush(heap, 2 * i + 1)
                        heappush(heap, 3 * i + 1)
        return ls</code></pre>
<p>And timing:</p>
<pre class="scheme"><code>&gt; (time (heap-n-wirth 10000))
cpu time: 562 real time: 557 gc time: 157
'(...)</code></pre>
<p>And we're back to the original runtime. So the sieved version still wins out.</p>
<p>If you have any particularly different algorithms (or any improvements to my versions above), be sure to let me know in the comments.</p>
<p>As always, you can download the full code for today's post from GitHub: - <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/numbers-of-wirth.py" title="Numbers of wirth source (python)">Python source</a> - <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/numbers-of-wirth.rkt" title="Numbers of wirth source (Racket)">Racket source</a></p>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Numbers of Wirth";
var disqus_url = "http://blog.jverkamp.com/2012/12/10/numbers-of-wirth/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="//blog.jverkamp.com/2012/12/10/confession-day-39">← Confession - Day 39</a></li><li><a href="//blog.jverkamp.com/category/archives">Archives</a></li><li><a href="//blog.jverkamp.com/2012/12/11/life-of-pi">Life of Pi →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="//blog.jverkamp.com/2012/11/29/one-billion-primes-segmented-sieve">← One Billion Primes - Segmented Sieve</a></li><li><a href="//blog.jverkamp.com/category/programming">Programming</a></li><li><a href="//blog.jverkamp.com/2012/12/12/generating-non-repeating-strings">Generating non-repeating strings →</a></li></ul></nav>

                <div class="legal">
                        <a href="//blog.jverkamp.com/feed/atom.xml">feed <img style="border: 0;" src="//blog.jverkamp.com/rss.png" /></a><br />
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.defer=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53688146-1', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>