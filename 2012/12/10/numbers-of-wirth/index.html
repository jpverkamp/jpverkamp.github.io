<!DOCTYPE html>
<html onclick >
<head>
    <title>Numbers of Wirth â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Numbers of Wirth</h1>

        <div class="entry-meta"><span class="entry-date">2012-12-10</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/11/21/list-algorithms-and-efficiency/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2012/12/12/generating-non-repeating-strings/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2012/11/29/one-billion-primes-segmented-sieve/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/racket">Racket</a><a href="https://blog.jverkamp.com/2012/12/12/generating-non-repeating-strings/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2012/11/29/one-billion-primes-segmented-sieve/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a><a href="https://blog.jverkamp.com/2012/12/12/generating-non-repeating-strings/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2012/11/29/one-billion-primes-segmented-sieve/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/programming-praxis">Programming Praxis</a><a href="https://blog.jverkamp.com/2012/12/12/generating-non-repeating-strings/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/11/29/one-billion-primes-segmented-sieve/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/12/12/generating-non-repeating-strings/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2012/12/10/confession-day-39/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2012/12/11/life-of-pi/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><p>Niklaus Wirth gave the following problem back in 1973:</p>

<blockquote>
<p>Develop a program that generates in ascending order the least 100 numbers of the set M, where M is defined as follows:</p>

<p>a) The number 1 is in M.</p>

<p>b) If x is in M, then y = 2 * x + 1 and z = 3 * x + 1 are also in M.</p>

<p>c) No other numbers are in M.</p>
</blockquote>

<p>(via <a href="http://programmingpraxis.com/2012/12/07/wirth-problem-15-12/" title="Programming Praxis: Wirth Problem 15.12">Programming Praxis</a>)</p>

<p>It&rsquo;s an interesting enough problem, so let&rsquo;s work out a few different ways of doing it.</p>

<p>First, there&rsquo;s the simple, brute force method. Start by writing a recursive definition to check if a number is a &lsquo;Wirth number&rsquo; by reversing the two equations given in part b of the definition:</p>

<p>In Scheme:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; recursively determine if a number is a wirth number</span>
(<span style="color:#66d9ef">define </span>(wirth? n)
  (<span style="color:#66d9ef">and </span>(positive? n)
       (integer? n)
       (<span style="color:#66d9ef">or </span>(= n <span style="color:#ae81ff">1</span>)
           (wirth? (/ (- n <span style="color:#ae81ff">1</span>) <span style="color:#ae81ff">2</span>))
           (wirth? (/ (- n <span style="color:#ae81ff">1</span>) <span style="color:#ae81ff">3</span>)))))</code></pre></div>
<p>And Python:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_wirth</span>(n):
	<span style="color:#e6db74">&#39;&#39;&#39;Recursively determine if a number is a wirth number&#39;&#39;&#39;</span>

	<span style="color:#66d9ef">if</span> n <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> n <span style="color:#f92672">!=</span> int(n):
		<span style="color:#66d9ef">return</span> False
	<span style="color:#66d9ef">elif</span> n <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
		<span style="color:#66d9ef">return</span> True
	<span style="color:#66d9ef">else</span>:
		<span style="color:#66d9ef">return</span> is_wirth((n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2.0</span>) <span style="color:#f92672">or</span> is_wirth((n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span>)</code></pre></div>
<p>With something like that, it would be easy enough to write a loop in either language that just starts at 1 and checks every number:</p>

<p>Scheme:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; list the first n wirth numbers</span>
(<span style="color:#66d9ef">define </span>(n-wirth n)
  (<span style="color:#66d9ef">let </span>loop ([i <span style="color:#ae81ff">1</span>] [cnt <span style="color:#ae81ff">0</span>])
    (cond
      [(= cnt n) <span style="color:#f92672">&#39;</span>()]
      [(wirth? i) (cons i (loop (+ i <span style="color:#ae81ff">1</span>) (+ cnt <span style="color:#ae81ff">1</span>)))]
      [<span style="color:#66d9ef">else </span>(loop (+ i <span style="color:#ae81ff">1</span>) cnt)])))</code></pre></div>
<p>Python:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">n_wirth</span>(n):
	<span style="color:#e6db74">&#39;&#39;&#39;List the first n wirth numbers&#39;&#39;&#39;</span>

	ls <span style="color:#f92672">=</span> []
	i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
	<span style="color:#66d9ef">while</span> len(ls) <span style="color:#f92672">&lt;</span> n:
		<span style="color:#66d9ef">if</span> is_wirth(i):
			ls<span style="color:#f92672">.</span>append(i)
		i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

	<span style="color:#66d9ef">return</span> ls</code></pre></div>
<p>Easy enough, and for the case of <code>n=100</code>, it runs pretty much instantly:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (time (n-wirth <span style="color:#ae81ff">100</span>))
cpu time: <span style="color:#ae81ff">0</span> real time: <span style="color:#ae81ff">1</span> gc time: <span style="color:#ae81ff">0</span>  
<span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">3</span>    <span style="color:#ae81ff">4</span>    <span style="color:#ae81ff">7</span>    <span style="color:#ae81ff">9</span>    <span style="color:#ae81ff">10</span>   <span style="color:#ae81ff">13</span>   <span style="color:#ae81ff">15</span>   <span style="color:#ae81ff">19</span>   <span style="color:#ae81ff">21</span>
  <span style="color:#ae81ff">22</span>   <span style="color:#ae81ff">27</span>   <span style="color:#ae81ff">28</span>   <span style="color:#ae81ff">31</span>   <span style="color:#ae81ff">39</span>   <span style="color:#ae81ff">40</span>   <span style="color:#ae81ff">43</span>   <span style="color:#ae81ff">45</span>   <span style="color:#ae81ff">46</span>   <span style="color:#ae81ff">55</span>
  <span style="color:#ae81ff">57</span>   <span style="color:#ae81ff">58</span>   <span style="color:#ae81ff">63</span>   <span style="color:#ae81ff">64</span>   <span style="color:#ae81ff">67</span>   <span style="color:#ae81ff">79</span>   <span style="color:#ae81ff">81</span>   <span style="color:#ae81ff">82</span>   <span style="color:#ae81ff">85</span>   <span style="color:#ae81ff">87</span>
  <span style="color:#ae81ff">91</span>   <span style="color:#ae81ff">93</span>   <span style="color:#ae81ff">94</span>   <span style="color:#ae81ff">111</span>  <span style="color:#ae81ff">115</span>  <span style="color:#ae81ff">117</span>  <span style="color:#ae81ff">118</span>  <span style="color:#ae81ff">121</span>  <span style="color:#ae81ff">127</span>  <span style="color:#ae81ff">129</span>
  <span style="color:#ae81ff">130</span>  <span style="color:#ae81ff">135</span>  <span style="color:#ae81ff">136</span>  <span style="color:#ae81ff">139</span>  <span style="color:#ae81ff">159</span>  <span style="color:#ae81ff">163</span>  <span style="color:#ae81ff">165</span>  <span style="color:#ae81ff">166</span>  <span style="color:#ae81ff">171</span>  <span style="color:#ae81ff">172</span>
  <span style="color:#ae81ff">175</span>  <span style="color:#ae81ff">183</span>  <span style="color:#ae81ff">187</span>  <span style="color:#ae81ff">189</span>  <span style="color:#ae81ff">190</span>  <span style="color:#ae81ff">193</span>  <span style="color:#ae81ff">202</span>  <span style="color:#ae81ff">223</span>  <span style="color:#ae81ff">231</span>  <span style="color:#ae81ff">235</span>
  <span style="color:#ae81ff">237</span>  <span style="color:#ae81ff">238</span>  <span style="color:#ae81ff">243</span>  <span style="color:#ae81ff">244</span>  <span style="color:#ae81ff">247</span>  <span style="color:#ae81ff">255</span>  <span style="color:#ae81ff">256</span>  <span style="color:#ae81ff">259</span>  <span style="color:#ae81ff">261</span>  <span style="color:#ae81ff">262</span>
  <span style="color:#ae81ff">271</span>  <span style="color:#ae81ff">273</span>  <span style="color:#ae81ff">274</span>  <span style="color:#ae81ff">279</span>  <span style="color:#ae81ff">280</span>  <span style="color:#ae81ff">283</span>  <span style="color:#ae81ff">319</span>  <span style="color:#ae81ff">327</span>  <span style="color:#ae81ff">331</span>  <span style="color:#ae81ff">333</span>
  <span style="color:#ae81ff">334</span>  <span style="color:#ae81ff">343</span>  <span style="color:#ae81ff">345</span>  <span style="color:#ae81ff">346</span>  <span style="color:#ae81ff">351</span>  <span style="color:#ae81ff">352</span>  <span style="color:#ae81ff">355</span>  <span style="color:#ae81ff">364</span>  <span style="color:#ae81ff">367</span>  <span style="color:#ae81ff">375</span>
  <span style="color:#ae81ff">379</span>  <span style="color:#ae81ff">381</span>  <span style="color:#ae81ff">382</span>  <span style="color:#ae81ff">387</span>  <span style="color:#ae81ff">388</span>  <span style="color:#ae81ff">391</span>  <span style="color:#ae81ff">405</span>  <span style="color:#ae81ff">406</span>  <span style="color:#ae81ff">409</span>  <span style="color:#ae81ff">418</span>)</code></pre></div>
<p>In fact, even until the first 10,000 such numbers it&rsquo;s still pretty fast:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (time (n-wirth <span style="color:#ae81ff">10000</span>))
cpu time: <span style="color:#ae81ff">670</span> real time: <span style="color:#ae81ff">700</span> gc time: <span style="color:#ae81ff">63</span>
<span style="color:#f92672">&#39;</span>(<span style="color:#f92672">...</span>)</code></pre></div>
<p>So why even bother doing better? Because we can!</p>

<p>The next step would be to realize that we&rsquo;re redoing a lot of the work in <code>is_wirth</code> / <code>wirth?</code>. This should look like the perfect opportunity to use memorization, which I just so happen to have posted about both in <a href="https://blog.jverkamp.com/2012/09/29/pickles-and-memoization/">Python</a> and <a href="https://blog.jverkamp.com/2012/10/20/memoization-in-racket/">Racket</a>.</p>

<p>Make those changes and run it again:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (time (n-wirth <span style="color:#ae81ff">10000</span>))
cpu time: <span style="color:#ae81ff">218</span> real time: <span style="color:#ae81ff">213</span> gc time: <span style="color:#ae81ff">0</span>
<span style="color:#f92672">&#39;</span>(<span style="color:#f92672">...</span>)</code></pre></div>
<p>Three times faster. None too shabby, particularly for such a relatively small runtime as it is. But there&rsquo;s still at least two (fairly obvious) ways to do it!</p>

<p>The next would be to use generators. This solution got a bit strange, so I only have a Python version. The basic idea is that for any number, we want to be able to generate the two branches of Wirth numbers from that number, merging them as we go. So first, let&rsquo;s start with a function that can merge two generators into a new generator (removing duplicates):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">merge_generators</span>(g1, g2):
	<span style="color:#e6db74">&#39;&#39;&#39;Merge two numeric generators in increasing order.&#39;&#39;&#39;</span>

	n1 <span style="color:#f92672">=</span> g1<span style="color:#f92672">.</span>next()
	n2 <span style="color:#f92672">=</span> g2<span style="color:#f92672">.</span>next()
	<span style="color:#66d9ef">while</span> True:
		<span style="color:#66d9ef">if</span> n1 <span style="color:#f92672">&lt;</span> n2:
			<span style="color:#66d9ef">yield</span> n1
			n1 <span style="color:#f92672">=</span> g1<span style="color:#f92672">.</span>next()
		<span style="color:#66d9ef">elif</span> n1 <span style="color:#f92672">&gt;</span> n2:
			<span style="color:#66d9ef">yield</span> n2
			n2 <span style="color:#f92672">=</span> g2<span style="color:#f92672">.</span>next()
		<span style="color:#66d9ef">else</span>:
			<span style="color:#66d9ef">yield</span> n1
			n1 <span style="color:#f92672">=</span> g1<span style="color:#f92672">.</span>next()
			n2 <span style="color:#f92672">=</span> g2<span style="color:#f92672">.</span>next()</code></pre></div>
<p>So for example, if we have generators for multiples of two and three:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">take</span>(gen, n):
	<span style="color:#e6db74">&#39;&#39;&#39;Take the first n items from a generator.&#39;&#39;&#39;</span>
	ls <span style="color:#f92672">=</span> []
	<span style="color:#66d9ef">while</span> len(ls) <span style="color:#f92672">&lt;</span> n:
		ls<span style="color:#f92672">.</span>append(gen<span style="color:#f92672">.</span>next())
	<span style="color:#66d9ef">return</span> ls

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">multiples_of</span>(n):
	<span style="color:#e6db74">&#39;&#39;&#39;Return multiples of n, starting at n.&#39;&#39;&#39;</span>
	i <span style="color:#f92672">=</span> n
	<span style="color:#66d9ef">while</span> True:
		<span style="color:#66d9ef">yield</span> i
		i <span style="color:#f92672">+=</span> n

<span style="color:#f92672">&gt;&gt;&gt;</span> take(merge_generators(multiples_of(<span style="color:#ae81ff">2</span>), multiples_of(<span style="color:#ae81ff">3</span>)), <span style="color:#ae81ff">20</span>)
[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">30</span>]</code></pre></div>
<p>So how do we put that all together?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wirth_gen</span>(n):
	<span style="color:#e6db74">&#39;&#39;&#39;A generator for wirth numbers.&#39;&#39;&#39;</span>
	<span style="color:#66d9ef">yield</span> n
	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> merge_generators(wirth_gen(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>), wirth_gen(<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)):
		<span style="color:#66d9ef">yield</span> i</code></pre></div>
<p>So you yield the number that you&rsquo;re at, then you merge the two generators. Straight forward enough. And we can use the <code>take</code> function from above to generate the first <code>n</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_n_wirth</span>(n):
	<span style="color:#e6db74">&#39;&#39;&#39;List the first n wirth numbers using generators&#39;&#39;&#39;</span>
	<span style="color:#66d9ef">return</span> take(wirth_gen(<span style="color:#ae81ff">1</span>), n)</code></pre></div>
<p>I have to admit, I think that&rsquo;s the most nested generator I&rsquo;ve ever written. In practice though, it&rsquo;s faster than either of the previous Racket versions, taking only 160ms to generate the first 10,000 numbers in the sequence.</p>

<p>Two more options and I think I&rsquo;ll call it a day. The first is based pretty much directly on the sieves that I used in my original <a href="https://blog.jverkamp.com/2012/11/01/the-sum-of-the-first-billion-primes/">billion primes post</a>. Basically, create a list of natural numbers. Starting at the bottom, we&rsquo;ll check off the Wirth numbers, returning them as we go. The only problem is that we don&rsquo;t have a solid upper bound (as we did with the primes). So we&rsquo;ll just ask the user to supply one. Here&rsquo;s the code:</p>

<p>Racket:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; list the first n wirth numbers with a sieve</span>
(<span style="color:#66d9ef">define </span>(sieve-n-wirth n sieve-size)
  (<span style="color:#66d9ef">define </span>sieve (make-vector sieve-size <span style="color:#66d9ef">#f</span>))
  (vector-set! sieve <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">#t</span>)
  (take
   (for/list ([i (in-range sieve-size)]
              <span style="color:#f92672">#</span>:when (vector-ref sieve i))
     (when (&lt; (+ (* <span style="color:#ae81ff">2</span> i) <span style="color:#ae81ff">1</span>) sieve-size)
       (vector-set! sieve (+ (* <span style="color:#ae81ff">2</span> i) <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">#t</span>))
     (when (&lt; (+ (* <span style="color:#ae81ff">3</span> i) <span style="color:#ae81ff">1</span>) sieve-size)
       (vector-set! sieve (+ (* <span style="color:#ae81ff">3</span> i) <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">#t</span>))
     i)
   n))</code></pre></div>
<p>Python:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sieve_n_wirth</span>(n, size):
	<span style="color:#e6db74">&#39;&#39;&#39;Generate the first n wirth numbers using a sieve.&#39;&#39;&#39;</span>

	sieve <span style="color:#f92672">=</span> [False <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> xrange(size)]
	sieve[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> True
	ls <span style="color:#f92672">=</span> []
	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> xrange(size):
		<span style="color:#66d9ef">if</span> sieve[i]:
			ls<span style="color:#f92672">.</span>append(i)
			<span style="color:#66d9ef">if</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span> size: sieve[<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> True
			<span style="color:#66d9ef">if</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span> size: sieve[<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> True
			<span style="color:#66d9ef">if</span> len(ls) <span style="color:#f92672">==</span> n:
				<span style="color:#66d9ef">break</span>
	<span style="color:#66d9ef">return</span> ls</code></pre></div>
<p>And timing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (time (sieve-n-wirth <span style="color:#ae81ff">10000</span>))
cpu time: <span style="color:#ae81ff">15</span> real time: <span style="color:#ae81ff">11</span> gc time: <span style="color:#ae81ff">0</span>
<span style="color:#f92672">&#39;</span>(<span style="color:#f92672">...</span>)</code></pre></div>
<p>I don&rsquo;t think we&rsquo;re going to beat that time.</p>

<p>Last but not least, priority queues / heaps. The general idea is to let the data structure do the work. Since a heap is designed to let you insert items in any order but only pull them back out in order, it&rsquo;s perfect for the task. You can get heaps in Python from <code>heapq</code> and in Racket from <code>data/heap</code>. Here&rsquo;s how you use it (there&rsquo;s a bit of ugliness to remove duplicates):</p>

<p>Racket:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(require data/heap)

<span style="color:#75715e">; list the first n wirth numbers with a heap</span>
(<span style="color:#66d9ef">define </span>(heap-n-wirth n)
  (<span style="color:#66d9ef">define </span>heap (make-heap &lt;))
  (heap-add! heap <span style="color:#ae81ff">1</span>)
  (<span style="color:#66d9ef">let </span>loop ([n n])
    (cond
      [(zero? n) <span style="color:#f92672">&#39;</span>()]
      [else
       (<span style="color:#66d9ef">define </span>i (heap-min heap))
       (heap-add! heap (+ (* <span style="color:#ae81ff">2</span> i) <span style="color:#ae81ff">1</span>))
       (heap-add! heap (+ (* <span style="color:#ae81ff">3</span> i) <span style="color:#ae81ff">1</span>))
       (<span style="color:#66d9ef">let </span>loop () <span style="color:#75715e">; remove duplicates</span>
         (when (= i (heap-min heap))
           (heap-remove-min! heap)
           (loop)))
       (cons i (loop (- n <span style="color:#ae81ff">1</span>)))])))</code></pre></div>
<p>Python:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> heapq <span style="color:#f92672">import</span> heappop, heappush 

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">heap_n_wirth</span>(n):
	<span style="color:#e6db74">&#39;&#39;&#39;Generate the first n wirth numbers using a heap.&#39;&#39;&#39;</span>

	ls <span style="color:#f92672">=</span> []
	heap <span style="color:#f92672">=</span> []
	heappush(heap, <span style="color:#ae81ff">1</span>)
	<span style="color:#66d9ef">while</span> len(ls) <span style="color:#f92672">&lt;</span> n:
		i <span style="color:#f92672">=</span> heappop(heap)
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> i <span style="color:#f92672">in</span> ls:
			ls<span style="color:#f92672">.</span>append(i)
			heappush(heap, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
			heappush(heap, <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
	<span style="color:#66d9ef">return</span> ls</code></pre></div>
<p>And timing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (time (heap-n-wirth <span style="color:#ae81ff">10000</span>))
cpu time: <span style="color:#ae81ff">562</span> real time: <span style="color:#ae81ff">557</span> gc time: <span style="color:#ae81ff">157</span>
<span style="color:#f92672">&#39;</span>(<span style="color:#f92672">...</span>)</code></pre></div>
<p>And we&rsquo;re back to the original runtime. So the sieved version still wins out.</p>

<p>If you have any particularly different algorithms (or any improvements to my versions above), be sure to let me know in the comments.</p>

<p>As always, you can download the full code for today&rsquo;s post from GitHub:
- <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/numbers-of-wirth.py" title="Numbers of wirth source (python)">Python source</a>
- <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/numbers-of-wirth.rkt" title="Numbers of wirth source (Racket)">Racket source</a></p></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Numbers of Wirth";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2012\/12\/10\/numbers-of-wirth\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
