<!DOCTYPE html>
<html>
<head>
    <title>
    The Evolution Of Flibs â€“ jverkamp.com
</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css">

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />


    
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper">
        <header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
        
            
        
            
            <li><a href="https://blog.jverkamp.com/photography/">Photography</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/programming/">Programming</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/research/">Research</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/writing/">Writing</a></li>
            
        
            <li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>


        <div id="page-content-wrapper">
            <div id="page-content">
            
<article>
	<header>
		<h1 class="entry-title">The Evolution Of Flibs</h1>

        <div class="entry-meta">
            
            <span class="entry-date">2012-10-18</span>
            
            
        </div>

        <div class="entry-tags">
    
    

    <ul class="taxonomy-keys">
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2012/10/17/rule-30-rng/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/racket">Racket</a>
                        <a href="https://blog.jverkamp.com/2012/10/20/memoization-in-racket/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2012/10/17/rule-30-rng/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a>
                        <a href="https://blog.jverkamp.com/2012/10/20/memoization-in-racket/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2012/10/17/rule-30-rng/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/sources/programming-praxis">Programming Praxis</a>
                        <a href="https://blog.jverkamp.com/2012/10/20/memoization-in-racket/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                            
                        
                    

                    
                    

                    <li>
                        
                        <a class="taxonomy-value" href="/programming/topics/genetic-algorithms">Genetic Algorithms</a>
                        
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    

    
        
        <li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2012/10/17/rule-30-rng/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2012/10/19/small-projects-source-code-on-github/" class="next-link">Next</a>
                
            </ul>
        </li>
        

        
        <li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2012/10/17/rule-30-rng/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2012/10/19/a-sea-of-stars---ch.-16---collision/" class="next-link">Next</a>
                
            </ul>
        </li>
        
    
    </ul>
</div>

    </header>

	<div class="entry-content">
		<p>In the past, I absolutely loved messing around with <a href="https://en.wikipedia.org/wiki/Genetic%20algorithm">genetic algorithms</a>. The idea of bringing the power of natural selection to bear to solve all manner of problems just appeals to me for some reason. So when I came across a puzzle on on Programming Praxis called <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/flibs.rkt">flibs source code</a></p>

<p>The eventual goal will be&ndash;given a binary sequence&ndash;to evolve a finite state machine that will recognize the sequence and output the same, offset by one. So if we&rsquo;re given the sequence <code>010011010011</code>, the solution will output something like this: <code>001001101001</code>.</p>

<p>So what do we need to do this? First, we need a way to represent the finite automaton. We&rsquo;re just going to directly go with what they suggested in the post and build machines with three states. So for example, this would be a valid machine:</p>

<table>
<thead>
<tr>
<th></th>
<th>Input 0</th>
<th></th>
<th>Input 1</th>
<th></th>
</tr>
</thead>

<tbody>
<tr>
<td>A</td>
<td>1</td>
<td>B</td>
<td>1</td>
<td>C</td>
</tr>

<tr>
<td>B</td>
<td>0</td>
<td>C</td>
<td>0</td>
<td>B</td>
</tr>

<tr>
<td>C</td>
<td>1</td>
<td>A</td>
<td>0</td>
<td>A</td>
</tr>
</tbody>
</table>

<p>Which is equivalent to this diagram:</p>


<figure >
    
        <img src="/embeds/2012/FSA-diagram.png" />
    
    
</figure>


<p>So how can we represent this in code? I went with a vector just writing straight across the rows and then down the columns. So the chart represented above then becomes this vector:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#f92672">&#39;#</span>(<span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> A)</code></pre></div>
<p>Given a flib and an input (also represented as a vector), how do we generate the output?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; run a flib on a given input</span>
(<span style="color:#66d9ef">define </span>(run-flib flib input)
  <span style="color:#75715e">; turn a state into a number</span>
  (<span style="color:#66d9ef">define </span>(f s) (<span style="color:#66d9ef">case </span>s [(A) <span style="color:#ae81ff">0</span>] [(B) <span style="color:#ae81ff">1</span>] [(C) <span style="color:#ae81ff">2</span>]))

  <span style="color:#75715e">; initial state</span>
  (<span style="color:#66d9ef">define </span>state <span style="color:#e6db74">&#39;A</span>)

  <span style="color:#75715e">; loop over the flip, update state and report output</span>
  (for/vector ([this input])
    (<span style="color:#66d9ef">let </span>([next (vector-ref flib (+ (* (f state) <span style="color:#ae81ff">4</span>) (* this <span style="color:#ae81ff">2</span>) <span style="color:#ae81ff">1</span>))]
          [output (vector-ref flib (+ (* (f state) <span style="color:#ae81ff">4</span>) (* this <span style="color:#ae81ff">2</span>)))])
      (<span style="color:#66d9ef">set! </span>state next)
      output)))</code></pre></div>
<p>Basically, keep a mutable state starting at <code>A</code>. At each tick, pull apart the rows in the vector structure from above to get the output for the current state and input, along with the next input. Each enough, but still nothing like a genetic algorithm.</p>

<p>The general idea of the algorithm is to generate a random initial population then repeatedly mutate and breed those individuals until the population improves enough to find an optimal solution. So the first thing we need is a way to generate random flibs. Easy enough with <code>for/vector</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; generate a random flib</span>
<span style="color:#75715e">; a flib is a state machine of the form</span>
<span style="color:#75715e">;   0  1</span>
<span style="color:#75715e">; A 1B 1C</span>
<span style="color:#75715e">; B 0C 0B</span>
<span style="color:#75715e">; C 1A 0A =&gt; 1B1C0C0B1A0A</span>
(<span style="color:#66d9ef">define </span>(random-flib)
  (for/vector ([i <span style="color:#ae81ff">12</span>])
    (<span style="color:#66d9ef">if </span>(even? i)
        (random <span style="color:#ae81ff">2</span>)
        (vector-ref <span style="color:#f92672">&#39;#</span>(A B C) (random <span style="color:#ae81ff">3</span>)))))</code></pre></div>
<p>After that, we need to calculate the fitness of each individual in the population. The strongest individuals will survive, the weaker ones will die off. So here&rsquo;s a function that will take an flib and an input vector, run the flib using the function above, and then measure the difference (offset by 1 as noted above).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; score a flib by calculating it&#39;s output, shifting one right</span>
<span style="color:#75715e">; and counting differences</span>
(<span style="color:#66d9ef">define </span>(score-flib flib input)
  (<span style="color:#66d9ef">define </span>output (run-flib flib input))
  (- <span style="color:#ae81ff">1.0</span> (/ (for/sum ([i (- (vector-length input) <span style="color:#ae81ff">1</span>)])
              (abs (- (vector-ref input (+ i <span style="color:#ae81ff">1</span>))
                      (vector-ref output i))))
            (- (vector-length input) <span style="color:#ae81ff">1</span>))))</code></pre></div>
<p>That&rsquo;s enough to tell us which the stronger individuals are, but how do we use that to improve the population? Two different ways. First, we want to be able to take two individuals together and &ldquo;breed&rdquo; them. In the example given, they suggested breeding the strongest and weakest individual and using that to replace the weakest, but there are many possible strategies. The one I went for was to remove the lowest (given) number from a population and then breeding surviving members at random to get back to the original population size. We&rsquo;ll see that later in the <code>run</code> function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; breed two flibs by selecting a crossover point and merging input</span>
(<span style="color:#66d9ef">define </span>(breed flib1 flib2)
  (<span style="color:#66d9ef">define </span>@ (random (vector-length flib1)))
  (for/vector ([i (vector-length flib1)]
               [c1 flib1]
               [c2 flib2])
    (<span style="color:#66d9ef">if </span>(&lt; i @) c1 c2)))</code></pre></div>
<p>The other option for advancement will mostly be used to break out of local optimums. With just crossovers, eventually a population is likely to stagnate as the individuals become too similar. So here we&rsquo;ll occasionally mutate an flib by randomly tweaking one of the genes therein.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; mutate a flib by random altering one character</span>
(<span style="color:#66d9ef">define </span>(mutate flib)
  (<span style="color:#66d9ef">define </span>@ (random (vector-length flib)))
  (for/vector ([i (vector-length flib)]
               [c flib])
    (<span style="color:#66d9ef">if </span>(= @ i)
        (<span style="color:#66d9ef">if </span>(symbol? c)
            (vector-ref <span style="color:#f92672">&#39;#</span>(A B C) (random <span style="color:#ae81ff">3</span>))
            (random <span style="color:#ae81ff">2</span>))
        c)))</code></pre></div>
<p>And with that, we&rsquo;re as good as done. I added a few more functions to help, for example to turn a string into a vector like the ones we want, which you can here: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/flibs.rkt">flibs source code</a>. And without further ado, here&rsquo;s the main function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; use a genetic algorithm to find a perfect flib</span>
(<span style="color:#66d9ef">define </span>(run input
             [pool-size <span style="color:#ae81ff">12</span>]  <span style="color:#75715e">; number of flibs to breed</span>
             [kill-off <span style="color:#ae81ff">2</span>]    <span style="color:#75715e">; remove the lowest this many flibs each generation</span>
                             <span style="color:#75715e">;   refill by breeding two random surviving flibs</span>
             [mutate-% <span style="color:#ae81ff">0.1</span>]) <span style="color:#75715e">; mutate this percentage of flibs each generation</span>

  <span style="color:#75715e">; sort a pool by a given criteria</span>
  (<span style="color:#66d9ef">define </span>(sort-pool pool)
    (sort 
     pool
     (<span style="color:#66d9ef">lambda </span>(p1 p2) (&gt; (car p1) (car p2)))))

  <span style="color:#75715e">; iterate until we have a winner</span>
  (<span style="color:#66d9ef">let </span>loop ([pool (sort-pool
                    (for/list ([i pool-size]) 
                      (<span style="color:#66d9ef">let </span>([flib (random-flib)])
                        (list (score-flib flib input) flib))))]
             [high-score <span style="color:#ae81ff">0</span>])

    <span style="color:#75715e">; find a new maximum</span>
    (<span style="color:#66d9ef">define </span>new-max (&gt; (caar pool) high-score))
    (<span style="color:#66d9ef">define </span>next-high-score (<span style="color:#66d9ef">if </span>new-max (caar pool) high-score))
    (<span style="color:#66d9ef">define </span>high-flib (cadar pool))

    <span style="color:#75715e">; display progress</span>
    (when new-max
      (printf <span style="color:#e6db74">&#34;new best flib: ~s scoring ~s\n&#34;</span> high-flib next-high-score))

    <span style="color:#75715e">; loop (or not)</span>
    (<span style="color:#66d9ef">if </span>(&lt; next-high-score <span style="color:#ae81ff">1</span>)
        (loop       
         <span style="color:#75715e">; kill off and replace the lowest performing flibs for the new pool</span>
         (sort-pool
          (append
           <span style="color:#75715e">; add new flibs by breeding the old ones</span>
           (for/list ([i kill-off]) 
             (<span style="color:#66d9ef">let </span>([flib1 (cadr (list-ref pool (- pool-size kill-off)))]
                   [flib2 (cadr (list-ref pool (- pool-size kill-off)))])
               (<span style="color:#66d9ef">let </span>([flib3 (breed flib1 flib2)])
                 (list (score-flib flib3 input) flib3))))
           <span style="color:#75715e">; randomly mutate surviving flibs the given percent of the time</span>
           (for/list ([sflib (drop (reverse pool) kill-off)])
             (<span style="color:#66d9ef">if </span>(&lt; (random) mutate-%)
                 (<span style="color:#66d9ef">let </span>([f (mutate (cadr sflib))])
                   (list (score-flib f input) f))
                 sflib))))
         next-high-score)

        high-flib)))</code></pre></div>
<p>Hopefully it should be pretty self explanatory, particularly with the comments I&rsquo;ve included, but there are definitely some more interesting bits. For example, the <code>pool</code> is going to be maintained as a list of pairs. Each pair has the score of an flib and then the flib in question to make sorting easier (without recalculating the score whenever we want to sort).</p>

<p>The next interesting part is the loop. Each iteration, we&rsquo;ll have a sorted list, so we&rsquo;ll check for the highest scoring flib currently in the pool. If it&rsquo;s better than what we&rsquo;ve seen, print that out and remember it. Otherwise, just keep going.</p>

<p>The bulk of work of updating the generation takes place in the recursive call to <code>loop</code>. We&rsquo;ll use <code>drop</code> to remove the weakest parts of the population (after a <code>reverse</code> so that they&rsquo;re at the front of the list) and then append on the newly bred members with their randomly selected parents.</p>

<p>And that&rsquo;s actually all there is to it. Here&rsquo;s an example of running it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (run (string-&gt;input (repeat-string <span style="color:#e6db74">&#34;010011&#34;</span> <span style="color:#ae81ff">5</span>)))
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> A) scoring <span style="color:#ae81ff">0.8275862068965517</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> A) scoring <span style="color:#ae81ff">0.8620689655172413</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">0</span> B) scoring <span style="color:#ae81ff">0.9655172413793104</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">0</span> B) scoring <span style="color:#ae81ff">1.0</span>
<span style="color:#f92672">&#39;#</span>(<span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">0</span> B)</code></pre></div>
<p>Not the same machine we had above, but they both represent the string. If we run the same thing again, we&rsquo;re likely to get another equivalent result:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (run (string-&gt;input (repeat-string <span style="color:#e6db74">&#34;010011&#34;</span> <span style="color:#ae81ff">5</span>)))
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">1</span> C) scoring <span style="color:#ae81ff">0.6551724137931034</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> A) scoring <span style="color:#ae81ff">0.6896551724137932</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">1</span> B) scoring <span style="color:#ae81ff">0.8275862068965517</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> B) scoring <span style="color:#ae81ff">0.8620689655172413</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">0</span> B) scoring <span style="color:#ae81ff">0.9655172413793104</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">0</span> A) scoring <span style="color:#ae81ff">1.0</span>
<span style="color:#f92672">&#39;#</span>(<span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">0</span> A)</code></pre></div>
<p>Alternatively, we can tweak the other parameters. Say we wanted a larger population with a <sup>1</sup>&frasl;<sub>5</sub> killoff rate and twice the mutation rate:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (run (string-&gt;input (repeat-string <span style="color:#e6db74">&#34;010011&#34;</span> <span style="color:#ae81ff">5</span>)) <span style="color:#ae81ff">25</span> <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0.2</span>)
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">1</span> A) scoring <span style="color:#ae81ff">0.6896551724137932</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> A) scoring <span style="color:#ae81ff">0.8275862068965517</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> B) scoring <span style="color:#ae81ff">0.8620689655172413</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">1</span> B <span style="color:#ae81ff">0</span> C) scoring <span style="color:#ae81ff">0.9655172413793104</span>
new best flib: <span style="color:#f92672">#</span>(<span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> B) scoring <span style="color:#ae81ff">1.0</span>
<span style="color:#f92672">&#39;#</span>(<span style="color:#ae81ff">1</span> A <span style="color:#ae81ff">0</span> B <span style="color:#ae81ff">0</span> C <span style="color:#ae81ff">0</span> A <span style="color:#ae81ff">1</span> C <span style="color:#ae81ff">1</span> B)</code></pre></div>
<p>That&rsquo;s one of the fun parts about genetic algorithms is tuning the parameters. Any given problem can have vastly different sets of optimal parameters.</p>

<p>In any case, that&rsquo;s all I have for now. I&rsquo;ve started working on a version that will generalize to any string (with only three states, this can only recognize strings with a limited length), but progress is proving rocky. We&rsquo;ll see how it goes.</p>

<p>If you would like the source code, you can get it here: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/flibs.rkt">flibs source code</a></p>

<p>If you have any questions or comments, drop me a line below.</p>

	</div>

    
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "The Evolution Of Flibs";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2012\/10\/18\/the-evolution-of-flibs\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>


</article>

            </div>
        </div>

        <footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>

            
            <li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>
            
        </ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js"></script>

<script type="text/javascript" src="/custom.js" defer></script>

</body>
</html>
