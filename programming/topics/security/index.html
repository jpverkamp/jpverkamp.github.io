<!doctype html><html><head><title>Programming, Topic:
Security - jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><h1 class=entry-title data-pagefind-meta=title>Programming, Topic:
Security</h1><div class=entry-content></div><h2>All posts</h2><ul><li><span class=entry-date>2025-07-25</span>:
<a href=https://blog.jverkamp.com/2025/07/25/using-csp-unsafe-hashes/>Using CSP unsafe-hashes</a></li><li><span class=entry-date>2023-11-14</span>:
<a href=https://blog.jverkamp.com/2023/11/14/rebuilding-streams-with-tshark/>Rebuilding Streams with TShark</a></li><li><span class=entry-date>2023-11-09</span>:
<a href=https://blog.jverkamp.com/2023/11/09/sqlite-metadata-via-sql-injection/>SQLite Metadata via SQL Injection</a></li><li><span class=entry-date>2023-11-07</span>:
<a href=https://blog.jverkamp.com/2023/11/07/mongo-db-data-exfiltration-via-search-conditions/>Mongo DB Data Exfiltration via Search Conditions</a></li><li><span class=entry-date>2022-02-03</span>:
<a href=https://blog.jverkamp.com/2022/02/03/a-cli-tool-for-bulk-processing-github-dependabot-alerts-with-graphql/>A CLI Tool for Bulk Processing Github Dependabot Alerts (with GraphQL!)</a></li><li><span class=entry-date>2022-02-01</span>:
<a href=https://blog.jverkamp.com/2022/02/01/a-simple-flask-logging/echo-server/>A simple Flask Logging/Echo Server</a></li><li><span class=entry-date>2022-01-25</span>:
<a href=https://blog.jverkamp.com/2022/01/25/pulling-more-than-5000-logs-from-datadog/>Pulling more than 5000 logs from datadog</a></li><li><span class=entry-date>2020-06-30</span>:
<a href=https://blog.jverkamp.com/2020/06/30/ssrf-protection-in-rails/>SSRF Protection in Rails</a></li><li><span class=entry-date>2020-01-16</span>:
<a href=https://blog.jverkamp.com/2020/01/16/rackcors-configuration-tricks/>Rack::Cors Configuration Tricks</a></li><li><span class=entry-date>2019-05-02</span>:
<a href=https://blog.jverkamp.com/2019/05/02/prevent-javascript-links-by-parsing-urls/>Prevent JavaScript links by parsing URLs</a></li><li><span class=entry-date>2019-04-30</span>:
<a href=https://blog.jverkamp.com/2019/04/30/forcing-secure-cookies-behind-an-elb-in-ruby/rails/>Forcing Secure Cookies Behind an ELB in Ruby/Rails</a></li><li><span class=entry-date>2015-04-14</span>:
<a href=https://blog.jverkamp.com/2015/04/14/a-quick-look-at-rc4/>A Quick Look at RC4</a></li><li><span class=entry-date>2014-01-13</span>:
<a href=https://blog.jverkamp.com/2014/01/13/csrf-protection-injection-with-jquery-and-zend/>CSRF protection injection with jQuery and Zend</a></li><li><span class=entry-date>2013-01-31</span>:
<a href=https://blog.jverkamp.com/2013/01/31/scanning-for-dns-resolvers/>Scanning for DNS resolvers</a></li></ul><h2>Recent posts</h2><div class=post-list><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2025/07/25/using-csp-unsafe-hashes/ class=clearfix>Using CSP unsafe-hashes</a></h1><div class=entry-meta><span class=entry-date>2025-07-25</span></div></header><div class=entry-content><p>So here&rsquo;s a fun one: how does the <code>unsafe-hashes</code> directive in a <a href=https://en.wikipedia.org/wiki/content%20security%20police>content security police</a> work?</p><p>In a perfect world, you don&rsquo;t need it. You can write a CSP with a minimal <code>script-src</code> policy, including only scripts from your own domains (<code>self</code>) or a list of specific other scripts or at worst domains.</p><p>But sometimes real life (and third party libraries) get in the way.</p><p>It starts with inline scripts. So you have to add <code>unsafe-inline</code>. But there&rsquo;s a better way to do that: CSP nonces. Specify a randomly generated (per request) nonce in the CSP header and then apply that same nonce to every <code>script</code> tag. Voila. Better.</p><h2 id=the-problem-inline-javascript-events>The problem: inline JavaScript events</h2><p>But what about something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;doSomething();&#34;</span>&gt;
</span></span></code></pre></div><p>Well, you might say, don&rsquo;t do that. Write it as a script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;doSomethinger&#34;</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>nonce</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;correctHorseBatteryStable&#34;</span>&gt;
</span></span><span style=display:flex><span>document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;doSomethinger&#34;</span>).<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>, <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>doSomething</span>();
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>But like I said&ndash;third parties scripts can be imperfect. And sometimes, they just <em>insist</em> on embedding their own event handlers inline.</p><h2 id=a-solution-unsafe-hashes>A solution: <code>unsafe-hashes</code></h2><p>Enter: <code>unsafe-hashes</code>.</p><p>Basically, you can add this to your CSP:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>script-src &#39;unsafe-hashes&#39; &#39;sha256-44558f2c36efd8163eac2903cec13ed1fafcca51abd91d9f696321ab895f1107&#39;
</span></span></code></pre></div><p>This tells the browser that you <em>are</em> allowed to have event listeners directly on HTML elements&mldr; so long as the content of the JavaScript hashes <em>exactly</em> to any hash listed as an <code>unsafe-hash</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo -n <span style=color:#e6db74>&#34;doSomething();&#34;</span> | sha256
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>44558f2c36efd8163eac2903cec13ed1fafcca51abd91d9f696321ab895f1107
</span></span></code></pre></div><h2 id=it-gets-worse-dynamically-generated-javascript>It gets worse: dynamically generated JavaScript</h2><p>There is, however, one problem with this that does come up unfortunately often. If you&rsquo;re already dealing with third parties not doing things you wish they would, well then you have to deal with fun code like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span> ($buttonIds <span style=color:#66d9ef>as</span> $buttonId) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;button onclick=&#34;doSomething(&#39;</span> <span style=color:#f92672>.</span> $buttonId <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;);&#34;&gt;Button &#39;</span> <span style=color:#f92672>.</span> $buttonId <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;&lt;/button&gt;&#39;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>PHP_EOL</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Unfortunately&mldr; that completely blows up the CSP. Because&mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo -n <span style=color:#e6db74>&#34;doSomething(1);&#34;</span> | sha256
</span></span><span style=display:flex><span>2ef899c15aae95711855a45a5bb93c55363162e0e75e295aad4f189f20323d7c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ echo -n <span style=color:#e6db74>&#34;doSomething(5);&#34;</span> | sha256
</span></span><span style=display:flex><span>0e03bb385169b89c95eb62659f50604ffb8283154bd58ab8cc7e692c4b5c05a3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ echo -n <span style=color:#e6db74>&#34;doSomething(42);&#34;</span> | sha256
</span></span><span style=display:flex><span>4d9691449db6740ee19207c5bb52361eb97e18f06352ed400f83ae7caee270da
</span></span></code></pre></div><p>Just hashes doing hash things there. So basically, you have to be able to dynamically generate your CSP on the fly, including all of the hashes of all of the functions <em>and with each of their arguments</em> that are either possible or (even better) actually used.</p><p>And this isn&rsquo;t fun at all.</p><p>Now, you might say: but you can do something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span> ($buttonIds <span style=color:#66d9ef>as</span> $buttonId) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;button data-id=&#34;$buttonId&#34; onclick=&#34;doSomething(this.dataset.id);&#34;&gt;&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>After all</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ echo -n <span style=color:#e6db74>&#34;doSomething(this.dataset.id);&#34;</span> | sha256
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>d2ecabb98b1bb7cc81cd75d43dcb7bac08ce31055339920976cb92aa2f5dd2f5
</span></span></code></pre></div><p>Only one hash!</p><p>But if you have that much control&mldr; then why are you using inline JavaScript in the first place?</p><h2 id=is-it-safe>Is it safe?</h2><p>Is this safe?</p><p>No. It&rsquo;s called <code>unsafe-*</code> for a reason. An attacker that controls input can theoretically take any of the hashed functions you&rsquo;re including (like <code>submitPayment</code>&mldr;) and inject them in places they shouldn&rsquo;t be. And heck, if you manage to find a SHA-256 hash collision? Well, then you have far more interesting things to do with <em>that</em> then attacking some site that found themselves force to used <code>unsafe-hashes</code>&mldr;</p><p><em>But</em> it&rsquo;s better than <code>unsafe-inline</code> without <code>nonces</code> which allows arbitrary inline scripts. And unfortunately, there&rsquo;s no way to actually use <code>nonces</code> with inline scripts.</p><p>And while a perfectly secure system would be the best case, it&rsquo;s absolutely better to do as much as you can to secure a system rather than doing nothing waiting for the perfect solution to become possible.</p><p>Onward!</p><p><a href=/2025/07/25/using-csp-unsafe-hashes/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2023/11/14/rebuilding-streams-with-tshark/ class=clearfix>Rebuilding Streams with TShark</a></h1><div class=entry-meta><span class=entry-date>2023-11-14</span></div></header><div class=entry-content><p>Another quick post in a list of CTF techniques: filtering streams with <a href=https://www.wireshark.org/docs/man-pages/tshark.html target=_blank rel=noopener>tshark</a>. tshark is the command line half of the packet capture tool <a href=https://www.wireshark.org/ target=_blank rel=noopener>Wireshark</a>. The advantage here is it let&rsquo;s you do all manner of filtering on the command line.</p><p><a href=/2023/11/14/rebuilding-streams-with-tshark/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2023/11/09/sqlite-metadata-via-sql-injection/ class=clearfix>SQLite Metadata via SQL Injection</a></h1><div class=entry-meta><span class=entry-date>2023-11-09</span></div></header><div class=entry-content><p>As mentioned in my <a href=https://blog.jverkamp.com/2023/11/07/mongo-db-data-exfiltration-via-search-conditions/>previous post</a>, I recently participated in a security CTF exercise and wanted to write out a few interesting techniques.</p><p>This is the second: extracting SQL metadata from a SQLite database.</p><p><a href=/2023/11/09/sqlite-metadata-via-sql-injection/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2023/11/07/mongo-db-data-exfiltration-via-search-conditions/ class=clearfix>Mongo DB Data Exfiltration via Search Conditions</a></h1><div class=entry-meta><span class=entry-date>2023-11-07</span></div></header><div class=entry-content><p>I recently participated in a security capture the flag (CTF) exercise through work. The goal was&ndash;in a wide variety of ways&ndash;to find a hidden string of the form <code>flag{...}</code> somewhere in the problem. Some required exploiting sample websites, some parsing various data formats or captures, some required reverse engineering code or binaries, and (new this year) some required messing with LLMs.</p><p>As I tend to do for just about everything, I ended up writing up my own experiences. I won&rsquo;t share that, since it&rsquo;s fairly tuned to the specific problems and thus 1) not interesting and 2) probably not mine to share, but I did want want to share a few interesting techniques I found/used. If it helps anyone either defend against similar attacks in the real world or (more importantly &#x1f604;) someone comes across this while trying to solve a CTF of their own, all the better.</p><p>Okay, first technique: extracting data from a MongoDB database using search conditions.</p><p><a href=/2023/11/07/mongo-db-data-exfiltration-via-search-conditions/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2022/02/03/a-cli-tool-for-bulk-processing-github-dependabot-alerts-with-graphql/ class=clearfix>A CLI Tool for Bulk Processing Github Dependabot Alerts (with GraphQL!)</a></h1><div class=entry-meta><span class=entry-date>2022-02-03</span></div></header><div class=entry-content><p>Dependabot is &mldr; <em>somewhat useful</em>. When it comes to letting you know that there are critical issues in your dependencies that can be fixed simply by upgrading the package (they did all the work for you*). The biggest problem is that it can just be <em>insanely</em> noisy. In a busy repo with multiple Node.JS codebases (especially), you can get dozens to even hundreds of reports a week. And for each one, you optimally would update the code&mldr; but sometimes it&rsquo;s just not practical. So you have to decide which updates you actually apply.</p><p>So. How do we do it?</p><p>Well the traditional rest based Github APIs don&rsquo;t expose the dependabot data, <em>but</em> the newer GraphQL one does! I&rsquo;ll admit, I haven&rsquo;t used as much GraphQL as I probably should, it&rsquo;s&mldr; a bit more complicated than REST. But it does expose what I need.</p><p><a href=/2022/02/03/a-cli-tool-for-bulk-processing-github-dependabot-alerts-with-graphql/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2022/02/01/a-simple-flask-logging/echo-server/ class=clearfix>A simple Flask Logging/Echo Server</a></h1><div class=entry-meta><span class=entry-date>2022-02-01</span></div></header><div class=entry-content><p>A very simple server that can be used to catch all incoming HTTP requests and just echo them back + log their contents. I needed it to test what a webhook actually returned to me, but I&rsquo;m sure that there are a number of other things it could be dropped in for.</p><p>It will take in any GET/POST/PATCH/DELETE HTTP request with any path/params/data (optionally JSON), pack that data into a JSON object, and both log that to a file (with a UUID1 based name) plus return this object to the request.</p><p>Warning: Off hand, there is already a potential security problem in this regarding DoS. It will happily try to log anything you throw at it, no matter how big and will store those in memory first. So long running requests / large requests / many requests will quickly eat up your RAM/disk. So&mldr; don&rsquo;t leave this running unattended? At least not without additional configuration.</p><p>That&rsquo;s it! Hope it&rsquo;s helpful.</p><p><a href=/2022/02/01/a-simple-flask-logging/echo-server/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2022/01/25/pulling-more-than-5000-logs-from-datadog/ class=clearfix>Pulling more than 5000 logs from datadog</a></h1><div class=entry-meta><span class=entry-date>2022-01-25</span></div></header><div class=entry-content><p><a href=https://www.datadoghq.com/ target=_blank rel=noopener>Datadog</a> is pretty awesome. I wish I had it at my previous job, but better late than never. In particular, I&rsquo;ve used it a lot for digging through recent logs to try to construct various events for various (security related) reasons.</p><p>One of the problems I&rsquo;ve come into though is that eventually you&rsquo;re going to hit the limits of what datadog can do. In particular, I was trying to reconstruct user&rsquo;s sessions and then check if they made one specific sequence of calls or another one. So far as I know, that isn&rsquo;t directly possible, so instead, I wanted to download a subset of the datadog logs and process them locally.</p><p>Easy enough, yes? Well: <a href=https://stackoverflow.com/questions/67281698/datadog-export-logs-more-than-5-000 target=_blank rel=noopener>https://stackoverflow.com/questions/67281698/datadog-export-logs-more-than-5-000</a></p><p>Turns out, you just can&rsquo;t export more than 5000 logs directly. <em>But</em>&mldr; they have an API with pagination!</p><p><a href=/2022/01/25/pulling-more-than-5000-logs-from-datadog/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2020/06/30/ssrf-protection-in-rails/ class=clearfix>SSRF Protection in Rails</a></h1><div class=entry-meta><span class=entry-date>2020-06-30</span></div></header><div class=entry-content><p>One of the more subtle bugs that a lot of companies miss is Server Side Request Forgery (SSRF). Like it&rsquo;s cousin CSRF (cross-site request forgery), SSRF involves carefully crafting a request that runs in a way that the original developers didn&rsquo;t expect to do things that shouldn&rsquo;t be done. In the case of CSRF, one site is making a request on behalf of another in a user&rsquo;s browser (cross-site), but in SSRF, a request is being made by a server on behalf of a client, but you can trick it into making a request that wasn&rsquo;t intended.</p><p>For a perhaps more obvious example, consider a website with a service that will render webpages as preview images&ndash;consider sharing links on a social network. A user makes a request such as <code>/render?url=https://www.google.com</code>. This goes to the server, which will then fetch <a href=https://www.google.com target=_blank rel=noopener>https://www.google.com</a>, render the page to a screenshot, and then return that as a thumbnail.</p><p>This seems like rather useful functionality, but what if instead, the user gives the url: <code>/render?url=https://secret-internal-site.company.com</code>. Normally, <code>company.com</code> would be an internal only domain that cannot be viewed by users, but in this case&ndash;the server is within the corporate network. Off the server goes, helpfully taking and returning a screenshot. Another option&ndash;if you&rsquo;re hosted on AWS&ndash;is the AWS <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html target=_blank rel=noopener>metadata endpoint</a>: <code>http://169.254.169.254/latest/meta-data/</code>. All sorts of interesting private things there. Or even more insidious, <code>/render?url=file:///etc/password</code>. That shouldn&rsquo;t work in most cases, since most libraries know better than to rener <code>file://</code> protocol URLs, but&mldr; not always!</p><p><a href=/2020/06/30/ssrf-protection-in-rails/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2020/01/16/rackcors-configuration-tricks/ class=clearfix>Rack::Cors Configuration Tricks</a></h1><div class=entry-meta><span class=entry-date>2020-01-16</span></div></header><div class=entry-content><p><a href=https://github.com/cyu/rack-cors>cyu&rsquo;s Rack::Cors middleware</a> is rather handy if want to control your <a href=https://en.wikipedia.org/wiki/CORS>CORS</a> (Cross-Origin Resource Sharing) settings in a Ruby-on-Rails project. Previously, there was a fairly major issue where <code>:credentials => true</code> was the default (which you generally do not want), but there were also some more complicated tweaks that I wanted to make.</p><p>One problem I recently had to deal with was wanting to:</p><ul><li>Allow CORS connections from arbitrary domains (this site functions as an API)</li><li>Do not allow CORS from http domains at all</li><li>Only allow cookies (<code>Access-Control-Allow-Credentials</code>) to be sent for sibling subdomains</li><li>Prevent cookies from being sent from specific sibling subdomains (that are actually run by a third party)</li><li>On development (non-production) versions of the site, allow credentials from localhost</li></ul><p><a href=/2020/01/16/rackcors-configuration-tricks/>read more...</a></p></div><hr></article><article class=li><header><h1 class=entry-title><a href=https://blog.jverkamp.com/2019/05/02/prevent-javascript-links-by-parsing-urls/ class=clearfix>Prevent JavaScript links by parsing URLs</a></h1><div class=entry-meta><span class=entry-date>2019-05-02</span></div></header><div class=entry-content><p>If you have a website that allows users to submit URLs, one of the (many many) things people will try to do to break your site is to submit URLs that use the <code>javascript:</code> protocol (rather than the more expected <code>http:</code> or <code>https:</code>). This is almost never something that you want, since it allows users to submit essentially arbitrary code that other users will run on click in the context of your domain (<a href=https://en.wikipedia.org/wiki/same%20origin%20policy>same origin policy</a>).</p><p>So how do you fix it?</p><p>First thought would be to try to check the protocol:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>url</span>) =&gt; <span style=color:#f92672>!</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/^javascript:/</span>)
</span></span><span style=display:flex><span>[Function<span style=color:#f92672>:</span> <span style=color:#a6e22e>safe_url</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;http://www.example.com&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>safe_url</span>(<span style=color:#e6db74>&#39;javascript:alert(1)&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>false</span>
</span></span></code></pre></div><p><a href=/2019/05/02/prevent-javascript-links-by-parsing-urls/>read more...</a></p></div><hr></article></div><nav id=pagination-navigation role=navigation><ul class="pagination pagination-default"><li class="page-item disabled"><a aria-disabled=true aria-label=First class=page-link role=button tabindex=-1><span aria-hidden=true>&#171;&#171;</span></a></li><li class="page-item disabled"><a aria-disabled=true aria-label=Previous class=page-link role=button tabindex=-1><span aria-hidden=true>&#171;</span></a></li><li class="page-item active"><a aria-current=page aria-label="Page 1" class=page-link role=button>1</a></li><li class=page-item><a href=/programming/topics/security/page/2/ aria-label="Page 2" class=page-link role=button>2</a></li><li class=page-item><a href=/programming/topics/security/page/2/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/programming/topics/security/page/2/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul></nav></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>