<!doctype html><html><head><title>AoC 2017 Day 21: Fractal Expander â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.a8e11addf4349ee2ca5045f7f3cbf1febbf2c3a2840be2143ea69539c10f8c7f.js integrity="sha256-qOEa3fQ0nuLKUEX388vx/rvyw6KEC+IUPqaVOcEPjH8=" defer></script><script src=/katex_17296078054267651618.min.4a06464d8d6f8358d8896de62b53b5a89205d335dfd8c5b6b27edd7c039ae9d8.js integrity="sha256-SgZGTY1vg1jYiW3mK1O1qJIF0zXf2MW2sn7dfAOa6dg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.a17078917a4403310cd19178939257b706fb5e1da76167c9f4a6d2123c9d59c4.js integrity="sha256-oXB4kXpEAzEM0ZF4k5JXtwb7Xh2nYWfJ9KbSEjydWcQ=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.7420a1602c62a85d4b50881c1d8ce42f72c049dc2b097d440696425d6e54bb1e.css integrity="sha256-dCChYCxiqF1LUIgcHYzkL3LASdwrCX1EBpZCXW5Uux4="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.5ff4b87c40715a96119d8b5f34d971604fc65ab18f4870fd8da6ede9fd1e6188.css integrity="sha256-X/S4fEBxWpYRnYtfNNlxYE/GWrGPSHD9jabt6f0eYYg="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Automation</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>AoC 2017 Day 21: Fractal Expander</h1><div class=entry-meta><span class=entry-date>2017-12-21</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/20/aoc-2017-day-20-miniature-universe-simulator/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2017/12/22/aoc-2017-day-22-langtons-ant/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/20/aoc-2017-day-20-miniature-universe-simulator/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2017/12/22/aoc-2017-day-22-langtons-ant/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2015/09/14/mandelbrot/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/fractals>Fractals</a></li><li><a href=https://blog.jverkamp.com/2016/12/17/aoc-2016-day-17-md5-maze/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/procedural-content>Procedural Content</a><a href=https://blog.jverkamp.com/2020/11/17/p5js-worms/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2017/12/20/aoc-2017-day-20-miniature-universe-simulator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/visualization>Visualization</a><a href=https://blog.jverkamp.com/2022/12/08/aoc-2022-day-8-treetopinator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/20/aoc-2017-day-20-miniature-universe-simulator/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2017>Advent of Code 2017</a><a href=https://blog.jverkamp.com/2017/12/22/aoc-2017-day-22-langtons-ant/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2017/12/20/aoc-2017-day-20-miniature-universe-simulator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2017/12/22/aoc-2017-day-22-langtons-ant/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2017/12/20/aoc-2017-day-20-miniature-universe-simulator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2017/12/22/aoc-2017-day-22-langtons-ant/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><h3 id=source-fractal-art>Source: <a href=http://adventofcode.com/2017/day/21 target=_blank rel=noopener>Fractal Art</a></h3><blockquote><p><strong>Part 1:</strong> Start with an input image made of <code>.</code> and <code>#</code> pixels. For <code>n</code> iterations, break the image into blocks:</p><ul><li>If the current size is even, break the image into 2x2 chunks and replace each with a 3x3 chunk</li><li>If the current size is odd, break the image into 3x3 chunks and replace each with a 4x4 chunk</li></ul><p>The replacement rules will be specified in the following format (example is a 3x3 -> 4x4 rule):</p><pre tabindex=0><code>.#./..#/### =&gt; #..#/..../..../#..#  
</code></pre><p>In that example, replace this:</p><pre tabindex=0><code>.#.
..#
###
</code></pre><p>With this:</p><pre tabindex=0><code>#..#
....
....
#..#
</code></pre><p>Any rotation or reflection of a chunk can be used to match the input of a replacement rule.</p><p>After <code>n = 18</code> iterations, how many <code>#</code> pixels are there?</p></blockquote><p>This is quite a problem. One of the first things that we have to deal with is what we&rsquo;re going to use for our data format for each step. I settled on keeping a single 1D string. It will always have a <a href=https://en.wikipedia.org/wiki/perfect%20square>perfect square</a> for the size, so we can always take a square root to render it as an actual square.</p><p>With that, we can work on expanding the image for each step.</p><p>First, we have to break apart the data into either 2x2 or 3x3 blocks:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>blocks</span>(data):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Convert data into blocks.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    If data has an even number of elements, return 2x2 blocks.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    If it has an odd number, return 3x3 blocks.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Assume data is a perfect square.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(data) <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>        block_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        block_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    data_row_width <span style=color:#f92672>=</span> int(math<span style=color:#f92672>.</span>sqrt(len(data)))
</span></span><span style=display:flex><span>    grid_size <span style=color:#f92672>=</span> data_row_width <span style=color:#f92672>//</span> block_size
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> grid_y <span style=color:#f92672>in</span> range(grid_size):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> grid_x <span style=color:#f92672>in</span> range(grid_size):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>yield</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(
</span></span><span style=display:flex><span>                data[data_row_width <span style=color:#f92672>*</span> block_size <span style=color:#f92672>*</span> grid_y <span style=color:#f92672>+</span> data_row_width <span style=color:#f92672>*</span> block_y <span style=color:#f92672>+</span> block_size <span style=color:#f92672>*</span> grid_x <span style=color:#f92672>+</span> block_x]
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> block_y <span style=color:#f92672>in</span> range(block_size)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> block_x <span style=color:#f92672>in</span> range(block_size)
</span></span><span style=display:flex><span>            )
</span></span></code></pre></div><p>The idea is that we have two nested grids. The larger grid is specified by <code>grid_size</code> and contains many 2x2 or 3x3 blocks within it. The smaller grid is always either 2x2 or 3x3 and within each block. With those two bits of information, we can calculate the index within the original data string to extract for each block. I think this is relatively readable, although if anyone has a way this could be made better, I&rsquo;d love to see it. It&rsquo;s mostly just a weird problem to work on.</p><p>Next, we want to take those blocks and expand them. To do that though, we need to be able to determine what the 8 possible rotations/reflections of a given square are:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rotations</span>(block):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Yield the 8 rotations/flips of a block.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> int(math<span style=color:#f92672>.</span>sqrt(len(block)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>2</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>yield</span> block
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># Rotate 90 degrees clockwise</span>
</span></span><span style=display:flex><span>            block <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(
</span></span><span style=display:flex><span>                block[(size <span style=color:#f92672>-</span> x <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> size <span style=color:#f92672>+</span> y]
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> range(size)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(size)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Flip vertically</span>
</span></span><span style=display:flex><span>        block <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(
</span></span><span style=display:flex><span>            block[(size <span style=color:#f92672>-</span> y <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> size <span style=color:#f92672>+</span> x]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> range(size)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(size)
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><p>This doesn&rsquo;t remove duplicates, but it&rsquo;s only 8 per block. If it matters, we can come back to this later (perhaps using a <code>set</code> to only return each unique string once?).</p><p>With that, we have the ability to expand either a single block or to use that to expand an entire grid full of blocks:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>expand_block</span>(block):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Expand a single block.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> rotation <span style=color:#f92672>in</span> rotations(block):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> rotation <span style=color:#f92672>in</span> rules:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> rules[rotation]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Unable to expand </span><span style=color:#e6db74>{</span>block<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>expand</span>(data):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Expand an entire grid.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> deblock([
</span></span><span style=display:flex><span>        expand_block(block)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> block <span style=color:#f92672>in</span> blocks(data)
</span></span><span style=display:flex><span>    ])
</span></span></code></pre></div><p>Rules are loaded from our input file. It&rsquo;s just a map of <code>.#</code> etc (either 4 or 9 long) to the same form output (either 9 or 16 long).</p><p>And finally, we&rsquo;ll take the expanded blocks and turn them back into the single long string. Another potential optimization would be to keep them in the unexpanded format<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>deblock</span>(data):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Inverse of the above, turn a list of blocks back into data.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    block_size <span style=color:#f92672>=</span> int(math<span style=color:#f92672>.</span>sqrt(len(data[<span style=color:#ae81ff>0</span>])))
</span></span><span style=display:flex><span>    grid_size <span style=color:#f92672>=</span> int(math<span style=color:#f92672>.</span>sqrt(len(data)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(
</span></span><span style=display:flex><span>        data[grid_y <span style=color:#f92672>*</span> grid_size <span style=color:#f92672>+</span> grid_x][block_y <span style=color:#f92672>*</span> block_size <span style=color:#f92672>+</span> block_x]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> grid_y <span style=color:#f92672>in</span> range(grid_size)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> block_y <span style=color:#f92672>in</span> range(block_size)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> grid_x <span style=color:#f92672>in</span> range(grid_size)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> block_x <span style=color:#f92672>in</span> range(block_size)
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div><p>It&rsquo;s basically the inverse of the <code>blocks</code> function above, albeit a bit easier yet to read.</p><p>Now that we have all that, the actual expansion function is pretty clean:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>param(<span style=color:#e6db74>&#39;state&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> round <span style=color:#f92672>in</span> range(lib<span style=color:#f92672>.</span>param(<span style=color:#e6db74>&#39;iterations&#39;</span>)):
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> expand(data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(render_block(data)<span style=color:#f92672>.</span>count(<span style=color:#e6db74>&#39;#&#39;</span>))
</span></span></code></pre></div><blockquote><p><strong>Part 2:</strong> Do the same thing for 18 iterations.</p></blockquote><p>No code changes. Just wait a bit longer<sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. It&rsquo;s quick enough though:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python3 run-all.py day-21
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>day-21  python3 fractal-expander.py input.txt --iterations <span style=color:#ae81ff>5</span>    0.11855697631835938     <span style=color:#ae81ff>133</span>
</span></span><span style=display:flex><span>day-21  python3 fractal-expander.py input.txt --iterations <span style=color:#ae81ff>18</span>   22.69156503677368       <span style=color:#ae81ff>2221990</span>
</span></span></code></pre></div><p>Instead, let&rsquo;s render some pretty pictures. Using the <code>generate_image</code> function <a href=https://blog.jverkamp.com/2015/09/14/mandelbrot/>from 2015</a> / used in <a href=https://blog.jverkamp.com/2017/12/14/aoc-2017-day-14-knot-hash-gridinator/>day 14</a>, we can render any given block as an image:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>render_image</span>(data, filename):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Render a block as an image (assumes # is black and . is white).&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    size <span style=color:#f92672>=</span> int(math<span style=color:#f92672>.</span>sqrt(len(data)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>generate_pixel</span>(x, y):
</span></span><span style=display:flex><span>        g <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>if</span> data[y <span style=color:#f92672>*</span> size <span style=color:#f92672>+</span> x] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;#&#39;</span> <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>255</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (g, g, g)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    lib<span style=color:#f92672>.</span>generate_image(size, size, generate_pixel)<span style=color:#f92672>.</span>save(filename)
</span></span></code></pre></div><p>If we do that, we can see the images at any particular step:</p><figure><img src=/embeds/2017/fractal-expander-5.png alt="Part 1: After 5 Iterations"><figcaption><p>Part 1: After 5 Iterations</p></figcaption></figure><figure><a href=/embeds/2017/fractal-expander-18.png><img src=/embeds/2017/fractal-expander-18.png alt="Part 2: After 18 Iterations (Click for full size)"></a><figcaption><p>Part 2: After 18 Iterations (Click for full size)</p></figcaption></figure><p>Or we can animate the whole thing as it expands using <a href=https://www.imagemagick.org/script/index.php target=_blank rel=noopener>ImageMagick</a> again:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ convert -delay <span style=color:#ae81ff>10</span> -interpolate Nearest -filter point -resize 324x324 frame-*.png fractal.gif
</span></span></code></pre></div><figure><img src=/embeds/2017/fractal-expander.gif></figure><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>In fact, we don&rsquo;t actually have to generate the entire image at all to determine how many pixels are on. We only have to recursively calculate each &lsquo;superpixel&rsquo; going down layers. We could cache each possible result and save quite a lot of time doing this. On the other hand, it only takes ~20 seconds to calculate part 2, so &#x1f937;.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>