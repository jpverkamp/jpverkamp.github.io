<!doctype html><html><head><title>AoC 2017 Day 20: Miniature Universe Simulator â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/auto-render_2152414756166376840.min.45ae2f6b03d0c7b867df0a6cb7d43215ec78369998685a5748c5b12f502321f2.js integrity="sha256-Ra4vawPQx7hn3wpst9QyFex4NpmYaFpXSMWxL1AjIfI=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.e0e68b86dea32185ab89b0b9cc01649107cc6b0be3290c8c7b13c716bc0dabfa.css integrity="sha256-4OaLht6jIYWribC5zAFkkQfMawvjKQyMexPHFrwNq/o="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>AoC 2017 Day 20: Miniature Universe Simulator</h1><div class=entry-meta><span class=entry-date>2017-12-20</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/19/aoc-2017-day-19-networkout/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2017/12/21/aoc-2017-day-21-fractal-expander/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/19/aoc-2017-day-19-networkout/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2017/12/21/aoc-2017-day-21-fractal-expander/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/18/aoc-2017-day-18-duetvm/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/visualization>Visualization</a><a href=https://blog.jverkamp.com/2017/12/21/aoc-2017-day-21-fractal-expander/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/19/aoc-2017-day-19-networkout/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2017>Advent of Code 2017</a><a href=https://blog.jverkamp.com/2017/12/21/aoc-2017-day-21-fractal-expander/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2017/12/19/aoc-2017-day-19-networkout/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2017/12/21/aoc-2017-day-21-fractal-expander/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2017/12/20/feet-of-clay/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2017/12/21/aoc-2017-day-21-fractal-expander/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><h3 id=source-particle-swarmhttpadventofcodecom2017day20>Source: <a href=http://adventofcode.com/2017/day/20 target=_blank rel=noopener>Particle Swarm</a></h3><blockquote><p><strong>Part 1:</strong> Given the initial position, velocity, and acceleration of a large number of particles, which particle will stay the closet to the origin as the simulation runs to infinity?</p></blockquote><p>So this is actually something of a trick question. In order to answer this, you have to realize that as you go to infinity, the initial position and velocity don&rsquo;t really matter at all<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. The particle that has the acceleration vector with the lowest magnitude will end up the closest point to the origin after all of the points are accelerating ever more quickly away from one another.</p><p>To whit:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># PART 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Calculate which point is acclerating away from the origin the slowest</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Assumptions:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - All particles will eventually move away from the origin increasingly quickly</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - The particle accelerating the slowest is the one that will eventually fall behind</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - If two have equal acceleration, the one that started closer to the origin wins</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>slowest_acceleration <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>slowest_distance <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>slowest_index <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> index, point <span style=color:#f92672>in</span> enumerate(points):
</span></span><span style=display:flex><span>    p, v, a <span style=color:#f92672>=</span> point
</span></span><span style=display:flex><span>    acceleration <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>vector_distance(a, origin)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    distance <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>vector_distance(p, origin)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    new_best <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>        slowest_acceleration <span style=color:#f92672>==</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>or</span> acceleration <span style=color:#f92672>&lt;</span> slowest_acceleration
</span></span><span style=display:flex><span>        <span style=color:#f92672>or</span> (acceleration <span style=color:#f92672>==</span> slowest_acceleration <span style=color:#f92672>and</span> distance <span style=color:#f92672>&lt;</span> slowest_distance)
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> new_best:
</span></span><span style=display:flex><span>        lib<span style=color:#f92672>.</span>log(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;New slowest acceleration point </span><span style=color:#e6db74>{</span>index<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>acceleration<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        slowest_acceleration <span style=color:#f92672>=</span> acceleration
</span></span><span style=display:flex><span>        slowest_distance <span style=color:#f92672>=</span> distance
</span></span><span style=display:flex><span>        slowest_index <span style=color:#f92672>=</span> index
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>slowest_index<span style=color:#e6db74>}</span><span style=color:#e6db74> has the slowest acceleration (</span><span style=color:#e6db74>{</span>slowest_acceleration<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#39;</span>)
</span></span></code></pre></div><p>The only caveat comes up if two points happen to have the same slowest accelerating. In this case, we want whichever one started closer to the origin, since it will be that same distance closer to the origin for all time.</p><p>This also assumes that you have the points already loaded, but that&rsquo;s a straight forward parsing problem. It also uses a few new library functions for vector math on tuples:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>vector_add</span>(a, b):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> tuple(i <span style=color:#f92672>+</span> j <span style=color:#66d9ef>for</span> i, j <span style=color:#f92672>in</span> zip(a, b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>vector_distance</span>(a, b):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> sum(abs(i <span style=color:#f92672>-</span> j) <span style=color:#66d9ef>for</span> i, j <span style=color:#f92672>in</span> zip(a, b))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>vector_scale</span>(s, a):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> tuple(s <span style=color:#f92672>*</span> i <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> a)
</span></span></code></pre></div><p><code>vector_add</code> will add two vectors together (useful for updating position from velocity or velocity from acceleration). <code>vector_distance</code> will return how far apart two vectors are. This can also be used to find the magnitude of a vector if either is the zero vector. <code>vector_scale</code> takes a vector and scales each number by a value. This is useful for running a simulation to an arbitrary distance out, for example (I don&rsquo;t actually use this in my final solutions).</p><blockquote><p><strong>Part 2:</strong> Assume that the particles can collide. Once the solution reaches a steady state, how many particles are left?</p></blockquote><p>This one is a bit more complicated. To do this, we do actually want to run the simulation.</p><p>First, a function that will take in the position, velocity, and acceleration of a point and return a generator that will yield each position the point will be at over time:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>simulate</span>(p, v, a):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Yield points along a curve until they are moving away from zero after speeding up.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    last_speed <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    speeding_up <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    last_distance_to_zero <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    moving_away <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> tick <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>count():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>yield</span> p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        v <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>vector_add(v, a)
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>vector_add(p, v)
</span></span></code></pre></div><p>I like generators. They make for elegant code.</p><p>Next, we use that to create a generator for every point in the simulation. We advance each one tick at a time (so they stay in sync) and check for any collisions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># PART 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Calculate how many points are left after collisions</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Assumptions:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - Stop if all particles are moving apart (maximum pairwise distance is increasing)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   (Technically you also have to know that all particles are currently accelerating)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>simulators <span style=color:#f92672>=</span> [simulate(<span style=color:#f92672>*</span>point) <span style=color:#66d9ef>for</span> point <span style=color:#f92672>in</span> points]
</span></span><span style=display:flex><span>last_max_distance <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> tick <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>count():
</span></span><span style=display:flex><span>    current_points <span style=color:#f92672>=</span> [next(simulator) <span style=color:#66d9ef>for</span> simulator <span style=color:#f92672>in</span> simulators]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Remove any particles that have collided</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    to_remove <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        i
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, pa <span style=color:#f92672>in</span> enumerate(current_points)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j, pb <span style=color:#f92672>in</span> enumerate(current_points)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>!=</span> j <span style=color:#f92672>and</span> pa <span style=color:#f92672>==</span> pb
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> to_remove:
</span></span><span style=display:flex><span>        lib<span style=color:#f92672>.</span>log(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>list(to_remove)<span style=color:#e6db74>}</span><span style=color:#e6db74> collided on tick </span><span style=color:#e6db74>{</span>tick<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    simulators <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        simulator
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> index, simulator <span style=color:#f92672>in</span> enumerate(simulators)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> index <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> to_remove
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Check if everything is moving apart (we can stop then)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    max_distance <span style=color:#f92672>=</span> max(
</span></span><span style=display:flex><span>        lib<span style=color:#f92672>.</span>vector_distance(p1, p2)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> p1 <span style=color:#f92672>in</span> current_points
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> p2 <span style=color:#f92672>in</span> current_points
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    lib<span style=color:#f92672>.</span>log(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;Maximum distance: </span><span style=color:#e6db74>{</span>max_distance<span style=color:#e6db74>}</span><span style=color:#e6db74> (last: </span><span style=color:#e6db74>{</span>last_max_distance<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> last_max_distance:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> max_distance <span style=color:#f92672>&gt;</span> last_max_distance:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        last_max_distance <span style=color:#f92672>=</span> max_distance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>len(simulators)<span style=color:#e6db74>}</span><span style=color:#e6db74> left after collisions&#39;</span>)
</span></span></code></pre></div><p>The main assumption here is that as the simulation runs to infinity, we&rsquo;ll eventually get to a point where all the particles are moving ever more quickly apart from each other. This could have a problem if we ever have an earlier tick where the particles happen to be moving apart before they all hit their inflection points, but it turns out that at least in the input I was given (and probably most of them), this is a perfectly safe approximation to make.</p><p>Once you&rsquo;ve stopped the simulation at this point, you know how far apart all of the particles were.</p><p>One thing that I would like to see is just what this simulation looks like. I know the particles will start in a rough ball which will likely contract and then blow apart, but it would still be interesting to see it. The main problem comes with rendering the points in 3D space. Let&rsquo;s</p><p>To do this, we will inject a rendering function after we&rsquo;ve made each simulation step to render each frame as a PNG:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>lib<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--render&#39;</span>, action <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;store_true&#39;</span>, help <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;On part 2, render each frame as an image&#39;</span>)
</span></span><span style=display:flex><span>lib<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--render-frames&#39;</span>, type <span style=color:#f92672>=</span> int, default <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, help <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;If specified, render this many frames rather than stopping when we have an answer&#39;</span>)
</span></span><span style=display:flex><span>lib<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;--render-region&#39;</span>, type <span style=color:#f92672>=</span> int, default <span style=color:#f92672>=</span> <span style=color:#ae81ff>15000</span>, help <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;The maximum x/y/z coordinate to render for --render-frames&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> lib<span style=color:#f92672>.</span>param(<span style=color:#e6db74>&#39;render&#39;</span>):
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> mpl_toolkits.mplot3d <span style=color:#f92672>import</span> Axes3D
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fig <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>figure()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    render_region <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>param(<span style=color:#e6db74>&#39;render_region&#39;</span>)
</span></span><span style=display:flex><span>    ax <span style=color:#f92672>=</span> fig<span style=color:#f92672>.</span>add_subplot(<span style=color:#ae81ff>111</span>, projection <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;3d&#39;</span>)
</span></span><span style=display:flex><span>    ax<span style=color:#f92672>.</span>set_xlim([<span style=color:#f92672>-</span>render_region, render_region])
</span></span><span style=display:flex><span>    ax<span style=color:#f92672>.</span>set_ylim([<span style=color:#f92672>-</span>render_region, render_region])
</span></span><span style=display:flex><span>    ax<span style=color:#f92672>.</span>set_zlim([<span style=color:#f92672>-</span>render_region, render_region])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ax<span style=color:#f92672>.</span>scatter(<span style=color:#f92672>*</span>zip(<span style=color:#f92672>*</span>current_points))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fig<span style=color:#f92672>.</span>savefig(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;frame-</span><span style=color:#e6db74>{</span>tick<span style=color:#e6db74>:</span><span style=color:#e6db74>04d</span><span style=color:#e6db74>}</span><span style=color:#e6db74>.png&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># If we want to limit the number of frames to render and we&#39;ve hit that, stop</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&lt;</span> lib<span style=color:#f92672>.</span>param(<span style=color:#e6db74>&#39;render_frames&#39;</span>) <span style=color:#f92672>&lt;=</span> tick:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span></code></pre></div><p>One neat trick there is that we&rsquo;re taking <code>current_points</code> and using <code>zip(*current_points)</code> to unpack that into three parameters: <code>xs</code>, <code>ys</code>, <code>zs</code> (a list of <code>x</code>, <code>y</code>, and <code>z</code> coordinates) which we are then passing as the first three arguments to <code>scatter</code>. This will render frames like this:</p><figure><img src=/embeds/2017/miniature-universe-frame-0.png alt=frame-0000.png><figcaption><p>frame-0000.png</p></figcaption></figure><p>We can combine these with <a href=https://www.imagemagick.org/script/index.php target=_blank rel=noopener>ImageMagick</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ convert -delay <span style=color:#ae81ff>10</span> frame-*.png simulation.gif
</span></span></code></pre></div><figure><img src=/embeds/2017/miniature-universe-simulation.gif></figure><p>You may have noticed that I set a limit on the axes with <code>set_xlim</code> etc. This is so that the bounds are automatically calculated per frame. That&rsquo;s what I did originally and they jumped around rather a lot. This works better.</p><p>Plus, watching them blow past the specified bounds is kind of hilarious.</p><p>If we&rsquo;re running it all without rendering frames, it&rsquo;s more or less quick enough (especially since it&rsquo;s for both parts<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python3 run-all.py day-20
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>day-20  python3 miniature-universe-simulator.py input.txt       70.74992203712463       <span style=color:#ae81ff>243</span> has the slowest acceleration <span style=color:#f92672>(</span>2<span style=color:#f92672>)</span>; <span style=color:#ae81ff>648</span> left after collisions
</span></span></code></pre></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Well&mldr; okay they matter for tie breakers. I&rsquo;ll get to that in a moment.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Yes, I know this is a cop out. The first part is basically instant.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>