<!doctype html><html><head><title>AoC 2017 Day 7: Tree â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.30448892aa1f91e9c4cb5494e5c5e5abc13b7778de7786e5256cdc7d2424813a.js integrity="sha256-MESIkqofkenEy1SU5cXlq8E7d3jed4blJWzcfSQkgTo=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg=" defer></script>
<script src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90=" defer></script>
<script src=/main.min.82ab51144325fae71ddbca46269a80c63b28bdab6be6b01aa9ec638c013748e6.js integrity="sha256-gqtRFEMl+ucd28pGJpqAxjsovatr5rAaqexjjAE3SOY=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.7cfac95bdd962d85ceec560e50fe7b04c44b58a76e5202006ef36ca8c0a7d836.css integrity="sha256-fPrJW92WLYXO7FYOUP57BMRLWKduUgIAbvNsqMCn2DY="><link rel=stylesheet href=/main.min.21cc0ec02bdbc197a68cb2e246e6db6d9df556ba2994084c55a6f8b6713e604d.css integrity="sha256-IcwOwCvbwZemjLLiRubbbZ31VroplAhMVab4tnE+YE0="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>AoC 2017 Day 7: Tree</h1><div class=entry-meta><span class=entry-date>2017-12-07</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/06/aoc-2017-day-6-tightrope/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2017/12/08/aoc-2017-day-8-conditiputer/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/06/aoc-2017-day-6-tightrope/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2017/12/08/aoc-2017-day-8-conditiputer/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/06/aoc-2017-day-6-tightrope/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/data-structures>Data Structures</a><a href=https://blog.jverkamp.com/2017/12/12/aoc-2017-day-12-gridlock/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/trees>Trees</a><a href=https://blog.jverkamp.com/2022/12/21/aoc-2022-day-21-yellinator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/06/aoc-2017-day-6-tightrope/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2017>Advent of Code 2017</a><a href=https://blog.jverkamp.com/2017/12/08/aoc-2017-day-8-conditiputer/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2017/12/06/aoc-2017-day-6-tightrope/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2017/12/08/aoc-2017-day-8-conditiputer/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2017/12/06/aoc-2017-day-6-tightrope/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2017/12/08/revisionary/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><h3 id=source-recursive-circushttpadventofcodecom2017day7>Source: <a href=http://adventofcode.com/2017/day/7>Recursive Circus</a></h3><blockquote><p><strong>Part 1:</strong> A tree is defined as such:</p></blockquote><blockquote><ul><li><code>node (weight) -> child1, child2, ...</code></li><li><code>node (weight)</code></li></ul></blockquote><blockquote><p>Where a <code>node</code> always has a weight, but may or may not have child nodes.</p></blockquote><blockquote><p>What is the name of the root <code>node</code> of the tree (the node without a parent)?</p></blockquote><p>First, we want to load the tree into a useful format. We&rsquo;ll keep a map of parent to children along with children back to their parents, just in case we need to go either direction:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>names <span style=color:#f92672>=</span> set()
</span></span><span style=display:flex><span>weight_map <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>child_map <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>parent_map <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lib<span style=color:#f92672>.</span>input():
</span></span><span style=display:flex><span>    name, weight, children <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>match(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;(\w+) \((\d+)\)(?: -&gt; (.*))?&#39;</span>, line)<span style=color:#f92672>.</span>groups()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    names<span style=color:#f92672>.</span>add(name)
</span></span><span style=display:flex><span>    weight_map[name] <span style=color:#f92672>=</span> int(weight)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> children:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> child <span style=color:#f92672>in</span> children<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;, &#39;</span>):
</span></span><span style=display:flex><span>            child_map<span style=color:#f92672>.</span>setdefault(name, set())<span style=color:#f92672>.</span>add(child)
</span></span><span style=display:flex><span>            parent_map[child] <span style=color:#f92672>=</span> name
</span></span></code></pre></div><p>This is the sort of thing that could easily be stored in an <code><a href="https://docs.python.org/3/search.html?q=object">object</a></code>
, but that seems overkill at this point.</p><p>As noted in the problem, the root node is the only one without a parent:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>for</span> name <span style=color:#f92672>in</span> names:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> name <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> parent_map:
</span></span><span style=display:flex><span>        root <span style=color:#f92672>=</span> name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;root: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(root), end <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;; &#39;</span>)
</span></span></code></pre></div><blockquote><p><strong>Part 2:</strong> A node is balanced if all of its children have the same weight (including their children, recursively). One node in the tree is the wrong weight to be balanced. What would that node&rsquo;s weight need to be to balance everything?</p></blockquote><p>This is a pretty interesting problem. Finding the weight of a particular node plus its children is a nice example of recursive at work:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>total_weight</span>(node):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Return the weight of this node + the sum of all children.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> weight_map[node] <span style=color:#f92672>+</span> sum(total_weight(child) <span style=color:#66d9ef>for</span> child <span style=color:#f92672>in</span> child_map<span style=color:#f92672>.</span>get(node, []))
</span></span></code></pre></div><p>Using this, we can write a recursive generator to iterate through the tree, find the node that isn&rsquo;t balanced, and try to fix it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>fix_balance</span>(node):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;Fix the balance from this node (recursively).&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># If we have no children, no point in balancing</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> child_map<span style=color:#f92672>.</span>get(node):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Collect a map of weight to set of children with that weight</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># We&#39;re unbalanced if this map has two keys, one with a single value</span>
</span></span><span style=display:flex><span>    weights <span style=color:#f92672>=</span> collections<span style=color:#f92672>.</span>defaultdict(set)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> child <span style=color:#f92672>in</span> child_map[node]:
</span></span><span style=display:flex><span>        weights[total_weight(child)]<span style=color:#f92672>.</span>add(child)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>yield from</span> fix_balance(child)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># If we only have a single weight, this node is not unbalanced</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(weights) <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Otherwise, figure out which node is unbalanced (the single mismatched weight)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> weight, children <span style=color:#f92672>in</span> weights<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> len(children) <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            unbalanced_node <span style=color:#f92672>=</span> list(children)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>            unbalanced_weight <span style=color:#f92672>=</span> weight
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            balanced_weight <span style=color:#f92672>=</span> weight
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Balance it</span>
</span></span><span style=display:flex><span>    weight_map[unbalanced_node] <span style=color:#f92672>+=</span> balanced_weight <span style=color:#f92672>-</span> unbalanced_weight
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>yield</span> unbalanced_node, weight_map[unbalanced_node]
</span></span></code></pre></div><p>The comments mostly note what we&rsquo;re doing at each state. One neat bit is that this function is more powerful than it needs to be. If there were many nodes out of balance, this would fix them all. Since there&rsquo;s only one, we just need to print out the single value this function will <code>yield</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>for</span> node, new_weight <span style=color:#f92672>in</span> fix_balance(root):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> -&gt; </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(node, new_weight))
</span></span></code></pre></div><p>It&rsquo;s quick too:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python3 run-all.py day-07
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>day-07  python3 tree.py input.txt       0.10468697547912598     root: azqje; rfkvap -&gt; <span style=color:#ae81ff>646</span>
</span></span></code></pre></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>