<!doctype html><html><head><title>AoC 2017 Day 6: Tightrope â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.a38b80d356cf8bf4156ba2df63ffa25593fab82156591d1626626c75bc83394a.js integrity="sha256-o4uA01bPi/QVa6LfY/+iVZP6uCFWWR0WJmJsdbyDOUo=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.769b3113e29a7df642b9426e9dace3b3499e1626944a7f98db68da3c1633cd23.js integrity="sha256-dpsxE+KaffZCuUJunazjs0meFiaUSn+Y22jaPBYzzSM=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.2b035670bce6e6394692a10248ec2f5abcfd2e5fafb0149895b6c901673bca7f.js integrity="sha256-KwNWcLzm5jlGkqECSOwvWrz9Ll+vsBSYlbbJAWc7yn8=" defer></script>
<script src=/main.min.982c2d7bb434b4cf8b19c2cf38ef7e7f7162ddbed610e5bdddbb937001e26574.js integrity="sha256-mCwte7Q0tM+LGcLPOO9+f3Fi3b7WEOW93buTcAHiZXQ=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.1a5fbab1ecff843d4ee6e936243fb06066197cd8c9357883d791333ce6001f3b.css integrity="sha256-Gl+6sez/hD1O5uk2JD+wYGYZfNjJNXiD15EzPOYAHzs="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>AoC 2017 Day 6: Tightrope</h1><div class=entry-meta><span class=entry-date>2017-12-06</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/05/aoc-2017-day-5-21-jump-street/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/python>Python</a><a href=https://blog.jverkamp.com/2017/12/07/aoc-2017-day-7-tree/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/05/aoc-2017-day-5-21-jump-street/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/advent-of-code>Advent of Code</a><a href=https://blog.jverkamp.com/2017/12/07/aoc-2017-day-7-tree/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/03/aoc-2017-day-3-spiraly/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/data-structures>Data Structures</a><a href=https://blog.jverkamp.com/2017/12/07/aoc-2017-day-7-tree/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/05/aoc-2017-day-5-21-jump-street/ class=previous-link></a><a class=taxonomy-value href=/series/advent-of-code-2017>Advent of Code 2017</a><a href=https://blog.jverkamp.com/2017/12/07/aoc-2017-day-7-tree/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2017/12/05/aoc-2017-day-5-21-jump-street/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2017/12/07/aoc-2017-day-7-tree/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2017/12/05/aoc-2017-day-5-21-jump-street/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2017/12/07/aoc-2017-day-7-tree/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><h3 id=source-memory-reallocationhttpadventofcodecom2017day6>Source: <a href=http://adventofcode.com/2017/day/6>Memory Reallocation</a></h3><blockquote><p><strong>Part 1:</strong> Start with <code>n</code> stacks of different sizes. Take the largest block and distribute its items starting with <code>n+1</code> and looping around. How many iterations of this does it take before you see a state you&rsquo;ve seen before?</p></blockquote><p>The core of this problem is getting the balancing function right:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>balance</span>(blocks):
</span></span><span style=display:flex><span>    to_distribute <span style=color:#f92672>=</span> max(<span style=color:#f92672>*</span>blocks)
</span></span><span style=display:flex><span>    index <span style=color:#f92672>=</span> blocks<span style=color:#f92672>.</span>index(to_distribute)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    for_each <span style=color:#f92672>=</span> to_distribute <span style=color:#f92672>//</span> len(blocks)
</span></span><span style=display:flex><span>    left_over <span style=color:#f92672>=</span> to_distribute <span style=color:#f92672>-</span> (for_each <span style=color:#f92672>*</span> len(blocks))
</span></span><span style=display:flex><span>    give_left_over_to <span style=color:#f92672>=</span> {i <span style=color:#f92672>%</span> len(blocks) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(index <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, index <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> left_over)}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> tuple(
</span></span><span style=display:flex><span>        (
</span></span><span style=display:flex><span>            (amount <span style=color:#66d9ef>if</span> i <span style=color:#f92672>!=</span> index <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>+</span> for_each
</span></span><span style=display:flex><span>            <span style=color:#f92672>+</span> (<span style=color:#ae81ff>1</span> <span style=color:#66d9ef>if</span> i <span style=color:#f92672>in</span> give_left_over_to <span style=color:#66d9ef>else</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, amount <span style=color:#f92672>in</span> enumerate(blocks)
</span></span><span style=display:flex><span>    )
</span></span></code></pre></div><p>The blocks are defined as a <code><a href="https://docs.python.org/3/search.html?q=tuple">tuple</a></code>
since that allows it to be used as an element in a <code><a href="https://docs.python.org/3/search.html?q=set">set</a></code>
(lists don&rsquo;t work since they are <a href=https://en.wikipedia.org/wiki/mutable>mutable</a>).</p><p>To actually distribute the blocks, we will start by dividing the amount and keeping the remainder. The quotient <code>for_each</code> goes to all of the blocks and the remainder <code>left_over</code> is the odd bits that will only go to some of the blocks. <code>give_left_over_to</code> is me figuring out which indexes are going to get the remainder. Finally, we create a new tuple by adding the current amount (except for the block we&rsquo;re redistributing) plus <code>for_each</code> plus 1 for those <code>left_over</code>.</p><p>Then we&rsquo;ll loop over those until we see a duplicate:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>blocks <span style=color:#f92672>=</span> tuple(
</span></span><span style=display:flex><span>    int(node)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lib<span style=color:#f92672>.</span>input()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> node <span style=color:#f92672>in</span> line<span style=color:#f92672>.</span>split()
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>seen <span style=color:#f92672>=</span> set()
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> cycle <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>count():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> blocks <span style=color:#f92672>in</span> seen:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        seen<span style=color:#f92672>.</span>add(blocks)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    blocks <span style=color:#f92672>=</span> balance(blocks)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(cycle)
</span></span></code></pre></div><blockquote><p><strong>Part 2:</strong> How many iterations are there in the loop?</p></blockquote><p>Interesting. To do this, what we want to do is store the index we see each arrangement of blocks at, rather than just that we saw them. Then the difference between the current iteration and that first one is the length of the cycle:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>seen <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> cycle <span style=color:#f92672>in</span> itertools<span style=color:#f92672>.</span>count():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> blocks <span style=color:#f92672>in</span> seen:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        seen[blocks] <span style=color:#f92672>=</span> cycle
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    blocks <span style=color:#f92672>=</span> balance(blocks)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(cycle, cycle <span style=color:#f92672>-</span> seen[blocks])
</span></span></code></pre></div><p>This will run both parts in a single command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ python3 run-all.py day-06
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>day-06  python3 tightrope.py input.txt  0.10088086128234863     <span style=color:#ae81ff>3156</span> <span style=color:#ae81ff>1610</span>
</span></span></code></pre></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>