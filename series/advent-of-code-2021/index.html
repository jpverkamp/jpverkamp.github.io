<!DOCTYPE html>
<html onclick >
<head>
    <title>jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content">
    <div class="entry-content"></div>

    <article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/16/aoc-2021-day-16-depacketinator/" class="clearfix">AoC 2021 Day 16: Depacketinator</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-16</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-packet-decoderhttpsadventofcodecom2021day16">Source: <a href="https://adventofcode.com/2021/day/16">Packet Decoder</a></h3>
<h4 id="part-1-given-a-recursive-binary-packet-definition-see-below-parse-the-given-packet-return-the-sum-of-each-packets-version"><strong>Part 1:</strong> Given a recursive binary packet definition (see below), parse the given packet. Return the sum of each packet&rsquo;s <code>version</code>.</h4>
<p>All packet fields are in bits. Possible packet formats:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Structure</th>
</tr>
</thead>
<tbody>
<tr>
<td>Literal Value</td>
<td><code>AAA 010 [1CCCC]* [1CCCC]</code></td>
</tr>
<tr>
<td>Type 0 Operator</td>
<td><code>AAA BBB 0 DDDDDDDDDDDDDDD (children)</code></td>
</tr>
<tr>
<td>Type 1 Operator</td>
<td><code>AAA BBB 1 EEEEEEEEEEE (children)</code></td>
</tr>
</tbody>
</table>
<p>In all packets:</p>
<ul>
<li><code>AAA</code> - 3 bits representing the <code>version</code> of the packet</li>
<li><code>BBB</code> - 3 bits representing the <code>type_id</code> of the packet</li>
</ul>
<p>In literal packets&ndash;where <code>type_id</code> = 4 (<code>010</code>)&ndash;the value is an integer encoded in a value similar to <a href="https://en.wikipedia.org/wiki/UTF-8%20encoding">UTF-8 encoding</a>. There will be a sequence of 0 or more 5 bit values <code>1CCCC</code> (with the <code>1</code> indicating the number continues, followed by a single <code>0CCCC</code> segment, ending the value. These <code>C*</code>s will be concatenated and treated as a single unsigned binary value and converted to an integer.</p>
<p>In Type 0 Operator packets, the next 15 bits (<code>D{15}</code>) should be interpreted as an unsigned integer containing the number of following bits that encode &lsquo;child&rsquo; packets. Parse the following <code>D</code> bits as child packets (perhaps recursively) and attach those to the Type 0 Operator as children.</p>
<p>In Type 1 Operator packets, the next 11 bits (<code>E{11}</code>) should be interpreted as an unsigned integer containing the number of child packets (instead of their length). Parse that many child packets (perhaps recursively, only top level children count towards this number <code>E</code>) and attach those to the Type 1 Operator as children.</p>
<p>Yeah, that&rsquo;s a mouthful. But it&rsquo;s a pretty awesome excuse to use a few techniques that are common in parsing binary encodings, such as network packets.</p>
<p>First things first, I want to make a <code>BitStream</code> class that can take in the data that&rsquo;s going to make up our packets and keep track of where we are. That way, we can read out an arbitrary number of bits (3, 1, 4, 15, and 11 bits in this case, depending on the structure) as whatever types we need:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BitStream</span>:
    index: int
    data: str

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">from_hex</span>(hex_data: str) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;BitStream&#39;</span>:
        <span style="color:#66d9ef">return</span> BitStream(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(
            <span style="color:#e6db74">&#39;{:04b}&#39;</span><span style="color:#f92672">.</span>format(int(c, <span style="color:#ae81ff">16</span>)) <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> hex_data
        ))

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read_bits</span>(self, n: int) <span style="color:#f92672">-&gt;</span> str:
        <span style="color:#e6db74">&#39;&#39;&#39;Read n bits from the current position in the bitsting as a string of 0/1&#39;&#39;&#39;</span>

        value <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>data[self<span style="color:#f92672">.</span>index:self<span style="color:#f92672">.</span>index<span style="color:#f92672">+</span>n]
        self<span style="color:#f92672">.</span>index <span style="color:#f92672">+=</span> n

        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">&gt;</span> len(self<span style="color:#f92672">.</span>data):
            <span style="color:#66d9ef">raise</span> BitStreamException(<span style="color:#e6db74">&#39;Attempted to read past the end of bitstream&#39;</span>)

        <span style="color:#66d9ef">return</span> value

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read_int</span>(self, n: int) <span style="color:#f92672">-&gt;</span> int:
        <span style="color:#e6db74">&#39;&#39;&#39;Read n bits from the current position and convert to an integer&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">return</span> int(self<span style="color:#f92672">.</span>read_bits(n), <span style="color:#ae81ff">2</span>)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read_bool</span>(self) <span style="color:#f92672">-&gt;</span> bool:
        <span style="color:#e6db74">&#39;&#39;&#39;Read the next bit from the current position as True/False&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>read_bits(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;1&#39;</span>

    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>index <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">&lt;</span> len(self<span style="color:#f92672">.</span>data):
            <span style="color:#66d9ef">return</span> f<span style="color:#e6db74">&#39;&lt;{self.index}/{len(self.data)}, {self.data[self.index:self.index+8]}...&gt;&#39;</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> f<span style="color:#e6db74">&#39;&lt;{self.index}/{len(self.data)}, {self.data[self.index:]}&gt;&#39;</span>
</code></pre></div><p>That&rsquo;s actually not that bad, I don&rsquo;t think. It&rsquo;s a bit interesting that we&rsquo;re mostly reading in <code>from_hex</code>, but that just means take each single hex character, turn it into an integer with <code>int(c, 16)</code> and then print that as a fixed four bits with <code>{:04b}.format(...)</code>. Other than that, <code>read_bits</code> will read n bits and advance the current pointer into the stream, and <code>read_int</code> / <code>read_bool</code> will wrap that to read a specific kind of value.</p>
<p>With all that, we should be ready to parse the packets:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Packet</span>:
    version: int
    type_id: int

    value: int
    children: List[<span style="color:#e6db74">&#39;Packet&#39;</span>]

    length: int

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">from_hex</span>(hex: str) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Packet&#39;</span>:
        <span style="color:#66d9ef">return</span> Packet<span style="color:#f92672">.</span>from_bitstream(BitStream<span style="color:#f92672">.</span>from_hex(hex))

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">from_bitstream</span>(bits: BitStream, _depth: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Packet&#39;</span>:
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth}Parsing new packet at {bits}&#39;</span>)

        version <span style="color:#f92672">=</span> bits<span style="color:#f92672">.</span>read_int(<span style="color:#ae81ff">3</span>)
        type_id <span style="color:#f92672">=</span> bits<span style="color:#f92672">.</span>read_int(<span style="color:#ae81ff">3</span>)
        length <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>

        value <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        children <span style="color:#f92672">=</span> []

        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - {version=}, {type_id=}&#39;</span>)

        <span style="color:#75715e"># Literal values</span>
        <span style="color:#66d9ef">if</span> type_id <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>:
            logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - Mode=literal&#39;</span>)

            keep_reading <span style="color:#f92672">=</span> True
            <span style="color:#66d9ef">while</span> keep_reading:
                keep_reading <span style="color:#f92672">=</span> bits<span style="color:#f92672">.</span>read_bool()
                byte <span style="color:#f92672">=</span> bits<span style="color:#f92672">.</span>read_int(<span style="color:#ae81ff">4</span>)
                logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - Read byte {byte}, will continue: {keep_reading}&#39;</span>)

                value <span style="color:#f92672">=</span> value <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> byte
                length <span style="color:#f92672">+=</span> <span style="color:#ae81ff">5</span>

        <span style="color:#75715e"># Any other operator value</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># The next bit is the length_type_id</span>
            <span style="color:#75715e"># If it&#39;s set, read the number of bits in subpackets</span>
            length <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
            <span style="color:#66d9ef">if</span> bits<span style="color:#f92672">.</span>read_bool():
                length <span style="color:#f92672">+=</span> <span style="color:#ae81ff">11</span>
                number_of_children <span style="color:#f92672">=</span> bits<span style="color:#f92672">.</span>read_int(<span style="color:#ae81ff">11</span>)
                logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - Mode=operator, length_type=1 ({number_of_children} children)&#39;</span>)

                <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(number_of_children):
                    child <span style="color:#f92672">=</span> Packet<span style="color:#f92672">.</span>from_bitstream(bits, _depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
                    children<span style="color:#f92672">.</span>append(child)

                    length <span style="color:#f92672">+=</span> child<span style="color:#f92672">.</span>length

            <span style="color:#75715e"># If it&#39;s not, read the number of subpackets</span>
            <span style="color:#66d9ef">else</span>:
                length <span style="color:#f92672">+=</span> <span style="color:#ae81ff">15</span>
                body_length <span style="color:#f92672">=</span> bits<span style="color:#f92672">.</span>read_int(<span style="color:#ae81ff">15</span>)
                logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - Mode=operator, length_type=0 ({body_length} bits)&#39;</span>)
                logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - {len(bits.data)-bits.index} of {len(bits.data)} remaining&#39;</span>)

                <span style="color:#66d9ef">while</span> body_length:
                    child <span style="color:#f92672">=</span> Packet<span style="color:#f92672">.</span>from_bitstream(bits, _depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
                    children<span style="color:#f92672">.</span>append(child)

                    body_length <span style="color:#f92672">-=</span> child<span style="color:#f92672">.</span>length
                    length <span style="color:#f92672">+=</span> child<span style="color:#f92672">.</span>length

                    logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - New child used {child.length} bits, {body_length} remaining&#39;</span>)

                    <span style="color:#66d9ef">if</span> body_length <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
                        <span style="color:#66d9ef">raise</span> PacketParseException(<span style="color:#e6db74">&#39;Could not parse packet, too many bits used by children&#39;</span>)

        p <span style="color:#f92672">=</span> Packet(version, type_id, value, children, length)
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} \ Packet parsed: {p}&#39;</span>)
        <span style="color:#66d9ef">return</span> p
</code></pre></div><p>There&rsquo;s a fair amount of debugging code in there&hellip; because this took a bit to get right. And all for a relatively simple mistake. Essentially, we start by taking the bit stream and reading the <code>value</code> and <code>type_id</code>. That is always 6 bits. After that, there&rsquo;s a special case for <code>type_id = 4</code>: literals. That&rsquo;s the first half of the <code>if</code>. In there, we&rsquo;re going to read 1 + 4 bits at a time until the first bit is 0, adding the other 4 bits as an ever growing base 16 literal. Pretty cool!</p>
<p>The other two cases depend on the next bit read with <code>bits.read_bool()</code>. If it&rsquo;s 0, we&rsquo;re parsing a specific number of children. That one&rsquo;s not so bad, because we can just read off <code>Packet.from_bitstream</code> at the current point for that many children. But we absolutely have to update the length because of the next case:</p>
<p>If the <code>bits.read_bool()</code> was 1. In this case, we only know how many bits the child packets are made of. This is actually the more common method in network and other binary formats I&rsquo;ve found, because it lets you skip parsing if you don&rsquo;t actually care about the children. You can just jump ahead that many bits. In the above case with a number of children, you have no idea how large those children actually are, so you have to parse them.</p>
<p>In any case, we now have perfectly functional parsing of packets. It&rsquo;s pretty cool to see it work too:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> Packet<span style="color:#f92672">.</span>from_hex(<span style="color:#e6db74">&#39;D2FE28&#39;</span>)
Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">2021</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">21</span>)

<span style="color:#f92672">&gt;&gt;&gt;</span> Packet<span style="color:#f92672">.</span>from_hex(<span style="color:#e6db74">&#39;38006F45291200&#39;</span>)
Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, children<span style="color:#f92672">=</span>[
    Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>),
    Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>)
], length<span style="color:#f92672">=</span><span style="color:#ae81ff">49</span>)

<span style="color:#f92672">&gt;&gt;&gt;</span> Packet<span style="color:#f92672">.</span>from_hex(<span style="color:#e6db74">&#39;EE00D40C823060&#39;</span>)
Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, children<span style="color:#f92672">=</span>[
    Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>), 
    Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>), 
    Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>)
], length<span style="color:#f92672">=</span><span style="color:#ae81ff">51</span>)
</code></pre></div><p>I like reading the debug view as well (which is good, since I spent a while staring at it&hellip;)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> Packet<span style="color:#f92672">.</span>from_hex(<span style="color:#e6db74">&#39;EE00D40C823060&#39;</span>)
INFO Parsing new packet at <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">11101110.</span><span style="color:#f92672">..&gt;</span>
INFO  <span style="color:#f92672">-</span> version<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
INFO  <span style="color:#f92672">-</span> Mode<span style="color:#f92672">=</span>operator, length_type<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> (<span style="color:#ae81ff">3</span> children)
INFO  Parsing new packet at <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">18</span><span style="color:#f92672">/</span><span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">01010000.</span><span style="color:#f92672">..&gt;</span>
INFO   <span style="color:#f92672">-</span> version<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>
INFO   <span style="color:#f92672">-</span> Mode<span style="color:#f92672">=</span>literal
INFO   <span style="color:#f92672">-</span> Read byte <span style="color:#ae81ff">1</span>, will <span style="color:#66d9ef">continue</span>: False
INFO   \ Packet parsed: Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>)
INFO  Parsing new packet at <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">29</span><span style="color:#f92672">/</span><span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">10010000.</span><span style="color:#f92672">..&gt;</span>
INFO   <span style="color:#f92672">-</span> version<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>
INFO   <span style="color:#f92672">-</span> Mode<span style="color:#f92672">=</span>literal
INFO   <span style="color:#f92672">-</span> Read byte <span style="color:#ae81ff">2</span>, will <span style="color:#66d9ef">continue</span>: False
INFO   \ Packet parsed: Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>)
INFO  Parsing new packet at <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">40</span><span style="color:#f92672">/</span><span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">00110000.</span><span style="color:#f92672">..&gt;</span>
INFO   <span style="color:#f92672">-</span> version<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>
INFO   <span style="color:#f92672">-</span> Mode<span style="color:#f92672">=</span>literal
INFO   <span style="color:#f92672">-</span> Read byte <span style="color:#ae81ff">3</span>, will <span style="color:#66d9ef">continue</span>: False
INFO   \ Packet parsed: Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>)
INFO  \ Packet parsed: Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, children<span style="color:#f92672">=</span>[Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>), Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>), Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>)], length<span style="color:#f92672">=</span><span style="color:#ae81ff">51</span>)

Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, children<span style="color:#f92672">=</span>[
    Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>), 
    Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>), 
    Packet(version<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, type_id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, children<span style="color:#f92672">=</span>[], length<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span>)
], length<span style="color:#f92672">=</span><span style="color:#ae81ff">51</span>)
</code></pre></div><p>Neat!</p>
<p>Wrap it to actually satisfy the actual prompt (sum all <code>versions</code>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sum_versions</span>(p: Packet) <span style="color:#f92672">-&gt;</span> int:
        <span style="color:#66d9ef">return</span> p<span style="color:#f92672">.</span>version <span style="color:#f92672">+</span> sum(sum_versions(child) <span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> p<span style="color:#f92672">.</span>children)

    p <span style="color:#f92672">=</span> Packet<span style="color:#f92672">.</span>from_hex(file<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>strip())
    logging<span style="color:#f92672">.</span>info(p)
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;{sum_versions(p):-16} {line}&#39;</span>)
</code></pre></div><p>And that&rsquo;s it. A nice recursive <code>sum_versions</code> that looks into <code>children</code> if there are any, summing as it goes. Nice. So&hellip; how does it work on the given input?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> python3 depacketinator<span style="color:#f92672">.</span>py part1 input<span style="color:#f92672">.</span>txt
             <span style="color:#ae81ff">981</span> <span style="color:#ae81ff">0055.</span><span style="color:#f92672">...</span>C000
<span style="color:#75715e"># time 63753417ns / 0.06s</span>
</code></pre></div><p>Nice. Quick too.</p>
<p>So&hellip; while we&rsquo;re here, what was the error that took me forever to figure out? Originally, my <code>else</code> block (the type 0/1 operators) looked like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">        <span style="color:#f92672">...</span>
        <span style="color:#75715e"># Any other operator value</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># The next bit is the length_type_id</span>
            <span style="color:#75715e"># If it&#39;s set, read the number of bits in subpackets</span>
            <span style="color:#66d9ef">if</span> bits<span style="color:#f92672">.</span>read_bool():
                number_of_children <span style="color:#f92672">=</span> bits<span style="color:#f92672">.</span>read_int(<span style="color:#ae81ff">11</span>)
                logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - Mode=operator, length_type=1 ({number_of_children} children)&#39;</span>)

                <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(number_of_children):
                    child <span style="color:#f92672">=</span> Packet<span style="color:#f92672">.</span>from_bitstream(bits, _depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
                    children<span style="color:#f92672">.</span>append(child)

                    length <span style="color:#f92672">+=</span> child<span style="color:#f92672">.</span>length

            <span style="color:#75715e"># If it&#39;s not, read the number of subpackets</span>
            <span style="color:#66d9ef">else</span>:
                body_length <span style="color:#f92672">=</span> bits<span style="color:#f92672">.</span>read_int(<span style="color:#ae81ff">15</span>)
                logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - Mode=operator, length_type=0 ({body_length} bits)&#39;</span>)
                logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - {len(bits.data)-bits.index} of {len(bits.data)} remaining&#39;</span>)

                <span style="color:#66d9ef">while</span> body_length:
                    child <span style="color:#f92672">=</span> Packet<span style="color:#f92672">.</span>from_bitstream(bits, _depth <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
                    children<span style="color:#f92672">.</span>append(child)

                    body_length <span style="color:#f92672">-=</span> child<span style="color:#f92672">.</span>length
                    length <span style="color:#f92672">+=</span> child<span style="color:#f92672">.</span>length

                    logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} - New child used {child.length} bits, {body_length} remaining&#39;</span>)

                    <span style="color:#66d9ef">if</span> body_length <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
                        <span style="color:#66d9ef">raise</span> PacketParseException(<span style="color:#e6db74">&#39;Could not parse packet, too many bits used by children&#39;</span>)

        p <span style="color:#f92672">=</span> Packet(version, type_id, value, children, length)
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{&#34; &#34; * _depth} \ Packet parsed: {p}&#39;</span>)
        <span style="color:#66d9ef">return</span> p
</code></pre></div><p>Pretty much the same, no?</p>
<p>Well, actually there are three very important lines missing. Three lines that, because of how the test packet lengths worked out, led to a number of hard to debug errors, but only in <em>some</em> of the test cases.</p>
<p>Any guesses? Look back and compare?</p>
<p>Turns out, you absolutely need to have the correct lengths for nested operator packets. So 1 bit for the type and either 15 or 11 for the count. It only matters if you have a Type 1 packet with non-literals inside of it (so at least two levels of nesting), otherwise the lengths work well enough, but in that case, it certainly got tricky. It kept looking for more information when there just weren&rsquo;t any more bits to be had.</p>
<p>Oh, debuggging.</p>
<p>I really should be writing better test cases, but in this case, that wouldn&rsquo;t have necessarily helped. I <em>knew</em> which test was failing, I just didn&rsquo;t know (at first) <em>why</em>. Live and learn.</p><p><a href="/2021/12/16/aoc-2021-day-16-depacketinator/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/15/aoc-2021-day-15-low-ceiling-simulator/" class="clearfix">AoC 2021 Day 15: Low Ceiling Simulator</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-15</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-chitonhttpsadventofcodecom2021day15">Source: <a href="https://adventofcode.com/2021/day/15">Chiton</a></h3>
<h4 id="part-1-given-a-grid-of-weights-find-the-minimum-path-from-top-left-to-top-right-return-the-total-weight-along-that-path"><strong>Part 1:</strong> Given a grid of weights, find the minimum path from top left to top right. Return the total weight along that path.</h4>
<p>A fairly standard thing to have to do, ripe for the <a href="https://en.wikipedia.org/wiki/A*%20search%20algorithm">A* search algorithm</a>. Which eventually I&rsquo;ll get to, but I&rsquo;ll admit, it wasn&rsquo;t the first algorithm I tried. 😄</p>
<p>Let&rsquo;s do this. First, let&rsquo;s assume that we already have a <code>load</code> function that returns a map of <code>(x, y) -&gt; cost</code> as we&rsquo;ve done a number of times before. No matter what algorithm we use, the wrapping code is going to be the same:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):

    map <span style="color:#f92672">=</span> load(file)
    best_path <span style="color:#f92672">=</span> explore(map)
    best_score <span style="color:#f92672">=</span> sum(map[x, y] <span style="color:#66d9ef">for</span> (x, y) <span style="color:#f92672">in</span> best_path[<span style="color:#ae81ff">1</span>:])

    logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{best_path=}&#39;</span>)
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;{best_score=}&#39;</span>)
</code></pre></div><p>Now, all we have to do is write an explore function. The first algorithm I tried was to write a cached recursive function (like last time). Essentially:</p>
<div class="latex-block">
bestPath(x, y) = cost(x,y) + minimum \left\{\begin{matrix}
bestPath(x+1, y) \\ 
bestPath(x-1, y) \\ 
bestPath(x, y+1) \\ 
bestPath(x, y-1)
\end{matrix}\right.
</div>

<p>You have to make sure that you don&rsquo;t recur infinitely (so you have to pass around the points you&rsquo;ve visited so you don&rsquo;t form loops), but other than that, it should work&hellip; Except Python isn&rsquo;t really designed for that. Oh the number of &lsquo;maximum recursion depth reached&rsquo; errors I got. Anyways.</p>
<p>Next solution:</p>
<ul>
<li>Start with a map of &lsquo;best known paths&rsquo; from each point to the goal (store the path + the cost)</li>
<li>Until the map has stabilized (doesn&rsquo;t change for an entire loop), loop across every point (x, y)
<ul>
<li>For each point, check each four neighbors for their minimum (path, cost)</li>
<li>If their (path, cost) + your cost is less than your current cost (or yours hasn&rsquo;t been set), store it</li>
</ul>
</li>
</ul>
<p>That means that you&rsquo;ll eventually fill in the entire graph. It&rsquo;s not super efficient, since you&rsquo;re going to be running it from top left to bottom right, where the grid fills from bottom right to top left&hellip; but it does work.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 low-ceiling-simulator.py part1 input.txt
best_score<span style="color:#f92672">=</span><span style="color:#ae81ff">687</span>
<span style="color:#75715e"># time 2041809750ns / 2.04s</span>
</code></pre></div><p>That&rsquo;s&hellip; fairly slow already for such a small graph&hellip; but it works for part one. How does the code work?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">explore</span>(map: Mapping[Point, int]) <span style="color:#f92672">-&gt;</span> List[Point]:
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    Version 1: Brute force, update all paths and iterate until stable. 
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>

    width <span style="color:#f92672">=</span> max(x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> (x, _) <span style="color:#f92672">in</span> map)
    height <span style="color:#f92672">=</span> max(y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> (_, y) <span style="color:#f92672">in</span> map)

    bottom_right <span style="color:#f92672">=</span> (width <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, height <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)

    best_paths <span style="color:#f92672">=</span> {
        bottom_right: (<span style="color:#ae81ff">1</span>, [bottom_right])
    }

    <span style="color:#75715e"># Pass until the best path map stops changing</span>
    best_paths_changed <span style="color:#f92672">=</span> True
    generation <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">while</span> best_paths_changed:
        best_paths_changed <span style="color:#f92672">=</span> False
        generation <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{generation=}, {len(best_paths)}/{len(map)} paths populated&#39;</span>)

        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(width):
            <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(height):
                neighbor_scores <span style="color:#f92672">=</span> [
                    best_paths[x <span style="color:#f92672">+</span> xd, y <span style="color:#f92672">+</span> yd]
                    <span style="color:#66d9ef">for</span> xd, yd <span style="color:#f92672">in</span> ORTHAGONAL
                    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">+</span> xd, y <span style="color:#f92672">+</span> yd) <span style="color:#f92672">in</span> best_paths
                ]

                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> neighbor_scores:
                    <span style="color:#66d9ef">continue</span>

                <span style="color:#75715e"># Find the best neighbor</span>
                best_score, best_path <span style="color:#f92672">=</span> min(neighbor_scores)

                new_score <span style="color:#f92672">=</span> map[x, y] <span style="color:#f92672">+</span> best_score
                new_path <span style="color:#f92672">=</span> [(x, y)] <span style="color:#f92672">+</span> best_path

                <span style="color:#75715e"># If we haven&#39;t found a path for this point or we found a better one, update</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> (x, y) <span style="color:#f92672">in</span> best_paths <span style="color:#f92672">or</span> new_score <span style="color:#f92672">&lt;</span> best_paths[x, y][<span style="color:#ae81ff">0</span>]:
                    best_paths_changed <span style="color:#f92672">=</span> True
                    best_paths[x, y] <span style="color:#f92672">=</span> (new_score, new_path)

    <span style="color:#66d9ef">return</span> best_paths[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>]
</code></pre></div><p>More or less exactly what I described in the psuedo-code, just much longer.</p>
<p>Okay, let&rsquo;s see what part 2 has in store for us!</p><p><a href="/2021/12/15/aoc-2021-day-15-low-ceiling-simulator/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/14/aoc-2021-day-14-polymerizationinator/" class="clearfix">AoC 2021 Day 14: Polymerizationinator</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-14</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-extended-polymerizationhttpsadventofcodecom2021day14">Source: <a href="https://adventofcode.com/2021/day/14">Extended Polymerization</a></h3>
<h4 id="part-1-given-a-complete-function-fa-b---c-where-any-string-ab-becomes-acb-and-an-input-string-apply-the-function-at-the-same-time-to-every-overlapping-pair-of-letters-repeat-this-time-times-report-the-difference-in-counts-between-the-most-and-least-common-letters-in-the-final-situation"><strong>Part 1:</strong> Given a complete function <code>f(a, b) -&gt; c</code> where any string <code>ab</code> becomes <code>acb</code> and an input string, apply the function at the same time to every (overlapping) pair of letters. Repeat this time times. Report the difference in counts between the most and least common letters in the final situation.</h4>
<p>Okay. First try, let&rsquo;s just solve this directly. Although, since we know that we&rsquo;re going to be inserting into the middle of the list constantly, we can be slightly more efficient by using a <a href="https://en.wikipedia.org/wiki/linked%20list">linked list</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
PolyMap <span style="color:#f92672">=</span> Mapping[Tuple[str, str], str]


<span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Node</span>(Iterable):
    value: str
    next: Optional[<span style="color:#e6db74">&#39;Node&#39;</span>]

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expand_via</span>(self, map: PolyMap) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Node&#39;</span>:
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>next <span style="color:#f92672">is</span> None:
            <span style="color:#66d9ef">return</span> self

        <span style="color:#66d9ef">for</span> a, b <span style="color:#f92672">in</span> zip(self, self<span style="color:#f92672">.</span>next):
            <span style="color:#66d9ef">if</span> (a<span style="color:#f92672">.</span>value, b<span style="color:#f92672">.</span>value) <span style="color:#f92672">in</span> map:
                a<span style="color:#f92672">.</span>next <span style="color:#f92672">=</span> Node(map[a<span style="color:#f92672">.</span>value, b<span style="color:#f92672">.</span>value], b)

        <span style="color:#66d9ef">return</span> self

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">from_iter</span>(iter: Iterable) <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#39;Node&#39;</span>:
        head <span style="color:#f92672">=</span> None
        previous <span style="color:#f92672">=</span> None

        <span style="color:#66d9ef">for</span> el <span style="color:#f92672">in</span> iter:
            n <span style="color:#f92672">=</span> Node(el, None)

            <span style="color:#66d9ef">if</span> previous:
                previous<span style="color:#f92672">.</span>next <span style="color:#f92672">=</span> n
            <span style="color:#66d9ef">else</span>:
                head <span style="color:#f92672">=</span> n

            previous <span style="color:#f92672">=</span> n

        <span style="color:#66d9ef">return</span> head

    <span style="color:#66d9ef">def</span> __iter__(self):
        self<span style="color:#f92672">.</span>iter_node <span style="color:#f92672">=</span> self
        <span style="color:#66d9ef">return</span> self

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__next__</span>(self):
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>iter_node:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">StopIteration</span>

        result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>iter_node
        self<span style="color:#f92672">.</span>iter_node <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>iter_node<span style="color:#f92672">.</span>next
        <span style="color:#66d9ef">return</span> result

    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(self)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load</span>(file: TextIO) <span style="color:#f92672">-&gt;</span> Tuple[Node, PolyMap]:

    ls <span style="color:#f92672">=</span> Node<span style="color:#f92672">.</span>from_iter(file<span style="color:#f92672">.</span>readline()<span style="color:#f92672">.</span>strip())
    file<span style="color:#f92672">.</span>readline()

    map <span style="color:#f92672">=</span> {
        (line[<span style="color:#ae81ff">0</span>], line[<span style="color:#ae81ff">1</span>]): line[<span style="color:#ae81ff">6</span>]
        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file
    }

    <span style="color:#66d9ef">return</span> ls, map

</code></pre></div><p>Okay, there are basically three interesting parts here.</p>
<ul>
<li>
<p>First, the <code>from_iter</code> function. That will take any <code>iterable</code> and make a linked list out of it, returning the head of that list. It does this by creating each Node in turn and attaching it to the previously created node.</p>
</li>
<li>
<p>Next, the <code>__iter__</code> and <code>__next__</code> functions. Together, these make <code>Node</code> iterable, so that we can do things like <code>for n in ls: ...</code> where <code>ls</code> is the head of a linked list.</p>
</li>
<li>
<p>Finally, <code>expand_via</code>. That will take in a mapping of pairs to a single character and expand the current linked list with it. Specifically, for any characters <code>a</code> and <code>b</code> in the linked list, insert a new node between them with value <code>map[a, b]</code>. Pretty cool right?</p>
</li>
<li>
<p>While we&rsquo;re at it, add a function to <code>load</code> the puzzle definitions from a file: the initial linked list (a string is iterable) and the series of mappings. They&rsquo;re always single characters in a set format, so we can hardcode where they are in the string. Perfect? No. Workable for now, sure.</p>
</li>
</ul>
<p>With all that, we can write a direct solution to the puzzle:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#a6e22e">@app.command</span>()
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">direct</span>(file: typer<span style="color:#f92672">.</span>FileText, steps: int):
    ls, map <span style="color:#f92672">=</span> load(file)

    <span style="color:#f92672">import</span> time
    start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()

    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(steps):
        logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;Generation {i} calculate after {time.time() - start:02f} sec, has {len(list(ls))} elements&#39;</span>)
        ls<span style="color:#f92672">.</span>expand_via(map)

    counts <span style="color:#f92672">=</span> Counter(n<span style="color:#f92672">.</span>value <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> ls)
    logging<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#39;{counts=}&#39;</span>)

    most, _ <span style="color:#f92672">=</span> max((qty, c) <span style="color:#66d9ef">for</span> (c, qty) <span style="color:#f92672">in</span> counts<span style="color:#f92672">.</span>items())
    least, _ <span style="color:#f92672">=</span> min((qty, c) <span style="color:#66d9ef">for</span> (c, qty) <span style="color:#f92672">in</span> counts<span style="color:#f92672">.</span>items())

    <span style="color:#66d9ef">print</span>(most <span style="color:#f92672">-</span> least)
</code></pre></div><p>(There&rsquo;s a reason I named this <code>direct</code> rather than <code>part1</code>)</p>
<p>It actually works great:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 polymerizationinator.py direct input.txt <span style="color:#ae81ff">10</span>
<span style="color:#ae81ff">2797</span>
</code></pre></div><p>So that&rsquo;s all she wrote, right?</p>
<p>Well&hellip;</p><p><a href="/2021/12/14/aoc-2021-day-14-polymerizationinator/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/13/aoc-2021-day-13-foldinator/" class="clearfix">AoC 2021 Day 13: Foldinator</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-13</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-transparent-origamihttpsadventofcodecom2021day13">Source: <a href="https://adventofcode.com/2021/day/13">Transparent Origami</a></h3>
<h4 id="part-1-given-a-set-of-points-and-a-sequence-of-fold-lines-where-you-either-fold-the-bottom-over-the-top-or-right-over-left-determine-how-many-points-exist-after-the-first-fold"><strong>Part 1:</strong> Given a set of points and a sequence of &lsquo;fold&rsquo; lines (where you either fold the bottom over the top or right over left), determine how many points exist after the first fold.</h4>
<p>First, data structures:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@dataclass</span>(frozen<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Point</span>:
    x: int
    y: int

    <span style="color:#66d9ef">def</span> __repr__(self):
        <span style="color:#66d9ef">return</span> f<span style="color:#e6db74">&#39;&lt;{self.x}, {self.y}&gt;&#39;</span>


<span style="color:#a6e22e">@dataclass</span>(frozen<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fold</span>:
    horizontal: bool
    line: int

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">apply_to</span>(self, points: Set[Point]) <span style="color:#f92672">-&gt;</span> Set[Point]:
        <span style="color:#66d9ef">return</span> {
            Point(
                p<span style="color:#f92672">.</span>x <span style="color:#66d9ef">if</span> (self<span style="color:#f92672">.</span>horizontal <span style="color:#f92672">or</span> p<span style="color:#f92672">.</span>x <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>line) <span style="color:#66d9ef">else</span> self<span style="color:#f92672">.</span>line <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> p<span style="color:#f92672">.</span>x,
                p<span style="color:#f92672">.</span>y <span style="color:#66d9ef">if</span> (<span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>horizontal <span style="color:#f92672">or</span> p<span style="color:#f92672">.</span>y <span style="color:#f92672">&lt;</span> self<span style="color:#f92672">.</span>line) <span style="color:#66d9ef">else</span> self<span style="color:#f92672">.</span>line <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> p<span style="color:#f92672">.</span>y
            )
            <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> points
        }

    <span style="color:#66d9ef">def</span> __repr__(self):
        <span style="color:#66d9ef">return</span> f<span style="color:#e6db74">&#39;fold@{&#34;x&#34; if self.horizontal else &#34;y&#34;}={self.line}&#39;</span>
</code></pre></div><p>Yes. Those could (mostly) be tuples. But I happen to like putting them in their own classes. The <code>apply_to</code> method is actually the bulk of the functionality here.</p>
<p>What you need to consider is when the <code>x</code>/<code>y</code> of a point <em>do not</em> change. If you&rsquo;re folding a horizontal line, the <code>x</code> will <em>never</em> change (likewise for vertical and <code>y</code>). Also, if you&rsquo;re in the top or left half, you&rsquo;ll not change.</p>
<p>There&rsquo;s only 1 in 4 cases that change: if you&rsquo;re below/right of the fold that&rsquo;s changing.</p>
<p>In that case, you are going to reflect it. In this case, if you&rsquo;re folding a point with <code>y=14</code> over the line <code>y=7</code>, then you should end up with <code>1</code>. Thus <code>line*2-y</code>.</p>
<p>Next, two helper functions in order to load/print the current points:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load</span>(file: TextIO) <span style="color:#f92672">-&gt;</span> Tuple[Set[Point], List[Fold]]:
    points <span style="color:#f92672">=</span> set()
    folds <span style="color:#f92672">=</span> []

    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file:
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#f92672">in</span> line:
            xs, ys <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)
            points<span style="color:#f92672">.</span>add(Point(x<span style="color:#f92672">=</span>int(xs), y<span style="color:#f92672">=</span>int(ys)))

        <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#f92672">in</span> line:
            left, vs <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;=&#39;</span>)
            folds<span style="color:#f92672">.</span>append(Fold(horizontal<span style="color:#f92672">=</span>left<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;y&#39;</span>), line<span style="color:#f92672">=</span>int(vs)))

    <span style="color:#66d9ef">return</span> points, folds

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">render</span>(points: Set[Point]):
    width <span style="color:#f92672">=</span> max(p<span style="color:#f92672">.</span>x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> points)
    height <span style="color:#f92672">=</span> max(p<span style="color:#f92672">.</span>y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> p <span style="color:#f92672">in</span> points)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(
        <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(
            <span style="color:#e6db74">&#39;*&#39;</span> <span style="color:#66d9ef">if</span> Point(x, y) <span style="color:#f92672">in</span> points <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39; &#39;</span>
            <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(width)
        )
        <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(height)
    ))
    <span style="color:#66d9ef">print</span>()
</code></pre></div><p>Straight forward enough. Technically, this is a more flexible format than given (you can mix points and folds in any order), but that&rsquo;s a superset of what we&rsquo;re actually interested in, so good enough.</p>
<p>Now that we have all of that, we can actually do all of the folds&hellip; but we only need the first:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):
    points, folds <span style="color:#f92672">=</span> load(file)
    points <span style="color:#f92672">=</span> folds[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>apply_to(points)
    <span style="color:#66d9ef">print</span>(len(points))
</code></pre></div><p>So short. 😄</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 foldinator.py part1 input.txt
<span style="color:#ae81ff">706</span>
</code></pre></div><p>Heh.</p><p><a href="/2021/12/13/aoc-2021-day-13-foldinator/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/12/aoc-2021-day-12-submarine-spider/" class="clearfix">AoC 2021 Day 12: Submarine Spider</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-12</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-passage-pathinghttpsadventofcodecom2021day12">Source: <a href="https://adventofcode.com/2021/day/12">Passage Pathing</a></h3>
<h4 id="part-1-given-a-list-of-edges-in-a-bi-directional-graph-count-the-number-of-paths-from-start-to-end-such-that-nodes-named-with-lowercase-letters-are-visited-once-and-nodes-with-uppercase-letters-can-be-visited-any-number-of-times"><strong>Part 1:</strong> Given a list of edges in a bi-directional graph, count the number of paths from <code>start</code> to <code>end</code> such that nodes named with lowercase letters are visited once, and nodes with uppercase letters can be visited any number of times.</h4>
<p>Interesting. First, let&rsquo;s define a graph structure:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@dataclass</span>(frozen<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Node</span>:
    label: str

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_big</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>label<span style="color:#f92672">.</span>isupper()

    <span style="color:#66d9ef">def</span> __repr__(self):
        <span style="color:#66d9ef">return</span> f<span style="color:#e6db74">&#39;&lt;{self.label}&gt;&#39;</span>


<span style="color:#a6e22e">@dataclass</span>(frozen<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Cave</span>:
    edges: Mapping[Node, Set[Node]]

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">from_file</span>(file: TextIO):

        edges: Dict[Node, Set[Node]] <span style="color:#f92672">=</span> {}

        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file:
            nodes <span style="color:#f92672">=</span> [Node(v) <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> line<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;-&#39;</span>)]

            <span style="color:#66d9ef">for</span> node <span style="color:#f92672">in</span> nodes:
                <span style="color:#66d9ef">if</span> node <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> edges:
                    edges[node] <span style="color:#f92672">=</span> set()

            <span style="color:#66d9ef">for</span> node_a <span style="color:#f92672">in</span> nodes:
                <span style="color:#66d9ef">for</span> node_b <span style="color:#f92672">in</span> nodes:
                    <span style="color:#66d9ef">if</span> node_a <span style="color:#f92672">!=</span> node_b:
                        edges[node_a]<span style="color:#f92672">.</span>add(node_b)

        <span style="color:#75715e"># Convert to a dict</span>
        <span style="color:#66d9ef">return</span> Cave(edges)
</code></pre></div><p>Originally, I had the pathing function in this class directly, but because it changes for part 2, I extracted it into the part 1 function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):
    cave <span style="color:#f92672">=</span> Cave<span style="color:#f92672">.</span>from_file(file)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">paths</span>(node: Node, visited: Set[Node]) <span style="color:#f92672">-&gt;</span> Generator[List[Node], None, None]:
        <span style="color:#e6db74">&#39;&#39;&#39;Yield all possible paths from the given node to &lt;end&gt;.&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">if</span> node <span style="color:#f92672">==</span> END:
            <span style="color:#66d9ef">yield</span> [END]
            <span style="color:#66d9ef">return</span>

        <span style="color:#66d9ef">if</span> node<span style="color:#f92672">.</span>is_small() <span style="color:#f92672">and</span> node <span style="color:#f92672">in</span> visited:
            <span style="color:#66d9ef">return</span>

        <span style="color:#66d9ef">for</span> next <span style="color:#f92672">in</span> cave<span style="color:#f92672">.</span>edges[node]:
            <span style="color:#66d9ef">for</span> path <span style="color:#f92672">in</span> paths(next, visited <span style="color:#f92672">|</span> {node}):
                <span style="color:#66d9ef">yield</span> [node] <span style="color:#f92672">+</span> path

    count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> paths(START, set()):
        count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

    <span style="color:#66d9ef">print</span>(count)
</code></pre></div><p>Because the paths are short enough, we can get away with a simple recursive function. In this case, <code>paths</code> will take the current point in the graph and a list of nodes visited already (so that we can avoid lowercase nodes that we&rsquo;ve already visited) and generate all paths from that point. It does so by recursion: each step is moving to a neighboring node in the graph, we&rsquo;re assuming the recursive call will generate some number of paths (might be 0), and the base case is the <code>end</code> node.</p>
<p>Note: If there are ever two or more &lsquo;big&rsquo; nodes adjacent to each other, this will totally blow up, since you can infinitely loop between the two. Good thing that doesn&rsquo;t come up in our input. :D This could be fixed with <a href="https://en.wikipedia.org/wiki/cycle%20detection">cycle detection</a>, but that would make teh algorithm somewhat slower&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 submarine-spider.py part1 input.txt
<span style="color:#ae81ff">4749</span>
</code></pre></div><p><a href="/2021/12/12/aoc-2021-day-12-submarine-spider/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/11/aoc-2021-day-11-octopus-flashinator/" class="clearfix">AoC 2021 Day 11: Octopus Flashinator</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-11</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-dumbo-octopushttpsadventofcodecom2021day11">Source: <a href="https://adventofcode.com/2021/day/11">Dumbo Octopus</a></h3>
<h4 id="part-1-simulate-a-grid-of-numbers-such-that-on-each-tick-advance-all-numbers-by-1-any-number-that-increases-over-9-will-flash-and-add-1-to-all-neighbors-recursively-but-each-cell-can-only-flash-once-and-then-reset-to-0-count-the-number-of-flashes-in-the-first-100-ticks"><strong>Part 1:</strong> Simulate a grid of numbers such that on each tick: advance all numbers by 1, any number that increases over 9 will &lsquo;flash&rsquo; and add 1 to all neighbors (recursively, but each cell can only flash once) and then reset to 0. Count the number of flashes in the first 100 ticks.</h4>
<p>DIRECT SIMULATION.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
NEIGHBORS <span style="color:#f92672">=</span> [
    (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>), (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>),
    (<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>), (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>),
    (<span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>), (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>),
]


<span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Cavern</span>:
    <span style="color:#e6db74">&#39;&#39;&#39;Simulation for https://adventofcode.com/2021/day/11.&#39;&#39;&#39;</span>

    width: int
    height: int
    data: MutableMapping[Tuple[int, int], int]

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">from_file</span>(file: TextIO):
        <span style="color:#e6db74">&#39;&#39;&#39;Load a simulation from a file-like object.&#39;&#39;&#39;</span>

        data <span style="color:#f92672">=</span> {
            (x, y): int(value)
            <span style="color:#66d9ef">for</span> x, line <span style="color:#f92672">in</span> enumerate(file)
            <span style="color:#66d9ef">for</span> y, value <span style="color:#f92672">in</span> enumerate(line<span style="color:#f92672">.</span>strip())
        }
        width <span style="color:#f92672">=</span> max(x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> (x, _) <span style="color:#f92672">in</span> data)
        height <span style="color:#f92672">=</span> max(y <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> (_, y) <span style="color:#f92672">in</span> data)

        <span style="color:#66d9ef">return</span> Cavern(width, height, data)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">step</span>(self):
        <span style="color:#e6db74">&#39;&#39;&#39;Advance the simulation 1 step, return the number of flashes.&#39;&#39;&#39;</span>

        flashpoint <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

        <span style="color:#75715e"># First advance everyone 1</span>
        <span style="color:#66d9ef">for</span> (x, y) <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>data:
            self<span style="color:#f92672">.</span>data[x, y] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

        <span style="color:#75715e"># Repeatedly find any 9s, but only trigger each one once (advanced)</span>
        advanced <span style="color:#f92672">=</span> set()
        <span style="color:#66d9ef">while</span> True:

            <span style="color:#75715e"># Find the set of points that haven&#39;t been advanced and should</span>
            to_advance <span style="color:#f92672">=</span> {
                (x, y)
                <span style="color:#66d9ef">for</span> (x, y) <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>data
                <span style="color:#66d9ef">if</span> (x, y) <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> advanced <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>data[x, y] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">9</span>
            }

            <span style="color:#75715e"># If we didn&#39;t, we&#39;re done</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> to_advance:
                <span style="color:#66d9ef">break</span>

            <span style="color:#75715e"># If we did, increment each neighbor</span>
            <span style="color:#66d9ef">for</span> (x, y) <span style="color:#f92672">in</span> to_advance:
                flashpoint <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

                <span style="color:#66d9ef">for</span> (xd, yd) <span style="color:#f92672">in</span> NEIGHBORS:
                    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">+</span> xd, y <span style="color:#f92672">+</span> yd) <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>data:
                        <span style="color:#66d9ef">continue</span>

                    self<span style="color:#f92672">.</span>data[x <span style="color:#f92672">+</span> xd, y <span style="color:#f92672">+</span> yd] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

                advanced<span style="color:#f92672">.</span>add((x, y))

        <span style="color:#75715e"># Once we&#39;re out of the loop, set all points that actually advanced (hit 9) to 0</span>
        <span style="color:#66d9ef">for</span> (x, y) <span style="color:#f92672">in</span> advanced:
            self<span style="color:#f92672">.</span>data[x, y] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

        <span style="color:#66d9ef">return</span> flashpoint

    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(
            <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(str(self<span style="color:#f92672">.</span>data[x, y]) <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>height))
            <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>width)
        ) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</code></pre></div><p>I particularly enjoy that <code>step</code> function. It seems pretty clean to me, using one <code>set</code> of values we&rsquo;ve already <code>advanced</code> and calculating a new <code>set</code> of values <code>to_advance</code> so that we don&rsquo;t duplicate.</p>
<p>And it makes for pretty clean code!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):

    cavern <span style="color:#f92672">=</span> Cavern<span style="color:#f92672">.</span>from_file(file)
    flashpoint <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>):
        flashpoint <span style="color:#f92672">+=</span> cavern<span style="color:#f92672">.</span>step()

    <span style="color:#66d9ef">print</span>(flashpoint)
</code></pre></div><p>How many flashes?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 octopus-flashinator.py part1 input.txt
<span style="color:#ae81ff">1679</span>
</code></pre></div><p><a href="/2021/12/11/aoc-2021-day-11-octopus-flashinator/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/10/aoc-2021-day-10-chunkinator/" class="clearfix">AoC 2021 Day 10: Chunkinator</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-10</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-syntax-scoringhttpsadventofcodecom2021day10">Source: <a href="https://adventofcode.com/2021/day/10">Syntax Scoring</a></h3>
<h4 id="part-1-given-a-sequence-of----and--with-nesting-allowed-find-the-first-syntax-error-where-the-wrong-closing-symbol-is-used-scoring-3-57-1197-and-25137-respectively-for-each-error-calculate-the-total-error-score"><strong>Part 1:</strong> Given a sequence of () [] {}, and &lt;&gt; with nesting allowed. Find the first syntax error (where the wrong closing symbol is used). Scoring 3, 57, 1197, and 25137 respectively for each error, calculate the total error score.</h4>
<p>Interesting. Let&rsquo;s use Python exceptions!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Using the strings directly is fine for python, but not mypy</span>
<span style="color:#75715e"># chunkinator.py:38: error: Unpacking a string is disallowed</span>
pairs <span style="color:#f92672">=</span> [tuple(pair) <span style="color:#66d9ef">for</span> pair <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;()&#39;</span>, <span style="color:#e6db74">&#39;[]&#39;</span>, <span style="color:#e6db74">&#39;{}&#39;</span>, <span style="color:#e6db74">&#39;&lt;&gt;&#39;</span>]]

<span style="color:#a6e22e">@dataclass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ParseMismatchException</span>(<span style="color:#a6e22e">Exception</span>):
    expected: str
    actual: str


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(line: str):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    Parse a line of matching pairs. For every left, you must match the corresponding right (respecting nesting).
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    If a mismatch is detected, raise a ParseMismatchException containing the expected/actual character.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Otherwise, return True
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>

    stack <span style="color:#f92672">=</span> []

    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> line:
        matched <span style="color:#f92672">=</span> False

        <span style="color:#75715e"># Start a new matching pair</span>
        <span style="color:#66d9ef">for</span> left, right <span style="color:#f92672">in</span> pairs:
            <span style="color:#66d9ef">if</span> c <span style="color:#f92672">==</span> left:
                stack<span style="color:#f92672">.</span>append(right)
                matched <span style="color:#f92672">=</span> True
        <span style="color:#66d9ef">if</span> matched:
            <span style="color:#66d9ef">continue</span>

        <span style="color:#75715e"># Otherwise, we have a closing character, check the stack</span>
        <span style="color:#66d9ef">if</span> c <span style="color:#f92672">==</span> (top :<span style="color:#f92672">=</span> stack<span style="color:#f92672">.</span>pop()):
            <span style="color:#66d9ef">continue</span>

        <span style="color:#75715e"># Otherwise, we have a failed match</span>
        <span style="color:#66d9ef">raise</span> ParseMismatchException(expected<span style="color:#f92672">=</span>top, actual<span style="color:#f92672">=</span>c)
    <span style="color:#75715e"># Otherwise, yay!</span>
    <span style="color:#66d9ef">return</span> True
</code></pre></div><p>I expect that we&rsquo;ll want to do something with &lsquo;incomplete&rsquo; matches in Part 2, but we haven&rsquo;t had to do that yet. So let&rsquo;s use this to solve the problem!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):

    scores <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;)&#39;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;]&#39;</span>: <span style="color:#ae81ff">57</span>, <span style="color:#e6db74">&#39;}&#39;</span>: <span style="color:#ae81ff">1197</span>, <span style="color:#e6db74">&#39;&gt;&#39;</span>: <span style="color:#ae81ff">25137</span>}
    total_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file:
        line <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>strip()

        <span style="color:#66d9ef">try</span>:
            parse(line)

        <span style="color:#66d9ef">except</span> ParseMismatchException <span style="color:#66d9ef">as</span> ex:
            total_score <span style="color:#f92672">+=</span> scores[ex<span style="color:#f92672">.</span>actual]

    <span style="color:#66d9ef">print</span>(total_score)
</code></pre></div><p>I like it when the parsing function does most of the work!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 chunkinator.py part1 input.txt
<span style="color:#ae81ff">167379</span>
</code></pre></div><p><a href="/2021/12/10/aoc-2021-day-10-chunkinator/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/" class="clearfix">AoC 2021 Day 9: Local Minimum Deminifier</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-09</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-smoke-basinhttpsadventofcodecom2021day9">Source: <a href="https://adventofcode.com/2021/day/9">Smoke Basin</a></h3>
<h4 id="part-1-given-a-heightmap-find-all-local-minimums-return-the-sum-of-minimum-height--1-for-each-local-minimum"><strong>Part 1:</strong> Given a heightmap, find all local minimums. Return the sum of (minimum height + 1) for each local minimum.</h4>
<p>First, as is often the case, let&rsquo;s load the data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load</span>(file: TextIO) <span style="color:#f92672">-&gt;</span> MutableMapping[Tuple[int, int], int]:
    <span style="color:#66d9ef">return</span> {
        (x, y): int(height)
        <span style="color:#66d9ef">for</span> y, line <span style="color:#f92672">in</span> enumerate(file)
        <span style="color:#66d9ef">for</span> x, height <span style="color:#f92672">in</span> enumerate(line<span style="color:#f92672">.</span>strip())
    }
</code></pre></div><p>This could more efficiently have been stored in a 2D array, but I really like dicts of <code>point -&gt; value</code> for this sort of thing. Especially because in Python you don&rsquo;t actually need the <code>()</code> for tuples in most cases, just the comma. So <code>heightmap[x,y]</code> works great.</p>
<p>After we have that data, it&rsquo;s just a matter of checking each point to see if all 2/3/4 neighbors are larger than a specific point, while at the same time making sure that we don&rsquo;t run off the edge of the map.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@app.command</span>()
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):

    heightmap <span style="color:#f92672">=</span> load(file)
    total_risk <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">for</span> (x, y), height <span style="color:#f92672">in</span> heightmap<span style="color:#f92672">.</span>items():
        neighbor_heights <span style="color:#f92672">=</span> [
            heightmap<span style="color:#f92672">.</span>get((x <span style="color:#f92672">+</span> xd, y <span style="color:#f92672">+</span> yd), <span style="color:#ae81ff">10</span>)
            <span style="color:#66d9ef">for</span> xd, yd <span style="color:#f92672">in</span> ORTHAGONAL_NEIGHBORS
        ]

        <span style="color:#66d9ef">if</span> min(neighbor_heights) <span style="color:#f92672">&gt;</span> height:
            total_risk <span style="color:#f92672">+=</span> height <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>

    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;{total_risk=}&#39;</span>)
</code></pre></div><p><code>ORTHAGONAL_NEIGHBORS = [(-1, 0), (1, 0), (0, -1), (0, 1)]</code>. And that&rsquo;s all we need:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 local-minimum-deminifier.py part1 input.txt
total_risk<span style="color:#f92672">=</span><span style="color:#ae81ff">491</span>
</code></pre></div><p><a href="/2021/12/09/aoc-2021-day-9-local-minimum-deminifier/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/08/aoc-2021-day-8-seven-segment-demystifier/" class="clearfix">AoC 2021 Day 8: Seven Segment Demystifier</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-08</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-seven-segment-searchhttpsadventofcodecom2021day8">Source: <a href="https://adventofcode.com/2021/day/8">Seven Segment Search</a></h3>
<h4 id="part-1-simulate-a-hahahugoshortcode-s0-hbhb-where-you-do-not-know-which-input-wire-controls-which-segment-given-the-wires-used-in-all-ten-digits-and-four-output-digits-count-how-many-times-1-4-7-and-8-are-outputted"><strong>Part 1:</strong> Simulate a <a href="https://en.wikipedia.org/wiki/seven%20segment%20displey">seven segment displey</a> where you do not know which input wire controls which segment. Given the wires used in all ten digits and four output digits, count how many times 1, 4, 7, and 8 are outputted.</h4>
<p>This one took me <em>far</em> longer to work out than I&rsquo;d care to admit. And it wasn&rsquo;t at all because I had the wrong approach (I went for brute force again), but rather because I had <em>mistyped one character</em> in my input. Bah humbug. That&rsquo;s why you write tests&hellip; Oy.</p>
<p>Like I mentioned, I&rsquo;m just going to try to brute force this problem. It will be slower than using their advice (the advice being that there is always 1 input with two segments (one) and 1 with 3 (seven). Instead, brute forcing all ten digits makes for much cleaner code. First, let&rsquo;s set up some constants:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Seven segment display</span>
<span style="color:#75715e">#   0:      1:      2:      3:      4:</span>
<span style="color:#75715e">#  aaaa    ....    aaaa    aaaa    ....</span>
<span style="color:#75715e"># b    c  .    c  .    c  .    c  b    c</span>
<span style="color:#75715e"># b    c  .    c  .    c  .    c  b    c</span>
<span style="color:#75715e">#  ....    ....    dddd    dddd    dddd</span>
<span style="color:#75715e"># e    f  .    f  e    .  .    f  .    f</span>
<span style="color:#75715e"># e    f  .    f  e    .  .    f  .    f</span>
<span style="color:#75715e">#  gggg    ....    gggg    gggg    ....</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#   5:      6:      7:      8:      9:</span>
<span style="color:#75715e">#  aaaa    aaaa    aaaa    aaaa    aaaa</span>
<span style="color:#75715e"># b    .  b    .  .    c  b    c  b    c</span>
<span style="color:#75715e"># b    .  b    .  .    c  b    c  b    c</span>
<span style="color:#75715e">#  dddd    dddd    ....    dddd    dddd</span>
<span style="color:#75715e"># .    f  e    f  .    f  e    f  .    f</span>
<span style="color:#75715e"># .    f  e    f  .    f  e    f  .    f</span>
<span style="color:#75715e">#  gggg    gggg    ....    gggg    gggg</span>

SEGMENTS <span style="color:#f92672">=</span> [
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
    {<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>},
]

ALPHABET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;abcdefg&#39;</span>
MAPPINGS <span style="color:#f92672">=</span> [
    dict(zip(ALPHABET, ordering))
    <span style="color:#66d9ef">for</span> ordering <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>permutations(ALPHABET)
]
</code></pre></div><p>The <code>SEGMENTS</code> define a set of correctly labeled wires goes to each segment (in order). So <code>0</code> uses all of them but <code>d</code>, <code>1</code> uses only <code>c</code> and <code>f</code>, etc.</p>
<p><code>MAPPINGS</code> is a neat trick. Using <code><a href="https://docs.python.org/3/search.html?q=itertools.permutations">itertools.permutations</a></code>
, we can generate all possible arrangements of the 7 letters in <code>ALPHABET</code>. We then zip each <code>ordering</code> up with <code>ALPHABET</code>, convert to a <code>dict</code> and we have a conversion. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> MAPPINGS[<span style="color:#ae81ff">286</span>]
{<span style="color:#e6db74">&#39;a&#39;</span>: <span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>: <span style="color:#e6db74">&#39;d&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>: <span style="color:#e6db74">&#39;c&#39;</span>, <span style="color:#e6db74">&#39;d&#39;</span>: <span style="color:#e6db74">&#39;g&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>: <span style="color:#e6db74">&#39;f&#39;</span>, <span style="color:#e6db74">&#39;f&#39;</span>: <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;g&#39;</span>: <span style="color:#e6db74">&#39;e&#39;</span>}
<span style="color:#f92672">&gt;&gt;&gt;</span> MAPPINGS[<span style="color:#ae81ff">286</span>][<span style="color:#e6db74">&#39;a&#39;</span>]
<span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> MAPPINGS[<span style="color:#ae81ff">286</span>][<span style="color:#e6db74">&#39;g&#39;</span>]
<span style="color:#e6db74">&#39;e&#39;</span>
</code></pre></div><p>In this case, input wire <code>a</code> maps to output <code>a</code>, but <code>g</code> maps to <code>e</code>, etc.</p>
<p>Okay. Fun part. For each input, we have all ten digits, with the input wires that makes those up, but we don&rsquo;t know which mapping matches. But we do know if a <code>mapping</code> is valid, it will have to turn each of those ten inputs into one of the possible <code>SEGMENTS</code>. So we can do this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load</span>(file: TextIO) <span style="color:#f92672">-&gt;</span> Generator[List[int], None, None]:
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    Load an input file with a scrambled set of 7 segment displays than 4 output digits.&#39;&#39;&#39;</span>

    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file:
        raw_inputs, raw_outputs <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; | &#39;</span>)
        inputs <span style="color:#f92672">=</span> [set(input) <span style="color:#66d9ef">for</span> input <span style="color:#f92672">in</span> raw_inputs<span style="color:#f92672">.</span>split()]
        outputs <span style="color:#f92672">=</span> [set(output) <span style="color:#66d9ef">for</span> output <span style="color:#f92672">in</span> raw_outputs<span style="color:#f92672">.</span>split()]

        <span style="color:#66d9ef">for</span> mapping <span style="color:#f92672">in</span> MAPPINGS:
            <span style="color:#66d9ef">if</span> any(
                {mapping[v] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> input} <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> SEGMENTS
                <span style="color:#66d9ef">for</span> input <span style="color:#f92672">in</span> inputs
            ):
                <span style="color:#66d9ef">continue</span>

            <span style="color:#66d9ef">yield</span> [
                SEGMENTS<span style="color:#f92672">.</span>index({mapping[v] <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> output})
                <span style="color:#66d9ef">for</span> output <span style="color:#f92672">in</span> outputs
            ]
</code></pre></div><p>We&rsquo;ll take the input (which looks like <code>acedgfb cdfbe gcdfa fbcad dab cefabd cdfgeb eafb cagedb ab | cdfeb fcadb cdfeb cdbaf</code>), split the input and output, and then go through each <code>mapping</code>. The line <code>{mapping[v] for v in input}</code> creates the output given the mapping, so we apply that to every <code>input</code> in <code>inputs</code> and check for any <em>not</em> in <code>SEGMENTS</code>. If that&rsquo;s the case, the mapping isn&rsquo;t valid, so skip it. We should have exactly 1 mapping that&rsquo;s valid, so decode the outputs (using that same mapping) and <code>yield</code> the resulting digits.</p>
<p>I expect that&rsquo;s overkill / already implementing part 2&hellip; but that&rsquo;s okay!</p>
<p>Since we have the digits, count up the 1, 4, 7, and 8 (they&rsquo;re the easiest to determine).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):
    <span style="color:#66d9ef">print</span>(sum(
        <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> digit <span style="color:#f92672">in</span> (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>) <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
        <span style="color:#66d9ef">for</span> digits <span style="color:#f92672">in</span> load(file)
        <span style="color:#66d9ef">for</span> digit <span style="color:#f92672">in</span> digits
    ))
</code></pre></div><p>Yeah&hellip; that&rsquo;s it!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 seven-segment-demystifier.py part1 input.txt
<span style="color:#ae81ff">349</span>
</code></pre></div><p><a href="/2021/12/08/aoc-2021-day-8-seven-segment-demystifier/">read more...</a></p></div>

        <hr /></article><article class="li">
    	<header>
    		<h1 class="entry-title">
                <a href="https://blog.jverkamp.com/2021/12/07/aoc-2021-day-7-brachyura-aligner/" class="clearfix">AoC 2021 Day 7: Brachyura Aligner</a></h1>

    		<div class="entry-meta"><span class="entry-date">2021-12-07</span>
                </div>
    	</header>
    	<div class="entry-content"><h3 id="source-the-treachery-of-whaleshttpsadventofcodecom2021day7">Source: <a href="https://adventofcode.com/2021/day/7">The Treachery of Whales</a></h3>
<h4 id="part-1-given-a-list-of-numbers-find-the-minimum-integer-i-such-the-sum-difference-of-each-number-and-i-is-minimized"><strong>Part 1:</strong> Given a list of numbers, find the minimum integer <code>I</code> such the sum difference of each number and I is minimized.</h4>
<p>There is probably a fancy number theory way of doing it to solve directly for <code>I</code>, but it&rsquo;s a really quick problem to brute force:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">part1</span>(file: typer<span style="color:#f92672">.</span>FileText):

    positions <span style="color:#f92672">=</span> [
        int(value)
        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file
        <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)
    ]

    fuel, target <span style="color:#f92672">=</span> min(
        (
            sum(abs(position <span style="color:#f92672">-</span> target) <span style="color:#66d9ef">for</span> position <span style="color:#f92672">in</span> positions),
            target
        )
        <span style="color:#66d9ef">for</span> target <span style="color:#f92672">in</span> range(min(positions), max(positions)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
    )

    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;{target=}, {fuel=}&#39;</span>)
</code></pre></div><p>Load in the numbers, calculate every possible <code>target</code> from minimum to maximum and the sum distance for that value of <code>I</code>, then return just the minimum such value.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 brachyura-aligner.py part1 input.txt
target<span style="color:#f92672">=</span>323, fuel<span style="color:#f92672">=</span><span style="color:#ae81ff">336040</span>
</code></pre></div><p>Quick.</p><p><a href="/2021/12/07/aoc-2021-day-7-brachyura-aligner/">read more...</a></p></div>

        <hr /></article><nav id="pagination-navigation" role="navigation">
<ul class="pagination">
  <li class="page-item">
    <a href="/series/advent-of-code-2021/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
  </li>
  <li class="page-item disabled">
    <a  class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
  </li>
  <li class="page-item active">
    <a class="page-link" href="/series/advent-of-code-2021/">1</a>
  </li>
  <li class="page-item">
    <a class="page-link" href="/series/advent-of-code-2021/page/2/">2</a>
  </li>
  <li class="page-item">
    <a href="/series/advent-of-code-2021/page/2/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
  </li>
  <li class="page-item">
    <a href="/series/advent-of-code-2021/page/2/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
  </li>
</ul>

</nav></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/series/atom.xml">
                    RSS: series<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
