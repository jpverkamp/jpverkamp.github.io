<!doctype html><html><head><title>StackLang Part I: The Idea – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.30448892aa1f91e9c4cb5494e5c5e5abc13b7778de7786e5256cdc7d2424813a.js integrity="sha256-MESIkqofkenEy1SU5cXlq8E7d3jed4blJWzcfSQkgTo=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg=" defer></script>
<script src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90=" defer></script>
<script src=/main.min.982c2d7bb434b4cf8b19c2cf38ef7e7f7162ddbed610e5bdddbb937001e26574.js integrity="sha256-mCwte7Q0tM+LGcLPOO9+f3Fi3b7WEOW93buTcAHiZXQ=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.7cfac95bdd962d85ceec560e50fe7b04c44b58a76e5202006ef36ca8c0a7d836.css integrity="sha256-fPrJW92WLYXO7FYOUP57BMRLWKduUgIAbvNsqMCn2DY="><link rel=stylesheet href=/main.min.9efa38cb8d96be1a2d31208e5279a2f48fd2a15f6bcc9173c7375c675225b767.css integrity="sha256-nvo4y42WvhotMSCOUnmi9I/SoV9rzJFzxzdcZ1Ilt2c="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>StackLang Part I: The Idea</h1><div class=entry-meta><span class=entry-date>2023-04-14</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2023/03/26/redis-in-rust-evictions-and-implementations/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/rust>Rust</a></li><li><a class=taxonomy-value href=/programming/languages/stacklang>StackLang</a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2017/12/25/aoc-2017-day-25-turing/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/assemblers>Assemblers</a></li><li><a href=https://blog.jverkamp.com/2023/01/17/proc-macro-workshop-derivebuilder-part-2/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/compilers>Compilers</a></li><li><a href=https://blog.jverkamp.com/2023/01/31/cloning-redis-in-rust-resp-part-1/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/data-structures>Data Structures</a></li><li><a href=https://blog.jverkamp.com/2013/08/22/tiny-turing-completeness-without-mmov/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/memory>Memory</a></li><li><a href=https://blog.jverkamp.com/2022/12/05/aoc-2022-day-5-stackinator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/stacks>Stacks</a></li><li><a href=https://blog.jverkamp.com/2017/12/25/aoc-2017-day-25-turing/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/virtual-machines>Virtual Machines</a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/series/stacklang>StackLang</a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2023/03/27/wildcard-lets-encrypt-certificates-with-nginx-proxy-manager-and-cloudflare/ class=previous-link>Prev</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2023/04/14/ultimate-spider-man-volume-14-warriors/ class=previous-link>Prev</a></ul></li></ul></div></div></header><div class=entry-content><p>I enjoy writing programming languages. {examples}. Let’s do that again.</p><p>This time, StackLang:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>{
</span></span><span style=display:flex><span>  @[n fact]
</span></span><span style=display:flex><span>  1
</span></span><span style=display:flex><span>  { n 1 - $fact fact n * }
</span></span><span style=display:flex><span>  N 1 &lt;= if
</span></span><span style=display:flex><span>} @fact
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>5 $fact fact writeln
</span></span></code></pre></div><p>Bit of gibberish there, I suppose, but the goal is to write everything in a postfix/stack based model. So <code>n 1 - $fact fact n *</code> is equivalent to <code>fact(fact, n - 1) * n</code> in a more traditional language.</p><p>Over the next few posts, I hope to write up where I am thus far and what’s next.</p><hr><p>Posts in this series:</p><div class=ranking><h3 class=title>Posts in <a href=/series/stacklang/>StackLang</a>:</h3><div class=content><ul><li><a href=https://blog.jverkamp.com/2023/04/14/stacklang-part-i-the-idea/>StackLang Part I: The Idea</a></li></ul></div></div><p>This post:</p><nav id=TableOfContents><ul><li><a href=#literals>Literals</a><ul><li><a href=#the-numeric-tower>The Numeric Tower</a></li></ul></li><li><a href=#identifiers-and-named-indexes>Identifiers and Named Indexes</a></li><li><a href=#blocks>Blocks</a><ul><li><a href=#arity>Arity</a></li><li><a href=#implicit-arity>Implicit Arity</a></li><li><a href=#explicit-arity>Explicit arity</a></li><li><a href=#extra-data>Extra data</a></li><li><a href=#naming-blocks>Naming blocks</a></li><li><a href=#passing-a-block-to-another-block>Passing a block to another block</a></li><li><a href=#explicit-recursion>Explicit recursion</a></li></ul></li><li><a href=#control-flow>Control flow</a></li><li><a href=#structs>Structs</a></li><li><a href=#thats-all-for-now>That&rsquo;s all for now</a></li></ul></nav><p>Full source code for StackLang: <a href=https://github.com/jpverkamp/stacklang/>github:jpverkamp/stacklang</a></p><h2 id=literals>Literals</h2><p>You have to start somewhere!</p><p>First, literals I support or intend to support:</p><ul><li>Numbers: a Lisp/Scheme style {numeric tower}: integers, rational numbers, floats, and complex numbers</li><li>Strings: double quoted; I intend to include multi line strings but I’m not sure if I want to support that with normal strings, backticks (JavaScript style), or triple quoted (Python style)</li><li>Booleans: true and false</li></ul><h3 id=the-numeric-tower>The Numeric Tower</h3><p>As in many Schemes, numbers form a ‘numeric tower’ of increasing complexity. When any mathematical operation is performed, numeric values will be automatically implicitly coerced to the same type. So adding a rational and float will result in a float, for example.</p><p>To convert the other way (and possibly truncate values) must be done explicitly.</p><h2 id=identifiers-and-named-indexes>Identifiers and Named Indexes</h2><p>I’m currently going Scheme style with identifiers. If you want to name a variant <code>is-awesome?</code>, go for it. The only exceptions are:</p><ol><li>Brackets. <code>{}</code> define blocks, <code>[]</code> define lists, and <code>()</code> are for grouping. None of these can be used in an identifier.</li><li>Dots, <code>.</code>. I intend to allow struct fields and implemented methods to use dot syntax directly. See {structs} for more information. So not dots in identifiers.</li><li>Special prefixes; these symbols have a special meaning when attached to the beginning of an identifier (so they’re allowed in identifiers but not as the prefix):<ul><li><code>@</code> names the top value of the stack, so <code>@n</code> lets you write <code>n</code> later to push whatever value is ‘at’ <code>n</code>, no matter how far down the stack</li><li><code>!</code> writes to a named variable, so <code>5 !n</code> is equivalent to <code>n = 5</code>; you can just use the same name again (and shadow the previous one)</li><li><code>$</code> lets you pass a block as a value rather than applying it, I’ll demonstrate this later</li></ul></li></ol><p>Other than that, most anything goes. Whitespace, brackets, and dots act as delimiters. Anything that can be parsed as a different sort of literal will be.</p><h2 id=blocks>Blocks</h2><p>Blocks are the building blocks (heh) of more complicated control structures. Every block will be delimited by <code>{}</code>, have a two part arity: in and out (see below), and then have as many other expressions as needed.</p><p>Here are some example blocks:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># Add 2 to the top value of the stack
</span></span><span style=display:flex><span>{ 2 + }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Duplicate the top value of the stack
</span></span><span style=display:flex><span>{ @n !2 n n }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Test if a number is even or odd
</span></span><span style=display:flex><span>{ @n “even” “odd” n 2 % 0 == if }
</span></span></code></pre></div><h3 id=arity>Arity</h3><p>Since all functions use the same stack, arity in is the number of variables that are available from the call site (and will be removed by calling the block). As an example, most mathematical functions have an arity in of 2. <code>if</code> has an arity in of 3 (true, false, and condition). Literals can be thought of as having an arity in of 0.</p><p>Likewise, arity out is how many more values should be on the stack after execution. So mathematical expressions have arity out of 1 as do literals. <code>writeln</code> has an arity out of 0; it doesn’t output anything.</p><h3 id=implicit-arity>Implicit Arity</h3><p>When possible, the arity of a block will be automatically calculated. So, <code>{ 2 + }</code> has an implicit arity of 1 to 1. It will read one value, (add 2 to it), and return one value. If an arity cannot be determined though, you can (and must) specify it explicitly.</p><h3 id=explicit-arity>Explicit arity</h3><p>To explicitly specify the arity, the first 1 or 2 expressions of the the block are used with <code>@</code> for arity in and <code>!</code> for arity out:</p><ul><li><code>@n</code> specifies an arity in of 1 and assigns the name <code>n</code></li><li><code>@[a b c]</code> specified an arity in of 3 and assigns the names <code>a</code>, <code>b</code>, and <code>c</code>. In this case <code>c</code> will be the current top of the stack with <code>b</code> beneath it and<code>a</code> beneath that</li><li><code>@2</code> specifies an arity in of 2 without naming any variables</li><li>If only arity out is specified explicitly, arity in is assumed to be 0</li><li><code>!n</code> specifies an output arity of 1 from the named value <code>n</code> rather than the top of the stack</li><li><code>![a b c]</code> specifies an output arity of 3 from the named variables, <code>a</code> pushed first and <code>c</code> last</li><li><code>!2</code> specifies an arity out of 2 from the top of the stack</li><li>If only arity in is specified explicitly, arity out is assumed to be 1</li></ul><h3 id=extra-data>Extra data</h3><p>It’s entirely possible to work with more data on the stack than the output arity. When that happens, any extra values are dropped and the arity out values will end up at the new top of the stack.</p><p>So this block:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>{
</span></span><span style=display:flex><span>  @n
</span></span><span style=display:flex><span>  “Hello” 42 “times”
</span></span><span style=display:flex><span>  n
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Will take in one value, push three values on top of it (Hello, 42, and times), the push a copy of whatever original value was in <code>n</code>. It will then drop the original <code>n</code>, the three pushed values, and move the copy of <code>n</code> to the stack and return control.</p><h3 id=naming-blocks>Naming blocks</h3><p>A block is not directly evaluated, but rather placed on the stack, as would any other value. You can then name it with <code>@</code>, once again, the same as any other value. So this code creates the ‘function’ <code>add2</code> out of a block:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>{
</span></span><span style=display:flex><span>  @n
</span></span><span style=display:flex><span>  2 n + 
</span></span><span style=display:flex><span>} @add2
</span></span></code></pre></div><p>At any future point, whenever you reference a block by name, it will be automatically applied, so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>10 add2 # 12
</span></span></code></pre></div><p>Alternatively, you can directly <code>apply</code> a block with the built in of that same name. So if you for some reason wanted to, the following are equivalent:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span># Directly adding 5 + 7
</span></span><span style=display:flex><span>5 7 +
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Creating an unnamed add7 block and applying it
</span></span><span style=display:flex><span>5 { @n 7 n + } apply
</span></span></code></pre></div><h3 id=passing-a-block-to-another-block>Passing a block to another block</h3><p>This does raise the more ‘functional’ question of what do you do if you want to pass a block to another block. This is what the prefix <code>$</code> is for:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>{ @[n f] n f f } do-twice
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10 $add2 do-twice # passed add2 as f, result is 12
</span></span></code></pre></div><h3 id=explicit-recursion>Explicit recursion</h3><p>Being able to pass a block to itself allows for recursion. For example, to recursively define the factorial function, you could do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>{
</span></span><span style=display:flex><span>	@[n fact]
</span></span><span style=display:flex><span>  1
</span></span><span style=display:flex><span>  { @n n 1 - $fact fact n * }
</span></span><span style=display:flex><span>  n 1 &lt;= if
</span></span><span style=display:flex><span>} @fact
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>5 $fact fact # 120
</span></span></code></pre></div><p>I’m still working on a better syntax for that. Options are <code>5 fact.recur</code> and <code>$block @fact</code> within the block.</p><h2 id=control-flow>Control flow</h2><p>There are currently only two control flow structures that I have added, although I will likely add more: <code>if</code> and <code>loop</code>.</p><p><code>if</code> takes 3 variables: the value or block if true, value or block if false, and conditional. As mentioned, the value or block for true or false can be either. If it’s a block, the one that is not chosen will not be evaluated (to, for example, prevent infinite recursion in the <code>factorial</code> example above.</p><p>Each of the blocks (and the literals, although this comes for free) should have the same arity.</p><p><code>loop</code> takes a block and an iterable or number. If it’s an iterable, it will call the block once with each value of the iterable. If a number, it will count up from 0 to n-1. So, for example, you could implement factorial like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>{
</span></span><span style=display:flex><span>  @n
</span></span><span style=display:flex><span>  1 { 1 + * } n loop
</span></span><span style=display:flex><span>} @fact
</span></span></code></pre></div><p>This will start with 1 and then from 0 to n-1 take the number, add 1 to it, and multiply the current top of the stack by it. This loop body has an implicit arity in of 2 and arity out of 1. The arity of the loop block can be anything, but not having out be 1 less than in can cause odd side effects (that will be dropped when the enclosing block returns).</p><h2 id=structs>Structs</h2><p>Currently all values are simple single values you can store on the stack. But you can do also define custom structs with custom methods like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[ x y ] @Point
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  @[self other]
</span></span><span style=display:flex><span>  self.x other.x +
</span></span><span style=display:flex><span>  self.y other.y +
</span></span><span style=display:flex><span>  Point
</span></span><span style=display:flex><span>} Point.add
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2 3 Point @p1
</span></span><span style=display:flex><span>4 5 Point @p2
</span></span><span style=display:flex><span>P2 p1.add 
</span></span><span style=display:flex><span># [6 7]
</span></span></code></pre></div><p>The dot syntax can also act on a non-named value on top of the stack if there’s nothing before the dot:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>2 3 Point 
</span></span><span style=display:flex><span>4 5 Point
</span></span><span style=display:flex><span>.add # [6 7]
</span></span></code></pre></div><p>In this case, the <code>.add</code> is being called on the Point <code>[4, 5]</code> with <code>[2, 3]</code> as other, which may be counter intuitive, so naming is probably the more common approach.</p><h2 id=thats-all-for-now>That&rsquo;s all for now</h2><p>Okay, that&rsquo;s more than enough to get going with, next up&mldr; lexing!</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>