<!doctype html><html><head><title>Runelang: A Bind Rune Generator â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.b60cba31b8c292392a2d336408f8f344e261df78516eb17bcf029173b24a42b5.css integrity="sha256-tgy6MbjCkjkqLTNkCPjzROJh33hRbrF7zwKRc7JKQrU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Runelang: A Bind Rune Generator</h1><div class=entry-meta><span class=entry-date>2022-08-25</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2022/07/16/runelang-evaluation/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/javascript>Javascript</a><a href=https://blog.jverkamp.com/2022/08/29/runelang-a-summoning-circle-generator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2022/07/16/runelang-evaluation/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/generative-art>Generative Art</a><a href=https://blog.jverkamp.com/2022/08/29/runelang-a-summoning-circle-generator/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2022/07/16/runelang-evaluation/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/procedural-content>Procedural Content</a><a href=https://blog.jverkamp.com/2022/08/29/runelang-a-summoning-circle-generator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2022/07/16/runelang-evaluation/ class=previous-link></a><a class=taxonomy-value href=/series/runelang-in-the-browser>Runelang in the Browser</a><a href=https://blog.jverkamp.com/2022/08/29/runelang-a-summoning-circle-generator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2022/07/16/runelang-evaluation/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2022/08/29/runelang-a-summoning-circle-generator/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2022/08/23/everything-everywhere-all-at-once/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2022/08/27/fruits-basket-season-2/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Continuing with my <a href=/series/runelang-in-the-browser/>Runelang in the Browser</a> series, I had the idea to automatically generate runes. So basically reversing the parsing step, rather than to take what I&rsquo;ve written and make it look good, to write something that Runelang can parse&ndash;and still look good.</p><p>In a nutshell, I want to write a series of functions that can recursively call one another to render runes:</p><ul><li><code>generate_bind_rune</code><ul><li><em>n</em> times <code>generate_bind_rune_arm</code><ul><li><em>m</em> times generate bars, circles, and other decrations</li><li>add a fork at the end</li></ul></li></ul></li></ul><h2 id=generate-bind-rune>Generate Bind Rune</h2><p>I&rsquo;ll follow up with a few other styles, but for this first one, here&rsquo;s what we have:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generate_rune</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stdlib</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#34;rune {&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>choose</span>(<span style=color:#a6e22e>generate_bind_rune</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;}&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generate_bind_rune</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#34;stroke(weight: 5) scale(0.75) {&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#34;radial(offset: 0) [&#34;</span>)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>generate_bind_rune_arm</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;]&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;}&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generate_bind_rune_arm</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#34;stack [&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>&#34;line&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#34;linear(scale: 0.25, min: 0.5) [&#34;</span>)
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>5</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>choose</span>(
</span></span><span style=display:flex><span>        <span style=color:#75715e>// cross bar
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#ae81ff>8</span>,
</span></span><span style=display:flex><span>        () =&gt; <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>&#34;bar&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e>// half circle in
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>        () =&gt; <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>&#34;group { translate(y: -0.25) scale(0.5) arc(-1/4, 1/4) }&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e>// half circle out
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>        () =&gt; <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>&#34;group { translate(y: 0.25) scale(0.5) arc(1/4, -1/4) }&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e>// full circle
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        () =&gt; <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>&#39;scale(0.25) fill(&#34;none&#34;) circle&#39;</span>),
</span></span><span style=display:flex><span>        <span style=color:#75715e>// two dots
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        () =&gt; {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#39;fill(&#34;black&#34;) stack [&#39;</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>&#34;{ translate(-0.5) scale(0.1) circle }&#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>&#34;{ translate(0.5) scale(0.1) circle }&#34;</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;]&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>`fork(</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>)`</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;]&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;]&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// main
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>generate_rune</span>()
</span></span></code></pre></div><p>Fairly straight forward to start with, if you assume that all of those helper functions do what you expect them to do:</p><ul><li><code>block</code>: starts an indented block (can be nested)</li><li><code>end_block</code>: ends the indentation of a previous block</li><li><code>line</code>: outputs a properly indented line of text</li><li><code>choose</code>: random choose and output one of many options, with optional weights</li><li><code>random_float</code> and <code>random_int</code>: wrap <code>random</code> to generate random numbers with given bounds</li></ul><p>So let&rsquo;s go through each of those.</p><h2 id=indentation-levels-block-and-end_block>Indentation levels: <code>block</code> and <code>end_block</code></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>INDENTATION_STRING</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;  &#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>INDENTATION_LEVEL</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>block</span>(<span style=color:#a6e22e>text</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>text</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>INDENTATION_LEVEL</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>end_block</span>(<span style=color:#a6e22e>text</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>INDENTATION_LEVEL</span><span style=color:#f92672>--</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>text</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>All this does is keep track of a global (I know) indentation level, incrementing it when we see a <code>block</code> and decrementing it when we see an <code>end_block</code>. You do have to make sure to do that in the proper order, otherwise you&rsquo;ll end up with the end block as part of the block (Python style) rather than as being at the level of the opening.</p><h2 id=single-lines-line>Single lines: <code>line</code></h2><p>Next, rendering single lines to the right level:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>text</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>INDENTATION_STRING</span>.<span style=color:#a6e22e>repeat</span>(<span style=color:#a6e22e>INDENTATION_LEVEL</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>text</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Not much there.</p><h2 id=weighty-choices-choose>Weighty choices: <code>choose</code></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>choose</span>(...<span style=color:#a6e22e>options</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>weights</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>total_options</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Number.<span style=color:#a6e22e>isInteger</span>(<span style=color:#a6e22e>options</span>[<span style=color:#a6e22e>i</span>])) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>weights</span>.<span style=color:#a6e22e>push</span>([<span style=color:#a6e22e>options</span>[<span style=color:#a6e22e>i</span>], <span style=color:#a6e22e>options</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]])
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>total_options</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>options</span>[<span style=color:#a6e22e>i</span>]
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>weights</span>.<span style=color:#a6e22e>push</span>([<span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>options</span>[<span style=color:#a6e22e>i</span>]])
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>total_options</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>total_options</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> [<span style=color:#a6e22e>weight</span>, <span style=color:#a6e22e>option</span>] <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>weights</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>value</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>weight</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>option</span> <span style=color:#66d9ef>instanceof</span> Function) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>option</span>()
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>option</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>value</span> <span style=color:#f92672>-=</span> <span style=color:#a6e22e>weight</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;out of range choice)&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is an interesting function, in large part because the arguments are so dynamic. You can specify any number of children to randomly choose between, along with optional weights. So you could have:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>// Randomly choose between a, b, and c
</span></span><span style=display:flex><span>choose(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// Randomly choose between a, b, and c with each twice as likely as the next
</span></span><span style=display:flex><span>choose(4, &#39;a&#39;, 2, &#39;b&#39;, &#39;c&#39;)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// Randomly choose a function with hello() twice as likely
</span></span><span style=display:flex><span>function hello() {}
</span></span><span style=display:flex><span>function world() {}
</span></span><span style=display:flex><span>choose(2, hello, world)
</span></span></code></pre></div><p>It&rsquo;s a bit persnickity if you want to randomly choose numeric values. Technically you can, but you always have to specify the weight. I think it&rsquo;s probably best if you don&rsquo;t though.</p><h2 id=random-numbers>Random numbers</h2><p>And finally, wrappers for random numbers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>random_float</span>(<span style=color:#a6e22e>min</span>, <span style=color:#a6e22e>max</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>min</span> <span style=color:#f92672>||=</span> <span style=color:#ae81ff>0.0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>max</span> <span style=color:#f92672>||=</span> <span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> (<span style=color:#a6e22e>max</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>min</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>min</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>random_int</span>(<span style=color:#a6e22e>min</span>, <span style=color:#a6e22e>max</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>max</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>max</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>min</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>min</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>floor</span>(Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>max</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>min</span>)) <span style=color:#f92672>+</span> <span style=color:#a6e22e>min</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=demo>Demo</h2><p>Demo time!</p><script defer type=module>
import { render } from '/embeds/runelang/runelang/main.js'
import logging from '/embeds/runelang/lib/logging.js'

const log = logging.get("system")

let elInput = document.querySelector('[data-input]')
let elOutput = document.querySelector('[data-output]')
let elLog = document.querySelector('[data-log]')

elInput.value = `
`

const INDENTATION_STRING = "  "
let INDENTATION_LEVEL = 0

function stdlib() {
  console.log(`
define bar { translate(x: 0.5) rotate(0.25) line }

define fork(n) {
  translate(x: 0.5) rotate(0.25) {
    line
    linear [
      rotate(0.25) translate(y: -0.5) scale(0.5) line
      times n
    ]
  }
}
  `)
}

function block(text) {
  line(text)
  INDENTATION_LEVEL++
}

function end_block(text) {
  INDENTATION_LEVEL--
  line(text)
}

function random_float(min, max) {
  min ||= 0.0
  max ||= 1.0

  return Math.random() * (max - min) + min
}

function random_int(min, max) {
  if (!max) {
    max = min
    min = 0
  }

  return Math.floor(Math.random() * (1 + max - min)) + min
}

function choose(...options) {
  let weights = []
  let total_options = 1

  for (let i = 0; i < options.length; i++) {
    if (Number.isInteger(options[i])) {
      weights.push([options[i], options[i + 1]])
      total_options += options[i]
      i += 1
    } else {
      weights.push([1, options[i]])
      total_options += 1
    }
  }

  let value = random_int(0, total_options - 1)
  for (let [weight, option] of weights) {
    if (value <= weight) {
      if (option instanceof Function) {
        return option()
      } else {
        return option
      }
    } else {
      value -= weight
    }
  }
  console.error("out of range choice)")
}

function line(text) {
  console.log(INDENTATION_STRING.repeat(INDENTATION_LEVEL) + text)
}

function generate_rune() {
  stdlib()
  block("rune {")
  choose(generate_bind_rune)
  end_block("}")
}

function generate_bind_rune() {
  block("stroke(weight: 5) scale(0.75) {")
  block("radial(offset: 0) [")
  {
    for (let i = 0; i < random_int(2, 4) * 2; i++) {
      generate_bind_rune_arm()
    }
  }

  end_block("]")
  end_block("}")
}

function generate_bind_rune_arm() {
  block("stack [")
  line("line")
  block("linear(scale: 0.25, min: 0.5) [")
  {
    for (let i = 0; i < random_int(2, 5); i++) {
      choose(
        // cross bar
        8,
        () => line("bar"),
        // half circle in
        2,
        () => line("group { translate(y: -0.25) scale(0.5) arc(-1/4, 1/4) }"),
        // half circle out
        2,
        () => line("group { translate(y: 0.25) scale(0.5) arc(1/4, -1/4) }"),
        // full circle
        1,
        () => line('scale(0.25) fill("none") circle'),
        // two dots
        1,
        () => {
          block('fill("black") stack [')
          line("{ translate(-0.5) scale(0.1) circle }")
          line("{ translate(0.5) scale(0.1) circle }")
          end_block("]")
        }
      )
    }
    line(`fork(${random_int(3, 5)})`)
  }
  end_block("]")
  end_block("]")
}

logging.register((msg) => {
   let node = document.createElement('li')
   node.innerText = msg
   elLog.prepend(node)
})

logging.setMode('ERROR')

function doRender() {
  elLog.innerHTML = ''
  let input = elInput.value

  try {
      let svg = render(input)
      elOutput.innerHTML = svg
      log.awesome('IT WORKED!')
   } catch (exception) {
      console.log(exception)
   }
}

function debounce(f, timeout = 500) {
   let timer
   return (...args) => {
         clearTimeout(timer)
         timer = setTimeout(() => f.apply(this, args), timeout)
   }
}

function doGenerate() {
    let buffer = []
    const old_log = console.log
    {
        console.log = (line) => buffer.push(line)
        generate_rune()
    }
    console.log = old_log

    elInput.value = buffer.join("\n")
    doRender()
}

document.addEventListener('keyup', debounce(doRender))
document.querySelector('button[data-generate="bind-rune"]').addEventListener('click', (event) => {
    event.preventDefault()
    doGenerate()
})

doGenerate()
</script><style>textarea[data-input],div[data-output]{width:80%;height:600px;padding:1em}td{width:45%;vertical-align:top}</style><h3>Output</h3><div data-output></div><h3>Source</h3><textarea data-input></textarea>
<button data-generate=bind-rune>Generate random Bind Rune</button><h3>Log (most recent messages first):</h2><ul data-log></ul></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>