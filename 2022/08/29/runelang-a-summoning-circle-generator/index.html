<!doctype html><html><head><title>Runelang: A Summoning Circle Generator â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.a8e11addf4349ee2ca5045f7f3cbf1febbf2c3a2840be2143ea69539c10f8c7f.js integrity="sha256-qOEa3fQ0nuLKUEX388vx/rvyw6KEC+IUPqaVOcEPjH8=" defer></script><script src=/katex_17296078054267651618.min.4a06464d8d6f8358d8896de62b53b5a89205d335dfd8c5b6b27edd7c039ae9d8.js integrity="sha256-SgZGTY1vg1jYiW3mK1O1qJIF0zXf2MW2sn7dfAOa6dg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.a17078917a4403310cd19178939257b706fb5e1da76167c9f4a6d2123c9d59c4.js integrity="sha256-oXB4kXpEAzEM0ZF4k5JXtwb7Xh2nYWfJ9KbSEjydWcQ=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.7420a1602c62a85d4b50881c1d8ce42f72c049dc2b097d440696425d6e54bb1e.css integrity="sha256-dCChYCxiqF1LUIgcHYzkL3LASdwrCX1EBpZCXW5Uux4="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.5ff4b87c40715a96119d8b5f34d971604fc65ab18f4870fd8da6ede9fd1e6188.css integrity="sha256-X/S4fEBxWpYRnYtfNNlxYE/GWrGPSHD9jabt6f0eYYg="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Automation</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Runelang: A Summoning Circle Generator</h1><div class=entry-meta><span class=entry-date>2022-08-29</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2022/08/25/runelang-a-bind-rune-generator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/generative-art>Generative Art</a><a href=https://blog.jverkamp.com/2023/02/01/genuary-2023.01-perfect-loop/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2022/08/25/runelang-a-bind-rune-generator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/procedural-content>Procedural Content</a><a href=https://blog.jverkamp.com/2023/02/01/genuary-2023.01-perfect-loop/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2022/08/25/runelang-a-bind-rune-generator/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/small-scripts>Small Scripts</a><a href=https://blog.jverkamp.com/2025/12/20/locking-bga-tabs-with-userscripts/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2022/08/25/runelang-a-bind-rune-generator/ class=previous-link></a><a class=taxonomy-value href=/series/runelang-in-the-browser>Runelang in the Browser</a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2022/08/25/runelang-a-bind-rune-generator/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2022/09/21/lunar-arithmetic-in-rust/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2022/08/29/the-unwritten-vol.-4-leviathan/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2022/08/31/a-canticle-for-leibowitz/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Last time we had <a href=https://blog.jverkamp.com/2022/08/25/runelang-a-bind-rune-generator/>Runelang: A Bind Rune Generator</a>. This time, let&rsquo;s make &lsquo;summoning circles&rsquo;. Basically, we want to make a circle with stars and other circles inscribed and around the borders with various &lsquo;mystic&rsquo; text in the mix. Something like this:</p><ul><li><code>generate_summoning_circle</code><ul><li>random chance of boder</li><li>random chance of one or more inscribed stars</li><li>random chance of recurring on the border (calling <code>generate_summoning_circle</code> again)</li><li>random chance of recurring in the middle</li></ul></li></ul><h2 id=generate-bind-rune>Generate Bind Rune</h2><p>Codewise, I only have one (relatively complicated) function this time:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>generate_summoning_circle</span>(<span style=color:#a6e22e>depth</span>, <span style=color:#a6e22e>options</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>LANGUAGES</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;GREEK_UPPER&#34;</span>, <span style=color:#e6db74>&#34;ASTROLOGICAL&#34;</span>, <span style=color:#e6db74>&#34;RUNIC&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>options</span> <span style=color:#f92672>||=</span> {}
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depth</span> <span style=color:#f92672>||=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#34;group {&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>border_text_chance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#34;border_text_chance&#34;</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0.5</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>star_chance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>depth</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#34;star_chance&#34;</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0.5</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>second_star_chance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>depth</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#34;second_star_chance&#34;</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0.5</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>border_recur_chance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#34;border_recur_chance&#34;</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>**</span> <span style=color:#a6e22e>depth</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>inner_recur_chance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#34;inner_recur_chance&#34;</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>**</span> <span style=color:#a6e22e>depth</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>inner_text_chance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>[<span style=color:#e6db74>&#34;inner_text_chance&#34;</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0.5</span> <span style=color:#75715e>// if not inner recur
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Border
</span></span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random_float</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>border_text_chance</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>`doubleTextCircle(</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>choose</span>(...<span style=color:#a6e22e>LANGUAGES</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>)`</span>)
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>&#34;double(0.1) circle&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Stars
</span></span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random_float</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>star_chance</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>13</span>][<span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>3</span>)]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>`star(</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>points</span><span style=color:#e6db74>}</span><span style=color:#e6db74>)`</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random_float</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>second_star_chance</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>13</span>][<span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>3</span>)]
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>`invert star(</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>points</span><span style=color:#e6db74>}</span><span style=color:#e6db74>)`</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Outer circles
</span></span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random_float</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>border_recur_chance</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>11</span>, <span style=color:#ae81ff>13</span>][<span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>3</span>)]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>depth</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>random_int</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#34;radial(scale: 1/4) [&#34;</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>points</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>generate_summoning_circle</span>(<span style=color:#a6e22e>depth</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;]&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Inscribed circles
</span></span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random_float</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>inner_recur_chance</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>block</span>(<span style=color:#e6db74>&#34;scale(0.5) {&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>generate_summoning_circle</span>(<span style=color:#a6e22e>depth</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;}&#34;</span>)
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random_float</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>inner_text_chance</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>line</span>(<span style=color:#e6db74>`text(chooseOne(</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>choose</span>(...<span style=color:#a6e22e>LANGUAGES</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>))`</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>end_block</span>(<span style=color:#e6db74>&#34;}&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Most of it&rsquo;s in the comments and configuration variables, but the idea for each part is <code>random_float() &lt; ***_chance</code>, randomly choosing which features to draw. And then in &lsquo;outer circles&rsquo; and &lsquo;inscribed circles&rsquo;, you have the recursive calls to <code>generate_summoning_circle</code>. You do have to be careful with those chances. If they&rsquo;re too high, you&rsquo;ll recur an awfully long way down and end up bringing your browser to a screaming halt. But until then, it&rsquo;s all good. :D</p><h2 id=demo>Demo</h2><p>Demo time!</p><script defer type=module>
import { render } from '/embeds/runelang/runelang/main.js'
import logging from '/embeds/runelang/lib/logging.js'

const log = logging.get("system")

let elInput = document.querySelector('[data-input]')
let elOutput = document.querySelector('[data-output]')
let elLog = document.querySelector('[data-log]')

elInput.value = `
`

const INDENTATION_STRING = "  "
let INDENTATION_LEVEL = 0

function stdlib() {
  console.log(`
define bar { translate(x: 0.5) rotate(0.25) line }

define fork(n) {
  translate(x: 0.5) rotate(0.25) {
    line
    linear [
      rotate(0.25) translate(y: -0.5) scale(0.5) line
      times n
    ]
  }
}

define doubleTextCircle(set) {
  double(0.1) circle
  stroke(weight: 1, color:"none") fill("black") invert text(chooseOne(set))
}
  `)
}

function block(text) {
  line(text)
  INDENTATION_LEVEL++
}

function end_block(text) {
  INDENTATION_LEVEL--
  line(text)
}

function random_float(min, max) {
  min ||= 0.0
  max ||= 1.0

  return Math.random() * (max - min) + min
}

function random_int(min, max) {
  if (!max) {
    max = min
    min = 0
  }

  return Math.floor(Math.random() * (1 + max - min)) + min
}

function choose(...options) {
  let weights = []
  let total_options = 1

  for (let i = 0; i < options.length; i++) {
    if (Number.isInteger(options[i])) {
      weights.push([options[i], options[i + 1]])
      total_options += options[i]
      i += 1
    } else {
      weights.push([1, options[i]])
      total_options += 1
    }
  }

  let value = random_int(0, total_options - 1)
  for (let [weight, option] of weights) {
    if (value <= weight) {
      if (option instanceof Function) {
        return option()
      } else {
        return option
      }
    } else {
      value -= weight
    }
  }
  console.error("out of range choice)")
}

function line(text) {
  console.log(INDENTATION_STRING.repeat(INDENTATION_LEVEL) + text)
}

function generate_rune(f) {
  stdlib()
  block("rune scale(0.8) {")
  if (f instanceof Function) {
    f()
  } else {
    choose(generate_bind_rune, generate_summoning_circle)
  }
  end_block("}")
}

function generate_summoning_circle(depth, options) {
  let LANGUAGES = ["GREEK_UPPER", "ASTROLOGICAL", "RUNIC"]

  options ||= {}
  depth ||= 0
  block("group {")

  let border_text_chance = options["border_text_chance"] || 0.5
  let star_chance = depth == 0 ? 1.0 : options["star_chance"] || 0.5
  let second_star_chance = depth == 0 ? 1.0 : options["second_star_chance"] || 0.5
  let border_recur_chance = options["border_recur_chance"] || 0.5 ** depth
  let inner_recur_chance = options["inner_recur_chance"] || 0.5 ** depth
  let inner_text_chance = options["inner_text_chance"] || 0.5 // if not inner recur

  // Border
  if (random_float() < border_text_chance) {
    line(`doubleTextCircle(${choose(...LANGUAGES)})`)
  } else {
    line("double(0.1) circle")
  }

  // Stars
  if (random_float() < star_chance) {
    let points = [5, 7, 11, 13][random_int(0, 3)]
    line(`star(${points})`)

    if (random_float() < second_star_chance) {
      let points = [5, 7, 11, 13][random_int(0, 3)]
      line(`invert star(${points})`)
    }
  }

  // Outer circles
  if (random_float() < border_recur_chance) {
    let points = [5, 7, 11, 13][random_int(0, 3)]
    if (depth <= random_int(1, 3)) {
      block("radial(scale: 1/4) [")
      for (let i = 0; i < points; i++) {
        generate_summoning_circle(depth + 1)
      }
      end_block("]")
    }
  }

  // Inscribed circles
  if (random_float() < inner_recur_chance) {
    block("scale(0.5) {")
    generate_summoning_circle(depth + 1)
    end_block("}")
  } else if (random_float() < inner_text_chance) {
    line(`text(chooseOne(${choose(...LANGUAGES)}))`)
  }

  end_block("}")
}

function generate_bind_rune() {
  block("stroke(weight: 5) scale(0.75) {")
  block("radial(offset: 0) [")
  {
    for (let i = 0; i < random_int(2, 4) * 2; i++) {
      generate_bind_rune_arm()
    }
  }

  end_block("]")
  end_block("}")
}

function generate_bind_rune_arm() {
  block("stack [")
  line("line")
  block("linear(scale: 0.25, min: 0.5) [")
  {
    for (let i = 0; i < random_int(2, 5); i++) {
      choose(
        // cross bar
        8,
        () => line("bar"),
        // half circle in
        2,
        () => line("group { translate(y: -0.25) scale(0.5) arc(-1/4, 1/4) }"),
        // half circle out
        2,
        () => line("group { translate(y: 0.25) scale(0.5) arc(1/4, -1/4) }"),
        // full circle
        1,
        () => line('scale(0.25) fill("none") circle'),
        // two dots
        1,
        () => {
          block('fill("black") stack [')
          line("{ translate(-0.5) scale(0.1) circle }")
          line("{ translate(0.5) scale(0.1) circle }")
          end_block("]")
        }
      )
    }
    line(`fork(${random_int(3, 5)})`)
  }
  end_block("]")
  end_block("]")
}

logging.register((msg) => {
   let node = document.createElement('li')
   node.innerText = msg
   elLog.prepend(node)
})

logging.setMode('ERROR')

function doRender() {
  elLog.innerHTML = ''
  let input = elInput.value

  try {
      let svg = render(input)
      elOutput.innerHTML = svg
      log.awesome('IT WORKED!')
   } catch (exception) {
      console.log(exception)
   }
}

function debounce(f, timeout = 500) {
   let timer
   return (...args) => {
         clearTimeout(timer)
         timer = setTimeout(() => f.apply(this, args), timeout)
   }
}

function doGenerate(f) {
    let buffer = []
    const old_log = console.log
    {
        console.log = (line) => buffer.push(line)
        f()
    }
    console.log = old_log

    elInput.value = buffer.join("\n")
    doRender()
}

document.addEventListener('keyup', debounce(doRender))

document.querySelectorAll('button[data-generate]').forEach(el => el.addEventListener('click', (event) => {
    event.preventDefault()

    if (event.target.dataset.generate === 'bind') {
      doGenerate(() => generate_rune(generate_bind_rune))
    } else if (event.target.dataset.generate === 'circle') {
      doGenerate(() => generate_rune(generate_summoning_circle))
    } else {
      doGenerate(generate_rune)
    }
}))

doGenerate(() => generate_rune(generate_summoning_circle))
</script><style>textarea[data-input],div[data-output]{width:80%;height:600px;padding:1em}td{width:45%;vertical-align:top}</style><h3>Output</h3><div data-output></div><h3>Source</h3><textarea data-input></textarea><div><button data-generate=rune>Random (either)</button>
<button data-generate=bind>Bind Rune</button>
<button data-generate=circle>Summoning Circle</button></div><h3>Log (most recent messages first):</h2><ul data-log></ul></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>