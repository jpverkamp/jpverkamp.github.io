<!DOCTYPE html>
<html>
<head>
    <title>AoC 2018 Day 14: Functionally Circular Elfs â€“ jverkamp.com</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">AoC 2018 Day 14: Functionally Circular Elfs</h1>

        <div class="entry-meta"><span class="entry-date">2018-12-14</span>
            </div><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2018/12/13/aoc-2018-day-13-mine-cart-madness/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/racket">Racket</a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2018/12/13/aoc-2018-day-13-mine-cart-madness/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2018/12/13/aoc-2018-day-13-mine-cart-madness/" class="previous-link"></a><a class="taxonomy-value" href="/series/advent-of-code-2018">Advent of Code 2018</a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2018/12/13/aoc-2018-day-13-mine-cart-madness/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2019/01/04/listing-and-downloading-s3-versions/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2018/12/13/aoc-2018-day-13-mine-cart-madness/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2018/12/29/furies-of-calderon/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</header>

	<div class="entry-content"><h3 id="source-chocolate-charts-https-adventofcode-com-2018-day-14">Source: <a href="https://adventofcode.com/2018/day/14">Chocolate Charts</a></h3>

<blockquote>
<p><strong>Part 1:</strong> Create an infinite stream of numbers, by starting with [3, 7] with two pointers: 0 and 1. To add values to the list:</p>

<ul>
<li>Add the current values of the two pointers

<ul>
<li>If the value is less than ten, add that value to the end of the list</li>
<li>If the value is greater or equal to ten, add 1 and then the ones digits to the end of the list</li>
</ul></li>
<li>Update each pointer by adding the value it is pointing at to its current index plus one</li>
</ul>

<p>With that algorithm, find the ten digits after a given index.</p>
</blockquote>

<p>Fascinating.</p>

<p>My first inclination is that I want circular lists. But the code I have from <a href="https://blog.jverkamp.com/2018/12/09/aoc-2018-day-9-marble-madness/">Marble Madness</a> won&rsquo;t quite work, since I also need to keep track of the two pointers.</p>

<p>My second inclination is that I want an array of values where I can cheaply add values to the end and index arbitrary elements. What I really want is something like an <code><a href="">ArrayList</a></code>
 from Java. But this is Racket. Let&rsquo;s just fake it with a <code><a href="http://docs.racket-lang.org/search/index.html?q=hash">hash</a></code>
 keyed on integers and a length. Not quite as memory efficient, but it will work.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket">(<span style="color:#66d9ef">struct</span> state (data length elf1 elf2) <span style="color:#66d9ef">#:transparent</span>)

(<span style="color:#66d9ef">define</span> (initial-state)
  (state (hash <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">7</span>)
         <span style="color:#ae81ff">2</span>
         <span style="color:#ae81ff">0</span>
         <span style="color:#ae81ff">1</span>))</code></pre></div>
<p>Now, we can start building up increasingly complicated functions. First, we want a function that can add a single value to the end of the list. Second, add either one or two values based on the current pointers (if the sum is greater than 10 or not). Third, move the pointers based on their current values:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Add a single value to the end of the current state</span>
(<span style="color:#66d9ef">define</span> (add-recipe s v)
  (<span style="color:#66d9ef">match-define</span> (state data length elf1 elf2) s)
  (state (hash-set data length v)
         (add1 length)
         elf1
         elf2))

<span style="color:#75715e">; Add one or two recipes to the state</span>
(<span style="color:#66d9ef">define</span> (add-recipes s)
  (<span style="color:#66d9ef">match-define</span> (state data length elf1 elf2) s)
  (<span style="color:#66d9ef">define</span> sum (+ (hash-ref data elf1) (hash-ref data elf2)))
  (<span style="color:#66d9ef">cond</span>
    [(&gt;= sum <span style="color:#ae81ff">10</span>)
     (add-recipe (add-recipe s (quotient sum <span style="color:#ae81ff">10</span>)) (remainder sum <span style="color:#ae81ff">10</span>))]
    [<span style="color:#66d9ef">else</span>
     (add-recipe s sum)]))

<span style="color:#75715e">; Update each elf&#39;s current recipe</span>
<span style="color:#75715e">; Wrap values that run off the end of the current list back to the beginning</span>
(<span style="color:#66d9ef">define</span> (move-elfs s)
  (<span style="color:#66d9ef">match-define</span> (state data length elf1 elf2) s)
  (state data
         length
         (remainder (+ elf1 (hash-ref data elf1) <span style="color:#ae81ff">1</span>) length)
         (remainder (+ elf2 (hash-ref data elf2) <span style="color:#ae81ff">1</span>) length)))</code></pre></div>
<p>And with that, we can expand the current list:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Do a full update</span>
(<span style="color:#66d9ef">define</span> (tick s)
  (move-elfs (add-recipes s)))</code></pre></div>
<p>I always love when the final version of a function is next to nothing because of the work you&rsquo;ve already put in.</p>

<p>So, how do we find the 10 values after a given point? Well, first we have to make the list long enough, then just pull them out of <code>state-data</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Calculate the score after a coordinate</span>
(<span style="color:#66d9ef">define</span> (score i)
  (<span style="color:#66d9ef">define</span> state
    (<span style="color:#66d9ef">let</span> loop ([s (initial-state)])
      (<span style="color:#66d9ef">cond</span>
        [(&lt; (state-length s) (+ i <span style="color:#ae81ff">10</span>))
         (loop (tick s))]
        [<span style="color:#66d9ef">else</span> s])))
  (<span style="color:#66d9ef">for/list</span> ([i (in-range i (+ i <span style="color:#ae81ff">10</span>))])
    (hash-ref (state-data state) i)))</code></pre></div>
<p>With a quick helper to turn that into a single number:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket">(<span style="color:#66d9ef">define</span> (digits-&gt;int ls)
  (<span style="color:#66d9ef">let</span> loop ([n <span style="color:#ae81ff">0</span>] [digits ls])
    (<span style="color:#66d9ef">cond</span>
      [(null? digits) n]
      [<span style="color:#66d9ef">else</span>
       (loop (+ (* n <span style="color:#ae81ff">10</span>) (first digits))
             (rest digits))])))

(<span style="color:#66d9ef">define</span> argv (current-command-line-arguments))
(<span style="color:#66d9ef">for</span> ([arg (in-vector argv)])
  (printf <span style="color:#e6db74">&#34;input: ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> arg)
  (printf <span style="color:#e6db74">&#34;[part1] ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> (digits-&gt;int (score (string-&gt;number arg)))))</code></pre></div>
<p>And for my input:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ racket functionally-circular-elfs.rkt <span style="color:#ae81ff">157901</span>

input: <span style="color:#ae81ff">157901</span>
<span style="color:#f92672">[</span>part1<span style="color:#f92672">]</span> <span style="color:#ae81ff">9411137133</span></code></pre></div>
<p>Nice.</p>

<blockquote>
<p><strong>Part 2:</strong> Given a sequence of digits, what is the index of the first occurance of those digits?</p>
</blockquote>

<p>This is computationally a bit more interesting. It actually reminds me of <a href="https://blog.jverkamp.com/2012/09/16/a-needle-in-a-pi-stack/">a post I wrote all the way back in 2012</a>&hellip;</p>

<p>The goal here will be to keep a list of digits we have left to find and scan through the current list of numbers, expanding it whenever we need more. If we get a partial match but then an error, just reset to the original list of digits:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Find a specific pattern in the input stream</span>
(<span style="color:#66d9ef">define</span> (search ls)
  (<span style="color:#66d9ef">let</span> loop ([state (initial-state)]
             [index <span style="color:#ae81ff">0</span>]
             [to-find ls])
    (<span style="color:#66d9ef">when</span> (zero? (remainder index <span style="color:#ae81ff">1000</span>)) (displayln index))
    (<span style="color:#66d9ef">cond</span>
      <span style="color:#75715e">; Found our target, return the index it started at</span>
      [(null? to-find) (- index (length ls))]
      <span style="color:#75715e">; Don&#39;t have enough data, generate some more</span>
      [(&gt;= index (state-length state))
       (loop (tick state) index to-find)]
      <span style="color:#75715e">; The current match continues</span>
      [(equal? (first to-find) (hash-ref (state-data state) index))
       (loop state (add1 index) (rest to-find))]
      <span style="color:#75715e">; The current match does not continue, reset to where we started + 1</span>
      [<span style="color:#66d9ef">else</span>
       (loop state (+ (- index (length ls)) (length to-find) <span style="color:#ae81ff">1</span>) ls)])))</code></pre></div>
<p>For full output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket">(<span style="color:#66d9ef">define</span> (int-&gt;digits n)
  (<span style="color:#66d9ef">let</span> loop ([n n] [digits <span style="color:#f92672">&#39;</span>()])
    (<span style="color:#66d9ef">cond</span>
      [(&lt; n <span style="color:#ae81ff">10</span>) (list* n digits)]
      [<span style="color:#66d9ef">else</span> (loop (quotient n <span style="color:#ae81ff">10</span>)
                  (list* (remainder n <span style="color:#ae81ff">10</span>) digits))])))

<span style="color:#75715e">; Find score/search for any given values</span>
(<span style="color:#66d9ef">define</span> argv (current-command-line-arguments))
(<span style="color:#66d9ef">for</span> ([arg (in-vector argv)])
  (printf <span style="color:#e6db74">&#34;input: ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> arg)
  (printf <span style="color:#e6db74">&#34;[part1] ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> (digits-&gt;int (score (string-&gt;number arg))))
  (printf <span style="color:#e6db74">&#34;[part2] ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> (search (int-&gt;digits (string-&gt;number arg)))))</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ racket functionally-circular-elfs.rkt <span style="color:#ae81ff">157901</span>

input: <span style="color:#ae81ff">157901</span>
<span style="color:#f92672">[</span>part1<span style="color:#f92672">]</span> <span style="color:#ae81ff">9411137133</span>
<span style="color:#f92672">[</span>part2<span style="color:#f92672">]</span> <span style="color:#ae81ff">20317612</span></code></pre></div>
<p>This is actually a really neat problem since my original approach was not at all functional, using mutation in order to create a proper doubly-linked list with pointers to the two elf nodes. But not only was it not as &lsquo;pure&rsquo; it was actually a lot more complicated and ugly code. This is just so much nicer to work with. ðŸ˜„</p></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "AoC 2018 Day 14: Functionally Circular Elfs";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2018\/12\/14\/aoc-2018-day-14-functionally-circular-elfs\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="/custom.js" defer></script>
</body>
</html>
