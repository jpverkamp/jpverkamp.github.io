<!DOCTYPE html>
<html onclick >
<head>
    <title>AoC 2018 Day 6: Infinite Area Simulator – jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">AoC 2018 Day 6: Infinite Area Simulator</h1>

        <div class="entry-meta"><span class="entry-date">2018-12-06</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2018/12/05/aoc-2018-day-5-alchemical-reduction/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/racket">Racket</a><a href="https://blog.jverkamp.com/2018/12/07/aoc-2018-day-7-job-simulator/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2018/12/05/aoc-2018-day-5-alchemical-reduction/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a><a href="https://blog.jverkamp.com/2018/12/07/aoc-2018-day-7-job-simulator/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2018/12/05/aoc-2018-day-5-alchemical-reduction/" class="previous-link"></a><a class="taxonomy-value" href="/series/advent-of-code-2018">Advent of Code 2018</a><a href="https://blog.jverkamp.com/2018/12/07/aoc-2018-day-7-job-simulator/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2018/12/05/aoc-2018-day-5-alchemical-reduction/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2018/12/07/aoc-2018-day-7-job-simulator/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2018/12/05/aoc-2018-day-5-alchemical-reduction/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2018/12/07/aoc-2018-day-7-job-simulator/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><h3 id="source-chronal-coordinates-https-adventofcode-com-2018-day-6">Source: <a href="https://adventofcode.com/2018/day/6">Chronal Coordinates</a></h3>

<blockquote>
<p><strong>Part 1:</strong> Given a list of points, calculate the region of points closest to each point (using <a href="https://en.wikipedia.org/wiki/Manhattan%20distance">Manhattan distance</a>). Return the size of the largest non-infinite region.</p>
</blockquote>

<p>First, some boilerplate. We want a function to load in the points and then find the bounds of the entire region (we&rsquo;ll need it later):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Read constant POINTS for the current input</span>
(<span style="color:#66d9ef">define</span> (read-points [in (current-input-port)])
  (<span style="color:#66d9ef">for/list</span> ([line (in-lines in)])
    (<span style="color:#66d9ef">match-define</span> (regexp <span style="color:#e6db74">#px&#34;(\\d+), (\\d+)&#34;</span> (list <span style="color:#66d9ef">_</span> raw-x raw-y)) line)
    (<span style="color:#66d9ef">define</span> x (string-&gt;number raw-x))
    (<span style="color:#66d9ef">define</span> y (string-&gt;number raw-y))
    (point x y)))

(<span style="color:#66d9ef">define</span> POINTS (read-points))

<span style="color:#75715e">; Determine the bounds for the given points</span>
(<span style="color:#66d9ef">define-values</span> (MIN-X MAX-X MIN-Y MAX-Y)
  (<span style="color:#66d9ef">for/fold</span> ([min-x <span style="color:#ae81ff">+inf.0</span>] [max-x <span style="color:#ae81ff">-inf.0</span>] [min-y <span style="color:#ae81ff">+inf.0</span>] [max-y <span style="color:#ae81ff">-inf.0</span>])
            ([pt (in-list POINTS)])
    (values (min min-x (point-x pt))
            (max max-y (point-x pt))
            (min min-x (point-y pt))
            (max max-y (point-y pt)))))

<span style="color:#75715e">; If a region has more points than are contained in the bounds, it&#39;s infinite</span>
(<span style="color:#66d9ef">define</span> VOLUME (* (- MAX-X MIN-X) (- MAX-Y MIN-Y)))</code></pre></div>
<p>Next, define our distance function, a function to find the closet point from our list of given points, and a helper that will give the four neighbors to a given point (we&rsquo;ll use this to <a href="https://en.wikipedia.org/wiki/flood%20fill">flood fill</a>).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Manhattan distance</span>
(<span style="color:#66d9ef">define</span> (distance p1 p2)
  (+ (abs (- (point-x p1) (point-x p2)))
     (abs (- (point-y p1) (point-y p2)))))

<span style="color:#75715e">; Return the point in pts closest to the given point pt</span>
(<span style="color:#66d9ef">define</span> (closest target)
  (<span style="color:#66d9ef">define-values</span> (min-point min-distance)
    (<span style="color:#66d9ef">for*/fold</span> ([min-point <span style="color:#66d9ef">#f</span>] [min-distance <span style="color:#ae81ff">+inf.0</span>])
               ([pt (in-list POINTS)]
                [d (in-value (distance target pt))]
                <span style="color:#66d9ef">#:when</span> (&lt;= d min-distance))
      (values (<span style="color:#66d9ef">if</span> (= d min-distance) <span style="color:#66d9ef">#f</span> pt) d)))
  min-point)

<span style="color:#75715e">; The four neighbors of a given point</span>
(<span style="color:#66d9ef">define</span> (neighbors target)
  (<span style="color:#66d9ef">match-define</span> (point x y) target)
  (list (point x (- y <span style="color:#ae81ff">1</span>))
        (point (+ x <span style="color:#ae81ff">1</span>) y)
        (point x (+ y <span style="color:#ae81ff">1</span>))
        (point (- x <span style="color:#ae81ff">1</span>) y)))</code></pre></div>
<p>And that&rsquo;s the bulk of what&rsquo;s needed. With that, we can start on a point and flood fill outwards until we either know we have an infinite area or until we find the boundary of all points that are now as close or closer to a different point:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Calculate the number of points closest to this point than any other via floodfill</span>
(<span style="color:#66d9ef">define</span> (area target)
  (<span style="color:#66d9ef">let</span> loop ([area <span style="color:#ae81ff">0</span>]
             [to-check (list target)]
             [checked (set)])
    (<span style="color:#66d9ef">cond</span>
      [(null? to-check) area]
      [<span style="color:#66d9ef">else</span>
       (<span style="color:#66d9ef">match-define</span> (list-rest current-to-check next-to-check) to-check)
       (<span style="color:#66d9ef">define</span> next-checked (set-add checked current-to-check))
       (<span style="color:#66d9ef">cond</span>
         <span style="color:#75715e">; Already checked this point, ignore</span>
         [(set-member? checked current-to-check)
          (loop area next-to-check checked)]
         <span style="color:#75715e">; More than the maximum area, has gone infinite</span>
         [(&gt; area VOLUME)
          <span style="color:#ae81ff">+inf.0</span>]
         <span style="color:#75715e">; Closest to target, add and expand</span>
         [(equal? target (closest current-to-check))
          (loop (add1 area)
                (append (neighbors current-to-check) next-to-check)
                next-checked)]
         <span style="color:#75715e">; Not closest, don&#39;t add or expand</span>
         [<span style="color:#66d9ef">else</span>
          (loop area next-to-check next-checked)])])))</code></pre></div>
<p>The trick to this algorithm is knowing that no single region will end up bigger than the volume enclosing all of the points. So if the area we&rsquo;re looking at is that big, it will clearly become infinite. While this isn&rsquo;t the best algorithm (we could probably trim down the bounds somewhat), it&rsquo;s still fairly fast. And it lets us finish part 1:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Find the largest non-infinite area</span>
(printf <span style="color:#e6db74">&#34;[part1]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
(<span style="color:#66d9ef">for/fold</span> ([max-point <span style="color:#66d9ef">#f</span>] [max-area <span style="color:#ae81ff">-inf.0</span>])
          ([pt (in-list POINTS)])
  (<span style="color:#66d9ef">define</span> a (area pt))
  (<span style="color:#66d9ef">cond</span>
    [(<span style="color:#66d9ef">and</span> (not (infinite? a))
          (&gt; a max-area))
     (values pt a)]
    [<span style="color:#66d9ef">else</span>
     (values max-point max-area)]))</code></pre></div>
<blockquote>
<p><strong>Part 2:</strong> Define a new region such that a point <span class="latex-inline">p_1</span>
 is in the region if the sum of distances to all input points is less than a given number <span class="latex-inline">R</span>
.</p>
</blockquote>

<p>This one took a bit to wrap my head around what they were asking. In the end though, the code ends up being a fairly direct translation of the problem statement. We keep a set of points to check, then move them over as we check them, adding them to the <code>region</code> if they satisfy the given condition.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket"><span style="color:#75715e">; Find the center point and flood fill out to all points with X of all points</span>
(<span style="color:#66d9ef">define</span> (points-within-range range)
  (<span style="color:#66d9ef">let</span> loop ([to-check (set (point (exact-round (/ (+ MIN-X MAX-X) <span style="color:#ae81ff">2</span>))
                                   (exact-round (/ (+ MIN-X MAX-X) <span style="color:#ae81ff">2</span>))))]
             [checked (set)]
             [region (set)])
    (<span style="color:#66d9ef">cond</span>
      <span style="color:#75715e">; Base case: checked all points, return region</span>
      [(set-empty? to-check) region]

      <span style="color:#75715e">; Already checked this point, ignore</span>
      [(set-member? checked (set-first to-check))
       (loop (set-rest to-check) checked region)]

      <span style="color:#75715e">; Sum of distances is less than range, include and expand search</span>
      [(&lt; (<span style="color:#66d9ef">for/sum</span> ([pt (in-list POINTS)])
            (distance (set-first to-check) pt))
          range)
       (loop (set-union (<span style="color:#66d9ef">for/set</span> ([neighbor (in-list (neighbors (set-first to-check)))]
                                  <span style="color:#66d9ef">#:when</span> (not (set-member? checked neighbor)))
                          neighbor)
                        (set-rest to-check))
             (set-add checked (set-first to-check))
             (set-add region (set-first to-check)))]

      <span style="color:#75715e">; Not in region, skip</span>
      [<span style="color:#66d9ef">else</span>
       (loop (set-rest to-check) (set-add checked (set-first to-check)) region)])))</code></pre></div>
<p>The most interesting case is the third one, mostly because of a few optimizations to make the code a bit quicker. First, we sum up distances and use that to determine if the sum of distances is within range (have I mentioned how much I like the <code><a href="http://docs.racket-lang.org/search/index.html?q=for">for</a></code>
) family of macros)<sup class="footnote-ref" id="fnref:yes"><a href="#fn:yes">1</a></sup>?</p>

<p>Print it out and you&rsquo;re done:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat input.txt | racket infinite-area-simulator.rkt

<span style="color:#f92672">[</span>part1<span style="color:#f92672">]</span>
<span style="color:#f92672">(</span>point <span style="color:#ae81ff">241</span> <span style="color:#ae81ff">157</span><span style="color:#f92672">)</span>
<span style="color:#ae81ff">3882</span>

<span style="color:#f92672">[</span>part2<span style="color:#f92672">]</span>
<span style="color:#ae81ff">43852</span> are within <span style="color:#ae81ff">10000</span></code></pre></div>
<figure>
    <img src="/embeds/2018/joliver-cool.gif"/> 
</figure>


<p>As an added bonus, while I was working out how to generate an image for the regions produced by part 1:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-racket" data-lang="racket">(<span style="color:#66d9ef">define</span> color-for
  (<span style="color:#66d9ef">let</span> ([colors (<span style="color:#66d9ef">for/list</span> ([pt (in-list POINTS)]) (vector (random) (random) (random)))])
    (<span style="color:#66d9ef">λ</span> (pt)
      (<span style="color:#66d9ef">define</span> closest-pt (closest pt))
      (<span style="color:#66d9ef">or</span>
       (<span style="color:#66d9ef">for/first</span> ([color (in-list colors)]
                   [pt^ (in-list POINTS)]
                   <span style="color:#66d9ef">#:when</span> (equal? closest-pt pt^))
         color)
       (vector <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>)))))

(<span style="color:#66d9ef">define</span> (write-image-debug filename)
  (<span style="color:#66d9ef">send</span>
   (flomap-&gt;bitmap
    (build-flomap*
     <span style="color:#ae81ff">3</span> (exact-round (- MAX-X MIN-X)) (exact-round (- MAX-Y MIN-Y))
     (<span style="color:#66d9ef">λ</span> (x y) (color-for (point (+ x MIN-X) (+ y MIN-Y))))))
   save-file
   filename
   <span style="color:#f92672">&#39;</span><span style="color:#e6db74">png</span>))</code></pre></div>
<figure>
    <img src="/embeds/2018/aoc-6-regions.png"/> 
</figure>


<p>The colors are random each time you run the program, but it&rsquo;s still pretty neat to do.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:yes"><figure>
    <img src="/embeds/2018/tennant-oh-yes.gif"/> 
</figure>

 <a class="footnote-return" href="#fnref:yes"><sup>[return]</sup></a></li>
</ol>
</div></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
