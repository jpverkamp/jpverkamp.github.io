<!DOCTYPE html>
<html onclick >
<head>
    <title>AoC 2016 Day 24: Venti â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li><a href="/resume" title="My Resume">Resume</a></li>
            <li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">AoC 2016 Day 24: Venti</h1>

        <div class="entry-meta"><span class="entry-date">2016-12-24</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/23/aoc-2016-day-23-assembunny2/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2016/12/25/aoc-2016-day-25-assembunny3/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/23/aoc-2016-day-23-assembunny2/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a><a href="https://blog.jverkamp.com/2016/12/25/aoc-2016-day-25-assembunny3/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/17/aoc-2016-day-17-md5-maze/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/backtracking">Backtracking</a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/23/aoc-2016-day-23-assembunny2/" class="previous-link"></a><a class="taxonomy-value" href="/series/advent-of-code-2016">Advent of Code 2016</a><a href="https://blog.jverkamp.com/2016/12/25/aoc-2016-day-25-assembunny3/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2016/12/23/aoc-2016-day-23-assembunny2/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2016/12/25/aoc-2016-day-25-assembunny3/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2016/12/23/aoc-2016-day-23-assembunny2/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2016/12/25/aoc-2016-day-25-assembunny3/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><h3 id="source-air-duct-spelunking-http-adventofcode-com-2016-day-24">Source: <a href="http://adventofcode.com/2016/day/24">Air Duct Spelunking</a></h3>

<blockquote>
<p><strong>Part 1:</strong> Given a map of the form:</p>

<pre><code>###########
#0.1.....2#
#.#######.#
#4.......3#
###########
</code></pre>

<p>Find the shortest route to visit each of the points, starting at <code>0</code>.</p>
</blockquote>

<p>First, we want to take the map that we were given and simplify it. We know that we want to visit all of the points, so lets take the original map and turn it just into a map of distances between any two named points.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">walls <span style="color:#f92672">=</span> set()
name_to_point <span style="color:#f92672">=</span> {}
point_to_name <span style="color:#f92672">=</span> {}

<span style="color:#75715e"># Load the input file into a set of walls and the location of points of interest</span>
<span style="color:#66d9ef">for</span> y, line <span style="color:#f92672">in</span> enumerate(fileinput<span style="color:#f92672">.</span>input(args<span style="color:#f92672">.</span>files)):
    <span style="color:#66d9ef">for</span> x, c <span style="color:#f92672">in</span> enumerate(line<span style="color:#f92672">.</span>strip()):
        <span style="color:#66d9ef">if</span> c<span style="color:#f92672">.</span>isdigit():
            name_to_point[int(c)] <span style="color:#f92672">=</span> (x, y)
            point_to_name[(x, y)] <span style="color:#f92672">=</span> int(c)

        <span style="color:#66d9ef">elif</span> c <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;#&#39;</span>:
            walls<span style="color:#f92672">.</span>add((x, y))

<span style="color:#75715e"># Dynamically fill a distance map to a given point</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">distances_to</span>(name):
    to_scan <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>Queue()
    to_scan<span style="color:#f92672">.</span>put((name_to_point[name], <span style="color:#ae81ff">0</span>))

    scanned <span style="color:#f92672">=</span> set()

    result <span style="color:#f92672">=</span> {}

    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> to_scan<span style="color:#f92672">.</span>empty():
        point, distance <span style="color:#f92672">=</span> to_scan<span style="color:#f92672">.</span>get()

        <span style="color:#66d9ef">if</span> point <span style="color:#f92672">in</span> point_to_name:
            name <span style="color:#f92672">=</span> point_to_name[point]
            <span style="color:#66d9ef">if</span> name <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> result:
                result[name] <span style="color:#f92672">=</span> distance

        <span style="color:#66d9ef">if</span> point <span style="color:#f92672">in</span> scanned:
            <span style="color:#66d9ef">continue</span>
        <span style="color:#66d9ef">else</span>:
            scanned<span style="color:#f92672">.</span>add(point)

        x, y <span style="color:#f92672">=</span> point
        <span style="color:#66d9ef">for</span> xd, yd <span style="color:#f92672">in</span> [(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>), (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>), (<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)]:
            neighbor <span style="color:#f92672">=</span> (x <span style="color:#f92672">+</span> xd, y <span style="color:#f92672">+</span> yd)
            <span style="color:#66d9ef">if</span> neighbor <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> walls:
                to_scan<span style="color:#f92672">.</span>put((neighbor, distance <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>))

    <span style="color:#66d9ef">return</span> result

distances <span style="color:#f92672">=</span> {
    name: distances_to(name)
    <span style="color:#66d9ef">for</span> name <span style="color:#f92672">in</span> name_to_point
}
names <span style="color:#f92672">=</span> list(sorted(name_to_point<span style="color:#f92672">.</span>keys()))</code></pre></div>
<p>The first part loads the map and the second part will flood fill out from each point. This will find the minimum distance from each named point to the given one, somewhat simplifying the problem.</p>

<p>Next, assume we have a list of points to visit in a given order. From that, we can add the distances between each pair to get the total distance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">total_length</span>(ordering):
    <span style="color:#66d9ef">return</span> sum(
        distances[p1][p2]
        <span style="color:#66d9ef">for</span> p1, p2 <span style="color:#f92672">in</span> zip(ordering, ordering[<span style="color:#ae81ff">1</span>:])
    )</code></pre></div>
<p>Using that function, we can try all possible iterations using <code><a href="https://docs.python.org/3/search.html?q=itertools.permutations">itertools.permutations</a></code>
. This is slightly complicated by having to start at point <code>0</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">minimum_length <span style="color:#f92672">=</span> float(<span style="color:#e6db74">&#34;inf&#34;</span>)
minimum_ordering <span style="color:#f92672">=</span> None

<span style="color:#75715e"># Looks a bit funny since we have to start at 0</span>
<span style="color:#66d9ef">for</span> ordering <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>permutations(names[<span style="color:#ae81ff">1</span>:], len(names) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>):
    ordering <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> list(ordering)
    length <span style="color:#f92672">=</span> total_length(ordering)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> minimum_ordering <span style="color:#f92672">or</span> length <span style="color:#f92672">&lt;</span> minimum_length:
        logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#39;New best ({} steps): {}&#39;</span><span style="color:#f92672">.</span>format(length, ordering))
        minimum_length <span style="color:#f92672">=</span> length
        minimum_ordering <span style="color:#f92672">=</span> ordering

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Best ordering ({} steps): {}&#39;</span><span style="color:#f92672">.</span>format(minimum_length, minimum_ordering))</code></pre></div>
<blockquote>
<p><strong>Part 2:</strong> Find the best route that also returns to the origin (point <code>0</code>).</p>
</blockquote>

<p>To do this, all we have to do is tweak our <code>total_length</code> function to include looping back to zero.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">total_length</span>(ordering):
    <span style="color:#75715e"># If we have to return back to the origin, the distance will from the last point to 0</span>
    offset_ordering <span style="color:#f92672">=</span> ordering[<span style="color:#ae81ff">1</span>:]
    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>must_return:
        offset_ordering <span style="color:#f92672">+=</span> ordering[:<span style="color:#ae81ff">1</span>]

    <span style="color:#66d9ef">return</span> sum(
        distances[p1][p2]
        <span style="color:#66d9ef">for</span> p1, p2 <span style="color:#f92672">in</span> zip(ordering, offset_ordering)
    )</code></pre></div>
<p>Then the same loop as above will find the best path using the new tweaked formula.</p></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "AoC 2016 Day 24: Venti";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2016\/12\/24\/aoc-2016-day-24-venti\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="/custom.js" defer></script>
</body>
</html>
