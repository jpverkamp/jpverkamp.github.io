<!DOCTYPE html>
<html onclick >
<head>
    <title>AoC 2016 Day 17: Md5 Maze â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">AoC 2016 Day 17: Md5 Maze</h1>

        <div class="entry-meta"><span class="entry-date">2016-12-17</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/16/aoc-2016-day-16-dragon-data/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2016/12/18/aoc-2016-day-18-its-a-trap/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/16/aoc-2016-day-16-dragon-data/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a><a href="https://blog.jverkamp.com/2016/12/18/aoc-2016-day-18-its-a-trap/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/11/aoc-2016-day-11-radiation-avoider/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/backtracking">Backtracking</a><a href="https://blog.jverkamp.com/2016/12/24/aoc-2016-day-24-venti/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2016/12/14/aoc-2016-day-14-bad-one-time-pads/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/hashes">Hashes</a><a href="https://blog.jverkamp.com/2017/12/10/aoc-2017-day-10-knot-cool/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2016/12/16/aoc-2016-day-16-dragon-data/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/procedural-content">Procedural Content</a><a href="https://blog.jverkamp.com/2017/12/21/aoc-2017-day-21-fractal-expander/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/16/aoc-2016-day-16-dragon-data/" class="previous-link"></a><a class="taxonomy-value" href="/series/advent-of-code-2016">Advent of Code 2016</a><a href="https://blog.jverkamp.com/2016/12/18/aoc-2016-day-18-its-a-trap/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2016/12/16/aoc-2016-day-16-dragon-data/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2016/12/18/aoc-2016-day-18-its-a-trap/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2016/12/17/harry-potter-and-the-half-blood-prince/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2016/12/18/aoc-2016-day-18-its-a-trap/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><h3 id="source-two-steps-forward-http-adventofcode-com-2016-day-17">Source: <a href="http://adventofcode.com/2016/day/17">Two Steps Forward</a></h3>

<blockquote>
<p><strong>Part 1:</strong> Create a 4x4 grid of rooms with doors <code>U</code>p, <code>D</code>own, <code>L</code>eft, and <code>R</code>ight from each location. To determine if a door is currently open:</p>

<ul>
<li>Calculate <code>MD5(salt + sequence)</code> where sequence is a string containing any combination of <code>UDLR</code> depending on how you got to this room</li>
<li>The first four hex values represent the doors <code>U</code>p, <code>D</code>own, <code>L</code>eft, and <code>R</code>ight respectively: <code>bcdef</code> means open; anything else is closed</li>
</ul>

<p>Find the shortest path from <code>(0, 0)</code> to <code>(3, 3)</code>.</p>
</blockquote>

<p>This problem is interesting because due to the nature of hashes, being in the same location in the grid doesn&rsquo;t necessarily mean that the same doors are open. At the start, <code>(0, 0)</code> is based on <code>MD5(salt)</code>, but if you go <code>D</code>own and then back <code>U</code>p, it&rsquo;s based on <code>MD5(salt + DU)</code>. So different doors may (and quite often will) be open. Quite often, you can go through a door and not go back the way you came.</p>

<p>The solution is still very similar to what we&rsquo;ve seen before though. A <a href="https://en.wikipedia.org/wiki/breadth%20first%20search">breadth first search</a>, using complex numbers for coordinates:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Moving in the given direction adds this to the initial position</span>
offset <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;U&#39;</span>: <span style="color:#ae81ff">0</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1j</span>,
    <span style="color:#e6db74">&#39;D&#39;</span>: <span style="color:#ae81ff">0</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1j</span>,
    <span style="color:#e6db74">&#39;L&#39;</span>: <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
    <span style="color:#e6db74">&#39;R&#39;</span>: <span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,
}

<span style="color:#75715e"># Order of the first four characters in the hash</span>
order <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UDLR&#39;</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">location</span>(path):
    <span style="color:#66d9ef">return</span> sum(offset[char] <span style="color:#66d9ef">for</span> char <span style="color:#f92672">in</span> path)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solved</span>(path):
    <span style="color:#66d9ef">return</span> location(path) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">+</span><span style="color:#ae81ff">3j</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">moves</span>(path, password):
        <span style="color:#e6db74">&#39;&#39;&#39;Yield the possible moves from the current and path.&#39;&#39;&#39;</span>

        current <span style="color:#f92672">=</span> location(path)

        hash <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>md5((password <span style="color:#f92672">+</span> path)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
        <span style="color:#66d9ef">for</span> offset_char, hash_char <span style="color:#f92672">in</span> zip(order, hash):
            next <span style="color:#f92672">=</span> current <span style="color:#f92672">+</span> offset[offset_char]
            <span style="color:#66d9ef">if</span> hash_char <span style="color:#f92672">in</span> <span style="color:#e6db74">&#39;bcdef&#39;</span> <span style="color:#f92672">and</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> next<span style="color:#f92672">.</span>real <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">and</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> next<span style="color:#f92672">.</span>imag <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>:
                <span style="color:#66d9ef">yield</span> offset_char

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve</span>(password):
    <span style="color:#e6db74">&#39;&#39;&#39;Find the shortest path through the maze.&#39;&#39;&#39;</span>

    q <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>Queue()
    q<span style="color:#f92672">.</span>put(<span style="color:#e6db74">&#39;&#39;</span>)

    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> q<span style="color:#f92672">.</span>empty():
        path <span style="color:#f92672">=</span> q<span style="color:#f92672">.</span>get()

        <span style="color:#66d9ef">if</span> solved(path):
            <span style="color:#66d9ef">return</span> path

        <span style="color:#66d9ef">for</span> move <span style="color:#f92672">in</span> moves(path, password):
            q<span style="color:#f92672">.</span>put(path <span style="color:#f92672">+</span> move)

    <span style="color:#66d9ef">if</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;return&#39;</span>:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#39;No solution&#39;</span>)

<span style="color:#66d9ef">print</span>(solve(args<span style="color:#f92672">.</span>password))</code></pre></div>
<blockquote>
<p><strong>Part 2:</strong> How long is the longest path that reaches <code>(3, 3)</code>? (Don&rsquo;t count paths that reach <code>(3, 3)</code> and double back.)</p>
</blockquote>

<p>One possibility would be just to generate all possible paths recursively:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">list_all_recursive</span>(password):
    <span style="color:#e6db74">&#39;&#39;&#39;Yield all paths through the maze using a recursive solution.&#39;&#39;&#39;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">generate</span>(path):
        <span style="color:#66d9ef">if</span> solved(path):
            <span style="color:#66d9ef">yield</span> path

        <span style="color:#66d9ef">for</span> move <span style="color:#f92672">in</span> moves(path, password):
            <span style="color:#66d9ef">yield</span> <span style="color:#f92672">from</span> generate(path <span style="color:#f92672">+</span> move)

    <span style="color:#66d9ef">yield</span> <span style="color:#f92672">from</span> generate(<span style="color:#e6db74">&#39;&#39;</span>)</code></pre></div>
<p>Unfortunately, Python doesn&rsquo;t deal well with that much recursion. You can up the built in limit with <code><a href="https://docs.python.org/3/search.html?q=sys.setrecursionlimit">sys.setrecursionlimit</a></code>
, but that&rsquo;s as likely to run your computer out of RAM as it is to actually solve the problem. Instead, we can just use the same code as the first time, but expand it with a mode that will yield solutions as we find them:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve</span>(password, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;return&#39;</span>):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    Find the shortest path through the maze.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Mode can be:
</span><span style="color:#e6db74">        return: return the first = shortest path
</span><span style="color:#e6db74">        yield: yield all paths
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>

    q <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>Queue()
    q<span style="color:#f92672">.</span>put(<span style="color:#e6db74">&#39;&#39;</span>)

    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> q<span style="color:#f92672">.</span>empty():
        path <span style="color:#f92672">=</span> q<span style="color:#f92672">.</span>get()

        <span style="color:#66d9ef">if</span> solved(path):
            <span style="color:#66d9ef">if</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;return&#39;</span>:
                <span style="color:#66d9ef">return</span> path
            <span style="color:#66d9ef">elif</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;yield&#39;</span>:
                <span style="color:#66d9ef">yield</span> path
                <span style="color:#66d9ef">continue</span> <span style="color:#75715e"># Don&#39;t look for solutions that hit the end and come back</span>

        <span style="color:#66d9ef">for</span> move <span style="color:#f92672">in</span> moves(path, password):
            q<span style="color:#f92672">.</span>put(path <span style="color:#f92672">+</span> move)

    <span style="color:#66d9ef">if</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;return&#39;</span>:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#39;No solution&#39;</span>)

best_length, best_solution <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, None
    <span style="color:#66d9ef">for</span> solution <span style="color:#f92672">in</span> solve(args<span style="color:#f92672">.</span>password, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;yield&#39;</span>):
        <span style="color:#66d9ef">if</span> len(solution) <span style="color:#f92672">&gt;</span> best_length:
            best_length <span style="color:#f92672">=</span> len(solution)
            best_solution <span style="color:#f92672">=</span> solution

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{} steps&#39;</span><span style="color:#f92672">.</span>format(best_solution, best_length))</code></pre></div>
<p>That&rsquo;s a pretty interesting problem. In theory, there doesn&rsquo;t have to actually be an upper bound on that solution. In practice, since only 5 of the 16 possible values for each door are open, it will tend to close off solutions eventually.</p></div>
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "AoC 2016 Day 17: Md5 Maze";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2016\/12\/17\/aoc-2016-day-17-md5-maze\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div></article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="/custom.js" defer></script>
</body>
</html>
