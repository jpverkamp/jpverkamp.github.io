<!DOCTYPE html>
<html onclick >
<head>
    <title>AoC 2016 Day 11: Radiation Avoider – jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">AoC 2016 Day 11: Radiation Avoider</h1>

        <div class="entry-meta"><span class="entry-date">2016-12-11</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/10/aoc-2016-day-10-bot-simulator/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2016/12/12/aoc-2016-day-12-assembunny/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/10/aoc-2016-day-10-bot-simulator/" class="previous-link"></a><a class="taxonomy-value" href="/programming/sources/advent-of-code">Advent of Code</a><a href="https://blog.jverkamp.com/2016/12/12/aoc-2016-day-12-assembunny/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2015/10/29/takuzu-solver/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/backtracking">Backtracking</a><a href="https://blog.jverkamp.com/2016/12/17/aoc-2016-day-17-md5-maze/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2015/01/29/ios-backups-in-racket-apps/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/data-structures">Data Structures</a><a href="https://blog.jverkamp.com/2016/12/20/aoc-2016-day-20-filter-table/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2015/01/01/generating-omnichromatic-images/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/optimization">Optimization</a><a href="https://blog.jverkamp.com/2017/12/16/aoc-2017-day-16-swing-your-partner/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/10/aoc-2016-day-10-bot-simulator/" class="previous-link"></a><a class="taxonomy-value" href="/series/advent-of-code-2016">Advent of Code 2016</a><a href="https://blog.jverkamp.com/2016/12/12/aoc-2016-day-12-assembunny/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2016/12/10/aoc-2016-day-10-bot-simulator/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2016/12/12/aoc-2016-day-12-assembunny/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2016/12/10/aoc-2016-day-10-bot-simulator/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2016/12/12/aoc-2016-day-12-assembunny/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><h3 id="source-radioisotope-thermoelectric-generators-http-adventofcode-com-2016-day-11">Source: <a href="http://adventofcode.com/2016/day/11">Radioisotope Thermoelectric Generators</a></h3>

<blockquote>
<p><strong>Part 1:</strong> Input will be a list of the following form:</p>

<ul>
<li>The first floor contains a hydrogen-compatible microchip and a lithium-compatible microchip.</li>
<li>The second floor contains a hydrogen generator.</li>
<li>The third floor contains a lithium generator.</li>
<li>The fourth floor contains nothing relevant.</li>
</ul>

<p>You have an elevator that can move exactly 1 or 2 items. You can only leave a microchip on a floor with a non-matching generator if a matching generator is also present.</p>

<p>Move all items to the top (4th) floor.</p>
</blockquote>

<p>Plan of attack: create a simulation and the perform a <a href="https://en.wikipedia.org/wiki/breadth%20first%20search">breadth first search</a> to find the fastest solution. This might have issues depending on how large the solution space is, but we can start with this.</p>

<p>First, represent the microchips and generators:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Thing</span>(object):
    <span style="color:#66d9ef">def</span> __init__(self, element): self<span style="color:#f92672">.</span>element <span style="color:#f92672">=</span> element
    <span style="color:#66d9ef">def</span> __repr__(self): <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;{}&lt;{}&gt;&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__name__, self<span style="color:#f92672">.</span>element)
    <span style="color:#66d9ef">def</span> __hash__(self): <span style="color:#66d9ef">return</span> hash(repr(self))
    <span style="color:#66d9ef">def</span> __eq__(self, other): <span style="color:#66d9ef">return</span> repr(self) <span style="color:#f92672">==</span> repr(other)
    <span style="color:#66d9ef">def</span> __lt__(self, other): <span style="color:#66d9ef">return</span> repr(self) <span style="color:#f92672">&lt;</span> repr(other)

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Generator</span>(Thing): <span style="color:#66d9ef">pass</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Microchip</span>(Thing): <span style="color:#66d9ef">pass</span></code></pre></div>
<p>The main interesting part here is that I have implemented <code>__hash__</code>, <code>__eq__</code> and <code>__lt__</code>. This means that either <code>Generators</code> and <code>Microchips</code> can be put in a <code><a href="https://docs.python.org/3/search.html?q=set">set</a></code>
 or they can be <code><a href="https://docs.python.org/3/search.html?q=sorted">sorted</a></code>
.</p>

<p>Next, a class that can represent the current &lsquo;state&rsquo; of the solution. This should be the current location of all <code>Things</code> and the elevator, along with being able to generate any next states we can get to from this one:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">State</span>(object):
    <span style="color:#66d9ef">def</span> __init__(self, floors, elevator <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, steps <span style="color:#f92672">=</span> None):
        self<span style="color:#f92672">.</span>_elevator <span style="color:#f92672">=</span> elevator
        self<span style="color:#f92672">.</span>_floors <span style="color:#f92672">=</span> floors
        self<span style="color:#f92672">.</span>_steps <span style="color:#f92672">=</span> steps <span style="color:#f92672">or</span> []
        self<span style="color:#f92672">.</span>_hash <span style="color:#f92672">=</span> hash(repr(self))

    <span style="color:#66d9ef">def</span> __repr__(self):
        <span style="color:#e6db74">&#39;&#39;&#39;Simple output for repr that doesn&#39;t include steps (since this is used by hash).&#39;&#39;&#39;</span>

        floor_strings <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> items <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>_floors:
            <span style="color:#66d9ef">if</span> items:
                floor_strings<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(repr(item) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> sorted(items)))
            <span style="color:#66d9ef">else</span>:
                floor_strings<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#39;∅&#39;</span>)

        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;State&lt;{}, {}&gt;&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>_elevator, <span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(floor_strings))

    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#e6db74">&#39;&#39;&#39;Nicer output for str(state) that includes steps.&#39;&#39;&#39;</span>

        floors <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> i, floor <span style="color:#f92672">in</span> enumerate(self<span style="color:#f92672">.</span>_floors):
            level_part <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;[{}]&#39;</span> <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>_elevator <span style="color:#f92672">==</span> i <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39; {} &#39;</span>)<span style="color:#f92672">.</span>format(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
            item_part <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(str(item) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> sorted(floor))
            floors<span style="color:#f92672">.</span>append(level_part <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">+</span> item_part)
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(reversed(floors))

    <span style="color:#66d9ef">def</span> __hash__(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_hash

    <span style="color:#66d9ef">def</span> __eq__(self, other):
        <span style="color:#66d9ef">return</span> hash(self) <span style="color:#f92672">==</span> hash(other)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">steps</span>(self):
        <span style="color:#e6db74">&#39;&#39;&#39;Return the steps taken by this object.&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">return</span> copy<span style="color:#f92672">.</span>copy(self<span style="color:#f92672">.</span>_steps)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">move</span>(self, delta, items):
        <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">        Return a new state resulting from moving the elevator by delta (-1/+1) and take items with it.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        If the new state isn&#39;t valid, return None.
</span><span style="color:#e6db74">        &#39;&#39;&#39;</span>

        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> (<span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> self<span style="color:#f92672">.</span>_elevator <span style="color:#f92672">+</span> delta <span style="color:#f92672">&lt;</span> len(self<span style="color:#f92672">.</span>_floors)):
            <span style="color:#66d9ef">return</span>

        new_floors <span style="color:#f92672">=</span> copy<span style="color:#f92672">.</span>deepcopy(self<span style="color:#f92672">.</span>_floors)
        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> items:
            new_floors[self<span style="color:#f92672">.</span>_elevator]<span style="color:#f92672">.</span>remove(item)
            new_floors[self<span style="color:#f92672">.</span>_elevator <span style="color:#f92672">+</span> delta]<span style="color:#f92672">.</span>add(item)

        new_state <span style="color:#f92672">=</span> State(
            floors <span style="color:#f92672">=</span> new_floors,
            elevator <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_elevator <span style="color:#f92672">+</span> delta,
            steps <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_steps <span style="color:#f92672">+</span> [(delta, items)],
        )

        <span style="color:#66d9ef">if</span> new_state<span style="color:#f92672">.</span>is_valid():
            <span style="color:#66d9ef">return</span> new_state

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_valid</span>(self):
        <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">        A state is invalid if a microchip is on a floor with a generator, but
</span><span style="color:#e6db74">        does not have its own generator.
</span><span style="color:#e6db74">        &#39;&#39;&#39;</span>

        <span style="color:#66d9ef">for</span> floor <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>_floors:
            chips <span style="color:#f92672">=</span> {item <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> floor <span style="color:#66d9ef">if</span> isinstance(item, Microchip)}
            generators <span style="color:#f92672">=</span> {item <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> floor <span style="color:#66d9ef">if</span> isinstance(item, Generator)}

            <span style="color:#75715e"># If there are no generators, the chips are safe</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> generators:
                <span style="color:#66d9ef">continue</span>

            <span style="color:#75715e"># At least one powered chip</span>
            <span style="color:#75715e"># If there are any chips that don&#39;t have a matching generator, they are not safe</span>
            <span style="color:#66d9ef">if</span> any(chip <span style="color:#66d9ef">for</span> chip <span style="color:#f92672">in</span> chips <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Generator(chip<span style="color:#f92672">.</span>element) <span style="color:#f92672">in</span> generators):
                <span style="color:#66d9ef">return</span> False

        <span style="color:#66d9ef">return</span> True

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">is_solved</span>(self):
        <span style="color:#e6db74">&#39;&#39;&#39;If all items are on the top floor, the puzzle is solved.&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">return</span> <span style="color:#f92672">not</span> any(self<span style="color:#f92672">.</span>_floors[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next_states</span>(self):
        <span style="color:#e6db74">&#39;&#39;&#39;Return all valid next states possible from moving 1-2 items up or down a floor.&#39;&#39;&#39;</span>

        <span style="color:#66d9ef">for</span> delta <span style="color:#f92672">in</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>]:
            <span style="color:#66d9ef">for</span> count <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]:
                <span style="color:#66d9ef">for</span> items <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>combinations(self<span style="color:#f92672">.</span>_floors[self<span style="color:#f92672">.</span>_elevator], count):
                    new_state <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>move(delta, items)
                    <span style="color:#66d9ef">if</span> new_state:
                        <span style="color:#66d9ef">yield</span> new_state</code></pre></div>
<p>There&rsquo;s a fair bit to unpack there, so let&rsquo;s go through it bit by bit.</p>

<p>First, some setup. The <code>__init__</code> method constructs a new state, <code>__str__</code> makes printing look nicer (mostly for debugging), and <code>__repr__</code> creates a machine readable version of the state. This is the most important part, since <code>__repr__</code> is used to construct the hash, which in turn is used to avoid recalculating duplicate states. No matter how we got to it, if the pieces are on the same floors, it&rsquo;s the same state.</p>

<p>Next, a few helper functions to check our current state. <code>is_solved</code> will return <code>True</code> if all of the items are on the top floor. <code>is_valid</code> will check the condition that an unpowered microchip cannot share a floor with a powered one. <code><a href="https://docs.python.org/3/search.html?q=any">any</a></code>
 is nice.</p>

<p>Finally, we want to calculate all possible moves from the given state to the next state. The <code>move</code> function does that for a single elevator movement (returning <code>None</code> if the new state doesn&rsquo;t work) and <code>next_states</code> creates an iterator that will return all possible ways that we could move the elevator. <code><a href="https://docs.python.org/3/search.html?q=itertools.combinations">itertools.combinations</a></code>
 is rather handy for this.</p>

<p>Now that we have the simulation layed out, we have a bit to load the initial state from a file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Read the initial state from the given input file</span>
re_object <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(\w+)(?:-compatible)? (generator|microchip)&#39;</span>)
<span style="color:#66d9ef">with</span> open(args<span style="color:#f92672">.</span>input, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> fin:
    floors <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> fin:
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> line<span style="color:#f92672">.</span>strip() <span style="color:#f92672">or</span> line<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;#&#39;</span>):
            <span style="color:#66d9ef">continue</span>

        floor <span style="color:#f92672">=</span> set()
        <span style="color:#66d9ef">for</span> element, type <span style="color:#f92672">in</span> re_object<span style="color:#f92672">.</span>findall(line):
            <span style="color:#66d9ef">if</span> type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;generator&#39;</span>:
                floor<span style="color:#f92672">.</span>add(Generator(element))
            <span style="color:#66d9ef">elif</span> type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;microchip&#39;</span>:
                floor<span style="color:#f92672">.</span>add(Microchip(element))

        floors<span style="color:#f92672">.</span>append(floor)

    initial_state <span style="color:#f92672">=</span> State(floors)</code></pre></div>
<p>And the actual <a href="https://en.wikipedia.org/wiki/breadth%20first%20search">breadth first search</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Use a BFS to find the fastest solution</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve</span>(initial_state):
    queue <span style="color:#f92672">=</span> [initial_state]
    duplicates <span style="color:#f92672">=</span> {initial_state}

    <span style="color:#66d9ef">while</span> queue:
        state <span style="color:#f92672">=</span> queue<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
        count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

        <span style="color:#66d9ef">if</span> state<span style="color:#f92672">.</span>is_solved():
            <span style="color:#66d9ef">return</span> state

        <span style="color:#66d9ef">for</span> next_state <span style="color:#f92672">in</span> state<span style="color:#f92672">.</span>next_states():
            <span style="color:#66d9ef">if</span> next_state <span style="color:#f92672">in</span> duplicates:
                duplicate_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
            <span style="color:#66d9ef">else</span>:
                queue<span style="color:#f92672">.</span>append(next_state)
                duplicates<span style="color:#f92672">.</span>add(next_state)

final_state <span style="color:#f92672">=</span> solve(initial_state)

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">=== Solution ===
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Initial state:
</span><span style="color:#e6db74">{initial}
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Final state:
</span><span style="color:#e6db74">{final}
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Steps:
</span><span style="color:#e6db74">{steps}
</span><span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#f92672">.</span>format(
    count <span style="color:#f92672">=</span> len(final_state<span style="color:#f92672">.</span>steps()),
    initial <span style="color:#f92672">=</span> initial_state,
    final <span style="color:#f92672">=</span> final_state,
    steps <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(
        <span style="color:#e6db74">&#39;{}: {} {}&#39;</span><span style="color:#f92672">.</span>format(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, delta, items)
        <span style="color:#66d9ef">for</span> i, (delta, items) <span style="color:#f92672">in</span> enumerate(final_state<span style="color:#f92672">.</span>steps())
    ),
))</code></pre></div>
<p>I should probably abstract out the code to do a search like that. We use it all of the time.</p>

<blockquote>
<p><strong>Part 2:</strong> Add the following elements to the first floor:</p>

<ul>
<li>An elerium generator.</li>
<li>An elerium-compatible microchip.</li>
<li>A dilithium generator.</li>
<li>A dilithium-compatible microchip.</li>
</ul>
</blockquote>

<p>Mostly, this just makes the puzzle <em>far</em> longer. It is no longer really feasible to run the direct solution. With 14 items that can each be on one of 4 floors, there are <span class="latex-inline">4^{14} = 268,435,456</span>
 possible states (many not valid). With a fast enough simulation, that&rsquo;s doable, but mine isn&rsquo;t super fast.</p>

<p>Instead, we can make an intuitive leap that took me rather a long time to think of: <em>there&rsquo;s no difference between the elements</em>.</p>

<p>So long as the generator and microchip match, there&rsquo;s no difference between having elerium<sup class="footnote-ref" id="fnref:xcom"><a href="#fn:xcom">1</a></sup> on floor 1 and dilithium<sup class="footnote-ref" id="fnref:startrek"><a href="#fn:startrek">2</a></sup> on floor 2 versus having dilithium on floor 1 and elerium on floor 2.</p>

<p>So what we can do is modify the <code>__repr__</code> function so that those two states have the same representation. This in turn will update the <code>__hash__</code> function so that we won&rsquo;t visit either state if we&rsquo;ve already seen the other.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> __repr__(self):
    <span style="color:#e6db74">&#39;&#39;&#39;Simple output for repr that doesn&#39;t include steps (since this is used by hash).&#39;&#39;&#39;</span>

    <span style="color:#75715e"># Optimization: Parts are interchangeable, rewrite them by order</span>
    <span style="color:#75715e"># This will assign an index the first time it sees a name and use that any more</span>
    <span style="color:#75715e"># So parts will always be ordered from lowest to highest, ties broken alphabetically</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ordered_rewrite</span>(m, cache <span style="color:#f92672">=</span> {}):
        type, name <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>groups()

        <span style="color:#66d9ef">if</span> name <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> cache:
            cache[name] <span style="color:#f92672">=</span> str(len(cache))

        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;{}{}&#39;</span><span style="color:#f92672">.</span>format(type[<span style="color:#ae81ff">0</span>], cache[name])

    floor_strings <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> items <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>_floors:
        <span style="color:#66d9ef">if</span> items:
            floor_strings<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(repr(item) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> sorted(items)))
        <span style="color:#66d9ef">else</span>:
            floor_strings<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#39;∅&#39;</span>)

    <span style="color:#66d9ef">return</span> re<span style="color:#f92672">.</span>sub(
        <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(Microchip|Generator)&lt;([^&lt;&gt;]+)&gt;&#39;</span>,
        ordered_rewrite,
        <span style="color:#e6db74">&#39;State&lt;{}, {}&gt;&#39;</span><span style="color:#f92672">.</span>format(self<span style="color:#f92672">.</span>_elevator, <span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(floor_strings)),
    )</code></pre></div>
<p>The trick here is apply a regex with a function (<code>ordered_rewrite</code>) that will rewrite each element with a number based on the order they appear in the string. This requires that Python&rsquo;s regex engine does replacements in the same order all the time, but that does actually work out. Using this, the solution is still relatively slow, but I did finally get an actual answer.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:xcom">I love <a href="https://en.wikipedia.org/wiki/X-COM">that game</a>.
 <a class="footnote-return" href="#fnref:xcom"><sup>[return]</sup></a></li>
<li id="fn:startrek">A pretty <a href="https://en.wikipedia.org/wiki/Star%20Trek">good show</a> too.
 <a class="footnote-return" href="#fnref:startrek"><sup>[return]</sup></a></li>
</ol>
</div></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
