<!DOCTYPE html>
<html onclick >
<head>
    <title>Command line emoji search ‚Äì jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Command line emoji search</h1>

        <div class="entry-meta"><span class="entry-date">2016-01-04</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2015/12/25/advent-of-code-day-25/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2016/01/06/command-line-unicode-search/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a class="taxonomy-value" href="/programming/topics/command-line">Command line</a><a href="https://blog.jverkamp.com/2016/01/06/command-line-unicode-search/" class="next-link"></a></li><li><a class="taxonomy-value" href="/programming/topics/emoji">Emoji</a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2016/01/02/inlining-plaintext-attachments-in-gmail/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2016/01/06/command-line-unicode-search/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2016/01/04/superior-saturday/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2016/01/05/lord-sunday/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><p>Sometimes, I find myself wanting to communicate in <a href="https://en.wikipedia.org/wiki/emoji">emoji</a>.</p>

<p>üêî</p>

<p>How about this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ emoji chicken
üêî

$ emoji <span style="color:#e6db74">&#34;which came first, the üêî or the ü•ö&#34;</span>
which came first, the üêî or the üç≥</code></pre></div>
<p>To start off, I&rsquo;m going to use the data from muan&rsquo;s emojilib on GitHub: <a href="https://github.com/muan/emojilib/">github:muan/emojilib</a>. Specifically, their list of keywords that relate to any given emoji: <a href="https://raw.githubusercontent.com/muan/emojilib/master/emojis.json">emojis.json</a><sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup></p>

<p>We&rsquo;ll fetch that file if we haven&rsquo;t before and otherwise use a locally cached version:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">cache_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>expanduser(<span style="color:#e6db74">&#39;~/.emoji.json&#39;</span>)
remote_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://raw.githubusercontent.com/muan/emojilib/master/emojis.json&#39;</span>

<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(cache_path):
    <span style="color:#66d9ef">with</span> open(cache_path, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> fout:
        response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(remote_url)
        fout<span style="color:#f92672">.</span>write(response<span style="color:#f92672">.</span>text)

<span style="color:#66d9ef">with</span> open(cache_path, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> fin:
    emoji <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(fin)</code></pre></div>
<p>After that, there are two different ways that we can look up Emoji. We can either look them up by a semi official name or by keyword. This function will search through the both, matching on names first and then falling back to the first which matches the given keyword (this script isn&rsquo;t designed to return choices for emoji, but rather just choose the first one that fits; because a Python <code>dict</code> isn&rsquo;t ordered, this is actually non-deterministic):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">emoji_by_keyword</span>(keyword):
    <span style="color:#66d9ef">if</span> keyword <span style="color:#f92672">in</span> emoji:
        <span style="color:#66d9ef">return</span> emoji[keyword][<span style="color:#e6db74">&#39;char&#39;</span>]

    <span style="color:#66d9ef">for</span> name <span style="color:#f92672">in</span> emoji:
        <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;keys&#39;</span>:
            <span style="color:#66d9ef">continue</span>

        <span style="color:#66d9ef">if</span> keyword <span style="color:#f92672">in</span> emoji[name][<span style="color:#e6db74">&#39;keywords&#39;</span>]:
            <span style="color:#66d9ef">return</span> emoji[name][<span style="color:#e6db74">&#39;char&#39;</span>]

    <span style="color:#66d9ef">return</span> keyword</code></pre></div>
<p>Following that, we can use regular expressions (the <code>re</code> module) to replace emoji in a string&ndash;if they&rsquo;re set off <code>:emoji:</code> style (a la GitHub):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">emojify</span>(string):
    <span style="color:#66d9ef">return</span> re<span style="color:#f92672">.</span>sub(
        <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;\:(\w+)\:&#39;</span>,
        <span style="color:#66d9ef">lambda</span> m : emoji_by_keyword(m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)),
        string
    )</code></pre></div>
<p>That&rsquo;s a neat trick that I use from time to time: the second argument to <code>re.sub</code> can be either a literal string or a function. If it&rsquo;s the latter, it&rsquo;s given the match object for each replacement, which we can then pass along to <code>emoji_by_keyword</code>.</p>

<p>And finally, let&rsquo;s mess with some command line arguments:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Run replacement mode on stdin if no parameters</span>
<span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> sys<span style="color:#f92672">.</span>stdin:
        <span style="color:#66d9ef">print</span>(emojify(line[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))

<span style="color:#75715e"># Othwise, run through the list</span>
<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">for</span> arg <span style="color:#f92672">in</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>:]:
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">in</span> arg:
            <span style="color:#66d9ef">print</span>(emojify(arg), end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39; &#39;</span>)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">print</span>(emoji_by_keyword(arg), end <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39; &#39;</span>)</code></pre></div>
<p>There are three modes we can be operating in:</p>

<ul>
<li><code>stdin</code> mode, where we will read text from <code>stdin</code> and replace any <code>:emoji:</code> blocks with the corresponding emoji</li>
<li>String mode, where we find any <code>:emoji:</code> in each argument in each input and replace them</li>
<li>Single lookup mode, where we look up each argument as an individual emoji keyword, without the need for <code>:</code></li>
</ul>

<p>And, that&rsquo;s it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ emoji fireworks fireworks fireworks
üéÜüéÜüéÜ</code></pre></div>
<p>Since this is now one of my <a href="https://blog.jverkamp.com/2015/02/11/update-dotfiles-encryption/">dotfiles</a>, you can find the entire source here: <a href="https://github.com/jpverkamp/dotfiles/blob/master/bin/emoji">emoji</a></p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">It&rsquo;s under an MIT license, so all is well.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
</ol>
</div></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
