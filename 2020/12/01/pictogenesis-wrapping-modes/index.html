<!doctype html><html><head><title>Pictogenesis: Wrapping Modes â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.30448892aa1f91e9c4cb5494e5c5e5abc13b7778de7786e5256cdc7d2424813a.js integrity="sha256-MESIkqofkenEy1SU5cXlq8E7d3jed4blJWzcfSQkgTo=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg=" defer></script>
<script src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90=" defer></script>
<script src=/main.min.982c2d7bb434b4cf8b19c2cf38ef7e7f7162ddbed610e5bdddbb937001e26574.js integrity="sha256-mCwte7Q0tM+LGcLPOO9+f3Fi3b7WEOW93buTcAHiZXQ=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.1a5fbab1ecff843d4ee6e936243fb06066197cd8c9357883d791333ce6001f3b.css integrity="sha256-Gl+6sez/hD1O5uk2JD+wYGYZfNjJNXiD15EzPOYAHzs="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>Pictogenesis: Wrapping Modes</h1><div class=entry-meta><span class=entry-date>2020-12-01</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2020/11/24/pictogenesis-register-machine/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/javascript>JavaScript</a><a href=https://blog.jverkamp.com/2020/12/03/pictogenesis-transpiling/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2020/11/24/pictogenesis-register-machine/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/cellular-automata>Cellular Automata</a><a href=https://blog.jverkamp.com/2020/12/03/pictogenesis-transpiling/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2020/11/24/pictogenesis-register-machine/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/generative-art>Generative Art</a><a href=https://blog.jverkamp.com/2020/12/03/pictogenesis-transpiling/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2020/11/24/pictogenesis-register-machine/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/p5js>p5js</a><a href=https://blog.jverkamp.com/2020/12/03/pictogenesis-transpiling/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2020/11/24/pictogenesis-register-machine/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/procedural-content>Procedural Content</a><a href=https://blog.jverkamp.com/2020/12/03/pictogenesis-transpiling/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2020/11/24/pictogenesis-register-machine/ class=previous-link></a><a class=taxonomy-value href=/series/pictogenesis>Pictogenesis</a><a href=https://blog.jverkamp.com/2020/12/03/pictogenesis-transpiling/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2020/11/24/pictogenesis-register-machine/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2020/12/03/pictogenesis-transpiling/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2020/11/27/spring-mills-2020/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2020/12/02/the-umbrella-academy-vol.-2-dallas/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Now that I&rsquo;ve got <a href=https://blog.jverkamp.com/2020/11/24/pictogenesis-register-machine/>register machines</a> working, one of the next ideas I had was to implement different wrapping modes. Currently, as it stands, <code>X</code> and <code>Y</code> are passed into the machine as floating point numbers from [0, 1] across the image and output is expected to be [0, 1] for each of <code>R</code>, <code>G</code>, and <code>B</code>. Any values that end up outside of that range, we truncate down to that range. But some of our mathematical functions (multiplication, exponentiation, negation, etc) tend to generate numbers way out of this range. But they don&rsquo;t have to!</p><p>Specifically, I&rsquo;m going to modify this to give a choice of options:</p><ul><li><code>keep</code>: The value is preserved, nothing is done</li><li><code>wrap</code>: The integer part of values is removed (1.37 -> 0.37, -1.37 -> 0.37)</li><li><code>clamp</code>: The old behavior: values less than 0 become 0, values greater than 1 become 1</li></ul><p>Any one of these options can be applied either step by step or only at the end of the entire run (although <code>keep</code> at the end of the function doesn&rsquo;t make overmuch sense).</p><p>How to implement that?</p><p>Per step:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Run each command in the program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>command</span> <span style=color:#66d9ef>of</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>program</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Collect input registers (all but the first)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>args</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>param</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>command</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>1</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>registers</span>[<span style=color:#a6e22e>param</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Run the function, store in the first param
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>command</span>.<span style=color:#66d9ef>function</span>.<span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>this</span>, <span style=color:#a6e22e>args</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> isNaN(<span style=color:#a6e22e>result</span>) <span style=color:#f92672>?</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>modeCall</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;clamp&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>result</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>modeCall</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;wrap&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>1.0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>readonlyXY</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>command</span>.<span style=color:#a6e22e>params</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;X&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>command</span>.<span style=color:#a6e22e>params</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;Y&#39;</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Do nothing, trying to write to x/y
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>registers</span>[<span style=color:#a6e22e>command</span>.<span style=color:#a6e22e>params</span>[<span style=color:#ae81ff>0</span>]] <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>It&rsquo;s pretty nice that modulus (<code>%</code>) does precisely what we need here!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rendering</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>v</span>) =&gt; <span style=color:#a6e22e>v</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>modeCall</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;clamp&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>v</span>) =&gt; <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>v</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>modeEnd</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;wrap&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>v</span>) =&gt; <span style=color:#a6e22e>v</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>1.0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>renderPerFrame</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>run</span>(<span style=color:#ae81ff>1.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>width</span>, <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>renderingY</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>el</span>) =&gt; <span style=color:#66d9ef>int</span>(<span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>f</span>(<span style=color:#a6e22e>el</span>)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            ...
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Check it out:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGuiPanel</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span>.<span style=color:#a6e22e>addObject</span>(<span style=color:#a6e22e>params</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span>.<span style=color:#a6e22e>setPosition</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Genome</span>(<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>genomeSize</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterMachine</span>(<span style=color:#a6e22e>g</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>block</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;div&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;textarea&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;400px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;height&#39;</span>, <span style=color:#e6db74>&#39;400px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>value</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rendering</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>renderPerFrame</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>run</span>(<span style=color:#ae81ff>1.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>width</span>, <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>renderingY</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>el</span>) =&gt; <span style=color:#66d9ef>int</span>(<span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>el</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>rect</span>(<span style=color:#a6e22e>renderingX</span>, <span style=color:#a6e22e>renderingY</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>renderingX</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>width</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>renderingY</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>renderingY</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>height</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rendering</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here&rsquo;s a big example of how this can work. The program</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>polT</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>b</span> <span style=color:#66d9ef>t1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sqrt</span> <span style=color:#66d9ef>g</span> <span style=color:#66d9ef>t0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mul</span> <span style=color:#66d9ef>g</span> <span style=color:#66d9ef>t0</span> <span style=color:#66d9ef>b</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>polT</span> <span style=color:#66d9ef>t1</span> <span style=color:#66d9ef>t0</span> <span style=color:#66d9ef>x</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>abs</span> <span style=color:#66d9ef>t1</span> <span style=color:#66d9ef>r</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>polR</span> <span style=color:#66d9ef>g</span> <span style=color:#66d9ef>y</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>sqrt</span> <span style=color:#66d9ef>t0</span> <span style=color:#66d9ef>t0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>invsub</span> <span style=color:#66d9ef>t1</span> <span style=color:#66d9ef>y</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>add</span> <span style=color:#66d9ef>r</span> <span style=color:#66d9ef>x</span> <span style=color:#66d9ef>x</span>
</span></span></code></pre></div><p>With <code>modeCall: clamp, modeEnd: clamp</code> or <code>modeCall: keep, modeEnd: clamp</code>:</p><figure><img src=/embeds/2020/pictogenesis-register-clamp-clamp.png></figure><p>With <code>modeCall: clamp, modeEnd: wrap</code>:</p><figure><img src=/embeds/2020/pictogenesis-register-clamp-wrap.png></figure><p>With <code>modeCall: wrap, modeEnd: clamp</code>:</p><figure><img src=/embeds/2020/pictogenesis-register-wrap-clamp.png></figure><p>Neat!</p><p>Here&rsquo;s the interactive one to play with:</p><div class=tab><button id=iframedemo class="tablinks default" data-tabset=706d onclick='changeTab(event,"706d","iframedemo")'>Demo</button>
<button id=sketch.js class=tablinks data-tabset=706d onclick='changeTab(event,"706d","sketch.js")'>sketch.js</button>
<button id=ops.js class=tablinks data-tabset=706d onclick='changeTab(event,"706d","ops.js")'>ops.js</button>
<button id=genome.js class=tablinks data-tabset=706d onclick='changeTab(event,"706d","genome.js")'>genome.js</button>
<button id=register.js class=tablinks data-tabset=706d onclick='changeTab(event,"706d","register.js")'>register.js</button></div><div class=tabcontent data-tabset=706d id=iframedemo><iframe marginwidth=0 width=660 height=990.0000000000001 frameborder=0 srcdoc='
            
<html>
<head>
<script src="https://blog.jverkamp.com/p5_12556498581193807062.min.92daa6da454d82d6d0c80d955df5c3aff2ac308264efd8726cd9434a9c4b4640.js" integrity="sha256-ktqm2kVNgtbQyA2VXfXDr/KsMIJk79hybNlDSpxLRkA=" defer></script><script src="https://blog.jverkamp.com/quicksettings_13755902899324222893.min.2a42b2a52ef781cfc8b23b19463b94ebca971666c0b532a26ff6710cd844f344.js" integrity="sha256-KkKypS73gc/IsjsZRjuU68qXFmbAtTKib/ZxDNhE80Q=" defer></script><script src="https://blog.jverkamp.com/p5.gui_14323647330486362791.min.25f90c9eb43149e2901f61d0b6b09a63dcd04667ea2a8a040eb494b20a2f8ab4.js" integrity="sha256-JfkMnrQxSeKQH2HQtrCaY9zQRmfqKooEDrSUsgovirQ=" defer></script>

    <style>canvas { border: 1px solid black; border-radius: 1em; }</style>
</head>
<body>

            <script>

            
                
                    
let gui;
let params = {
  registerCount: 7,
  registerCountMin: 5, // x, y, ..., r, g, b
  registerCountMax: 30,
  genomeSize: 30,
  genomeSizeMin: 10,
  genomeSizeMax: 1000,
  modeCall: ["keep", "clamp", "wrap"],
  modeEnd: ["clamp", "wrap"],
  readonlyXY: true,
  renderPerFrame: 100,
  renderPerFrameMax: 1000,
  noise: 10,
  noiseMin: 0.01,
  noiseMax: 100,
  noiseStep: 0.01,
};

let g, p;
let rendering = true,
  renderingX = 0,
  renderingY = 0;
let code;

function resetRendering() {
  background(0);
  rendering = false;
  renderingX = 0;
  renderingY = 0;
}

function updateP(kls) {
  if (kls) {
    p = new kls(g);
  } else {
    p = new p.constructor(g);
  }
  code.value(p.toString());
  resetRendering();
  rendering = true;
}

// Helper function to index an array by a real number
gendex = (arr, id) => arr[int(arr.length * id)];

function oldSetup() {
  createCanvas(400, 400);
  gui = createGuiPanel();
  gui.addObject(params);
  gui.setPosition(420, 0);

  background(0);

  g = new Genome(params.genomeSize);
  p = new RegisterMachine(g);

  let divMachine = createDiv("machines");
  
  divMachine.child(createButton("registers").mousePressed(() => {
    g = new Genome(params.genomeSize);
    updateP(RegisterMachine);
  }));

  let divMutations = createDiv("mutations");

  divMutations.child(createButton("point").mousePressed(() => {
    g.mutatePoint();
    updateP();
  }));

  divMutations.child(createButton("insert").mousePressed(() => {
    g.mutateInsertion();
    updateP();
  }));

  divMutations.child(createButton("delete").mousePressed(() => {
    g.mutateDeletion();
    updateP();
  }));

  divMutations.child(createButton("duplicate").mousePressed(() => {
    g.mutateDuplication();
    updateP();
  }));

  createButton("rerender").mousePressed(() => {
    resetRendering();
    rendering = true;
  });

  let block = createElement(&#39;div&#39;);
  code = createElement(&#39;textarea&#39;);
  code.style(&#39;width&#39;, &#39;400px&#39;);
  code.style(&#39;height&#39;, &#39;400px&#39;);
  code.value(p.toString());
  block.child(code);
}

function draw() {
  if (rendering) {
    let f = (v) => v;
    if (params.modeEnd === "clamp") {
      f = (v) => constrain(v, 0, 1);
    } else if (params.modeEnd === "wrap") {
      f = (v) => v % 1.0;
    }

    for (var i = 0; i < params.renderPerFrame; i++) {
      let c = p.run(1.0 * renderingX / width, 1.0 * renderingY / height);
      c = c.map((el) => int(255 * f(el)));

      fill(c);
      noStroke();
      rect(renderingX, renderingY, 1, 1);

      renderingX++;
      if (renderingX >= width) {
        renderingX = 0;
        renderingY++;
      }
      if (renderingY >= height) {
        rendering = false;
      }
    }
  }
}

                
                    
const instructions = [
  // Basic math
  {name: "id", function: (x) => x},
  {name: "add", function: (x, y) => x + y},
  {name: "sub", function: (x, y) => x - y},
  {name: "mul", function: (x, y) => x * y},
  {name: "div", function: (x, y) => x / y},
  {name: "mod", function: (x, y) => x % y},
  {name: "max", function: (x, y) => Math.max(x, y)},
  {name: "min", function: (x, y) => Math.min(x, y)},
  {name: "abs", function: (x) => Math.abs(x)},
  {name: "inv", function: (x) => 1 / x},
  {name: "invsub", function: (x) => 1 - x},
  {name: "neg", function: (x) => -x},
  {name: "sin", function: (x) => Math.sin(x)},
  {name: "exp", function: (x) => Math.exp(x)},
  {name: "log", function: (x) => Math.log(x)},
  {name: "sqrt", function: (x) => Math.sqrt(x)},
  
  // Polar coordinate conversions
  {name: "polR", function: (x, y) => Math.sqrt(x * x + y * y)},
  {name: "polT", function: (x, y) => Math.atan2(x, y)},
  
  // Constants
  {name: "ZERO", function: () => 0},
  {name: "ONE", function: () => 1},
  
  // Conditionals
  {name: "zero?", function: (c, t, f) => c === 0 ? t : f},
  {name: "equal?", function: (a, b, t, f) => a === b ? t : f},
  {name: "gt?", function: (a, b, t, f) => a > b ? t : f},
  
  // Perlin noise
  {name: "noise1", function: (x) => noise(params.noise * x)},
  {name: "noise2", function: (x, y) => noise(params.noise * x, params.noise * y)},
];

                
                    
class Genome {
  constructor(length) {
    length = length || 10;
    this.data = [];
    while (this.data.length < length) {
      this.data.push(random());
    }
  }

  // Apply up to one of each kind of mutation to this genome
  mutate() {
    var index;

    if (random() < params.mutationRate_point) mutatePoint();
    if (random() < params.mutationRate_insertion) mutateInsertion();
    if (random() < params.mutationRate_deletion) mutateDeletion();
    if (random() < params.mutationRate_duplication) mutateDuplication();
  }

  mutatePoint() {
    var index = Math.floor(random() * this.data.length);
    this.data[index] = random();
  }

  mutateInsertion() {
    var index = Math.floor(random() * this.data.length);
    this.data.splice(index, 0, random());
  }


  mutateDeletion() {
    var index = Math.floor(random() * this.data.length);
    this.data.splice(index, 1);
  }


  mutateDuplication() {
    var index = Math.floor(random() * this.data.length);
    this.data.splice(index, 0, this.data[index]);
  }

  crossover(other) {
    var child = new Genome();
    var thisIndex = Math.floor(random() * this.data.length);
    var otherIndex = Math.floor(random() * other.data.length);

    child.data = this.data.slice(0, thisIndex).concat(other.data.slice(otherIndex));
    return child;
  }
}

                
                    
class RegisterMachine {
  constructor(genome) {
    // Low registers are input, high output, middle are temporary
    let registers = [&#39;x&#39;, &#39;y&#39;, &#39;r&#39;, &#39;g&#39;, &#39;b&#39;];
    while (registers.length < params.registerCount) {
      registers.splice(2, 0, &#39;t&#39; + (registers.length - 5));
    }

    // Pull off one command for instruction and then as many args as needed
    this.program = [];
    for (var i = 0; i < genome.data.length;) {
      // Copy the instruction to add params
      let instruction = {
        ...gendex(instructions, genome.data[i++])
      };
      instruction.params = []
      for (var j = 0; j < instruction.function.length + 1; j++) {
        instruction.params.push(gendex(registers, genome.data[i++]));
      }
      this.program.push(instruction);
    }
  }

  run(x, y) {
    let registers = {
      x: x,
      y: y,
      r: 0,
      g: 0,
      b: 0
    };

    // Run each command in the program
    for (var command of this.program) {
      // Collect input registers (all but the first)
      let args = [];
      for (var param of command.params.slice(1)) {
        args.push(registers[param] || 0);
      }

      // Run the function, store in the first param
      var result = command.function.apply(this, args);
      result = isNaN(result) ? 0 : result;
      if (params.modeCall === "clamp") {
        result = constrain(result, 0, 1);
      } else if (params.modeCall == "wrap") {
        result = result % 1.0;
      }

      if (params.readonlyXY && (command.params[0] == &#39;x&#39; || command.params[0] == &#39;y&#39;)) {
        // Do nothing, trying to write to x/y
      } else {
        registers[command.params[0]] = result;
      }
    }

    // Return the color from the r/g/b registers
    return [
      registers.r,
      registers.g,
      registers.b
    ];
  }

  toString() {
    return this.program.map((cmd) => cmd.name + &#39; &#39; + cmd.params.join(&#39; &#39;)).join(&#39;\n&#39;);
  }
}

                
            

            const START_PAUSED = false;

            
function setup() {
    // Load saved settings from the browser hash fragment
    if (parent.location.hash && typeof params !== "undefined") {
        try {
            var settings = JSON.parse(atob(parent.location.hash.substring(1)));
            Object.keys(params).forEach((key) => params[key] = key in settings ? settings[key] : params[key]);
        } catch(ex) {
        }
    }

    oldSetup();
    if (START_PAUSED) {
        noLoop();
    }

    createButton("play/pause").mousePressed(() => {
        if (isLooping()) {
            noLoop();
        } else {
            loop();
        }
    });

    createButton("save").mousePressed(() => {
        saveCanvas(&#39;photo&#39;, &#39;png&#39;)
    });

    createButton("clear").mousePressed(() => {
        if (typeof reset !== &#39;undefined&#39;) {
            reset();
        } else {
            clear();
        }
    });

    createButton("reload").mousePressed(() => {
        window.location.reload();
    });

    if (typeof params !== "undefined") {
        for (var el of document.querySelectorAll(&#39;input&#39;)) {
            if (el.id && el.id.startsWith(&#39;qs_&#39;)) {
                el.addEventListener(&#39;change&#39;, () => {
                    parent.location.hash = btoa(JSON.stringify(params));
                });
            }
        }
    }
}

            </script>
            
<noscript>To display this p5.js sketch, JavaScript must be enabled.</noscript>
</body>
</html>

        '></iframe></div><div class=tabcontent data-tabset=706d id=sketch.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gui</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>registerCount</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>7</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>registerCountMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>, <span style=color:#75715e>// x, y, ..., r, g, b
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>registerCountMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>30</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>genomeSize</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>30</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>genomeSizeMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>genomeSizeMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1000</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modeCall</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;keep&#34;</span>, <span style=color:#e6db74>&#34;clamp&#34;</span>, <span style=color:#e6db74>&#34;wrap&#34;</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>modeEnd</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;clamp&#34;</span>, <span style=color:#e6db74>&#34;wrap&#34;</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>readonlyXY</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>renderPerFrame</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>100</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>renderPerFrameMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1000</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noise</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noiseMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.01</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noiseMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>100</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noiseStep</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.01</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>p</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rendering</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>renderingY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>code</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>resetRendering</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rendering</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>renderingY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updateP</span>(<span style=color:#a6e22e>kls</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>kls</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>kls</span>(<span style=color:#a6e22e>g</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>g</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>value</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resetRendering</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rendering</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Helper function to index an array by a real number
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>gendex</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>arr</span>, <span style=color:#a6e22e>id</span>) =&gt; <span style=color:#a6e22e>arr</span>[<span style=color:#66d9ef>int</span>(<span style=color:#a6e22e>arr</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>id</span>)];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGuiPanel</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span>.<span style=color:#a6e22e>addObject</span>(<span style=color:#a6e22e>params</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span>.<span style=color:#a6e22e>setPosition</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Genome</span>(<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>genomeSize</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterMachine</span>(<span style=color:#a6e22e>g</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>divMachine</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createDiv</span>(<span style=color:#e6db74>&#34;machines&#34;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>divMachine</span>.<span style=color:#a6e22e>child</span>(<span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;registers&#34;</span>).<span style=color:#a6e22e>mousePressed</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Genome</span>(<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>genomeSize</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updateP</span>(<span style=color:#a6e22e>RegisterMachine</span>);
</span></span><span style=display:flex><span>  }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>divMutations</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createDiv</span>(<span style=color:#e6db74>&#34;mutations&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>divMutations</span>.<span style=color:#a6e22e>child</span>(<span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;point&#34;</span>).<span style=color:#a6e22e>mousePressed</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>mutatePoint</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updateP</span>();
</span></span><span style=display:flex><span>  }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>divMutations</span>.<span style=color:#a6e22e>child</span>(<span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;insert&#34;</span>).<span style=color:#a6e22e>mousePressed</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>mutateInsertion</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updateP</span>();
</span></span><span style=display:flex><span>  }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>divMutations</span>.<span style=color:#a6e22e>child</span>(<span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;delete&#34;</span>).<span style=color:#a6e22e>mousePressed</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>mutateDeletion</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updateP</span>();
</span></span><span style=display:flex><span>  }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>divMutations</span>.<span style=color:#a6e22e>child</span>(<span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;duplicate&#34;</span>).<span style=color:#a6e22e>mousePressed</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>mutateDuplication</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updateP</span>();
</span></span><span style=display:flex><span>  }));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;rerender&#34;</span>).<span style=color:#a6e22e>mousePressed</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resetRendering</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rendering</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>block</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;div&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;textarea&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;width&#39;</span>, <span style=color:#e6db74>&#39;400px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#39;height&#39;</span>, <span style=color:#e6db74>&#39;400px&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>value</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>block</span>.<span style=color:#a6e22e>child</span>(<span style=color:#a6e22e>code</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>rendering</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>v</span>) =&gt; <span style=color:#a6e22e>v</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>modeEnd</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;clamp&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>v</span>) =&gt; <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>v</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>modeEnd</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;wrap&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>v</span>) =&gt; <span style=color:#a6e22e>v</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>1.0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>renderPerFrame</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>run</span>(<span style=color:#ae81ff>1.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>width</span>, <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>renderingY</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>el</span>) =&gt; <span style=color:#66d9ef>int</span>(<span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>f</span>(<span style=color:#a6e22e>el</span>)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>rect</span>(<span style=color:#a6e22e>renderingX</span>, <span style=color:#a6e22e>renderingY</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>renderingX</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>width</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>renderingX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>renderingY</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>renderingY</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>height</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rendering</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=tabcontent data-tabset=706d id=ops.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>instructions</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Basic math
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;id&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; <span style=color:#a6e22e>x</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;add&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>y</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;sub&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>y</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mul&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>y</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;div&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>y</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mod&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; <span style=color:#a6e22e>x</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>y</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;max&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>)},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;min&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>)},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;abs&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>x</span>)},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;inv&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>x</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;invsub&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>x</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;neg&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; <span style=color:#f92672>-</span><span style=color:#a6e22e>x</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;sin&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; Math.<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>x</span>)},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;exp&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; Math.<span style=color:#a6e22e>exp</span>(<span style=color:#a6e22e>x</span>)},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;log&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; Math.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>x</span>)},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;sqrt&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; Math.<span style=color:#a6e22e>sqrt</span>(<span style=color:#a6e22e>x</span>)},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Polar coordinate conversions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;polR&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; Math.<span style=color:#a6e22e>sqrt</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>y</span>)},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;polT&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; Math.<span style=color:#a6e22e>atan2</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>)},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Constants
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ZERO&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> () =&gt; <span style=color:#ae81ff>0</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ONE&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> () =&gt; <span style=color:#ae81ff>1</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Conditionals
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;zero?&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>f</span>) =&gt; <span style=color:#a6e22e>c</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>t</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>f</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;equal?&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>f</span>) =&gt; <span style=color:#a6e22e>a</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>t</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>f</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;gt?&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>f</span>) =&gt; <span style=color:#a6e22e>a</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>t</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>f</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Perlin noise
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;noise1&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>) =&gt; <span style=color:#a6e22e>noise</span>(<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>noise</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span>)},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;noise2&#34;</span>, <span style=color:#66d9ef>function</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) =&gt; <span style=color:#a6e22e>noise</span>(<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>noise</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>noise</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>y</span>)},
</span></span><span style=display:flex><span>];
</span></span></code></pre></div></div><div class=tabcontent data-tabset=706d id=genome.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Genome</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>length</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>length</span> <span style=color:#f92672>||</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>random</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Apply up to one of each kind of mutation to this genome
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>mutate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>index</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>mutationRate_point</span>) <span style=color:#a6e22e>mutatePoint</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>mutationRate_insertion</span>) <span style=color:#a6e22e>mutateInsertion</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>mutationRate_deletion</span>) <span style=color:#a6e22e>mutateDeletion</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>random</span>() <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>mutationRate_duplication</span>) <span style=color:#a6e22e>mutateDuplication</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mutatePoint</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>index</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>random</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mutateInsertion</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>splice</span>(<span style=color:#a6e22e>index</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>random</span>());
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mutateDeletion</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>splice</span>(<span style=color:#a6e22e>index</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mutateDuplication</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>splice</span>(<span style=color:#a6e22e>index</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>index</span>]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>crossover</span>(<span style=color:#a6e22e>other</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>child</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Genome</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>thisIndex</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>otherIndex</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>other</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>child</span>.<span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>thisIndex</span>).<span style=color:#a6e22e>concat</span>(<span style=color:#a6e22e>other</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#a6e22e>otherIndex</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>child</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=tabcontent data-tabset=706d id=register.js><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RegisterMachine</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>genome</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Low registers are input, high output, middle are temporary
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>registers</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;x&#39;</span>, <span style=color:#e6db74>&#39;y&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>registers</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>registerCount</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>registers</span>.<span style=color:#a6e22e>splice</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;t&#39;</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>registers</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>5</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Pull off one command for instruction and then as many args as needed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>program</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>genome</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>;) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Copy the instruction to add params
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>instruction</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        ...<span style=color:#a6e22e>gendex</span>(<span style=color:#a6e22e>instructions</span>, <span style=color:#a6e22e>genome</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>])
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>instruction</span>.<span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>instruction</span>.<span style=color:#66d9ef>function</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>instruction</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>gendex</span>(<span style=color:#a6e22e>registers</span>, <span style=color:#a6e22e>genome</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>]));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>program</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>instruction</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>registers</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>r</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>g</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Run each command in the program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>command</span> <span style=color:#66d9ef>of</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>program</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Collect input registers (all but the first)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>args</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>param</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>command</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>1</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>registers</span>[<span style=color:#a6e22e>param</span>] <span style=color:#f92672>||</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Run the function, store in the first param
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>command</span>.<span style=color:#66d9ef>function</span>.<span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>this</span>, <span style=color:#a6e22e>args</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> isNaN(<span style=color:#a6e22e>result</span>) <span style=color:#f92672>?</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>modeCall</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;clamp&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>result</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>modeCall</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;wrap&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>1.0</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>readonlyXY</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>command</span>.<span style=color:#a6e22e>params</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;x&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>command</span>.<span style=color:#a6e22e>params</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;y&#39;</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Do nothing, trying to write to x/y
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>registers</span>[<span style=color:#a6e22e>command</span>.<span style=color:#a6e22e>params</span>[<span style=color:#ae81ff>0</span>]] <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Return the color from the r/g/b registers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> [
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>registers</span>.<span style=color:#a6e22e>r</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>registers</span>.<span style=color:#a6e22e>g</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>registers</span>.<span style=color:#a6e22e>b</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>toString</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>program</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>cmd</span>) =&gt; <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39; &#39;</span>)).<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;\n&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>