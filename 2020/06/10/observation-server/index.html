<!DOCTYPE html>
<html onclick >
<head>
    <title>Observation Server – jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/maker/">Maker</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Observation Server</h1>

        <div class="entry-meta"><span class="entry-date">2020-06-10</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2019/05/02/prevent-javascript-links-by-parsing-urls/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/python">Python</a><a href="https://blog.jverkamp.com/2020/07/07/a-smart-mysql-wrapper/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2016/12/09/aoc-2016-day-9-decompressinator/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/compression">Compression</a></li><li><a href="https://blog.jverkamp.com/2018/07/09/creating-a-temporary-smtp-server-to-catch-domain-validation-emails/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/email">Email</a><a href="https://blog.jverkamp.com/2020/07/16/an-spf-dns-server/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2016/02/26/audiobooks-to-podcasts/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/flask">Flask</a><a href="https://blog.jverkamp.com/2020/07/14/directly-monitoring-sidekiq-in-redis/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2018/07/09/creating-a-temporary-smtp-server-to-catch-domain-validation-emails/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/smtp">SMTP</a></li><li><a href="https://blog.jverkamp.com/2015/07/20/configuring-websockets-behind-an-aws-elb/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/websites">Websites</a><a href="https://blog.jverkamp.com/2020/06/30/ssrf-protection-in-rails/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2020/05/12/ld46-tetris-life-scoring/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2020/06/30/ssrf-protection-in-rails/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2020/06/07/odessa-sea/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2020/06/10/fullmetal-alchemist-vol.-16/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><p>For a number of years now, I&rsquo;ve been writing down my &lsquo;observations&rsquo;. Essentially, it&rsquo;s a semi-structured set of text files that I keep in Dropbox. One for each day, in a folder by month. I record interesting people I see, things I did worth doing, and things my children did which were adorable.</p>
<p>After a while, I started wanting to look back, so first, I wrote a relatively simple script that would go back through my archives and send me everything I did 1/2/3/4/etc years ago. That worked well enough, but it ended up generating a lot of emails to go through some days. So the second generation is a server that can format those pages and display them as a nice webpage.</p>
<p>The most interesting part perhaps was dealing with the tarballs that I keep the archives in (they&rsquo;re plain text, so they compress very well). I wanted to keep them compressed, so I had to decompress them in memory on the fly.</p>
<p>The general format is one folder per year, a sub folder per month, and a file per day. From time to time, I&rsquo;ll compress the previous months and then each new year, I&rsquo;ll uncompress those and stick them back into a whole year. Originally, I would actually nest the tarballs and I have code to deal with that.</p>
<h1 id="unpacking-tarballs">Unpacking tarballs</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_observations</span>(date):
    ymstr <span style="color:#f92672">=</span> date<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%Y-%m&#39;</span>)
    datestr <span style="color:#f92672">=</span> date<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">.txt&#39;</span>)

    <span style="color:#75715e"># File exists directly</span>
    path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39;data&#39;</span>, ymstr, datestr)
    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(path):
        <span style="color:#66d9ef">with</span> open(path, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> fin:
            <span style="color:#66d9ef">return</span> fin<span style="color:#f92672">.</span>read()

    <span style="color:#75715e"># Check for an archive</span>
    path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#39;data&#39;</span>, date<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;%Y.tgz&#39;</span>))
    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(path):
        <span style="color:#66d9ef">with</span> tarfile<span style="color:#f92672">.</span>open(path, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> tf:
            <span style="color:#66d9ef">for</span> ti <span style="color:#f92672">in</span> tf<span style="color:#f92672">.</span>getmembers():
                <span style="color:#75715e"># Skip mac files</span>
                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;._&#39;</span> <span style="color:#f92672">in</span> ti<span style="color:#f92672">.</span>name:
                    <span style="color:#66d9ef">continue</span>

                <span style="color:#75715e"># We found the date we were looking for</span>
                <span style="color:#66d9ef">if</span> ti<span style="color:#f92672">.</span>name<span style="color:#f92672">.</span>endswith(datestr):
                    <span style="color:#66d9ef">with</span> tf<span style="color:#f92672">.</span>extractfile(ti) <span style="color:#66d9ef">as</span> fin:
                        <span style="color:#66d9ef">return</span> fin<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>, <span style="color:#e6db74">&#39;replace&#39;</span>)

                <span style="color:#75715e"># Found another tarball with the month</span>
                <span style="color:#66d9ef">elif</span> ymstr <span style="color:#f92672">in</span> ti<span style="color:#f92672">.</span>name <span style="color:#f92672">and</span> ti<span style="color:#f92672">.</span>name<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;tgz&#39;</span>):
                    <span style="color:#66d9ef">with</span> tf<span style="color:#f92672">.</span>extractfile(ti) <span style="color:#66d9ef">as</span> tf2_fin:
                        <span style="color:#66d9ef">with</span> tarfile<span style="color:#f92672">.</span>open(path, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> tf2:
                            <span style="color:#66d9ef">for</span> ti2 <span style="color:#f92672">in</span> tf2<span style="color:#f92672">.</span>getmembers():
                                <span style="color:#66d9ef">if</span> ti2<span style="color:#f92672">.</span>name<span style="color:#f92672">.</span>endswith(datestr):
                                    fin <span style="color:#f92672">=</span> tf2<span style="color:#f92672">.</span>extractfile(ti2)
                                    <span style="color:#66d9ef">return</span> fin<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>, <span style="color:#e6db74">&#39;replace&#39;</span>)
</code></pre></div><p>The easiest case, just open the file. No problem.</p>
<p>But if we have an archive, we&rsquo;ll open it with <code><a href="https://docs.python.org/3/search.html?q=tarfile.open">tarfile.open</a></code>
 in memory and scan through the file. Then <code>tf.extractfile</code> to get a file pointer and read it. Not even that complicated. It&rsquo;s ugly, but it works! I could probably have structured that better.</p>
<h1 id="going-back-in-time">Going back in time</h1>
<p>The next problem is going back in time. I&rsquo;ve always liked infinite generators, and this is a good enough case for one:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">naturals</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>):
    <span style="color:#66d9ef">while</span> True:
        <span style="color:#66d9ef">yield</span> i
        i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
<span style="color:#66d9ef">for</span> years_ago <span style="color:#f92672">in</span> naturals(<span style="color:#ae81ff">1</span>):
    year_content <span style="color:#f92672">=</span> get_content(years_ago)
    <span style="color:#66d9ef">if</span> year_content:
        content <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">=== {year} ===</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">{content}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(
            year <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now()<span style="color:#f92672">.</span>year <span style="color:#f92672">-</span> years_ago,
            content <span style="color:#f92672">=</span> year_content
        )
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">break</span>
</code></pre></div><p><code>get_contents</code> takes a number of years ago and calls <code>get_observations</code> with that date.</p>
<h1 id="sending-emails">Sending emails</h1>
<p>Then, we just send the email off in the off in the next to lowest level way you could do it (at least I&rsquo;m not generating the bytes/network connections by hand?):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Generate a plaintext email and send it</span>
msg <span style="color:#f92672">=</span> email<span style="color:#f92672">.</span>mime<span style="color:#f92672">.</span>text<span style="color:#f92672">.</span>MIMEText(content, _charset <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;utf-8&#39;</span>)
msg[<span style="color:#e6db74">&#39;Subject&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Daily observations&#39;</span>
msg[<span style="color:#e6db74">&#39;From&#39;</span>] <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;EMAIL_TO&#39;</span>]
msg[<span style="color:#e6db74">&#39;To&#39;</span>] <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;EMAIL_TO&#39;</span>]

smtp <span style="color:#f92672">=</span> smtplib<span style="color:#f92672">.</span>SMTP_SSL(os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;EMAIL_HOST&#39;</span>], int(os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;EMAIL_PORT&#39;</span>]))
smtp<span style="color:#f92672">.</span>ehlo()
smtp<span style="color:#f92672">.</span>login(os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;EMAIL_USER&#39;</span>], os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;EMAIL_PASS&#39;</span>])
smtp<span style="color:#f92672">.</span>sendmail(os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;EMAIL_TO&#39;</span>], [os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;EMAIL_TO&#39;</span>]], msg<span style="color:#f92672">.</span>as_string())
smtp<span style="color:#f92672">.</span>quit()
</code></pre></div><p>There are certainly better ways to do this. Heck, I have <em>done</em> the better ways to do this. I&rsquo;ll write those up at some point. But it works.</p>
<p>And that was it. For years, that did it&rsquo;s job.</p>
<p>But then in my recent push to <em>server all the things</em>, I moved on to making an internal server just for my home network.</p>
<h1 id="creating-a-server">Creating a server</h1>
<p>Like I generally do for simple one off servers, I used <a href="https://flask.palletsprojects.com/en/1.1.x/">Flask</a>.</p>
<p>First, a route for specific days:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/&lt;int:year&gt;/&lt;int:month&gt;/&lt;int:day&gt;&#39;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_date</span>(year, month, day):
    date <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>date(year, month, day)
    observations <span style="color:#f92672">=</span> parse_observations(get_observations(date), include_all <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;all&#39;</span> <span style="color:#f92672">in</span> flask<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>args)
    categories <span style="color:#f92672">=</span> set(observations<span style="color:#f92672">.</span>keys())

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">jumplink</span>(text, <span style="color:#f92672">**</span>kwargs):
        <span style="color:#66d9ef">if</span> kwargs<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;today&#39;</span>):
            new_date <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>date<span style="color:#f92672">.</span>today()
        <span style="color:#66d9ef">elif</span> kwargs<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;random&#39;</span>):
            new_date <span style="color:#f92672">=</span> random_date()
        <span style="color:#66d9ef">else</span>:
            new_date <span style="color:#f92672">=</span> date <span style="color:#f92672">+</span> dateutil<span style="color:#f92672">.</span>relativedelta<span style="color:#f92672">.</span>relativedelta(<span style="color:#f92672">**</span>kwargs)

        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;&lt;a class=&#34;button&#34; href=&#34;{link}&#34;&gt;{text}&lt;/a&gt;&#39;</span><span style="color:#f92672">.</span>format(
            link <span style="color:#f92672">=</span> new_date<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#39;/%Y/%m/</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#39;</span>),
            text <span style="color:#f92672">=</span> text
        )

    <span style="color:#66d9ef">return</span> flask<span style="color:#f92672">.</span>render_template(
        <span style="color:#e6db74">&#39;daily.html&#39;</span>,
        date <span style="color:#f92672">=</span> date,
        offset <span style="color:#f92672">=</span> humanize<span style="color:#f92672">.</span>naturaldelta(datetime<span style="color:#f92672">.</span>date<span style="color:#f92672">.</span>today() <span style="color:#f92672">-</span> date),
        categories <span style="color:#f92672">=</span> categories,
        entries <span style="color:#f92672">=</span> observations,
        jumplink <span style="color:#f92672">=</span> jumplink,
        is_favorite <span style="color:#f92672">=</span> is_favorite
    )
</code></pre></div><p>Get the date first, sure. Then the observations next. Okay. Then I&rsquo;m doing a bit to break down categories (which are the &lsquo;interesting things&rsquo; / &lsquo;things I did worth doing&rsquo; I mentioned before, the parsing of those isn&rsquo;t super interesting). The <code>jumplink</code> nested function is a bit interesting. Basically, you can call it with a bunch of different options to jump around in time:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button-list&#34;</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;today&#39;, today = True) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;random&#39;, random = True) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;yesterday&#39;, days = -1) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;tomorrow&#39;, days = 1) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;last week&#39;, weeks = -1) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;next week&#39;, weeks = 1) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;last month&#39;, months = -1) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;next month&#39;, months = 1) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;last year&#39;, years = -1) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;{{ jumplink(&#39;next year&#39;, years = 1) | safe }}&lt;/<span style="color:#f92672">li</span>&gt;
    &lt;<span style="color:#f92672">li</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/favorites&#34;</span>&gt;favorites&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">li</span>&gt;
&lt;/<span style="color:#f92672">ul</span>&gt;
</code></pre></div><p>Then I use all of that information to render the page via a <a href="https://jinja.palletsprojects.com/en/2.11.x/">Jinja template</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{% if categories %}
    {% for category in categories | sort %}
    &lt;<span style="color:#f92672">h2</span>&gt;{{ category }}&lt;/<span style="color:#f92672">h2</span>&gt;

    &lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;entry-list&#34;</span>&gt;
        {% for entrylist in entries[category] %}
        &lt;<span style="color:#f92672">li</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;entry&#34;</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;content&#34;</span>&gt;
            {% for entry in entrylist %}
            {{ entry }} &lt;<span style="color:#f92672">br</span> /&gt;
            {% endfor %}
            &lt;/<span style="color:#f92672">div</span>&gt;
            &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;#&#34;</span> <span style="color:#a6e22e">data-favorite</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ is_favorite(hash(entrylist)) }}&#34;</span> <span style="color:#a6e22e">onclick</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;favorite(this, &#39;{{ date }}&#39;, &#39;{{ hash(entrylist) }}&#39;)&#34;</span>&gt;♡&lt;/<span style="color:#f92672">a</span>&gt;
        &lt;/<span style="color:#f92672">li</span>&gt;
        {% endfor %}
    &lt;/<span style="color:#f92672">ul</span>&gt;
    {% endfor %}
{% else %}
    &lt;<span style="color:#f92672">h2</span>&gt;No entries today (it wasn&#39;t always so)&lt;/<span style="color:#f92672">h2</span>&gt;
{% endif %}
</code></pre></div><p>Pretty nice.</p>
<p>That&rsquo;s really it. As you can see there, I also added some functionality for &lsquo;favoriting&rsquo; specific observations. Those, I&rsquo;ll create an MD5 hash (it&rsquo;s not great from a security perspective, but I&rsquo;m not using it for that). I did do a quick trick to make that function available to Jinja though:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">app <span style="color:#f92672">=</span> flask<span style="color:#f92672">.</span>Flask(__name__)
app<span style="color:#f92672">.</span>jinja_env<span style="color:#f92672">.</span>globals[<span style="color:#e6db74">&#39;hash&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> el : hashlib<span style="color:#f92672">.</span>md5(str(el)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
</code></pre></div><p>I thought that was neat. I can change the hash too, just by changing <code>md5</code> for <code>sha256</code> for example. I then store the dates and hashes in a <a href="https://yaml.org/">YAML</a> file in the same observations directory.</p>
<p>A few more helper routes (that go with the <code>jumplink</code> code earlier):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
<span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/today&#39;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hello_world</span>():
    date <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>date<span style="color:#f92672">.</span>today()
    <span style="color:#66d9ef">return</span> get_date(date<span style="color:#f92672">.</span>year, date<span style="color:#f92672">.</span>month, date<span style="color:#f92672">.</span>day)

<span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/random&#39;</span>)
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_random</span>():
    date <span style="color:#f92672">=</span> random_date()
    <span style="color:#66d9ef">return</span> get_date(date<span style="color:#f92672">.</span>year, date<span style="color:#f92672">.</span>month, date<span style="color:#f92672">.</span>day)
</code></pre></div><p>And we&rsquo;re golden.</p>
<p>I know it&rsquo;s a quick post, but perhaps you&rsquo;ll find something interesting there to use for your own projects!</p></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
