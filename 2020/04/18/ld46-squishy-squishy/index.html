<!doctype html><html><head><title>LD46: Squishy squishy â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css integrity=sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel=stylesheet><link rel=stylesheet href=/custom.css defer><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>LD46: Squishy squishy</h1><div class=entry-meta><span class=entry-date>2020-04-18</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/godot>Godot</a><a href=https://blog.jverkamp.com/2020/04/18/ld46-particles/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/gscript>GScript</a><a href=https://blog.jverkamp.com/2020/04/18/ld46-particles/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/ludum-dare>Ludum Dare</a><a href=https://blog.jverkamp.com/2020/04/18/ld46-particles/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/games>Games</a><a href=https://blog.jverkamp.com/2020/04/18/ld46-particles/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/physics>Physics</a><a href=https://blog.jverkamp.com/2020/04/18/ld46-its-working/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/ class=previous-link></a><a class=taxonomy-value href=/series/ludum-dare-46>Ludum Dare 46</a><a href=https://blog.jverkamp.com/2020/04/18/ld46-particles/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2020/04/18/ld46-particles/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2020/04/18/ld46-particles/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>It&rsquo;s so squish!</p><p><video controls src=/embeds/2020/ludum-dare-46-squishy.mp4></video></p><p>That is not at all what I intended, but I kind of love it, so for the moment, it stays in.</p><p>To get this far, I had a heck of a time trying to figure out Godot&rsquo;s physics engine, but I&rsquo;m learning quickly!</p><h1 id=define-the-blocks>Define the blocks</h1><p>First, we have to figure out what the blocks look like. From Wikipedia:</p><figure><img src=/embeds/2020/ludum-dare-46-shapes-wiki.png></figure><p>So I have 7 shapes to define, each of which has four &lsquo;blocks&rsquo; inside of it. So first I layed out a graphic:</p><figure><img src=/embeds/2020/ludum-dare-46-tetris-shapes.jpg></figure><p>Now I need to define how they relate in code. First, I was going to define what the neighbors of each was:</p><figure><img src=/embeds/2020/ludum-dare-46-neighbors-1.jpg></figure><p>In this case, that means that in an <code>I</code> block, <code>1</code> has top, right, bottom, left neighbors of <code>_</code> (none), <code>_</code>, <code>2</code>, <code>_</code> and so on. Seems verbose. So then I realized that I can calculate the neighbors myself. I just need to determine where they all are:</p><figure><img src=/embeds/2020/ludum-dare-46-neighbors-2.jpg></figure><p>That&rsquo;s much cleaner. It also includes the &lsquo;central point&rsquo; of the shape that I will rotate around (which I don&rsquo;t end up using).</p><p>Turning that into code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Tetromino.gd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the shapes, values are the four coordinates and then a center point to rotate around</span>
</span></span><span style=display:flex><span>const SHAPES <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;I&#39;</span>: [Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>), Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>3</span>), Vector2(<span style=color:#ae81ff>0.5</span>, <span style=color:#ae81ff>2.0</span>)],
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;O&#39;</span>: [Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>1.0</span>)],
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;T&#39;</span>: [Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>0.5</span>)],
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;J&#39;</span>: [Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>), Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>), Vector2(<span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>2.5</span>)],
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;L&#39;</span>: [Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>), Vector2(<span style=color:#ae81ff>0.5</span>, <span style=color:#ae81ff>2.5</span>)],
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;S&#39;</span>: [Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>0.5</span>)],
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#39;Z&#39;</span>: [Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>), Vector2(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>), Vector2(<span style=color:#ae81ff>1.5</span>, <span style=color:#ae81ff>0.5</span>)]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>From there, the actual hard part. I have the 4 Blocks already created (in the [previous post]https://blog.jverkamp.com/2020/04/18/ld46-tetris-is-working-sort-of/), but I have to move them around and stick them together:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Tetromonio.gd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>onready var bodies <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#e6db74>&#34;Block0/Body&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#e6db74>&#34;Block1/Body&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#e6db74>&#34;Block2/Body&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>$</span><span style=color:#e6db74>&#34;Block3/Body&#34;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Helper functions to get the correct child nodes by index</span>
</span></span><span style=display:flex><span>func block(i):
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> get_node(<span style=color:#e6db74>&#34;Block&#34;</span> <span style=color:#f92672>+</span> str(i))
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span><span style=color:#75715e># Initialize a random shape</span>
</span></span><span style=display:flex><span>func init_random():
</span></span><span style=display:flex><span>	var names <span style=color:#f92672>=</span> SHAPES<span style=color:#f92672>.</span>keys()
</span></span><span style=display:flex><span>	var name <span style=color:#f92672>=</span> names[randi() <span style=color:#f92672>%</span> names<span style=color:#f92672>.</span>size()]
</span></span><span style=display:flex><span>	init(name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Initialize the shape with one of the names</span>
</span></span><span style=display:flex><span>func init(shape):
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>assert</span>(shape <span style=color:#f92672>in</span> SHAPES)
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e># Set positions</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>		block(i)<span style=color:#f92672>.</span>position <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span> <span style=color:#f92672>*</span> SHAPES[shape][i]
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>	<span style=color:#75715e># Get neighbors and create joints</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>4</span>):
</span></span><span style=display:flex><span>			var xi <span style=color:#f92672>=</span> SHAPES[shape][i]<span style=color:#f92672>.</span>x
</span></span><span style=display:flex><span>			var yi <span style=color:#f92672>=</span> SHAPES[shape][i]<span style=color:#f92672>.</span>y
</span></span><span style=display:flex><span>			var xj <span style=color:#f92672>=</span> SHAPES[shape][j]<span style=color:#f92672>.</span>x
</span></span><span style=display:flex><span>			var yj <span style=color:#f92672>=</span> SHAPES[shape][j]<span style=color:#f92672>.</span>y
</span></span><span style=display:flex><span>			
</span></span><span style=display:flex><span>			var bi <span style=color:#f92672>=</span> block(i)
</span></span><span style=display:flex><span>			var bj <span style=color:#f92672>=</span> block(j)
</span></span><span style=display:flex><span>			
</span></span><span style=display:flex><span>			<span style=color:#75715e># Each only has to do one way, since we&#39;ll catch the other when bi  and bj swap</span>
</span></span><span style=display:flex><span>			var joined <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> xi <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> xj <span style=color:#f92672>and</span> yi <span style=color:#f92672>==</span> yj:
</span></span><span style=display:flex><span>				bi<span style=color:#f92672>.</span>get_node(<span style=color:#e6db74>&#34;Body/PixelEngine&#34;</span>)<span style=color:#f92672>.</span>neighbors[<span style=color:#e6db74>&#39;right&#39;</span>] <span style=color:#f92672>=</span> bj
</span></span><span style=display:flex><span>				joined <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>elif</span> xi <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> xj <span style=color:#f92672>and</span> yi <span style=color:#f92672>==</span> yj:
</span></span><span style=display:flex><span>				bi<span style=color:#f92672>.</span>get_node(<span style=color:#e6db74>&#34;Body/PixelEngine&#34;</span>)<span style=color:#f92672>.</span>neighbors[<span style=color:#e6db74>&#39;left&#39;</span>] <span style=color:#f92672>=</span> bj
</span></span><span style=display:flex><span>				joined <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>elif</span> xi <span style=color:#f92672>==</span> xj <span style=color:#f92672>and</span> yi <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> yj:
</span></span><span style=display:flex><span>				bi<span style=color:#f92672>.</span>get_node(<span style=color:#e6db74>&#34;Body/PixelEngine&#34;</span>)<span style=color:#f92672>.</span>neighbors[<span style=color:#e6db74>&#39;bottom&#39;</span>] <span style=color:#f92672>=</span> bj
</span></span><span style=display:flex><span>				joined <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>elif</span> xi <span style=color:#f92672>==</span> xj <span style=color:#f92672>and</span> yi <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>==</span> yj:
</span></span><span style=display:flex><span>				bi<span style=color:#f92672>.</span>get_node(<span style=color:#e6db74>&#34;Body/PixelEngine&#34;</span>)<span style=color:#f92672>.</span>neighbors[<span style=color:#e6db74>&#39;top&#39;</span>] <span style=color:#f92672>=</span> bj
</span></span><span style=display:flex><span>				joined <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>				
</span></span><span style=display:flex><span>			<span style=color:#75715e># Only add joints one direction</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> joined <span style=color:#f92672>and</span> i <span style=color:#f92672>&lt;</span> j:
</span></span><span style=display:flex><span>				var midpoint <span style=color:#f92672>=</span> (bi<span style=color:#f92672>.</span>position <span style=color:#f92672>+</span> bj<span style=color:#f92672>.</span>position) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>				var pins <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>				
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> xi <span style=color:#f92672>==</span> xj:
</span></span><span style=display:flex><span>					pins<span style=color:#f92672>.</span>append(midpoint <span style=color:#f92672>+</span> Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>					pins<span style=color:#f92672>.</span>append(midpoint <span style=color:#f92672>+</span> Vector2(<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>					pins<span style=color:#f92672>.</span>append(midpoint <span style=color:#f92672>+</span> Vector2(<span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>					pins<span style=color:#f92672>.</span>append(midpoint <span style=color:#f92672>+</span> Vector2(<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>					
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>for</span> pin <span style=color:#f92672>in</span> pins:
</span></span><span style=display:flex><span>					var joint <span style=color:#f92672>=</span> PinJoint2D<span style=color:#f92672>.</span>new()
</span></span><span style=display:flex><span>					joint<span style=color:#f92672>.</span>position <span style=color:#f92672>=</span> pin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					add_child(joint)
</span></span><span style=display:flex><span>					joint<span style=color:#f92672>.</span>node_a <span style=color:#f92672>=</span> joint<span style=color:#f92672>.</span>get_path_to(bi<span style=color:#f92672>.</span>get_node(<span style=color:#e6db74>&#34;Body&#34;</span>))
</span></span><span style=display:flex><span>					joint<span style=color:#f92672>.</span>node_b <span style=color:#f92672>=</span> joint<span style=color:#f92672>.</span>get_path_to(bj<span style=color:#f92672>.</span>get_node(<span style=color:#e6db74>&#34;Body&#34;</span>))
</span></span></code></pre></div><p>I know right?</p><p>It&rsquo;s some pretty wacky code. Except for the joints, it came together pretty quickly. The joints proved to be quite the headache though. First, I was using a <code><a href="https://docs.godotengine.org/en/stable/search.html?q=KinematicBody2D&check_keywords=yes&area=default">KinematicBody2D</a></code>
for the block, which &mldr; doesn&rsquo;t really work with joints at all? So I switched to <code><a href="https://docs.godotengine.org/en/stable/search.html?q=RigidBody2D&check_keywords=yes&area=default">RigidBody2D</a></code>
. But that means I have to change the physics system (more on that in a bit). Then I made the joints, but with only one pin, so they rotated all over the place. It turns out what I really want is to join each pair of blocks on the two corners touching.</p><p>So, rewriting the input/physics engine. In a nutshell:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Tetromino.gd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>func _physics_process(delta):
</span></span><span style=display:flex><span>	<span style=color:#75715e># Keyboard controls</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> body <span style=color:#f92672>in</span> bodies:
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> Input<span style=color:#f92672>.</span>is_action_pressed(<span style=color:#e6db74>&#34;ui_right&#34;</span>):
</span></span><span style=display:flex><span>			body<span style=color:#f92672>.</span>apply_central_impulse(IMPULSE)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> Input<span style=color:#f92672>.</span>is_action_pressed(<span style=color:#e6db74>&#34;ui_left&#34;</span>):
</span></span><span style=display:flex><span>			body<span style=color:#f92672>.</span>apply_central_impulse(<span style=color:#f92672>-</span>IMPULSE)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> Input<span style=color:#f92672>.</span>is_action_pressed(<span style=color:#e6db74>&#34;ui_up&#34;</span>):
</span></span><span style=display:flex><span>			body<span style=color:#f92672>.</span>apply_central_impulse(<span style=color:#f92672>-</span><span style=color:#ae81ff>0.1</span> <span style=color:#f92672>*</span> GRAVITY)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> Input<span style=color:#f92672>.</span>is_action_pressed(<span style=color:#e6db74>&#34;ui_down&#34;</span>):
</span></span><span style=display:flex><span>			body<span style=color:#f92672>.</span>apply_central_impulse(GRAVITY)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> Input<span style=color:#f92672>.</span>is_action_pressed(<span style=color:#e6db74>&#34;ui_rotate_left&#34;</span>):
</span></span><span style=display:flex><span>			body<span style=color:#f92672>.</span>apply_torque_impulse(<span style=color:#f92672>-</span>TORQUE)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> Input<span style=color:#f92672>.</span>is_action_pressed(<span style=color:#e6db74>&#34;ui_rotate_right&#34;</span>):
</span></span><span style=display:flex><span>			body<span style=color:#f92672>.</span>apply_torque_impulse(TORQUE)
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>	var settled <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> body <span style=color:#f92672>in</span> bodies:
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> body<span style=color:#f92672>.</span>sleeping:
</span></span><span style=display:flex><span>			settled <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e># If we hit something, start a counter, if that goes long enough, lock the block</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> settled:
</span></span><span style=display:flex><span>		velocity <span style=color:#f92672>=</span> Vector2<span style=color:#f92672>.</span>ZERO
</span></span><span style=display:flex><span>		stuck_time <span style=color:#f92672>+=</span> delta
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> stuck_time <span style=color:#f92672>&gt;</span> LOCK_TIME:
</span></span><span style=display:flex><span>			set_physics_process(false)
</span></span><span style=display:flex><span>			emit_signal(<span style=color:#e6db74>&#34;on_lock&#34;</span>)
</span></span><span style=display:flex><span>			
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>		stuck_time <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>I actually really like how <code><a href="https://docs.godotengine.org/en/stable/search.html?q=RigidBody2D&check_keywords=yes&area=default">RigidBody2D</a></code>
s work. I should play with those more. I do have to apply the forces to all of the 4 blocks, otherwise they start rotating like mad when you don&rsquo;t want them to (I mean, I do want them to, but not by themselves!).</p><p>The <code>body.sleeping</code> actually works pretty well. Sometimes it gets stuck, but I can push that down the road a bit. I think I&rsquo;ll add a keybinding to Let It Go<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> and move on to the next block without waiting.</p><p>It&mldr; works?</p><p>What we do end up getting though is amusingly squishy, which I love. I&rsquo;m totally going to keep it for now.</p><p><video controls src=/embeds/2020/ludum-dare-46-squishy-2.mp4></video></p><figure><img src=/embeds/2020/my-squishy.gif></figure><p>Anyways, off to a block, and then it&rsquo;s time to actually add some falling sand!</p><p>EDIT: I was working on adding a few keybindings (ESC restarts and ENTER forces you to the next tile) and this happened:</p><p><video controls src=/embeds/2020/ludum-dare-46-oops.mp4></video></p><p><code>is_action_**just**_pressed</code> y&rsquo;all. That is all.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>I finally got around to watching Frozen 2. The movie is insane, but I actually realy enjoy the music. Man it&rsquo;s stuck in my head.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div><script defer src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script>
<script defer src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin=anonymous></script>
<script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js integrity=sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h crossorigin=anonymous></script>
<script defer src=https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script defer>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script><script defer src=/custom.js></script></body></html>