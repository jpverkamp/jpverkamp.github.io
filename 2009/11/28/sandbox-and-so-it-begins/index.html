<!doctype html><html><head><title>Sandbox - And so it begins – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/auto-render_2152414756166376840.min.45ae2f6b03d0c7b867df0a6cb7d43215ec78369998685a5748c5b12f502321f2.js integrity="sha256-Ra4vawPQx7hn3wpst9QyFex4NpmYaFpXSMWxL1AjIfI=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.e0e68b86dea32185ab89b0b9cc01649107cc6b0be3290c8c7b13c716bc0dabfa.css integrity="sha256-4OaLht6jIYWribC5zAFkkQfMawvjKQyMexPHFrwNq/o="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Sandbox - And so it begins</h1><div class=entry-meta><span class=entry-date>2009-11-28</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2009/01/19/audiovision-update/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/.net>.NET</a><a href=https://blog.jverkamp.com/2009/11/28/sandbox-reactions/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2009/01/19/audiovision-update/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/c>C#</a><a href=https://blog.jverkamp.com/2009/11/28/sandbox-reactions/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/programming/topics/falling-sand>Falling Sand</a><a href=https://blog.jverkamp.com/2009/11/28/sandbox-reactions/ class=next-link></a></li><li><a class=taxonomy-value href=/programming/topics/games>Games</a><a href=https://blog.jverkamp.com/2009/11/28/sandbox-reactions/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2009/11/23/flairs-2010/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2009/11/28/sandbox-reactions/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2009/11/27/frisbee-golf-x2/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2009/11/28/sandbox-reactions/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>For the past few years, I&rsquo;ve been fascinated by falling sand / particle simulation type games (<a href=http://fallingsandgame.com/sand/>like this one</a>).  Enough so that I&rsquo;ve set out to make one a fair number of times.  Each time, I&rsquo;ve advanced my own techniques by a little bit, finding new and better ways to make digital sand.</p><p>This time around, I&rsquo;m going to try to use C# with <a href=http://cs-sdl.sourceforge.net/index.php/Main_Page>SDL.NET</a> for all of my graphical work and a simple grid for all of the particle data.  Rather than looping over the grid, I will be using <a href=https://en.wikipedia.org/wiki/Quadtree>quadtrees</a> to only update the regions that actually need to be updated.  So far the results are promising!</p><p>The last implementation of Sandbox (using C# and <a href=http://www.agatelib.org/>AgateLib</a>) that I tried used a list of particles and could handle about 20,000 particles before slowing down</p><p>Check out below for screen shots and downloads from the first version.  The executable should run if you have <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=333325FD-AE52-4E35-B531-508D977D32A6&amp;displaylang=en">.NET 3.5</a> (which you should either have already or only have to download once) and <a href=http://sourceforge.net/projects/cs-sdl/files/>SDL.NET</a>.  Theoretically, it should also work perfectly well with Mono, although I haven&rsquo;t had a chance to try it yet.  When I get back to campus and can test it on a Linux machine, I&rsquo;ll let you know.</p><p><strong>Current progress:</strong></p><ul><li>Particles work.</li><li>Three kinds of matter - solids (don&rsquo;t move), liquids (fall down), and gasses (drift up)</li><li>Static walls and emitters for now</li></ul><p><strong>Things to do:</strong></p><ul><li>Add reactions so that particles interact besides just hitting each other.</li><li>Add actual emitters (possibly as a reaction).</li><li>Add dynamically placed walls and/or emitters.</li></ul><p><strong>Screenshots:</strong></p><figure><img src=/embeds/2009/Sandbox-0.1.1-Starting-out.png></figure><p>First, the simulation just starting out.  It&rsquo;s been a second or two and we already have over 2,000 particles on the screen.</p><figure><img src=/embeds/2009/Sandbox-0.1.1-Piles-of-sand.png></figure><p>After a little longer, the sand has really started to pile up.  Now we have 10 times as many particles.  Believe me, the system can handle far more than that.</p><figure><img src=/embeds/2009/Sandbox-0.1.1-Display-regions.png></figure><p>This shot shows the same number of particles as before with the alternate display mode.  Here we can see the regions that are currently active (in red) and the region that do not need to be updated (in blue).  One thing to note is that once particles settle down (in the middle for example), they don&rsquo;t need to be updated until something happens.</p><p>Currently, the quadtrees are set to use OR as their boolean logic base.  That means that if one subregion is active, the overall region is active.  What this means from a simulation standpoint is that inactive regions are grouped but active regions are not (for now).  It seems counter-intuitive to me, but this is actually faster than using an AND tree.  I hope to add the ability to switch between the two in the future.</p><figure><img src=/embeds/2009/Sandbox-0.1.1-Lots-of-sand.png></figure><p>Here the simulation has been running for a minute or two.  There are currently 85,000 particles on the screen.  I was originally going to show another factor of 10 increase, but the particles were falling off of the screen fast enough to make that impractical.  One interesting thing to note is the extended edges on each side of the center.  The particles are falling against each other with the liquid (falling) particles pushing against the gas (rising) particles, forming an additional wall.  Something of an emergent behavior&mldr; very shiny!</p><figure><img src=/embeds/2009/Sandbox-0.1.1-Complex-regions.png></figure><p>The same time in the simulation as the previous image, showing the display regions.  There are quite a few more divisions that earlier but the ability to not draw regions that are not updating is still quite a time saver.</p><p><strong>Downloads:</strong></p><ul><li><strong><figure><a href=Sandbox-0.1.1.zip><img src=/embeds/2009/Sandbox%200.1.1></a></figure></strong></li><li><strong><figure><a href=Sandbox-0.1.1-Source.zip><img src=/embeds/2009/Sandbox%200.1.1%20%28Source%29></a></figure></strong></li></ul><p><strong>Keyboard shortcuts:</strong></p><ul><li>Esc/Q - Quit the program</li><li>F1 - Toggle region display mode</li><li>B - Toggle border behavior (does not correctly reactivate particles yet)</li><li>P - Pause / Unpause</li><li>Space - Advance the simulation one step (when paused)</li></ul><ul><li>Updated matter definition file to use attributes instead of nested elements.</li><li>Moved global variables into main program file.</li><li>Fixed bug (&lt; vs &lt;=) in quadtrees.</li><li>Updated region display mode to display active regions in red, inactive in blue.</li><li>Fixed stuck particle bug.</li></ul></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>