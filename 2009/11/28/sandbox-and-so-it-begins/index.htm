<!DOCTYPE html>
<html>
<head>
        
        

        <title>Sandbox - And so it begins | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" defer></script>
        <script src="//code.jquery.com/ui/1.11.1/jquery-ui.min.js" defer></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" defer />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" defer />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js" defer></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" defer />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js" defer></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js" defer></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/obsidian.css" defer />
        <script src="/highlight/highlight.pack.js" defer></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" defer />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js" defer ></script>

        <!-- Pretty pretty fonts -->
        <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Calligraffitti" defer />

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" defer />
        <script src="/custom.js" defer></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/" />
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="//blog.jverkamp.com"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="//blog.jverkamp.com/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/archives/2004">2004</a></li><li><a href="//blog.jverkamp.com/category/archives/2005">2005</a></li><li><a href="//blog.jverkamp.com/category/archives/2006">2006</a></li><li><a href="//blog.jverkamp.com/category/archives/2007">2007</a></li><li><a href="//blog.jverkamp.com/category/archives/2008">2008</a></li><li><a href="//blog.jverkamp.com/category/archives/2009">2009</a></li><li><a href="//blog.jverkamp.com/category/archives/2010">2010</a></li><li><a href="//blog.jverkamp.com/category/archives/2011">2011</a></li><li><a href="//blog.jverkamp.com/category/archives/2012">2012</a></li><li><a href="//blog.jverkamp.com/category/archives/2013">2013</a></li><li><a href="//blog.jverkamp.com/category/archives/2014">2014</a></li><li><a href="//blog.jverkamp.com/category/archives/2015">2015</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="//blog.jverkamp.com/category/other/book-reviews">Book Reviews</a></li><li><a href="//blog.jverkamp.com/category/other/cooking">Cooking</a></li><li><a href="//blog.jverkamp.com/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/photography/dp-challenge">DP Challenge</a></li><li><a href="//blog.jverkamp.com/category/photography/photosets">Photosets</a></li><li><a href="//blog.jverkamp.com/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/programming/by-language">By Language</a></li><li><a href="//blog.jverkamp.com/category/programming/by-project">By Project</a></li><li><a href="//blog.jverkamp.com/category/programming/by-source">By Source</a></li><li><a href="//blog.jverkamp.com/category/programming/by-topic">By Topic</a></li><li><a href="//blog.jverkamp.com/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/research/by-topic">By Topic</a></li><li><a href="//blog.jverkamp.com/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="//blog.jverkamp.com/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="//blog.jverkamp.com/category/writing/by-genre">By Genre</a></li><li><a href="//blog.jverkamp.com/category/writing/ideas">Ideas</a></li><li><a href="//blog.jverkamp.com/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="//blog.jverkamp.com/category/writing/novels">Novels</a></li><li><a href="//blog.jverkamp.com/category/writing/other">Other</a></li><li><a href="//blog.jverkamp.com/category/writing/short-stories">Short Stories</a></li><li><a href="//blog.jverkamp.com/category/writing/writing-excuses">Writing Excuses</a></li></ul></li></ul>

      <form action="//www.google.com/search" method="get" onSubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input name="q" type="hidden" />
          <input name="qfront" type="text" class="form-control" placeholder="Search" />
          <button type="submit" class="btn btn-default" value="Search">Search</button>
        </p>
      </form>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Sandbox - And so it begins</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2009-11-28"><span class="year">2009</span> <span class="month">Nov</span> <span class="day">28</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="//blog.jverkamp.com/category/programming/by-language/net">.NET</a></li><li><a href="//blog.jverkamp.com/category/programming/by-language/c">C#</a></li><li><a href="//blog.jverkamp.com/category/programming/by-topic/games">Games</a></li><li><a href="//blog.jverkamp.com/category/programming">Programming</a></li><li><a href="//blog.jverkamp.com/category/programming/by-project/games/sandbox">Sandbox</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <p>For the past few years, I've been fascinated by falling sand / particle simulation type games (<a href="http://fallingsandgame.com/sand/">like this one</a>).  Enough so that I've set out to make one a fair number of times.  Each time, I've advanced my own techniques by a little bit, finding new and better ways to make digital sand.</p>
<p>This time around, I'm going to try to use C# with <a href="http://cs-sdl.sourceforge.net/index.php/Main_Page">SDL.NET</a> for all of my graphical work and a simple grid for all of the particle data.  Rather than looping over the grid, I will be using <a href="https://en.wikipedia.org/wiki/quadtrees">Quadtree</a> to only update the regions that actually need to be updated.  So far the results are promising!</p>
<!--more-->
<p>The last implementation of Sandbox (using C# and <a href="http://www.agatelib.org/">AgateLib</a>) that I tried used a list of particles and could handle about 20,000 particles before slowing down</p>
<p>Check out below for screen shots and downloads from the first version.  The executable should run if you have <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=333325FD-AE52-4E35-B531-508D977D32A6&amp;displaylang=en">.NET 3.5</a> (which you should either have already or only have to download once) and <a href="http://sourceforge.net/projects/cs-sdl/files/">SDL.NET</a>.  Theoretically, it should also work perfectly well with Mono, although I haven't had a chance to try it yet.  When I get back to campus and can test it on a Linux machine, I'll let you know.</p>
<p><strong>Current progress:</strong></p>
<ul>
        <li>Particles work.</li>
        <li>Three kinds of matter - solids (don't move), liquids (fall down), and gasses (drift up)</li>
        <li>Static walls and emitters for now</li>
</ul>
<p><strong>Things to do:</strong></p>
<ul>
        <li>Add reactions so that particles interact besides just hitting each other.</li>
        <li>Add actual emitters (possibly as a reaction).</li>
        <li>Add dynamically placed walls and/or emitters.</li>
</ul>
<p><strong>Screenshots:</strong></p>
<p><a href="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Starting-out.png" data-toggle="lightbox"><img src="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Starting-out.png" /></a></p>
<p>First, the simulation just starting out.  It's been a second or two and we already have over 2,000 particles on the screen.</p>
<p><a href="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Piles-of-sand.png" data-toggle="lightbox"><img src="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Piles-of-sand.png" /></a></p>
<p>After a little longer, the sand has really started to pile up.  Now we have 10 times as many particles.  Believe me, the system can handle far more than that.</p>
<p><a href="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Display-regions.png" data-toggle="lightbox"><img src="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Display-regions.png" /></a></p>
<p>This shot shows the same number of particles as before with the alternate display mode.  Here we can see the regions that are currently active (in red) and the region that do not need to be updated (in blue).  One thing to note is that once particles settle down (in the middle for example), they don't need to be updated until something happens.</p>
<p>Currently, the quadtrees are set to use OR as their boolean logic base.  That means that if one subregion is active, the overall region is active.  What this means from a simulation standpoint is that inactive regions are grouped but active regions are not (for now).  It seems counter-intuitive to me, but this is actually faster than using an AND tree.  I hope to add the ability to switch between the two in the future.</p>
<p><a href="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Lots-of-sand.png" data-toggle="lightbox"><img src="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Lots-of-sand.png" /></a></p>
<p>Here the simulation has been running for a minute or two.  There are currently 85,000 particles on the screen.  I was originally going to show another factor of 10 increase, but the particles were falling off of the screen fast enough to make that impractical.  One interesting thing to note is the extended edges on each side of the center.  The particles are falling against each other with the liquid (falling) particles pushing against the gas (rising) particles, forming an additional wall.  Something of an emergent behavior... very shiny!</p>
<p><a href="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Complex-regions.png" data-toggle="lightbox"><img src="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Complex-regions.png" /></a></p>
<p>The same time in the simulation as the previous image, showing the display regions.  There are quite a few more divisions that earlier but the ability to not draw regions that are not updating is still quite a time saver.</p>
<p><strong>Downloads:</strong></p>
<ul>
        <li><strong><a href="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1.zip">Sandbox 0.1.1</a></strong></li>
        <li><strong><a href="//blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/Sandbox-0.1.1-Source.zip">Sandbox 0.1.1 (Source)</a></strong></li>
</ul>
<p><strong>Keyboard shortcuts:</strong></p>
<ul>
        <li>Esc/Q - Quit the program</li>
        <li>F1 - Toggle region display mode</li>
        <li>B - Toggle border behavior (does not correctly reactivate particles yet)</li>
        <li>P - Pause / Unpause</li>
        <li>Space - Advance the simulation one step (when paused)</li>
</ul>
<div id="_mcePaste" style="overflow: hidden; position: absolute; left: -10000px; top: 84px; width: 1px; height: 1px;">- Updated matter definition file to use attributes instead of nested elements.
- Moved global variables into main program file.
- Fixed bug (< vs <=) in quadtrees.
- Updated region display mode to display active regions in red, inactive in blue.
- Fixed stuck particle bug.</div>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Sandbox - And so it begins";
var disqus_url = "http://blog.jverkamp.com/2009/11/28/sandbox-and-so-it-begins/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="//blog.jverkamp.com/2009/11/27/frisbee-golf-x2">← Frisbee Golf x2</a></li><li><a href="//blog.jverkamp.com/category/archives">Archives</a></li><li><a href="//blog.jverkamp.com/2009/11/28/sandbox-reactions">Sandbox - Reactions →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="//blog.jverkamp.com/2009/11/23/flairs-2010">← FLAIRS 2010</a></li><li><a href="//blog.jverkamp.com/category/programming">Programming</a></li><li><a href="//blog.jverkamp.com/2009/11/28/sandbox-reactions">Sandbox - Reactions →</a></li></ul></nav>

                <div class="legal">
                        <a href="//blog.jverkamp.com/feed/atom.xml">feed <img style="border: 0;" src="//blog.jverkamp.com/rss.png" /></a><br />
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.defer=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53688146-1', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>