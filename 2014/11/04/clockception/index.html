<!doctype html><html><head><title>Clockception – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script defer src=/jquery_6894410585563545744.min.cc1cade18c999752b7befe111634889dca8d89b24923775954ecebc68c54fcd3.js integrity="sha256-zByt4YyZl1K3vv4RFjSIncqNibJJI3dZVOzrxoxU/NM="></script>
<script defer src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg="></script>
<script defer src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM="></script>
<script defer src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY="></script>
<script defer src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90="></script>
<script defer src=/custom.js></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="></script><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="></script><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="></script><link rel=stylesheet href=/css_4780214198035419921.min.7cfac95bdd962d85ceec560e50fe7b04c44b58a76e5202006ef36ca8c0a7d836.css integrity="sha256-fPrJW92WLYXO7FYOUP57BMRLWKduUgIAbvNsqMCn2DY="></script><link rel=stylesheet href=/custom.css><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js></script></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>Clockception</h1><div class=entry-meta><span class=entry-date>2014-11-04</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/10/28/tile-puzzle/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2014/11/13/a-one-line-echo-server-using-let-in-racket/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/10/28/tile-puzzle/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2014/11/13/a-one-line-echo-server-using-let-in-racket/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/fractals>Fractals</a><a href=https://blog.jverkamp.com/2015/09/14/mandelbrot/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/10/28/tile-puzzle/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/graphics>Graphics</a><a href=https://blog.jverkamp.com/2014/12/23/palette-swapping/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2014/10/28/tile-puzzle/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/11/13/a-one-line-echo-server-using-let-in-racket/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2014/11/04/nanowrimo-2014/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/11/08/the-giver-dvd/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Let&rsquo;s talk about clocks.</p><p>We can draw traditional analog clocks<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>:</p><figure><img src=/embeds/2014/analog.png></figure><p>We can draw nice digital clocks:</p><pre tabindex=0><code>┌─┐  │ │ ─┐ ┌─┐
│ │└─┤    │ │ │
└─┘  │ │ ─┴─└─┘
</code></pre><p>Or we can go downright mad and make clocks out of clocks:</p><figure><img src=/embeds/2014/clockception.png></figure><p>Even animated!</p><figure><img src=/embeds/2014/animated.gif></figure><p>I got the basic idea for this post from <a href=http://io9.com/these-stylish-minimalistic-clocks-let-you-tell-time-wit-1652202065>this post</a> on io9. That first clock ought to look awfully familiar (although theirs looks a bit better). Let&rsquo;s see how we can make one of our own.</p><p>First, some basic structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>(<span style=color:#66d9ef>struct</span> time-data (hour minute second) <span style=color:#66d9ef>#:transparent</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (<span style=color:#66d9ef>time</span> hour minute [second <span style=color:#66d9ef>#f</span>])
</span></span><span style=display:flex><span>  (time-data hour minute second))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> current-size (make-parameter <span style=color:#ae81ff>30</span>))
</span></span></code></pre></div><p>This will represent the times that we are dealing with. I specifically broke the <code>time-data</code> structure and <code>time</code> function apart, since I wanted to have optional parameters. There is an <code>#:auto</code> option for struct fields, but it doesn&rsquo;t quite do what I want. Finally, <code>current-size</code> will be the width of each individual analog clock.</p><p>Speaking of which, let&rsquo;s draw some basic analog clocks. I went through several different Racket drawing libraries (<code><a href="http://docs.racket-lang.org/search/index.html?q=pict">pict</a></code>
, (<code><a href="http://docs.racket-lang.org/search/index.html?q=2htdp/image">2htdp/image</a></code>
, (<code><a href="http://docs.racket-lang.org/search/index.html?q=racket/draw">racket/draw</a></code>
) before finally settling on <code><a href="http://docs.racket-lang.org/search/index.html?q=racket/draw">racket/draw</a></code>
. I&rsquo;m sure any of them could be used, but I just kept running into odd issues with coordinates.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Render a clock at the current-size</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (analog-clock <span style=color:#66d9ef>when</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (time-data hour minute second) <span style=color:#66d9ef>when</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> size (current-size))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> target (make-bitmap size size))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> dc (<span style=color:#66d9ef>new</span> bitmap-dc% [bitmap target]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>send</span> dc set-pen <span style=color:#e6db74>&#34;lightgray&#34;</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&#39;</span><span style=color:#e6db74>solid</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>send</span> dc draw-ellipse <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> size size)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>send</span> dc set-pen <span style=color:#e6db74>&#34;black&#34;</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&#39;</span><span style=color:#e6db74>solid</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Helper to draw a hand given a radius [0, 1.0] and angle</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Angle of 0 is upright, positive angles are clockwise</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> (draw-hand! r θ)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define</span> c (/ size <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define</span> x (+ c (* <span style=color:#ae81ff>0.5</span> r size (cos θ))))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define</span> y (+ c (* <span style=color:#ae81ff>0.5</span> r size (sin θ))))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>send</span> dc draw-line c c x y))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (draw-hand! <span style=color:#ae81ff>0.8</span> (+ (* pi <span style=color:#ae81ff>1.5</span>) (* <span style=color:#ae81ff>2</span> pi (/ minute <span style=color:#ae81ff>60</span>))))
</span></span><span style=display:flex><span>  (draw-hand! <span style=color:#ae81ff>0.7</span> (+ (* pi <span style=color:#ae81ff>1.5</span>) (* <span style=color:#ae81ff>2</span> pi (/ hour <span style=color:#ae81ff>12</span>))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>and</span> second
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>begin</span>
</span></span><span style=display:flex><span>         (draw-hand! <span style=color:#ae81ff>0.9</span> (+ (* pi <span style=color:#ae81ff>1.5</span>) (* <span style=color:#ae81ff>2</span> pi (/ second <span style=color:#ae81ff>60</span>))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  target)
</span></span></code></pre></div><p>The basic idea of <code>racket/draw</code> is that you have a sort of canvas (<code>target</code>) on which you can draw. You then issue a series of commands that either change your state (<code><a href="http://docs.racket-lang.org/search/index.html?q=set-pen">set-pen</a></code>
) or draw (<code><a href="http://docs.racket-lang.org/search/index.html?q=draw-ellipse">draw-ellipse</a></code>
and <code><a href="http://docs.racket-lang.org/search/index.html?q=draw-line">draw-line</a></code>
). I did abstract a little bit the function to create the clock hands: <code>draw-hand!</code>, mostly so I wouldn&rsquo;t have to redo the centering offset (<code>c</code>, since <code>0,0</code> is in the top left, not the center as I&rsquo;d hoped) and the <a href=https://en.wikipedia.org/wiki/trigonometry>trigonometry</a> to convert a radius and angle to x and y.</p><p>And that&rsquo;s actually all you need to make a basic clock:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (analog-clock (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>10</span>))
</span></span></code></pre></div><figure><img src=/embeds/2014/analog.png></figure><p>Straight forward enough. What&rsquo;s especially neat is that because radians cycle every two 2π rotations, you can put in some crazy times:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (analog-clock (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>208</span> <span style=color:#ae81ff>-350</span>))
</span></span></code></pre></div><figure><img src=/embeds/2014/analog.png></figure><p>Cool. Okay, next step. Let&rsquo;s figure out how to animate these, so we can transition from one time to another. In this, I had two options. Either I could move as a clock moves (where the minute hand has to move an entire rotation for the hour hand to move 1/12) or independently (such that both hands move at the same speed). Because it&rsquo;s both less code and honestly works better in the final result, I went with the second option:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Render a sequence of frames animating a clock spinnging from one time to another</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Hands will always move clockwise but will both move at once (not as a normal clock)</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (analog-frames α β frames)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (time-data α-hour α-minute α-second) α)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (time-data β-hour β-minute β-second) β)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let</span> ([β-hour   (<span style=color:#66d9ef>if</span> (&gt;= β-hour α-hour)     β-hour    (+ β-hour <span style=color:#ae81ff>12</span>))]
</span></span><span style=display:flex><span>        [β-minute (<span style=color:#66d9ef>if</span> (&gt;= β-minute α-minute) β-minute (+ β-minute <span style=color:#ae81ff>60</span>))]
</span></span><span style=display:flex><span>        [β-second (<span style=color:#66d9ef>and</span> α-second β-second
</span></span><span style=display:flex><span>                       (<span style=color:#66d9ef>if</span> (&gt;= β-second α-second) β-second (+ β-second <span style=color:#ae81ff>60</span>)))])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>for/list</span> ([i (in-range frames)])
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>define</span> frame-multiplier (/ i frames))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>define</span> hour (+ α-hour (* frame-multiplier (- β-hour α-hour))))
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>define</span> minute (+ α-minute (* frame-multiplier (- β-minute α-minute))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>define</span> second
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>and</span> α-second β-second
</span></span><span style=display:flex><span>             (+ α-second (* frame-multiplier (- β-second α-second)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      (analog-clock (<span style=color:#66d9ef>time</span> hour minute second)))))
</span></span></code></pre></div><p>Basically, we will loop through the frames and interpolate for each frame. The <code>frame-multiplier</code> will range evenly from 0 to 1 over the course of the frames. Also, the <code>let</code> block setting <code>β-hour</code> etc is to make sure that the clocks rotate clockwise. Since the second (<code>β</code>) value will always be higher, we always rotate right.</p><p>Okay, next let&rsquo;s switch gears and make some digital clocks. Since the eventual end goal was to make clocks out of clocks, I wanted a nice blocky font, built out of only a few different pieces. That way we could animate it more easily. Luckily the Unicode <a href=https://en.wikipedia.org/wiki/box-drawing%20characters>box-drawing characters</a> will do exactly what we need:</p><p>I went with a 3x3 character map for each letter:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>(<span style=color:#66d9ef>define</span> digits
</span></span><span style=display:flex><span>  (vector <span style=color:#e6db74>&#34;┌─┐│ │└─┘&#34;</span> <span style=color:#75715e>; 0</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;─┐  │ ─┴─&#34;</span> <span style=color:#75715e>; 1</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34; ─┐┌─┘└──&#34;</span> <span style=color:#75715e>; 2</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;──┐ ─┤──┘&#34;</span> <span style=color:#75715e>; 3</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;  │└─┤  │&#34;</span> <span style=color:#75715e>; 4</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;┌─ └─┐──┘&#34;</span> <span style=color:#75715e>; 5</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;│  ├─┐└─┘&#34;</span> <span style=color:#75715e>; 6</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;──┐  │  │&#34;</span> <span style=color:#75715e>; 7</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;┌─┐├─┤└─┘&#34;</span> <span style=color:#75715e>; 8</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;┌─┐└─┤  │&#34;</span> <span style=color:#75715e>; 9</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34; │     │ &#34;</span> <span style=color:#75715e>; delimiter</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34; ○     ○ &#34;</span>))
</span></span></code></pre></div><p>If you straighten them out, you have things like this for 5 for example:</p><pre tabindex=0><code>┌─
└─┐
──┘
</code></pre><p>They&rsquo;re not perfect, but I think they have a certain sort of charm.</p><p>Putting that all together, we can loop across all of the digits in the final clock and then each character that makes them up:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Render a digital clock using ascii bar graphics</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (digital-clock <span style=color:#66d9ef>when</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>match-define</span> (time-data hour minute second) <span style=color:#66d9ef>when</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (string-join
</span></span><span style=display:flex><span>   (<span style=color:#66d9ef>for/list</span> ([line-index (in-range <span style=color:#ae81ff>3</span>)])
</span></span><span style=display:flex><span>     (list-&gt;string
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>for*/list</span> ([digit
</span></span><span style=display:flex><span>                   (in-list
</span></span><span style=display:flex><span>                    (append (list (<span style=color:#66d9ef>if</span> (&lt; hour <span style=color:#ae81ff>10</span>) <span style=color:#ae81ff>0</span> (quotient hour <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>                                  (remainder hour <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>                                  <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>                                  (<span style=color:#66d9ef>if</span> (&lt; minute <span style=color:#ae81ff>10</span>) <span style=color:#ae81ff>0</span> (quotient minute <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>                                  (remainder minute <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>                            (<span style=color:#66d9ef>if</span> second
</span></span><span style=display:flex><span>                                (list <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>                                      (<span style=color:#66d9ef>if</span> (&lt; second <span style=color:#ae81ff>10</span>) <span style=color:#ae81ff>0</span> (quotient second <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>                                      (remainder second <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>                                (list))))]
</span></span><span style=display:flex><span>                  [char-index (in-range <span style=color:#ae81ff>3</span>)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>define</span> str (vector-ref digits digit))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>define</span> char (string-ref str (+ char-index (* line-index <span style=color:#ae81ff>3</span>))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        char)))
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>))
</span></span></code></pre></div><p>It&rsquo;s a bit ugly, but the bulk of the code is to make sure that we have enough digits for numbers less than 10. I bet I could do something nice with string formatting, but it works well enough. An example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (digital-clock (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;┌─┐  │ │ ─┐ ┌─┐</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>│ │└─┤    │ │ │</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>└─┘  │ │ ─┴─└─┘&#34;</span>
</span></span></code></pre></div><p>Oops.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (display (digital-clock (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>10</span>)))
</span></span><span style=display:flex><span>┌─┐  │ │ ─┐ ┌─┐
</span></span><span style=display:flex><span>│ │└─┤    │ │ │
</span></span><span style=display:flex><span>└─┘  │ │ ─┴─└─┘
</span></span></code></pre></div><p>Much better.</p><p>Okay, now we&rsquo;re at the point of no return. How do we turn a digital clock with that 3x3 font into smaller clocks?</p><p>First, we need a map of the bar characters to times:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Convert the bar images used back into clocks</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> bar-&gt;clock
</span></span><span style=display:flex><span>  (hash <span style=color:#e6db74>#\└</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\┘</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\┼</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\─</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>45</span> <span style=color:#ae81ff>45</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\┴</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>45</span> <span style=color:#ae81ff>15</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\├</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\┤</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\┬</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>45</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\┌</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\┐</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>9</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\│</span> (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\○</span> <span style=color:#66d9ef>#f</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>#\space</span> <span style=color:#66d9ef>#f</span>))
</span></span></code></pre></div><p>These could probably use a little more tuning. But what this does allow us to make is a very simple function to make a clock out of clocks:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>(<span style=color:#66d9ef>define</span> timeless (make-parameter (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Make a clock out of clocks!</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (clock-clock <span style=color:#66d9ef>when</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> chars (digital-clock <span style=color:#66d9ef>when</span>))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> empty-frame (analog-clock (timeless)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> rows
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>for/list</span> ([line (in-list (string-split chars <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>))])
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>for/list</span> ([char (in-string line)])
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>cond</span>
</span></span><span style=display:flex><span>          [(hash-ref bar-&gt;clock char) <span style=color:#66d9ef>=&gt;</span> analog-clock]
</span></span><span style=display:flex><span>          [<span style=color:#66d9ef>else</span> empty-frame]))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (apply above (map (curry apply beside) rows)))
</span></span></code></pre></div><p>In use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; (clock-clock (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>10</span>))
</span></span></code></pre></div><figure><img src=/embeds/2014/clockception.png></figure><p>That right there is actually one of the parts of programming I love the most. Where you write a small pile of functions, each of which does one specific piece and then when you finally get to the big overall algorithm&mldr; bam. Simple.</p><p>But&mldr; back to being a little more complicated. How do we do the transition from one <code>clock-clock</code> to another? It would be nice if we could use the previous function, but we really can&rsquo;t. A similar idea will work though:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Animate a clock of clocks turning from one time to another</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (tick-tock α β frames)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> α-chars (digital-clock α))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> β-chars (digital-clock β))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> rows*
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>for/list</span> ([α-line (in-list (string-split α-chars <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>))]
</span></span><span style=display:flex><span>               [β-line (in-list (string-split β-chars <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>))])
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>for/list</span> ([α-char (in-string α-line)]
</span></span><span style=display:flex><span>                 [β-char (in-string β-line)])
</span></span><span style=display:flex><span>        (analog-frames (<span style=color:#66d9ef>or</span> (hash-ref bar-&gt;clock α-char) (timeless))
</span></span><span style=display:flex><span>                       (<span style=color:#66d9ef>or</span> (hash-ref bar-&gt;clock β-char) (timeless))
</span></span><span style=display:flex><span>                       frames))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>for/list</span> ([i (in-range frames)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define</span> rows
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>for/list</span> ([row (string-split α-chars <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)]
</span></span><span style=display:flex><span>                 [row-index (in-naturals)])
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>for/list</span> ([char-index (in-range (string-length row))])
</span></span><span style=display:flex><span>          (list-ref (list-ref (list-ref rows* row-index) char-index) i))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (apply above (map (curry apply beside) rows))))
</span></span></code></pre></div><p>Basically, we have two steps. First we define <code>rows*</code> by generating each of the subclocks for each of the intermediate times. Then, that last is in the wrong order (indexed by row, column, then frame, rather than frame, row, then column) so we unpack it and put it back together. This is pretty terribly inefficient, but there will only ever be 3 rows and up to 20 columns, so it&rsquo;s not that bad.</p><p>With that, we can make simple animations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span>&gt; <span style=color:#75715e>; Fix bitmaps so that big-bang / run-movie / etc can render them</span>
</span></span><span style=display:flex><span>&gt; (<span style=color:#66d9ef>define</span> (fix img) (rotate <span style=color:#ae81ff>0</span> img))
</span></span><span style=display:flex><span>&gt; (run-movie <span style=color:#ae81ff>0.1</span> (tick-tock (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>59</span>) (<span style=color:#66d9ef>time</span> <span style=color:#ae81ff>8</span> <span style=color:#ae81ff>0</span>) <span style=color:#ae81ff>56</span>))
</span></span></code></pre></div><figure><img src=/embeds/2014/animated.gif></figure><p>I really wish that <code>fix</code> wasn&rsquo;t necessary, but for whatever reason, <code><a href="http://docs.racket-lang.org/search/index.html?q=big-bang">big-bang</a></code>
/ <code><a href="http://docs.racket-lang.org/search/index.html?q=run-movie">run-movie</a></code>
/ et al don&rsquo;t like <code><a href="http://docs.racket-lang.org/search/index.html?q=bitmap%25">bitmap%</a></code>
s. So it goes.</p><p>On the other hand though, <code><a href="http://docs.racket-lang.org/search/index.html?q=run-movie">run-movie</a></code>
is really cool. I&rsquo;ve been doing things like this with <code><a href="http://docs.racket-lang.org/search/index.html?q=big-bang">big-bang</a></code>
and the <code>stop-when</code> parameter, but this just needs a list of images and stops automatically. Another tool for my toolchest!</p><p>Okay, one more step. I know I just said <code><a href="http://docs.racket-lang.org/search/index.html?q=run-movie">run-movie</a></code>
is the new shiny, but let&rsquo;s step back to <code><a href="http://docs.racket-lang.org/search/index.html?q=big-bang">big-bang</a></code>
for a second. Given that we have a clock made of clocks, what would it take to actually render it in real time?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-racket data-lang=racket><span style=display:flex><span><span style=color:#75715e>; Make a tick-tock real time clock</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define</span> (tick-tock-real-time-clock <span style=color:#66d9ef>#:12-hour?</span> [12-hour? <span style=color:#66d9ef>#f</span>])
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Get the current time in hours/minutes/seconds</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> (now)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define</span> date (current-date))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>time</span> (date-hour date) (date-minute date) <span style=color:#66d9ef>#f</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Generate a list of frames for the next transition</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Note: The big bang clock is supposed to tick 28 times per second</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define</span> (transition-frames)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>match-define</span> (time-data hour minute <span style=color:#66d9ef>_</span>) (now))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define</span> next-minute (remainder (+ minute <span style=color:#ae81ff>1</span>) <span style=color:#ae81ff>60</span>))
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>define</span> next-hour (remainder (<span style=color:#66d9ef>if</span> (= next-minute <span style=color:#ae81ff>60</span>) (+ hour <span style=color:#ae81ff>1</span>) hour) (<span style=color:#66d9ef>if</span> 12-hour? <span style=color:#ae81ff>12</span> <span style=color:#ae81ff>24</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    (tick-tock (<span style=color:#66d9ef>time</span> hour minute)
</span></span><span style=display:flex><span>               (<span style=color:#66d9ef>time</span> next-hour next-minute)
</span></span><span style=display:flex><span>               <span style=color:#ae81ff>56</span>)) <span style=color:#75715e>; Note: The big bang clock is supposed to</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>; tick 28 times per second</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (big-bang (list (now) (transition-frames))
</span></span><span style=display:flex><span>    [on-tick
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>λ</span> (state)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>match-define</span> (list old-time frames) state)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>define</span> new-time (now))
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>cond</span>
</span></span><span style=display:flex><span>         <span style=color:#75715e>; We&#39;ve advanced to the new time, jump ahead!</span>
</span></span><span style=display:flex><span>         [(not (equal? old-time new-time))
</span></span><span style=display:flex><span>          (list new-time (transition-frames))]
</span></span><span style=display:flex><span>         <span style=color:#75715e>; Freeze if we only have one frame left</span>
</span></span><span style=display:flex><span>         [(null? (rest frames))
</span></span><span style=display:flex><span>          state]
</span></span><span style=display:flex><span>         <span style=color:#75715e>; Otherwise, advance one frame</span>
</span></span><span style=display:flex><span>         [<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>          (list old-time (rest frames))]))]
</span></span><span style=display:flex><span>    [to-draw
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>λ</span> (state)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>match-define</span> (list old-time frames) state)
</span></span><span style=display:flex><span>       (fix (first frames)))]))
</span></span></code></pre></div><p>Now that is a cool function. Basically, each minute we will generate the frames that will be used by the transition. Since <code>big-bang</code> runs at 28 frames per second, the 56 frames will takes 2 seconds to animate. Each minute, the next transition will be generated and then ticked down one frame at a time until only one is left, at which point we will just wait. Neat!</p><p>Originally I had it rendering seconds as well, but it was just a little bit too jittery. So minutes it is! I can&rsquo;t really do this thing justice in a gif (it actually looks just like <code>tick-tock</code> above, just with the current time), but it&rsquo;s still pretty cool.</p><p>And&mldr; that&rsquo;s it. Clocks made of clocks. Who would have thought? As always, the full code is available on GitHub. Check it out: <a href=https://github.com/jpverkamp/small-projects/blob/master/blog/clockception.rkt>clockception.rkt</a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>I wonder what percentage of people can still read these? Takes me a bit longer than it used to&mldr;&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>