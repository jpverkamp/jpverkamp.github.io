<!DOCTYPE html>
<html>
<head>
    <title>
    Graph coloring – jverkamp.com
</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css">

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />


    
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper">
        <header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
        
            
        
            
            <li><a href="https://blog.jverkamp.com/photography/">Photography</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/programming/">Programming</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/research/">Research</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/writing/">Writing</a></li>
            
        
            <li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>


        <div id="page-content-wrapper">
            <div id="page-content">
            
<article>
	<header>
		<h1 class="entry-title">Graph coloring</h1>

        <div class="entry-meta">
            
            <span class="entry-date">2014-01-15</span>
            
            
        </div>

        <div class="entry-tags">
    
    

    <ul class="taxonomy-keys">
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/racket">Racket</a>
                        <a href="https://blog.jverkamp.com/2014/01/27/factoring-factorials/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a>
                        <a href="https://blog.jverkamp.com/2014/01/27/factoring-factorials/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/data-structures">Data Structures</a>
                        <a href="https://blog.jverkamp.com/2014/05/28/quadtree-image-compression/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/graph-theory">Graph Theory</a>
                        <a href="https://blog.jverkamp.com/2014/07/05/cracker-barrel-peg-game/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/graphs">Graphs</a>
                        <a href="https://blog.jverkamp.com/2014/05/21/phone-networks/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/mathematics">Mathematics</a>
                        <a href="https://blog.jverkamp.com/2014/01/27/factoring-factorials/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    

    
        
        <li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2014/01/27/factoring-factorials/" class="next-link">Next</a>
                
            </ul>
        </li>
        

        
        <li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2014/01/27/factoring-factorials/" class="next-link">Next</a>
                
            </ul>
        </li>
        
    
    </ul>
</div>

    </header>

	<div class="entry-content">
		<p>Here&rsquo;s <a href="http://www.reddit.com/r/dailyprogrammer/comments/1tj0kl/122313_challenge_130_hard_coloring_frances/">another one</a> from /r/dailyprogrammer:</p>

<blockquote>
<p>&hellip; Your goal is to color a map of these regions with two requirements: 1) make sure that each adjacent department do not share a color, so you can clearly distinguish each department, and 2) minimize these numbers of colors.</p>
</blockquote>

<p>Essentially, <a href="https://en.wikipedia.org/wiki/graph%20coloring">graph coloring</a>.</p>

<p></p>

<p>Of course we&rsquo;ll go ahead and use the <a href="https://blog.jverkamp.com/2014/01/14/graph-radius/">yesterday&rsquo;s post</a>. The input format is a little different this time, where each line contains a node then all of the neighbors, but that shouldn&rsquo;t be an issue. We just need a slightly different <code>read-graph</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Given a string or input port, read a graph</span>
<span style="color:#75715e">; First line is number of following lines</span>
<span style="color:#75715e">; The rest of the lines have a node id than one or more ids of that node&#39;s neighbors</span>
(<span style="color:#66d9ef">define </span>(read-graph [str/in (current-input-port)])
  (<span style="color:#66d9ef">define </span>in (<span style="color:#66d9ef">if </span>(string? str/in) (open-input-string str/in) str/in))
  (<span style="color:#66d9ef">define </span>node-count (read in))

  (<span style="color:#66d9ef">define </span>g (unweighted-graph/undirected <span style="color:#f92672">&#39;</span>()))

  (for* ([i (in-range node-count)]
         [line (in-lines in)])
    (<span style="color:#66d9ef">define </span>nums (map string-&gt;number (string-split line)))
    (when (&gt; (length nums) <span style="color:#ae81ff">1</span>)
      (for ([n (in-list (rest nums))])
        (add-edge! g (first nums) n))))

  g)</code></pre></div>
<p>After that, we have to figure out what strategy we want to use to color the graph. It turns out that even determining how many colors the best coloring would need is hard<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>. That means that a perfect solution is going to be slow, especially as the problem gets bigger. So how about instead we start out with a very basic <a href="https://en.wikipedia.org/wiki/greedy%20algorithm">greedy algorithm</a> and go from there.</p>

<p>Idea the first: Iterate through the nodes of the graph, coloring each one in turn. Use the first available color that hasn&rsquo;t already been assigned.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Assign a color given a graph, color hash, and node</span>
(<span style="color:#66d9ef">define </span>(assign-first-color! g cs n)
  (for/first ([i (in-naturals)]
              <span style="color:#f92672">#</span>:unless 
              (member i (map (λ (n) (hash-ref cs n <span style="color:#66d9ef">#f</span>))
                               (neighbors g n))))
      (hash-set! cs n i)))

<span style="color:#75715e">; Basic greedy coloring: color each node in turn with the first available color</span>
(<span style="color:#66d9ef">define </span>(greedy-coloring g [node-order (in-vertices g)])
  (<span style="color:#66d9ef">define </span>colors (make-hash))

  <span style="color:#75715e">; For each node, try each color</span>
  <span style="color:#75715e">; for/first will bail as soon as it is execute once</span>
  (for ([n (in-list node-order)])
    (assign-first-color! g colors n))

  colors)</code></pre></div>
<p>There&rsquo;s a bit of voodoo magic in the first method, but basically I&rsquo;m using <code>for/first</code> to short circuit the loop. Previously, I&rsquo;ve done much the same thing with <code>let/ec</code>, but this feels more &lsquo;Rackety&rsquo;. Essentially, we run through the colors (represented as numbers) until we find one that isn&rsquo;t a <code>member</code> of the list of all neighboring colors. As soon as we see that, we assign the color and bail out of the loop.</p>

<p>The second function takes the graph and a node ordering (which defaults to whatever is being internally stored in the graph) and repeatedly uses the assignment function to color nodes. To test it out, let&rsquo;s use that same Butterfly graph as yesterday:</p>


<figure >
    
        <img src="/embeds/2014/butterfly.png" />
    
    
</figure>


<p>Assigning the nodes left to right then top to bottom, we have:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#66d9ef">define </span>butterfly (read-graph <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">5
</span><span style="color:#e6db74">1 2 3
</span><span style="color:#e6db74">2 1 3
</span><span style="color:#e6db74">3 1 2 4 5
</span><span style="color:#e6db74">4 3 5
</span><span style="color:#e6db74">5 3 4
</span><span style="color:#e6db74">&#34;</span>))

&gt; (greedy-coloring butterfly)
<span style="color:#f92672">&#39;#</span>hash((<span style="color:#ae81ff">5</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">4</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">3</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">2</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">1</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>))</code></pre></div>

<figure >
    
        <img src="/embeds/2014/butterfly-greedy.png" />
    
    
</figure>


<p>So we assigned the central node a color (3) and then each side two colors (0/1). For this particular case, it turns out that&rsquo;s actually optimal. But we can come up with a graph where a simple greedy coloring doesn&rsquo;t work:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#66d9ef">define </span>loop (read-graph <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">6
</span><span style="color:#e6db74">1 4 6
</span><span style="color:#e6db74">2 3 5
</span><span style="color:#e6db74">3 2 6
</span><span style="color:#e6db74">4 1 5
</span><span style="color:#e6db74">5 2 4
</span><span style="color:#e6db74">6 1 3
</span><span style="color:#e6db74">&#34;</span>))

&gt; (greedy-coloring loop)
<span style="color:#f92672">&#39;#</span>hash((<span style="color:#ae81ff">6</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">5</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">4</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">3</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">2</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>))</code></pre></div>

<figure >
    
        <img src="/embeds/2014/loop-greedy.png" />
    
    
</figure>


<p>Here, we have three different colors for each of the pairs. The problem is, it&rsquo;s fairly obvious that there should be a two coloring. Just color every other node:</p>


<figure >
    
        <img src="/embeds/2014/loop-random.png" />
    
    
</figure>


<p>So how should we do it? Well one interesting thing about the greedy coloring is that while the default node order doesn&rsquo;t give an optimal coloring, there does exist an ordering that does<sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup>. So how about we try a bunch of random orderings and take the best? Something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Try a bunch of random colorings, keeping the best</span>
(<span style="color:#66d9ef">define </span>(random-coloring g <span style="color:#f92672">#</span>:iterations [iterations <span style="color:#ae81ff">1</span>e6])

  (define-values (coloring count)
    (for/fold ([best-coloring <span style="color:#66d9ef">#f</span>] [best-count +inf<span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>])
              ([i (in-range iterations)])
      (<span style="color:#66d9ef">define </span>new-coloring (greedy-coloring g (shuffle (in-vertices g))))
      (<span style="color:#66d9ef">define </span>new-count (set-count (list-&gt;set (hash-values new-coloring))))

      (<span style="color:#66d9ef">if </span>(&lt; new-count best-count)
          (values new-coloring new-count)
          (values best-coloring best-count))))

  coloring)</code></pre></div>
<p>Give it a try:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (random-coloring loop <span style="color:#f92672">#</span>:iterations <span style="color:#ae81ff">100</span>)
<span style="color:#f92672">&#39;#</span>hash((<span style="color:#ae81ff">6</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">5</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">4</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">3</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">2</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">1</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>))</code></pre></div>
<p>That&rsquo;s pretty shiny. With just a hundred random trials, we&rsquo;ve found a two coloring. Granted, there are only 720 possible permutations for this particularly graph (<span class="latex-inline">6!</span>
), but you could play with the number of iterations.</p>

<p>Still, we should be able to do better.</p>

<p><a href="http://www.reddit.com/r/dailyprogrammer/comments/1tj0kl/122313_challenge_130_hard_coloring_frances/ceb58ch">One interesting comment</a> from the original problem brings up some work from <a href="https://en.wikipedia.org/wiki/Daniel%20Br%c3%a9laz">Daniel Brélaz</a>. Essentially, you repeatedly pick the node that has the most already colored neighbors (those will be the hardest to color), breaking ties by the most uncolored neighbors (most likely to need a new color). The way I&rsquo;ll be implementing that is by assigning a &lsquo;brélaz-number&rsquo; to each node:</p>

<div class="latex-block">
    brelaz(n) = |G| coloredNeighbors(n) + uncoloredNeighbors(n)
</div>


<p>Basically, we have a two digit number, using the size of the graph as the base. If that doesn&rsquo;t make sense, we could certainly make a more direct two stage sorting function, but I think it&rsquo;s sort of elegant. 😄</p>

<p>Anyways, here&rsquo;s the entire function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Use a Brélaz coloring: </span>
<span style="color:#75715e">;   Choose the vertex with the most colored neighbors,</span>
<span style="color:#75715e">;   breaking ties by most uncolored neighbors</span>
(<span style="color:#66d9ef">define </span>(brélaz-coloring g)
  (<span style="color:#66d9ef">define </span>colors (make-hash))

  <span style="color:#75715e">; Used to break ties as mentioned above</span>
  (<span style="color:#66d9ef">define </span>(count-colored-neighbors n)
    (length (filter (curry hash-has-key? colors) (neighbors g n))))

  (<span style="color:#66d9ef">define </span>(count-uncolored-neighbors n)
    (length (filter (negate (curry hash-has-key? colors)) (neighbors g n))))

  (<span style="color:#66d9ef">define </span>graph-size (length (in-vertices g)))
  (<span style="color:#66d9ef">define </span>(brélaz-number n)
    (+ (* (count-colored-neighbors n) graph-size)
       (count-uncolored-neighbors n)))

  <span style="color:#75715e">; Each time, color the node with the highest current brélaz-number (see above)</span>
  (for ([i (in-range graph-size)])
    (assign-first-color! 
     g 
     colors 
     (first
      (sort
       (filter (negate (curry hash-has-key? colors)) (in-vertices g))
       (λ (n1 n2) (&gt; (brélaz-number n1) (brélaz-number n2)))))))

  colors)

(<span style="color:#66d9ef">define </span>brelaz-coloring brélaz-coloring)</code></pre></div>
<p>How does that do on the previous problem?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (brélaz-coloring loop)
<span style="color:#f92672">&#39;#</span>hash((<span style="color:#ae81ff">6</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">5</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">4</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">3</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">2</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">1</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>))</code></pre></div>

<figure >
    
        <img src="/embeds/2014/loop-brelaz.png" />
    
    
</figure>


<p>Much better, although either runs quickly enough that on my machine at least you can&rsquo;t even tell the difference. It will make a difference on much bigger graphs though. For example, let&rsquo;s try running the various scans on the actual original problem (a coloring of French regions, available 
<figure >
    <a href="france.txt">
        <img src="/embeds/2014/here" />
    </a>
    
</figure>
):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#66d9ef">define </span>france (with-input-from-file <span style="color:#e6db74">&#34;france.txt&#34;</span> read-graph))
&gt; (greedy-coloring france)
<span style="color:#f92672">&#39;#</span>hash((<span style="color:#ae81ff">46</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">4</span>) (<span style="color:#ae81ff">29</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">12</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">72</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">4</span>) (<span style="color:#ae81ff">89</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">5</span>) (<span style="color:#ae81ff">94</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">4</span>) (<span style="color:#ae81ff">79</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">4</span>)
       (<span style="color:#ae81ff">11</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">26</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">4</span>) (<span style="color:#ae81ff">41</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">56</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">78</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">95</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">4</span>) (<span style="color:#ae81ff">27</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>)
       (<span style="color:#ae81ff">10</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">57</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">40</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">92</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">77</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">43</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">4</span>) (<span style="color:#ae81ff">58</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">4</span>)
        (<span style="color:#ae81ff">9</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">24</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">76</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">93</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">59</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">42</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">25</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>)
        (<span style="color:#ae81ff">8</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>)  (<span style="color:#ae81ff">7</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">22</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">37</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">52</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">82</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">67</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>)
       (<span style="color:#ae81ff">23</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>)  (<span style="color:#ae81ff">6</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">53</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">36</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">66</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">83</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">39</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>)
       (<span style="color:#ae81ff">54</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>)  (<span style="color:#ae81ff">5</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">80</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">65</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">55</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">38</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">21</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>)
        (<span style="color:#ae81ff">4</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">64</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">81</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">86</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>) (<span style="color:#ae81ff">71</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">3</span>)  (<span style="color:#ae81ff">3</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">18</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>)
       (<span style="color:#ae81ff">33</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">48</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">70</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">87</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">19</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>)  (<span style="color:#ae81ff">2</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">49</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>)
       (<span style="color:#ae81ff">32</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">84</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">69</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">35</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">50</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>)  (<span style="color:#ae81ff">1</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">16</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>)
       (<span style="color:#ae81ff">68</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">85</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">51</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">34</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">17</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">15</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">30</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>)
       (<span style="color:#ae81ff">45</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">60</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">90</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">75</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">31</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">14</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">61</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>)
       (<span style="color:#ae81ff">44</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">74</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">91</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">1</span>)  (<span style="color:#ae81ff">0</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">47</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">62</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">13</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>)
       (<span style="color:#ae81ff">28</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">88</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">73</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">63</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">0</span>))</code></pre></div>

<figure >
    
        <img src="/embeds/2014/france-greedy.png" />
    
    
</figure>


<p>A little messy down there towards the bottom, and not that easy to tell how many colors we have. Looks like six. Let&rsquo;s go ahead and write a function to tell us how many we actually used:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Calculate the chromatic number of a graph, potentially given a coloring function</span>
(<span style="color:#66d9ef">define </span>(chromatic-number g <span style="color:#f92672">#</span>:coloring-function [coloring perfect-coloring])
  (add1 (apply max (hash-values (coloring g)))))</code></pre></div>
<p>With the greedy coloring algorithm:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (chromatic-number france <span style="color:#f92672">#</span>:coloring-function greedy-coloring)
<span style="color:#ae81ff">6</span></code></pre></div>
<p>Hmm. Let&rsquo;s see if Brélaz can do better:</p>


<figure >
    
        <img src="/embeds/2014/france-brelaz.png" />
    
    
</figure>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (chromatic-number france <span style="color:#f92672">#</span>:coloring-function brélaz-coloring)
<span style="color:#ae81ff">4</span></code></pre></div>
<p>That&rsquo;s much better! And given the <a href="https://en.wikipedia.org/wiki/four%20color%20theorem">four color theorem</a><sup class="footnote-ref" id="fnref:3"><a rel="footnote" href="#fn:3">3</a></sup>, that should be an upper bound. Unfortunately, it doesn&rsquo;t seem that the random coloring is doing any better (at least with my random number generator). Even with 100,000 iterations, the best that it found was 5.</p>

<p>But&hellip; what if we want to do it perfectly? Well, if we go through <em>every</em> coloring, we&rsquo;re guaranteed to find a correctly solution. Of course in <a href="https://en.wikipedia.org/wiki/Big-oh">Big O notation</a>, that&rsquo;s <span class="latex-inline">O(n!)</span>
 which basically is as good as forever&hellip; Still, we might as well write the code<footnote>Plus it gives me an excuse to play with Racket&rsquo;s <code><a href="http://docs.racket-lang.org/search/index.html?q=generators">generators</a></code>
!). 😄</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Try every possible coloring (this is crazy slow)</span>
(<span style="color:#66d9ef">define </span>(perfect-coloring g)
  <span style="color:#75715e">; Return all permutations of a given list as a sequence</span>
  (<span style="color:#66d9ef">define </span>(in-permutations ls)
    (local-require racket/generator)
    (in-generator
     (<span style="color:#66d9ef">let </span>loop ([ls ls] [acc <span style="color:#f92672">&#39;</span>()])
       (cond
         [(null? ls) 
          (yield acc)]
         [else
          (for ([a (in-list ls)])
            (loop (remove a ls) (cons a acc)))]))))

  <span style="color:#75715e">; Try each coloring in turn</span>
  (define-values (coloring count)
    (for/fold ([best-coloring <span style="color:#66d9ef">#f</span>] [best-count +inf<span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>])
              ([coloring-order (in-permutations (in-vertices g))])

      (<span style="color:#66d9ef">define </span>new-coloring (greedy-coloring g coloring-order))
      (<span style="color:#66d9ef">define </span>new-count (set-count (list-&gt;set (hash-values new-coloring))))

      (<span style="color:#66d9ef">if </span>(&lt; new-count best-count)
          (values new-coloring new-count)
          (values best-coloring best-count))))

  coloring)</code></pre></div>
<p>Basically, we use a <code><a href="http://docs.racket-lang.org/search/index.html?q=generator">generator</a></code>
 to create all of the permutations recursively. With that, we keep going until we have a best coloring. For the loop or butterfly, it works fine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (chromatic-number loop <span style="color:#f92672">#</span>:coloring-function perfect-coloring)
<span style="color:#ae81ff">2</span>
&gt; (chromatic-number butterfly <span style="color:#f92672">#</span>:coloring-function perfect-coloring)
<span style="color:#ae81ff">3</span></code></pre></div>
<p>Anything bigger&hellip; be prepared for a wait.</p>

<p>And that&rsquo;s pretty much it. I did want to show off one more neat bit of code, designed to output graph files in the format Graphviz expects in order to generate all of the visualizations on this page. Pretty neat stuff and fairly easy to write:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Output a graph in graphviz / dot format, potentially with coloring</span>
(<span style="color:#66d9ef">define </span>(graphviz g
                  <span style="color:#f92672">#</span>:coloring-function [coloring <span style="color:#66d9ef">#f</span>] 
                  <span style="color:#f92672">#</span>:horizontal [horizontal <span style="color:#66d9ef">#f</span>]
                  <span style="color:#f92672">#</span>:save-as-png [save-as-png <span style="color:#66d9ef">#f</span>])
  <span style="color:#75715e">; Generate the dot file</span>
  (<span style="color:#66d9ef">define </span>dot-file
    (with-output-to-string
      (thunk
        (printf <span style="color:#e6db74">&#34;graph G {\n&#34;</span>)

        <span style="color:#75715e">; Prefer horizontal layout to vertical</span>
        (when horizontal
          (printf <span style="color:#e6db74">&#34;\trankdir=LR;\n&#34;</span>))

        <span style="color:#75715e">; Color nodes using evenly spaced HSV colors</span>
        (when coloring
          (<span style="color:#66d9ef">define </span>colors (coloring g))
          (<span style="color:#66d9ef">define </span>color-count (add1 (apply max (hash-values colors))))

          (for ([(node color) (in-hash colors)])
            (printf <span style="color:#e6db74">&#34;\t~a [color=\&#34;~a 1.0 1.0\&#34;];\n&#34;</span>
                    node 
                    (~a <span style="color:#f92672">#</span>:max-width <span style="color:#ae81ff">5</span> (exact-&gt;inexact (/ color color-count))))))

        <span style="color:#75715e">; Write out all edges (directional, so only if sorted)</span>
        (for ([edge (in-edges g)])
          (when (&lt; (first edge) (second edge))
            (printf <span style="color:#e6db74">&#34;\t~a -- ~a;\n&#34;</span> (first edge) (second edge))))

        (printf <span style="color:#e6db74">&#34;}\n&#34;</span>))))

  <span style="color:#75715e">; Either save via buffer file or just return the dot file text</span>
  (cond
    [save-as-png
     (with-output-to-file <span style="color:#f92672">#</span>:exists <span style="color:#e6db74">&#39;replace</span> <span style="color:#e6db74">&#34;output.dot&#34;</span> (thunk (display dot-file)))
     (system (format <span style="color:#e6db74">&#34;dot output.dot -Kneato -Tpng -s0.5 -o ~a&#34;</span> save-as-png))]
    [else
     dot-file]))</code></pre></div>
<p>If you don&rsquo;t supply a <code>#:save-as-png</code> parameter, you get the graph. Something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (display (graphviz butterfly <span style="color:#f92672">#</span>:coloring-function brelaz-coloring))
graph G <span style="color:#960050;background-color:#1e0010">{</span>
	<span style="color:#ae81ff">1</span> [color=<span style="color:#e6db74">&#34;0.333 1.0 1.0&#34;</span>]<span style="color:#75715e">;</span>
	<span style="color:#ae81ff">2</span> [color=<span style="color:#e6db74">&#34;0.666 1.0 1.0&#34;</span>]<span style="color:#75715e">;</span>
	<span style="color:#ae81ff">3</span> [color=<span style="color:#e6db74">&#34;0.0 1.0 1.0&#34;</span>]<span style="color:#75715e">;</span>
	<span style="color:#ae81ff">4</span> [color=<span style="color:#e6db74">&#34;0.333 1.0 1.0&#34;</span>]<span style="color:#75715e">;</span>
	<span style="color:#ae81ff">5</span> [color=<span style="color:#e6db74">&#34;0.666 1.0 1.0&#34;</span>]<span style="color:#75715e">;</span>
	<span style="color:#ae81ff">1</span> -- <span style="color:#ae81ff">2</span><span style="color:#75715e">;</span>
	<span style="color:#ae81ff">1</span> -- <span style="color:#ae81ff">3</span><span style="color:#75715e">;</span>
	<span style="color:#ae81ff">2</span> -- <span style="color:#ae81ff">3</span><span style="color:#75715e">;</span>
	<span style="color:#ae81ff">3</span> -- <span style="color:#ae81ff">4</span><span style="color:#75715e">;</span>
	<span style="color:#ae81ff">3</span> -- <span style="color:#ae81ff">5</span><span style="color:#75715e">;</span>
	<span style="color:#ae81ff">4</span> -- <span style="color:#ae81ff">5</span><span style="color:#75715e">;</span>
<span style="color:#960050;background-color:#1e0010">}</span></code></pre></div>
<p>That&rsquo;s one of the things I love about the HSV color space. You can just evenly divide the H parameter and you&rsquo;ll get a bunch of unique colors.</p>

<p>And there you have it. Graph coloring / visualization. I think it&rsquo;s one of my favorite branches of mathematics. There are just so many interesting things you can do with graphs.</p>

<p>The source code is on GitHub, if you&rsquo;d like to check it out: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/graph-coloring.rkt">graph-coloring.rkt</a></p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">Technically, <a href="https://en.wikipedia.org/wiki/NP-complete">NP-complete</a>, as noted in <a href="https://en.wikipedia.org/wiki/Karp%27s%2021%20NP-complete%20problems">Karp&#39;s 1972 list of 21 NP-complete problems</a>
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">Exercise for the reader: prove this 😄
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
<li id="fn:3">And assuming that there aren&rsquo;t any discontinuous regions, which I don&rsquo;t think is actually the case&hellip;
 <a class="footnote-return" href="#fnref:3"><sup>[return]</sup></a></li>
</ol>
</div>
	</div>

    
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Graph coloring";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2014\/01\/15\/graph-coloring\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>


</article>

            </div>
        </div>

        <footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>

            
            <li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>
            
        </ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js"></script>

<script type="text/javascript" src="/custom.js" defer></script>

</body>
</html>
