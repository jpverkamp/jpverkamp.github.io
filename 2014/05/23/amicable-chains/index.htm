<!DOCTYPE html>
<html>
<head>
        
        

        <title>Amicable chains | jverkamp.com | John-Paul Verkamp</title>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

        <script src="//code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>

        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" />
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/3.0.3a/ekko-lightbox.min.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.transit/0.9.9/jquery.transit.min.js"></script>

        <!-- Highlight.js for syntax highlighting -->
        <link rel="stylesheet" href="/highlight/styles/obsidian.css" />
        <script src="/highlight/highlight.pack.js"></script>

        <!-- MathJax for LaTeX support -->
        <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- nanoGallery for Flickr Galleries -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css" />
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

        <!-- Pretty pretty fonts -->
        <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Calligraffitti" />

        <!-- Any custom CSS or JS that I've written; this should be kept minimal -->
        <link rel="stylesheet" href="/custom.css" />
        <script src="/custom.js"></script>

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="http://blog.jverkamp.com/feed/" />
</head>
<body>
        <header class="container">
        <nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://blog.jverkamp.com"><span style="color: green;">jv</span>erkamp.com</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav"><li class="dropdown"><a href="http://blog.jverkamp.com/category/archives" class="dropdown-toggle">Archives<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/archives/2004">2004</a></li><li><a href="http://blog.jverkamp.com/category/archives/2005">2005</a></li><li><a href="http://blog.jverkamp.com/category/archives/2006">2006</a></li><li><a href="http://blog.jverkamp.com/category/archives/2007">2007</a></li><li><a href="http://blog.jverkamp.com/category/archives/2008">2008</a></li><li><a href="http://blog.jverkamp.com/category/archives/2009">2009</a></li><li><a href="http://blog.jverkamp.com/category/archives/2010">2010</a></li><li><a href="http://blog.jverkamp.com/category/archives/2011">2011</a></li><li><a href="http://blog.jverkamp.com/category/archives/2012">2012</a></li><li><a href="http://blog.jverkamp.com/category/archives/2013">2013</a></li><li><a href="http://blog.jverkamp.com/category/archives/2014">2014</a></li><li><a href="http://blog.jverkamp.com/category/archives/2015">2015</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/other" class="dropdown-toggle">Other<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/other/board-game-reviews">Board Game Reviews</a></li><li><a href="http://blog.jverkamp.com/category/other/book-reviews">Book Reviews</a></li><li><a href="http://blog.jverkamp.com/category/other/cooking">Cooking</a></li><li><a href="http://blog.jverkamp.com/category/other/movie-reviews">Movie Reviews</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/photography" class="dropdown-toggle">Photography<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/photography/dp-challenge">DP Challenge</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosets">Photosets</a></li><li><a href="http://blog.jverkamp.com/category/photography/photosynth">Photosynth</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/programming" class="dropdown-toggle">Programming<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/programming/by-language">By Language</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-project">By Project</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-source">By Source</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/programming/libraries">Libraries</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/research" class="dropdown-toggle">Research<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/research/by-topic">By Topic</a></li><li><a href="http://blog.jverkamp.com/category/research/publications">Publications</a></li></ul></li><li class="dropdown"><a href="http://blog.jverkamp.com/category/writing" class="dropdown-toggle">Writing<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="http://blog.jverkamp.com/category/writing/by-genre">By Genre</a></li><li><a href="http://blog.jverkamp.com/category/writing/ideas">Ideas</a></li><li><a href="http://blog.jverkamp.com/category/writing/nanowrimo">NaNoWriMo</a></li><li><a href="http://blog.jverkamp.com/category/writing/novels">Novels</a></li><li><a href="http://blog.jverkamp.com/category/writing/other">Other</a></li><li><a href="http://blog.jverkamp.com/category/writing/short-stories">Short Stories</a></li><li><a href="http://blog.jverkamp.com/category/writing/writing-excuses">Writing Excuses</a></li></ul></li></ul>

      <form action="http://www.google.com/search" method="get" onSubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input name="q" type="hidden" />
          <input name="qfront" type="text" class="form-control" placeholder="Search" />
          <button type="submit" class="btn btn-default" value="Search">Search</button>
        </p>
      </form>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
        </header>

        <article class="container">
                <header>
                        <h1 class="entry-title">Amicable chains</h1>

                        <div class="entry-meta">
                                <span class="posted-on"><time class="entry-date" datetime="2014-05-23"><span class="year">2014</span> <span class="month">May</span> <span class="day">23</span></time></span>
                                <span class="tags"><ul class="tag-list list-inline"><li><a href="http://blog.jverkamp.com/category/programming/by-topic/data-structures/graphs">Graphs</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/mathematics">Mathematics</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-topic/number-theory">Number Theory</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/racket">Racket</a></li><li><a href="http://blog.jverkamp.com/category/programming/by-language/scheme">Scheme</a></li></ul></span>
                        </div>

                        <hr />
                </header>
                <div class="entry-content">
                        <p>Mathematicians are an odd bunch. Names for just about everyhing. There are <a href="https://en.wikipedia.org/wiki/amicable_numbers">Amicable number</a> and <a href="https://en.wikipedia.org/wiki/perfect_number">perfect number</a>, <a href="https://en.wikipedia.org/wiki/sociable_number">sociable number</a> and <a href="https://en.wikipedia.org/wiki/betrothed_numbers">Betrothed number</a>. There are <a href="https://en.wikipedia.org/wiki/sublime_number">sublime number</a>, <a href="https://en.wikipedia.org/wiki/frugal_number">frugal number</a>, and <a href="https://en.wikipedia.org/wiki/quasiperfect_number">quasiperfect number</a>. Heck, there are <a href="https://en.wikipedia.org/wiki/powerful_number">powerful number</a>, <a href="https://en.wikipedia.org/wiki/smooth_number">smooth number</a>, and even <a href="https://en.wikipedia.org/wiki/sphenic_numbers">Sphenic number</a>. Rather a lot to deal with all told... So let's just focus on two of them: <a href="https://en.wikipedia.org/wiki/perfect_numbers">Perfect number</a> and <a href="https://en.wikipedia.org/wiki/amicable_numbers">Amicable number</a>.</p>
<!--more-->
<p>The two are rather related, in that they're both defined in terms of their sum of proper divisors. Start with divisors: the set of numbers that evenly divide a given number. So say the divisors of 25 are 1, 5, and 25. Proper adds the constraint that a number is not a divisor of itself (so only 1 and 5). Sum them and you have <span>\( spd(25) = 6 \)</span>.</p>
<p>If <span>\( spd(n) = n \)</span>, a number is considered perfect. If <span>\( spd(n) = m \)</span> and <span>\( spd(m) = n \)</span>, the <span>\( m \)</span> and <span>\( n \)</span> are amicable. Simple<span class="footnote"><sup><a href="#footnote-1">[1]</a></sup></span> as that. The same context can be extended to a sequence:<div>$$ \mathbb{X} = \left \{ x_n | spd(x_n) = x_{n+1}  \right \} $$</div>So that's what we're dealing with today, given <a href="http://programmingpraxis.com/2014/05/20/amicable-chains/">Tuesday's post</a> on Programming Praxis. In a single sentence: find all perfect numbers, amicable pairs, and amicable chains less than one million.</p>
<p>Let's get started.</p>
<h2>Perfect numbers and amicable pairs</h2>
<p>First we need to write a function that can quickly calculate the <code>sum-of-divisors</code> of a number. We'll be using the <code><a href="http://docs.racket-lang.org/search/index.html?q=math/number-theory">math/number-theory</a></code> module to calculate divisors and <a href="http://pkg.racket-lang.org/#[memoize]">jbclements' <code>memoize</code> module</a> to save us a bit of time calculating a pile of these over and over again:</p>
<pre class="scheme"><code>(require math/number-theory
         memoize)

; Calculate sum of proper divisors (proper, thus subtracting i)
(define/memo (sum-of-divisors n)
  (- (apply + (divisors n)) n))</code></pre>
<p>Testing it out with the value we already know:</p>
<pre class="scheme"><code>&gt; (sum-of-divisors 25)
6</code></pre>
<p>From here and with the definitions above, we can directly define perfect numbers:</p>
<pre class="scheme"><code>; A number is perfect if its divisors sum to itself
(define (perfect? n)
  (= n (sum-of-divisors n)))</code></pre>
<p>And amicable pairs:</p>
<pre class="scheme"><code>; Two numbers are amicable if each numbers's sum of divisors is the other
(define (amicable? m n)
  (and (= m (sum-of-divisors n))
       (= n (sum-of-divisors m))))</code></pre>
<p>As an example:</p>
<pre class="scheme"><code>&gt; (perfect? 6)
#t
&gt; (perfect? 25) ; (spd 25) -&gt; 6
#f
&gt; (amicable? 25 6)
#f
&gt; (amicable? 220 284) ; (spd 220) -&gt; 284; (spd 284) -&gt; 220
#t</code></pre>
<p>Looks good. But how about we think a little bit bigger, eh?</p>
<h2>Amicable chains</h2>
<p>For the next part of the problem, we want to calculate <em>amicable chains</em>. Sequences of numbers of any length such that the sum of proper divisors of each number is the next and the chain wraps around at the end. On the smaller end, all perfect numbers are amicable chains of length 1. All amicable pairs are chains of length 2. One example amicable chain of length 5 would be <code>(12496 14264 14536 15472 14288)</code><span class="footnote"><sup><a href="#footnote-2">[2]</a></sup></span>.</p>
<p>Given all of that, we should be able to write a nice recursive function to determine if a number is in an amicable chain and, if so, return it. To do so, we're going to essentially need to recur down a chain of numbers until one of three/four conditions is met:</p>
<ol>
        <li>We find the original number in the sequence; return the amicable chain</li>
        <li>The chain terminates at 1 (any prime number will have 1 as the sum of divisors after which the chain will terminate)</li>
        <li>We find a number other than the original for the second time; there is a chain, but the number in question is not part of it (example 25 -> 6 which then loops)</li>
        <li><em>optional:</em> The current number is larger than some bound; it may be a chain, but for our purposes return <code>#f</code></li>
</ol>
<p>Translating this relatively directly into code, we have:</p>
<pre class="scheme"><code>; An amicable chain is a sequence of numbers where each's sum of divisors is the next
; Ignore chains that leave the given bounds
(define (amicable-chain n [bound +inf.0])
  (let/ec return
    (let loop ([x (sum-of-divisors n)] [prev '()])
      (cond
        [(= x n)
         (cons x prev)]
        [(or (&gt; x bound) (= x 1) (member x prev))
         (return #f)]
        [else
         (loop (sum-of-divisors x)
               (cons x prev))]))))</code></pre>
<p>As given earlier:</p>
<pre class="scheme"><code>&gt; (amicable-chain 12496)
'(12496 14264 14536 15472 14288)
&gt; (amicable-chain 15472)
'(15472 14288 12496 14264 14536)</code></pre>
<p>That gives us most of our framework. All that's left is extended it to a bunch of numbers at a time (and as a bonus: making a pretty picture).</p>
<h2>Generating a graph</h2>
<p>Basic idea: Iterate through all numbers 2 through some bound. For each in turn, if it's an amicable chain, add the numbers in the chain to a graph. Skip any number added as we iterate upwards.</p>
<pre class="scheme"><code>; Create a graph of all amicable chains within the bounds
(define (amicable-chains-graph bound)
  (define graph (unweighted-graph/directed '()))
  (define colors (make-hash))

  (for ([i (in-range 2 bound)] #:unless (has-vertex? graph i))
    (cond
      [(amicable-chain i bound)
       =&gt; (λ (chain)
            (displayln chain)
            (for ([from (in-list chain)]
                  [to (in-list (snoc (car chain) (cdr chain)))])
              (hash-set! colors from
                         (case (length chain)
                           [(1) 0] [(2) 1] [else 2]))
              (add-directed-edge! graph from to)))]))

  (values graph colors))</code></pre>
<p>That's actually all there is to it. One interesting trick is iterating over the list <code>chain</code> and <code>(snoc (car chain) (cdr chain))</code>. Basically, that's a sneaky way to iterate over all sequential numbers in the list. <code>snoc</code> is the reversed form of <code>cons</code>. Rather than adding to the head of a list, add to the end. It's terribly inefficient, but at the very least it serves our purposes.</p>
<p>With a helper wrapping the <code>graphviz</code> function to actually generate the files, and we can actually write out our results:</p>
<p><a href="http://blog.jverkamp.com/2014/05/23/amicable-chains/amicable-chains.png" data-toggle="lightbox"><img src="http://blog.jverkamp.com/2014/05/23/amicable-chains/amicable-chains.png" /></a></p>
<p>Looks like we have four perfect numbers (in red; 6, 28, 496, and 8128), a whole pile of amicable pairs, and two nice chains (the larger has almost 30 numbers). I'm actually a little surprised that such a large chain already appears under a million. It sort of makes me wonder just how large of chains there might be out there if you look further...</p>
<p>And that's it for today. As always, the code is on GitHub: <a href="https://github.com/jpverkamp/small-projects/blob/master/blog/amicable-chains.rkt">amicable-chain.rkt</a>. Enjoy!</p>
                </div>
                <div class="entry-footnotes">
                        <div id="footnotes"><ol><li><a name="footnote-1"></a>For some definitions of simple</li><li><a name="footnote-2"></a>Verification left as exercise to the reader</li></ol></div>
                </div>

                <div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "jverkamp";
var disqus_title = "Amicable chains";
var disqus_url = "http://blog.jverkamp.com/2014/05/23/amicable-chains/";
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>

        <footer class="container" role="contentinfo">
                <nav class="navbar navbar-default" role="navigation"><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2014/05/21/phone-networks">← Phone networks</a></li><li><a href="http://blog.jverkamp.com/category/archives">Archives</a></li><li><a href="http://blog.jverkamp.com/2014/05/28/quadtree-image-compression">Quadtree image compression →</a></li></ul><ul class="nav navbar-nav nav-justified"><li><a href="http://blog.jverkamp.com/2014/05/21/phone-networks">← Phone networks</a></li><li><a href="http://blog.jverkamp.com/category/programming">Programming</a></li><li><a href="http://blog.jverkamp.com/2014/05/28/quadtree-image-compression">Quadtree image compression →</a></li></ul></nav>

                <div class="legal">
                        <a href="http://blog.jverkamp.com/feed/atom.xml">feed <img style="border: 0;" src="http://blog.jverkamp.com/rss.png" /></a><br />
                        All posts unless otherwise mentioned are licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/80x15.png" /></a><br />
                        Any source code unless otherwise mentioned is licensed under the <a href="http://directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
                </div>
        </footer>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53688146-1', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>