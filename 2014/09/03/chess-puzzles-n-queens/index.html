<!DOCTYPE html>
<html>
<head>
    <title>
    Chess Puzzles: N Queens – jverkamp.com
</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css">

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />


    
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper">
        <header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
        
            
        
            
            <li><a href="https://blog.jverkamp.com/photography/">Photography</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/programming/">Programming</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/research/">Research</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/writing/">Writing</a></li>
            
        
            <li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>


        <div id="page-content-wrapper">
            <div id="page-content">
            
<article>
	<header>
		<h1 class="entry-title">Chess Puzzles: N Queens</h1>

        <div class="entry-meta">
            
            <span class="entry-date">2014-09-03</span>
            
            
        </div>

        <div class="entry-tags">
    
    

    <ul class="taxonomy-keys">
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/08/28/chess-puzzles-2-board/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/racket">Racket</a>
                        <a href="https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/08/28/chess-puzzles-2-board/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a>
                        <a href="https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/07/05/cracker-barrel-peg-game/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/backtracking">Backtracking</a>
                        <a href="https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/08/28/chess-puzzles-2-board/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/chess">Chess</a>
                        <a href="https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/08/28/chess-puzzles-2-board/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/series/chess-puzzles">Chess Puzzles</a>
                        <a href="https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    

    
        
        <li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2014/09/03/removing-large-files-from-git-history/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/" class="next-link">Next</a>
                
            </ul>
        </li>
        

        
        <li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2014/09/03/removing-large-files-from-git-history/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/" class="next-link">Next</a>
                
            </ul>
        </li>
        
    
    </ul>
</div>

    </header>

	<div class="entry-content">
		<p>After two weeks, it seems only right that we actually get around to a real chess puzzle. First on the list: <a href="https://en.wikipedia.org/wiki/the%20eight%20queens%20puzzle">Eight queens puzzle</a>.</p>


<figure >
    
        <img src="/embeds/2014/8-queens-solution.png" />
    
    
</figure>


<p>Specifically, how do you place n queens on an n by n chess board such that no pair of queens can attack one another?</p>

<p></p>

<p>Those of you paying attention may think this problem looks <a href="https://blog.jverkamp.com/2012/09/24/n-queens-in-18-lines-of-code/">awfully familiar</a>. Turns out I&rsquo;ve already done this one. But not with my new <a href="https://blog.jverkamp.com/2013/02/01/#1gam---chesslike-1.0---did-it/">chess library</a>! So let&rsquo;s do it again:</p>

<p>Basically, the idea is simple. Start in the first row and column, placing a queen:</p>


<figure >
    
        <img src="/embeds/2014/8-queens-step-1.png" />
    
    
</figure>


<p>Next, move down to the second row, first column:</p>

<p>
<figure >
    
        <img src="/embeds/2014/8-queens-step-2.png" />
    
    
</figure>


<figure >
    
        <img src="/embeds/2014/8-queens-step-3.png" />
    
    
</figure>


<figure >
    
        <img src="/embeds/2014/8-queens-step-4.png" />
    
    
</figure>
</p>

<p>We cannot place a queen there since it can attack the first. Try the second column &hellip; Still doesn&rsquo;t work, since it can attack diagonally. Try the third&hellip; Bam. Placed. Head down to the third row and start over in the first column.</p>


<figure >
    
        <img src="/embeds/2014/8-queens-step-5.png" />
    
    
</figure>


<p>Keep on keeping on. Eventually though, you&rsquo;ll run into a row when you can&rsquo;t place a queen. What do you do then?</p>

<a href="https://en.wikipedia.org/wiki/Backtrack!">Backtracking</a>

<p>Specifically, go back one row and remove that queen. Start over from one column to the right of where it was. If there&rsquo;s no where else to place that queen, back up another column, over and over until you finally find where you can place one.</p>

<p>Sounds crazy, keeping track of all that state (how many queens we&rsquo;ve removed and which), but this is where the magic of recursion comes in. We can actually use the call stack to handle all of this backtracking for us!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Try to place n queens on an nxn chessboard such that none are threatened</span>
(<span style="color:#66d9ef">define </span>(queens n)
  <span style="color:#75715e">; Create a new nxn board</span>
  (current-board-size n)
  (define-piece Queen (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;*</span>))
  (<span style="color:#66d9ef">define </span>b (make-board n <span style="color:#f92672">#</span>:pieces (hash <span style="color:#e6db74">&#39;Queen</span> Queen)))

  <span style="color:#75715e">; Try to place a queen in each row</span>
  (<span style="color:#66d9ef">let </span>place-queen ([board b] [x <span style="color:#ae81ff">0</span>] [y <span style="color:#ae81ff">0</span>])
    (cond
      <span style="color:#75715e">; Done with all of the rows, we have a valid configuration</span>
      [(&gt;= y n) board]
      <span style="color:#75715e">; Done with the current row, if we haven&#39;t placed a queen yet, bail out</span>
      [(&gt;= x n) <span style="color:#66d9ef">#f</span>]
      <span style="color:#75715e">; Otherwise, try to place the queen at this location</span>
      <span style="color:#75715e">; Use the row as the player ID so they can all attack one another</span>
      [else
       (<span style="color:#66d9ef">define </span>new-board (board-set board (pt x y) <span style="color:#f92672">`</span>(<span style="color:#f92672">,</span>y Queen)))
       (cond
         <span style="color:#75715e">; We attack a current queen, try the next square on the old board</span>
         [(for/first ([target-pt (moves-from new-board (pt x y))]
                      <span style="color:#f92672">#</span>:when (board-ref new-board target-pt))
            <span style="color:#66d9ef">#t</span>)
          (place-queen board (+ x <span style="color:#ae81ff">1</span>) y)]
         <span style="color:#75715e">; We do not attack anything (yet), try this solution</span>
         <span style="color:#75715e">; If that fails, fall through (or short circuits)</span>
         [else
          (<span style="color:#66d9ef">or </span>(place-queen new-board <span style="color:#ae81ff">0</span> (+ y <span style="color:#ae81ff">1</span>))
              (place-queen board     (+ x <span style="color:#ae81ff">1</span>) y))])])))</code></pre></div>
<p>The interesting parts of the solution are at the beginning (when we set up the intial board using our new library) and the <code><a href="http://docs.racket-lang.org/search/index.html?q=for/first">for/first</a></code>
 section. That&rsquo;s what&rsquo;s checking out attacks. In this case, <code>for/first</code> will return <code>#t</code> if any <code>#:when</code> is true, <code>#f</code> if none of them are. This works with our framework (as the code mentions) because we&rsquo;re setting each queen to a different player so they can all attack one another.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (render (queens <span style="color:#ae81ff">8</span>))</code></pre></div>

<figure >
    
        <img src="/embeds/2014/8-queens-solution.png" />
    
    
</figure>


<p>Nice!</p>

<p>Even bigger?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (render (queens <span style="color:#ae81ff">13</span>))</code></pre></div>

<figure >
    
        <img src="/embeds/2014/13-queens.png" />
    
    
</figure>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (render (queens <span style="color:#ae81ff">25</span>) <span style="color:#f92672">#</span>:tile-size <span style="color:#ae81ff">12</span>)</code></pre></div>

<figure >
    
        <img src="/embeds/2014/25-queens.png" />
    
    
</figure>


<p>(That one took a little while.)</p>

<p>Okay, so that&rsquo;s all well and good. But what if we don&rsquo;t want just one solution. What if we want all of them? Well, it turns out, that&rsquo;s actually not that much harder. We just need to slightly tweak how we recur. Instead of a board or <code>#f</code>, we need to return a list of possible solutions. That way we can <code>append</code> instead of <code>or</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Try to place n queens on an nxn chessboard such that none are threatened</span>
(<span style="color:#66d9ef">define </span>(queens n <span style="color:#f92672">#</span>:all? [generate-all? <span style="color:#66d9ef">#f</span>])
  <span style="color:#f92672">...</span>

      <span style="color:#75715e">; Done with all of the rows, we have a valid configuration</span>
      [(&gt;= y n) (<span style="color:#66d9ef">if </span>generate-all? (list board) board)]
      <span style="color:#75715e">; Done with the current row, if we haven&#39;t placed a queen yet, bail out</span>
      [(&gt;= x n) (<span style="color:#66d9ef">if </span>generate-all? (list)       <span style="color:#66d9ef">#f</span>)]

      <span style="color:#f92672">...</span>

         <span style="color:#75715e">; We do not attack anything (yet), try this solution</span>
         <span style="color:#75715e">; If that fails, fall through (or short circuits)</span>
         <span style="color:#75715e">; If we&#39;re generating all solutions, do both</span>
         <span style="color:#75715e">; (we cannot do ((if generate-all? append or) ...) because or is a macro</span>
         [generate-all?
          (append (place-queen new-board <span style="color:#ae81ff">0</span> (+ y <span style="color:#ae81ff">1</span>))
                  (place-queen board     (+ x <span style="color:#ae81ff">1</span>) y))]

         <span style="color:#f92672">...</span>)</code></pre></div>
<p>That way, we could get all of the 6x6 solutions in one go:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (map (λ (b) (render b <span style="color:#f92672">#</span>:player-colors (const <span style="color:#e6db74">&#34;black&#34;</span>)))
       (queens <span style="color:#ae81ff">6</span> <span style="color:#f92672">#</span>:all? <span style="color:#66d9ef">#t</span>))</code></pre></div>
<p>
<figure >
    
        <img src="/embeds/2014/6-queens-1.png" />
    
    
</figure>
 
<figure >
    
        <img src="/embeds/2014/6-queens-2.png" />
    
    
</figure>
 
<figure >
    
        <img src="/embeds/2014/6-queens-3.png" />
    
    
</figure>
 
<figure >
    
        <img src="/embeds/2014/6-queens-4.png" />
    
    
</figure>
</p>

<p>Or determine how many queens that there are for each puzzle size:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (for/list ([n (in-range <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">11</span>)])
    (list n (length (queens n <span style="color:#f92672">#</span>:all? <span style="color:#66d9ef">#t</span>))))
<span style="color:#f92672">&#39;</span>((<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">4</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">5</span> <span style="color:#ae81ff">10</span>) (<span style="color:#ae81ff">6</span> <span style="color:#ae81ff">4</span>) (<span style="color:#ae81ff">7</span> <span style="color:#ae81ff">40</span>) (<span style="color:#ae81ff">8</span> <span style="color:#ae81ff">92</span>) (<span style="color:#ae81ff">9</span> <span style="color:#ae81ff">352</span>) (<span style="color:#ae81ff">10</span> <span style="color:#ae81ff">724</span>))</code></pre></div>
<p>That matches up perfectly with sequence <a href="https://oeis.org/A000170">A000170</a> on <a href="https://en.wikipedia.org/wiki/OEIS">OEIS</a>, which must mean we&rsquo;re doing something right. Shiny!</p>

<p>One final trick, what if we want to animate these things? Well, for that we&rsquo;re going to use the <code><a href="http://docs.racket-lang.org/search/index.html?q=racket/generator">racket/generator</a></code>
 module. I&rsquo;ve used it before, and although the performance isn&rsquo;t <em>great</em>, it&rsquo;s certainly the easiest way to get what we want. Really, we only need two changes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Try to place n queens on an nxn chessboard such that none are threatened</span>
(require racket/generator)
(<span style="color:#66d9ef">define </span>(queens-generator n <span style="color:#f92672">#</span>:all? [generate-all? <span style="color:#66d9ef">#f</span>])
  (generator ()
    <span style="color:#f92672">...</span>

    <span style="color:#75715e">; Try to place a queen in each row</span>
    (<span style="color:#66d9ef">let </span>place-queen ([board b] [x <span style="color:#ae81ff">0</span>] [y <span style="color:#ae81ff">0</span>])
      (yield board x y)
      (cond
        <span style="color:#f92672">...</span></code></pre></div>
<p>That way, if we create a generator and keep calling it, it will return each board state including the backtracking. It&rsquo;s a little more complicated to turn it into a nice animation, once again using the excellent <code><a href="http://docs.racket-lang.org/search/index.html?q=big-bang">big-bang</a></code>
 function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Use the queens generator to render an n-queens problem</span>
(require <span style="color:#ae81ff">2</span>htdp/image <span style="color:#ae81ff">2</span>htdp/universe)
(<span style="color:#66d9ef">define </span>(queens-animate n <span style="color:#f92672">#</span>:all? [generate-all? <span style="color:#66d9ef">#f</span>])
  (<span style="color:#66d9ef">define </span>g (queens-generator n <span style="color:#f92672">#</span>:all? generate-all?))

  (define-values (last-board last-x last-y) (g))
  (<span style="color:#66d9ef">define </span>done? <span style="color:#66d9ef">#f</span>)

  (<span style="color:#66d9ef">define </span>r (render last-board <span style="color:#f92672">#</span>:player-colors (const <span style="color:#e6db74">&#34;black&#34;</span>)))
  (<span style="color:#66d9ef">define </span>w (send r get-width))
  (<span style="color:#66d9ef">define </span>h (send r get-height))

  (big-bang (void)
    [stop-when (λ (_) done?)]
    [on-tick
     (λ (_)
       (with-handlers ([exn? (thunk* (<span style="color:#66d9ef">set! </span>done? <span style="color:#66d9ef">#t</span>))])
         (define-values (board x y) (g))
         (<span style="color:#66d9ef">set! </span>last-board board)
         (<span style="color:#66d9ef">set! </span>last-x x)
         (<span style="color:#66d9ef">set! </span>last-y y)))]
    [to-draw
     (λ (_)
       (place-image
        (render last-board
                <span style="color:#f92672">#</span>:player-colors (const <span style="color:#e6db74">&#34;black&#34;</span>)
                <span style="color:#f92672">#</span>:highlights (hash (pt last-x last-y) <span style="color:#e6db74">&#34;green&#34;</span>))
        (/ w <span style="color:#ae81ff">2</span>)
        (/ h <span style="color:#ae81ff">2</span>)
        (empty-scene w h)))]
    [record? <span style="color:#66d9ef">#t</span>]))</code></pre></div>
<p>The <code><a href="http://docs.racket-lang.org/search/index.html?q=with-handlers">with-handlers</a></code>
 is a little ugly, but it&rsquo;s designed to deal with the fact that we don&rsquo;t return multiple values on the last call, since generators by default return the last (return) value of a function at the end. But if we wanted to make that return x and y as well, things might just get ugly, seeing as how we&rsquo;d have to change all of the recursive calls. No thank you.</p>

<p>It&rsquo;s certainly pretty to watch though:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (queens-animate <span style="color:#ae81ff">4</span>)</code></pre></div>

<figure >
    
        <img src="/embeds/2014/8-queens.gif" />
    
    
</figure>


<p>You can see the backtracking anytime the green box jumps back and suddenly one or more of the previously place queens vanishes. It would be even neater if it could show the branching solutions, but that&rsquo;s a challenge for another day.</p>

<p>And that&rsquo;s it. A bit more in detail than <a href="https://blog.jverkamp.com/2012/09/24/n-queens-in-18-lines-of-code/">last time</a>, but I think it was a lot of fun. The code is available in my <a href="https://github.com/jpverkamp/chess-puzzles">chess-puzzles</a> repo on GitHub: <a href="https://github.com/jpverkamp/chess-puzzles/blob/master/puzzles/queens.rkt">queens.rkt</a>. Check it out!</p>
	</div>

    
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Chess Puzzles: N Queens";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2014\/09\/03\/chess-puzzles-n-queens\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>


</article>

            </div>
        </div>

        <footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>

            
            <li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>
            
        </ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js"></script>

<script type="text/javascript" src="/custom.js" defer></script>

</body>
</html>
