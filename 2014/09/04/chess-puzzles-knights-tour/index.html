<!doctype html><html><head><title>Chess Puzzles: Knight's Tour – jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/auto-render_2152414756166376840.min.45ae2f6b03d0c7b867df0a6cb7d43215ec78369998685a5748c5b12f502321f2.js integrity="sha256-Ra4vawPQx7hn3wpst9QyFex4NpmYaFpXSMWxL1AjIfI=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.7a29c6e86e28b6da48d6e8a526f4fa597dfba1464ca3f975ea9e0fb8c00052b7.css integrity="sha256-einG6G4ottpI1uilJvT6WX37oUZMo/l16p4PuMAAUrc="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Chess Puzzles: Knight's Tour</h1><div class=entry-meta><span class=entry-date>2014-09-04</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2014/09/14/procedural-invaders/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2014/09/14/procedural-invaders/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/backtracking>Backtracking</a><a href=https://blog.jverkamp.com/2014/10/28/tile-puzzle/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/chess>Chess</a></li><li><a href=https://blog.jverkamp.com/2014/07/05/cracker-barrel-peg-game/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/heuristics>Heuristics</a><a href=https://blog.jverkamp.com/2015/10/29/takuzu-solver/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/ class=previous-link></a><a class=taxonomy-value href=/series/chess-puzzles>Chess Puzzles</a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/09/14/procedural-invaders/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/09/14/procedural-invaders/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Onwards and upwards! For today&rsquo;s chess puzzle, let&rsquo;s take a first crack at the <a href=https://en.wikipedia.org/wiki/Knight%27s%20Tour>Knight's Tour</a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><figure><img src=/embeds/2014/tour-5-solution.gif></figure><p>As with <a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/>N Queens</a>, the problem is simply stated:</p><blockquote><p>A knight&rsquo;s tour is a sequence of moves of a knight on a chessboard such that the knight visits every square only once.</p></blockquote><p>And once again, we can get a solution working relatively well using <a href=https://en.wikipedia.org/wiki/backtracking>backtracking</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>define-piece</span> Knight (<span style=color:#a6e22e>move</span> <span style=color:#ae81ff>1</span> (<span style=color:#a6e22e>leaper</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>define-piece</span> Visited <span style=color:#f92672>&#39;</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Solve a knights tour on a given board</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>knights-tour</span> width [height width])
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Create a new empty board</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>b (<span style=color:#a6e22e>make-board</span> width height <span style=color:#f92672>#</span>:pieces (list Knight Visited)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; A board is completed if there are no empty squares</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; All squares are either the Knight or Visited</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>completed?</span> b)
</span></span><span style=display:flex><span>    (not (<span style=color:#a6e22e>for*/first</span> ([x (<span style=color:#a6e22e>in-range</span> width)]
</span></span><span style=display:flex><span>                      [y (<span style=color:#a6e22e>in-range</span> height)]
</span></span><span style=display:flex><span>                      <span style=color:#f92672>#</span>:when (not (<span style=color:#a6e22e>board-ref</span> b (<span style=color:#a6e22e>pt</span> x y))))
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>#t</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Move the knight from the given point to each possible next point in turn</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Return a list of valid moves to finish the tour if such a list exists, #f otherwise</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>move-knight</span> b p)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; Done, we have a tour and there are no more valid moves necessary</span>
</span></span><span style=display:flex><span>      [(<span style=color:#a6e22e>completed?</span> b) <span style=color:#f92672>&#39;</span>()]
</span></span><span style=display:flex><span>      <span style=color:#75715e>; Otherwise, try all possible moves from this point</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; Since all pieces are the same color, moves from is only empty tiles</span>
</span></span><span style=display:flex><span>      [else
</span></span><span style=display:flex><span>       (<span style=color:#a6e22e>for*/first</span> ([next (<span style=color:#a6e22e>in-list</span> (<span style=color:#a6e22e>moves-from</span> b p))]
</span></span><span style=display:flex><span>                    [recur (<span style=color:#a6e22e>in-value</span> (<span style=color:#66d9ef>let* </span>([b (<span style=color:#a6e22e>board-move</span> b p next)]
</span></span><span style=display:flex><span>                                            [b (<span style=color:#a6e22e>board-set</span> b p <span style=color:#f92672>&#39;</span>(Black Visited))])
</span></span><span style=display:flex><span>                                       (<span style=color:#a6e22e>move-knight</span> b next)))]
</span></span><span style=display:flex><span>                    <span style=color:#f92672>#</span>:when recur)
</span></span><span style=display:flex><span>         (cons p recur))]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Try each possible initial location until we find one that works</span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>for*/first</span> ([x (<span style=color:#a6e22e>in-range</span> width)]
</span></span><span style=display:flex><span>               [y (<span style=color:#a6e22e>in-range</span> height)]
</span></span><span style=display:flex><span>               [solution (<span style=color:#a6e22e>in-value</span>
</span></span><span style=display:flex><span>                           (<span style=color:#a6e22e>move-knight</span>
</span></span><span style=display:flex><span>                             (<span style=color:#a6e22e>board-set</span> b (<span style=color:#a6e22e>pt</span> x y) <span style=color:#f92672>&#39;</span>(Black Knight))
</span></span><span style=display:flex><span>                             (<span style=color:#a6e22e>pt</span> x y)))]
</span></span><span style=display:flex><span>               <span style=color:#f92672>#</span>:when solution)
</span></span><span style=display:flex><span>    solution))
</span></span></code></pre></div><p>Basically, there are three interesting pieces here: <code>completed?</code>, <code>move-knight</code>, and the <code>for*/first</code> initial loop.</p><p>First, how can a tour be <code>completed?</code> If all of the locations on the board are filled. We get around this with the psuedo-piece: <code>Visited</code>. It fills up the board as we continue to move our knight around. Technically, I could have just filled the board with knights, but I like how visited lets us visualize things.</p><p>Next, <code>move-knight</code>. This is the core of the algorithm. As it states, we are building up a list of moves recursively. So the base case (when the board is completed) return the empty list <code>'()</code>. Otherwise, we&rsquo;re going to use <code><a href="http://docs.racket-lang.org/search/index.html?q=for*/first">for*/first</a></code>
to find the first move which recursively solves the problem (or <code>#f</code> if none does). The use of <code><a href="http://docs.racket-lang.org/search/index.html?q=in-value">in-value</a></code>
is a trick I picked up <a href=https://groups.google.com/forum/#!topic/racket-users/p2S6F3FAiU0>from the mailing list</a> for using an &rsquo;expensive&rsquo; value in a <code>#:when</code> clause and body without having to recalculate it.</p><p>Finally, we loop across all of the starting states. It doesn&rsquo;t matter in the case of closed tours (where the start and end points match and thus any point can be a start point), but on some boards not every starting location is valid.</p><p>So now we can solve a tour:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>knights-tour</span> <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>list</span>
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>4</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>2</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>4</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>2</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>4</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>3</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>4</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>3</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span> (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>3</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>1</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>2</span>))
</span></span></code></pre></div><p>Whee! Okay, what does that actually look like? Let&rsquo;s animate it!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>current-glyphs</span> (<span style=color:#a6e22e>hash</span> <span style=color:#e6db74>&#39;Knight</span> <span style=color:#e6db74>&#34;♞&#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;Visited</span> <span style=color:#e6db74>&#34;♘&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Render a knights tour into an animation</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>knights-tour/animate-solution</span> width [height width])
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>tour (<span style=color:#a6e22e>knights-tour</span> width height)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Create an initial board</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>board (<span style=color:#a6e22e>make-board</span> width height <span style=color:#f92672>#</span>:pieces (list Knight Visited)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Prerender the board once so we know how large of a scene to create</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>r (<span style=color:#a6e22e>render</span> board <span style=color:#f92672>#</span>:player-colors (<span style=color:#a6e22e>const</span> <span style=color:#e6db74>&#34;black&#34;</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>render-width (<span style=color:#a6e22e>send</span> r get-width))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>render-height (<span style=color:#a6e22e>send</span> r get-height))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Animate the tour, rendering each frame once</span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>big-bang</span> tour
</span></span><span style=display:flex><span>    [on-tick cdr]
</span></span><span style=display:flex><span>    [to-draw (<span style=color:#a6e22e>λ</span> (<span style=color:#a6e22e>tour</span>)
</span></span><span style=display:flex><span>               (<span style=color:#a6e22e>place-image</span>
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>render</span> (<span style=color:#66d9ef>if </span>(null? tour)
</span></span><span style=display:flex><span>                            board
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>board-set</span> board (car tour) <span style=color:#f92672>&#39;</span>(Black Knight))))
</span></span><span style=display:flex><span>                (/ render-width <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>                (/ render-height <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>                (<span style=color:#a6e22e>empty-scene</span> render-width render-height)))]
</span></span><span style=display:flex><span>    [stop-when null?]
</span></span><span style=display:flex><span>    [record? <span style=color:#66d9ef>#t</span>]))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>knights-tour/animate-solution</span> <span style=color:#ae81ff>5</span>)
</span></span></code></pre></div><figure><img src=/embeds/2014/tour-5-solution.gif></figure><p>Shiny.</p><p>Okay, so that&rsquo;s all well and good for normal boards. What if instead you want a board with holes in it / a non-regular board?</p><p>Simple! We&rsquo;ll just add a third type of piece <code>Invalid</code> and pre-populate the board with those:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#a6e22e>current-glyphs</span> (<span style=color:#a6e22e>hash</span> <span style=color:#e6db74>&#39;Knight</span> <span style=color:#e6db74>&#34;♞&#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;Invalid</span> <span style=color:#e6db74>&#34;✗&#34;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;Visited</span> <span style=color:#e6db74>&#34;♘&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>define-piece</span> Knight (<span style=color:#a6e22e>move</span> <span style=color:#ae81ff>1</span> (<span style=color:#a6e22e>leaper</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>define-piece</span> Invalid <span style=color:#f92672>&#39;</span>())
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>define-piece</span> Visited <span style=color:#f92672>&#39;</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Solve a knights tour on a given board (optionally with some pieces removed)</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>knights-tour</span> width [height width] <span style=color:#f92672>#</span>:removed [removed <span style=color:#f92672>&#39;</span>()])
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Create a new board (potentially removing some pieces)</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>b
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>for/fold</span> ([b (<span style=color:#a6e22e>make-board</span> width height
</span></span><span style=display:flex><span>                    <span style=color:#f92672>#</span>:pieces (list Knight Invalid Visited))])
</span></span><span style=display:flex><span>              ([p (<span style=color:#a6e22e>in-list</span> removed)])
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>board-set</span> b p <span style=color:#f92672>&#39;</span>(Black Invalid))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>)
</span></span></code></pre></div><p>All the rest of the code stays the same. Pretty nice eh? Let&rsquo;s try an example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>knights-tour/animate-solution</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>#</span>:removed (list (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>2</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>3</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>3</span>)))
</span></span></code></pre></div><figure><img src=/embeds/2014/tour-4-limited-solution.gif></figure><p>Hmm, that&rsquo;s all well and code showing off the final tour. But what if we want to see the search in progress? Let&rsquo;s put in a <code><a href="http://docs.racket-lang.org/search/index.html?q=generator">generator</a></code>
again so we can animate this. This time around though, I&rsquo;m actually going to fold the generator code into the main method rather than duplicating a bunch of code.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>knights-tour</span> width [height width] <span style=color:#f92672>#</span>:generator? [generator? <span style=color:#66d9ef>#f</span>])
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>g
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>generator</span> ()
</span></span><span style=display:flex><span>      <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>move-knight</span> b p)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>when</span> generator?
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>yield</span> b p))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>...</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if </span>generator? g (<span style=color:#a6e22e>g</span>)))
</span></span></code></pre></div><p>In this case, we create the <code>generator</code> no matter what. But we only call <code>yield</code> if we actually specify it to the function. This way we can see each step of our simultion as we go. If we don&rsquo;t want the generator, we immediately call it as we&rsquo;re returning, forcing it to return a value: the implicit <code>yield</code> at the end of the function.</p><p>So with this, we have enough that we can animate the search space:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Render the search for a knights tour into an animation</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>knights-tour/animate-search</span> width [height width] <span style=color:#f92672>#</span>:removed [removed <span style=color:#f92672>&#39;</span>()])
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Create an initial board including the missing tiles</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>board
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>for/fold</span> ([b (<span style=color:#a6e22e>make-board</span> width height <span style=color:#f92672>#</span>:pieces (list Knight Invalid Visited))])
</span></span><span style=display:flex><span>              ([p (<span style=color:#a6e22e>in-list</span> removed)])
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>board-set</span> b p <span style=color:#f92672>&#39;</span>(Black Invalid))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Prerender the board once so we know how large of a scene to create</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>r (<span style=color:#a6e22e>render</span> board <span style=color:#f92672>#</span>:player-colors (<span style=color:#a6e22e>const</span> <span style=color:#e6db74>&#34;black&#34;</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>render-width (<span style=color:#a6e22e>send</span> r get-width))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>render-height (<span style=color:#a6e22e>send</span> r get-height))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Set the last board, which will be updated on each yield</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>last-board board)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>last-point (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>g (<span style=color:#a6e22e>knights-tour</span> width height <span style=color:#f92672>#</span>:removed removed <span style=color:#f92672>#</span>:generator? <span style=color:#66d9ef>#t</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Animate the tour, rendering each frame once</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Stop when the generator returns 1 value</span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>big-bang</span> <span style=color:#66d9ef>#t</span>
</span></span><span style=display:flex><span>    [on-tick
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>λ</span> (<span style=color:#a6e22e>running?</span>)
</span></span><span style=display:flex><span>       (<span style=color:#66d9ef>and </span>running?
</span></span><span style=display:flex><span>            (<span style=color:#a6e22e>with-handlers</span> ([exn? (<span style=color:#a6e22e>const</span> <span style=color:#66d9ef>#f</span>)])
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>define-values</span> (<span style=color:#a6e22e>board</span> point) (<span style=color:#a6e22e>g</span>))
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>set! </span>last-board board)
</span></span><span style=display:flex><span>              (<span style=color:#66d9ef>set! </span>last-point point)
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>#t</span>)))]
</span></span><span style=display:flex><span>    [to-draw
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>λ</span> (<span style=color:#a6e22e>_</span>)
</span></span><span style=display:flex><span>       (<span style=color:#a6e22e>place-image</span>
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>render</span> last-board)
</span></span><span style=display:flex><span>        (/ render-width <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        (/ render-height <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>empty-scene</span> render-width render-height)))]
</span></span><span style=display:flex><span>    [stop-when (<span style=color:#a6e22e>negate</span> identity)]
</span></span><span style=display:flex><span>    [record? <span style=color:#66d9ef>#t</span>]))
</span></span></code></pre></div><p>And in action:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>knights-tour/animate-search</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>#</span>:removed (list (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>0</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>2</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>3</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span>) (<span style=color:#a6e22e>pt</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>3</span>)))
</span></span></code></pre></div><figure><img src=/embeds/2014/tour-4-limited-search.gif></figure><p>Sweet!</p><p>That&rsquo;s about all for today. If you were following along though, you might have noticed one very important omission&mldr;</p><p>It doesn&rsquo;t work on 8x8 boards.</p><p>Well, that&rsquo;s not strictly speaking true. It will work. If you wait long enough, you will eventually get a solution, but it&rsquo;s going to be a <em>very</em> long wait. So looks like we&rsquo;ll need a follow looking for a better solution<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><p>That&rsquo;s for another time though. If you&rsquo;d like to see the entire code, you can do so in the <a href=https://github.com/jpverkamp/chess-puzzles>chess-puzzles</a> repo on GitHub: <a href=https://github.com/jpverkamp/chess-puzzles/blob/master/puzzles/knights-tour.rkt>knights-tour.rkt</a>. Check it out!</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Backtracking is wicked slow on this one, we&rsquo;re going to have to solve it twice.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Perhaps one using <a href=https://en.wikipedia.org/wiki/neural%20networks>neural networks</a>? Been a while since I&rsquo;ve worked with those&mldr;&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>