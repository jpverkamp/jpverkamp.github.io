<!doctype html><html><head><title>Procedural Invaders â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/auto-render_2152414756166376840.min.45ae2f6b03d0c7b867df0a6cb7d43215ec78369998685a5748c5b12f502321f2.js integrity="sha256-Ra4vawPQx7hn3wpst9QyFex4NpmYaFpXSMWxL1AjIfI=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.d99288811f82c16d031e4f6c01e50e18aeccbb9968db7c625a21660aef059ef5.css integrity="sha256-2ZKIgR+CwW0DHk9sAeUOGK7Mu5lo23xiWiFmCu8FnvU="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Procedural Invaders</h1><div class=entry-meta><span class=entry-date>2014-09-14</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2014/09/15/look-and-say/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2014/09/15/look-and-say/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/08/24/sandbox-battle/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/games>Games</a><a href=https://blog.jverkamp.com/2014/09/16/fractal-invaders/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/05/30/braille-unicode-pixelation/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/graphics>Graphics</a><a href=https://blog.jverkamp.com/2014/09/16/fractal-invaders/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/08/07/langtons-ant/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/procedural-content>Procedural Content</a><a href=https://blog.jverkamp.com/2014/09/16/fractal-invaders/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/09/15/look-and-say/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/09/15/look-and-say/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>Today&rsquo;s post comes from a long line of &lsquo;inspired by posts&rsquo; all pretty much leading back (so far as I can tell) to this post by j.tarbell: <a href=http://www.complexification.net/gallery/machines/invaderfractal/>invader.procedural</a> from 2003.</p><p>The basic idea is that we want to generate &lsquo;invaders&rsquo; in the style of <a href=https://en.wikipedia.org/wiki/space%20invaders>space invaders</a>. Except we don&rsquo;t want 10 or 20, we want tens of thousands. So how do we do it? Well, take a look at this:</p><figure><img src=/embeds/2014/procedural-invader-big.png></figure><p>Despite the fact that it&rsquo;s scaled up, on the lowest level we actually have a 5x5 grid of pixels. In addition, it&rsquo;s mirrored to make it symmetrical, so (counting the non-mirrored center row), we actually only have 15 pixels:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>+----+----+----+----+----+
</span></span><span style=display:flex><span>|  1 |  6 | 11 |  6 |  1 |
</span></span><span style=display:flex><span>+----+----+----+----+----+
</span></span><span style=display:flex><span>|  2 |  7 | 12 |  7 |  2 |
</span></span><span style=display:flex><span>+----+----+----+----+----+
</span></span><span style=display:flex><span>|  3 |  8 | 13 |  8 |  3 |
</span></span><span style=display:flex><span>+----+----+----+----+----+
</span></span><span style=display:flex><span>|  4 |  9 | 14 |  9 |  4 |
</span></span><span style=display:flex><span>+----+----+----+----+----+
</span></span><span style=display:flex><span>|  5 | 10 | 15 | 10 |  5 |
</span></span><span style=display:flex><span>+----+----+----+----+----+
</span></span></code></pre></div><p>Represent those 15 pixels as a 15 bit number. For example, the above image, we have bits 2, 4, 6, 7, 8, 10, 13, and 15 set, so we have the number:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; <span style=color:#f92672>#</span>b010101110100101
</span></span><span style=display:flex><span><span style=color:#ae81ff>11173</span>
</span></span></code></pre></div><p>Given that there are over 32 thousand 15 bit numbers (<span class=latex-inline>2^{15</span>
=@(expt 2 15)}), that&rsquo;s a lot of invaders. So how do we generate them?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Create a symmetric 5x5 image similar to a space invader with this bit pattern</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; 0 5 10 5 0</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; 1 6 11 6 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; 2 7 12 7 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; 3 8 13 8 3</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; 4 9 14 9 4</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>procedural-invader</span> i)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>bits
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>for/vector</span> ([c (<span style=color:#a6e22e>in-string</span> (<span style=color:#a6e22e>~a</span> (number-&gt;string i <span style=color:#ae81ff>2</span>) <span style=color:#f92672>#</span>:width <span style=color:#ae81ff>15</span> <span style=color:#f92672>#</span>:pad-string <span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#f92672>#</span>:align <span style=color:#e6db74>&#39;right</span>))])
</span></span><span style=display:flex><span>      (eq? c <span style=color:#e6db74>#\1</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>build-flomap*</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>   (<span style=color:#a6e22e>Î»</span> (<span style=color:#a6e22e>x</span> y)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>define </span>i (+ y (* <span style=color:#ae81ff>5</span> (<span style=color:#66d9ef>if </span>(&lt; x <span style=color:#ae81ff>3</span>) x (- <span style=color:#ae81ff>4</span> x)))))
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>if </span>(vector-ref bits i) <span style=color:#f92672>&#39;#</span>(<span style=color:#ae81ff>1.0</span>) <span style=color:#f92672>&#39;#</span>(<span style=color:#ae81ff>0.0</span>)))))
</span></span></code></pre></div><p>There are really two parts here. First we covert the given integer into a vector of <code>#t</code> / <code>#f</code>. There are certainly far faster ways to do this (<code>bitwise-and</code> with the correct bit for example), but given that the size is set and small, this is good enough for the time being.</p><p>After that, we take those bits and use <code><a href="http://docs.racket-lang.org/search/index.html?q=build-flomap*">build-flomap*</a></code>
to create a 5x5 image where <code>#t</code> is white and <code>#f</code> is black. Shiny. Now unfortunately Dr. Racket will not display flomaps directly inline, but if we convert them to bitmaps it will:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>flomap-&gt;bitmap</span> (<span style=color:#a6e22e>procedural-invader</span> <span style=color:#ae81ff>11173</span>))
</span></span></code></pre></div><figure><img src=/embeds/2014/procedural-invader-tiny.png></figure><p>Oof. Tiny. Let&rsquo;s make it bigger:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>flomap-&gt;bitmap</span> (<span style=color:#a6e22e>flomap-resize</span> (<span style=color:#a6e22e>procedural-invader</span> <span style=color:#ae81ff>11173</span>) <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>50</span>))
</span></span></code></pre></div><figure><img src=/embeds/2014/procedural-invader-big-blurry.png></figure><p>Well that&rsquo;s not what I was looking for. The problem is that flomaps by default are designed for interpolated values. So that if you have a black pixel right next to a white pixel, you can actually ask for the &lsquo;pixel&rsquo; halfway between the two, getting a gray value. But in this case, that&rsquo;s not what we want. We want sharp (<a href=https://en.wikipedia.org/wiki/nearest%20neighbor>nearest neighbor</a>) scaling:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Resize a flomap using nearest-neighbors to preserve sharp edges</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>flomap-resize/nn</span> img new-width [new-height new-width])
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>match-define</span> (<span style=color:#a6e22e>flomap</span> _ components old-width old-height) img)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>build-flomap*</span>
</span></span><span style=display:flex><span>   components new-width new-height
</span></span><span style=display:flex><span>   (<span style=color:#a6e22e>Î»</span> (<span style=color:#a6e22e>new-x</span> new-y)
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>flomap-ref*</span> img
</span></span><span style=display:flex><span>                  (floor (* old-width (/ new-x new-width)))
</span></span><span style=display:flex><span>                  (floor (* old-height (/ new-y new-height)))))))
</span></span></code></pre></div><p>Same as before, we are creating a new image. But this time, we covert the old coordinate system to the new and throw away any of the decimal part, getting an exact answer. That way we never interpolate:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>flomap-&gt;bitmap</span> (<span style=color:#a6e22e>flomap-resize/nn</span> (<span style=color:#a6e22e>procedural-invader</span> <span style=color:#ae81ff>11173</span>) <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>50</span>))
</span></span></code></pre></div><figure><img src=/embeds/2014/procedural-invader-big.png></figure><p>Nice and sharp. That&rsquo;s exactly what we were looking for.</p><p>For the base of the problem, that&rsquo;s pretty much it. But we&rsquo;re not quite done. What if we want to make a nice display mode so that we can see a bunch of them at once?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Generate a demo shee\t of procedural invaders</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>demo</span> [rows <span style=color:#ae81ff>5</span>] [cols rows] <span style=color:#f92672>#</span>:image-size [image-size <span style=color:#ae81ff>20</span>] <span style=color:#f92672>#</span>:margins [margins <span style=color:#ae81ff>5</span>])
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>images
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>for/list</span> ([row (<span style=color:#a6e22e>in-range</span> rows)])
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>for/list</span> ([col (<span style=color:#a6e22e>in-range</span> cols)])
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>define </span>r (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>32768</span>))
</span></span><span style=display:flex><span>        (<span style=color:#66d9ef>define </span>img (<span style=color:#a6e22e>procedural-invader</span> r))
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>flomap-&gt;bitmap</span> (<span style=color:#a6e22e>flomap-add-margin</span> (<span style=color:#a6e22e>flomap-resize/nn</span> img image-size) margins)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>    [(<span style=color:#66d9ef>and </span>(= rows <span style=color:#ae81ff>1</span>) (= cols <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>     (caar images)]
</span></span><span style=display:flex><span>    [(= rows <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>     (car (map (<span style=color:#a6e22e>curry</span> apply beside) images))]
</span></span><span style=display:flex><span>    [(= cols <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>     (apply above (map car images))]
</span></span><span style=display:flex><span>    [else
</span></span><span style=display:flex><span>     (apply above (map (<span style=color:#a6e22e>curry</span> apply beside) images))]))
</span></span></code></pre></div><p>That way we can make nice mixed sheets of the things:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>demo</span>)
</span></span></code></pre></div><figure><img src=/embeds/2014/procedural-invaders.png></figure><p>Or even giant sheets:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>demo</span> <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>80</span> <span style=color:#f92672>#</span>:image-size <span style=color:#ae81ff>5</span> <span style=color:#f92672>#</span>:margins <span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><figure><img src=/embeds/2014/procedural-invaders-80x40.png></figure><p>Pop quiz: Find two identical invaders. What is the likelihood of that happening? Well using the same math as in <a href=https://blog.jverkamp.com/2012/10/01/the-birthday-paradox/>The Birthday Paradox</a>, the chance of no duplicates is:</p><div class=latex-block>B(n, x) = 1 - \prod_{i=1}^{(n-1)}(1-\frac{i}{x})</div><p>Where <span class=latex-inline>n</span>
is the number of generated invaders and <span class=latex-inline>x = 15^{2</span>
= 32768} is the total number of possible invaders.</p><p>Specifically, for the 5x5 case:</p><div class=latex-block>B(25, 32768)
= 1 - \prod_{i=1}^{(25-1)}(1-\frac{i}{32768})
\approx 9.1\%</div><p>And for the 80x40 case:</p><div class=latex-block>B(3200, 32768)
= 1 - \prod_{i=1}^{(3200-1)}(1-\frac{i}{32768})
\approx 100\%</div><p>So it&rsquo;s (almost certainly) there&mldr; you just have to find it. ðŸ˜„</p><p>Okay, what else can we do with these things? Well, at the moment, they&rsquo;re a little bit bland. Let&rsquo;s add a few bits to the generation and spice them up a bit with highlights. Specifically, let&rsquo;s choose one of the 15 bits to be red instead of black or white. In order to do that (choose 1 of 15), we need 4 bits (with one left over). SOmething like this should work:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Create a procedural invader as above, but highlight the point specified by four highest bits</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>procedural-invader/highlight</span> i)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>highlight (<span style=color:#a6e22e>bitwise-and</span> i <span style=color:#f92672>#</span>b1111))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>img-w/o-highlight (<span style=color:#a6e22e>procedural-invader</span> (<span style=color:#a6e22e>arithmetic-shift</span> i <span style=color:#ae81ff>-4</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>build-flomap*</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>   (<span style=color:#a6e22e>Î»</span> (<span style=color:#a6e22e>x</span> y)
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>define </span>i (+ y (* <span style=color:#ae81ff>5</span> (<span style=color:#66d9ef>if </span>(&lt; x <span style=color:#ae81ff>3</span>) x (- <span style=color:#ae81ff>4</span> x)))))
</span></span><span style=display:flex><span>     (<span style=color:#66d9ef>if </span>(= highlight i)
</span></span><span style=display:flex><span>         <span style=color:#f92672>&#39;#</span>(<span style=color:#ae81ff>1.0</span> <span style=color:#ae81ff>0.0</span> <span style=color:#ae81ff>0.0</span>)
</span></span><span style=display:flex><span>         (make-vector <span style=color:#ae81ff>3</span> (<span style=color:#a6e22e>flomap-ref</span> img-w/o-highlight <span style=color:#ae81ff>0</span> x y))))))
</span></span></code></pre></div><p>Basically, we pull off the lowest four bits with a <a href=https://en.wikipedia.org/wiki/bitmask>bitmask</a> for the highlight then shift all the rest down and pass off to the original <code>procedural-invader</code> function. Then we build a new image from that, mostly copying but taking a single pixel and making it red. Adding an argument so that our <code>demo</code> function can handle highlighting:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>demo</span> <span style=color:#f92672>#</span>:highlights? <span style=color:#66d9ef>#t</span>)
</span></span></code></pre></div><figure><img src=/embeds/2014/procedural-invaders-highlights.png></figure><p>Or even giant sheets:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>demo</span> <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>80</span> <span style=color:#f92672>#</span>:image-size <span style=color:#ae81ff>5</span> <span style=color:#f92672>#</span>:margins <span style=color:#ae81ff>1</span> <span style=color:#f92672>#</span>:highlights? <span style=color:#66d9ef>#t</span>)
</span></span></code></pre></div><figure><img src=/embeds/2014/procedural-invaders-80x40-highlights.png></figure><p>Ooh. That&rsquo;s starting to look like a game. Perhaps I&rsquo;ll revist these for the next <a href=https://blog.jverkamp.com/2013/05/21/ludum-dare-26-vtanks-results/>Ludum Dare</a>&mldr;</p><p>What else can we do with these? Well, take the <a href=http://www.complexification.net/gallery/machines/invaderfractal/>post I was inspired by</a>. In that case, they fill up a space with procedural invaders of different sizes. That would be neat to check out. I&rsquo;ve started implementing something&mldr;</p><figure><img src=/embeds/2014/fractal-invaders.png></figure><p>But it&rsquo;s not quite right yet. Perhaps next time&mldr;</p><p>If you&rsquo;d like to check out the entire code for today&rsquo;s post, as always, it&rsquo;s available on GitHub: <a href=https://github.com/jpverkamp/small-projects/blob/master/blog/procedural-invaders.rkt>procedural-invaders.rkt</a></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>