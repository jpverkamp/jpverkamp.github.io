<!doctype html><html><head><title>Ludum Dare 30: Sandbox Battle â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.ef050764ff69f3287c89ff655825479dd8304dcd9bc653d1ddd4772a701ad445.js integrity="sha256-7wUHZP9p8yh8if9lWCVHndgwTc2bxlPR3dR3KnAa1EU=" defer></script><script src=/katex_17296078054267651618.min.deed0e78a77391517d530a00324ce7b760ac204134992ef22d36f583615ae498.js integrity="sha256-3u0OeKdzkVF9UwoAMkznt2CsIEE0mS7yLTb1g2Fa5Jg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.bfe50b47c0387e3c3bf97ec5f338bba94f7ccb02f962a4aec8cf0b4d68c8434d.js integrity="sha256-v+ULR8A4fjw7+X7F8zi7qU98ywL5YqSuyM8LTWjIQ00=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.64e42891d651aee0b8cd02ec9227ff271d37bcf06dae985d1acf0eba1623e850.css integrity="sha256-ZOQokdZRruC4zQLskif/Jx03vPBtrphdGs8OuhYj6FA="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.0d2b289fa3451447692959fcee5676b846532fe7ab50ddc4660824c42d4adcd7.css integrity="sha256-DSson6NFFEdpKVn87lZ2uEZTL+erUN3EZggkxC1K3Nc="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.67505d77381ebd82623ab9296c1989c44ec828d867c00296e80e52ef860cac37.css integrity="sha256-Z1BddzgevYJiOrkpbBmJxE7IKNhnwAKW6A5S74YMrDc="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.34a34d86b8aae11b989d80a1626629c053029d012419a1993cfb6c12ea175737.css integrity="sha256-NKNNhriq4RuYnYChYmYpwFMCnQEkGaGZPPtsEuoXVzc="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Home Automation</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Ludum Dare 30: Sandbox Battle</h1><div class=entry-meta><span class=entry-date>2014-08-22</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/03/18/approximating-pi-with-buffons-needle/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/html>HTML</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-hints-of-a-game/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2013/05/21/ludum-dare-26-vtanks-results/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/ludum-dare>Ludum Dare</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-hints-of-a-game/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/08/07/langtons-ant/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/cellular-automata>Cellular Automata</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-hints-of-a-game/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2010/02/06/sandbox-its-alive/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/falling-sand>Falling Sand</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-hints-of-a-game/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/07/10/cracker-barrel-peg-game-part-3/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/games>Games</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-hints-of-a-game/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a class=taxonomy-value href=/series/ludum-dare-30>Ludum Dare 30</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-hints-of-a-game/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2014/08/21/chess-puzzles-1-get-moving/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-hints-of-a-game/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2014/08/21/chess-puzzles-1-get-moving/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-hints-of-a-game/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>And here we are again. <a href=https://blog.jverkamp.com/2013/05/21/ludum-dare-26-vtanks-results/>Ludum Dare</a>. Taken directly from their about page&mldr;</p><blockquote><p>Ludum Dare is a regular accelerated game development Event. Participants develop games from scratch in a weekend, based on a theme suggested by community.</p></blockquote><p>More specifically, the goal is to make a game from scratch in 48 hours. You&rsquo;re allowed to use publicly available frameworks and code libraries, but no art or other assets. Previously, I missed the original start time. So although I made my game in 48 hours, it didn&rsquo;t qualify. This time around, I&rsquo;m starting on time.</p><p>The theme this time is <a href=http://www.ludumdare.com/compo/2014/08/16/ludum-dare-30-theme-voting-begins/>Connected Worlds</a>. I like that a lot more than many of the previous themes, so let&rsquo;s see what ideas we can come up with.</p><p>Taking about an hour at the start of the compo to both work out and think, I ended up basically going in two directions:</p><ul><li>A <a href=https://en.wikipedia.org/wiki/falling%20sand>falling sand</a> style game, only with discrete &lsquo;bubbles&rsquo; with different particles / physics</li><li>A <a href=https://en.wikipedia.org/wiki/puzzle%20platformer>Platform_game#Puzzle_platformers</a> based around portals that split you into two realities you play at the same time</li></ul><p>Of the two, the second has the advantages of 1) actually sounding like a game (that&rsquo;s always been my problem with falling sand style simulations) and 2) being much easier to code. I&rsquo;ve worked on falling sand style games before (<a href=https://blog.jverkamp.com/2010/02/06/sandbox-its-alive/>Sandbox</a>) and they take a lot of tuning to get reasonable performance. Certainly worth doing&mldr; but not the best idea for a 48 hour time window.</p><p>So of course I&rsquo;m going with option A. &#x1f604;</p><p>About 6 hours in, and so far this is what I have:</p><figure><img src=/embeds/2014/screenshot.png></figure><hr><p>Real-life demo! (Click run, then try dragging the boxes around)</p><p><canvas id=frame1 width=100 height=100></canvas>
<canvas id=frame2 width=100 height=100></canvas>
<canvas id=frame3 width=100 height=100></canvas></p><p><button id=runGame type=button>Run!</button></p><style>canvas{border:1px solid #000}</style><script>$(function(){var e,t,s,o,i,n=1e4;$("canvas").each(function(e,t){$(t).attr("data-index",e)}),t=[],$("canvas").each(function(e){t.push(e)}),$("canvas").draggable({stack:"*",drag:function(){},stop:function(e){var s=parseInt($(e.target).attr("data-index")),o=t.indexOf(s);t.splice(o,1),t.unshift(s)}}),s=function(e,t,n){for(var o,i=new Array(e),s=0;s<e;s++){i[s]=new Array(t);for(o=0;o<t;o++)i[s][o]=n}return i},o=function(e,t,n,s){for(o=0;o<n;o++)for(i=0;i<s;i++)t[o][i]=0;for(var o,c=0,a=0,r=0,i=s-1;i>=0;i--)for(o=0;o<n;o++){if(e[o][i]==0)continue;a=o,r=i,c=Math.random(),c<.5?i>0&&t[o][i-1]==0&&(a=o,r=i-1):c<.7?o>0&&i>0&&t[o-1][i-1]==0&&(a=o-1,r=i-1):c<.9?o<n-1&&i>1&&t[o+1][i-1]==0&&(a=o+1,r=i-1):c<.95?o>0&&t[o-1][i]==0&&(a=o-1,r=i):o<n-1&&t[o+1][i]==0&&(a=o+1,r=i),e[a][r]!=0&&(a=o,r=i),t[a][r]=e[o][i]}},e={},i=function(t,i){f=(new Date).getTime(),u=i.getContext("2d"),u.imageSmoothingEnabled=!1;var l,u,f,b,j,y,a=i.width,r=i.height,c=s(a,r,0),v=s(a,r,0),d=0,m=0,h=0,p=0,g=0;e[t]=c,l=u.createImageData(a,r),b=0,j=function(){c[a/2][r-1]=t+1,o(c,v,a,r),y=c,c=v,v=y,$("canvas").each(function(n,s){if(i==s)return;var l,d,u,h,m,o=i.getBoundingClientRect(),c=s.getBoundingClientRect();if(o.right<c.left||o.left>c.right||o.bottom<c.top||o.top>c.bottom)return;if(o.top<c.top)return;for(l=0;l<r;l++)for(d=0;d<a;d++)u=Math.floor(o.left-c.left+d),h=Math.floor(c.top-o.top+l),0<=u&&u<a&&0<=h&&h<r&&e[t][d][l]==0&&(m=e[t][d][l],e[t][d][l]=e[n][u][h],e[n][u][h]=m)});for(var s,_=0;_<r;_++)for(s=0;s<a;s++)d=s+(r-_)*a,m=h=p=0,g=255,c[s][_]==0?g=0:c[s][_]==1?p=255:c[s][_]==2?m=255:c[s][_]==3&&(h=255),l.data[d*4+0]=m,l.data[d*4+1]=h,l.data[d*4+2]=p,l.data[d*4+3]=g;u.putImageData(l,0,0),b<n?(b+=1,setTimeout(j,0)):(end=(new Date).getTime(),console.log(n+" frames in "+(end-f)+" ms = "+n/((end-f)/1e3)+" fps"))},j()},$("#runGame").click(function(){console.log("starting..."),$("canvas").each(i)})})</script><p>You can click and drag the blocks around and the sand will from from box to box. At first, I was trying to figure out goals where you could&ndash;for example&ndash;use water in one box to put out fire in another. But right at the end, I had an even better idea (hopefully not just the long day talking): SANDBOX BATTLE! Basically, some sort of multiplayer / AI madness, where you are trying to steal the other box&rsquo;s sand before they can steal yours&mldr; I&rsquo;m going to have to think about that&mldr;</p><p>Anyways, here are some of the interesting bits (in JavaScript for once!):</p><p>First, the core of the whole thing, the update function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>update</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>buffer</span>, <span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Clear the buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>width</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>height</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>buffer</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update the buffer with falling cells
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>xt</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>yt</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>height</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>--</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>width</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Skip empty cells
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>xt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>yt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Determine which way it&#39;s going to fall
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>random</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.5</span>) { <span style=color:#75715e>// Straight down
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>y</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) { <span style=color:#a6e22e>xt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span>; <span style=color:#a6e22e>yt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.7</span>) { <span style=color:#75715e>// Down left
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>][<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) { <span style=color:#a6e22e>xt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>yt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.9</span>) { <span style=color:#75715e>// Down right
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>width</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>][<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) { <span style=color:#a6e22e>xt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>yt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.95</span>) { <span style=color:#75715e>// Straight left
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>][<span style=color:#a6e22e>y</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) { <span style=color:#a6e22e>xt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>yt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span>; }
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> { <span style=color:#75715e>// Straight right
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>width</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>buffer</span>[<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>][<span style=color:#a6e22e>y</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) { <span style=color:#a6e22e>xt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>yt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span>; }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>xt</span>][<span style=color:#a6e22e>yt</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) { <span style=color:#a6e22e>xt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span>; <span style=color:#a6e22e>yt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>y</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Update the buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>buffer</span>[<span style=color:#a6e22e>xt</span>][<span style=color:#a6e22e>yt</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span>];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The basic idea is two have two data arrays: <code>data</code> and <code>buffer</code>. We will trust the rest of the code to swap them the other way and spend all of the effort in this function creating buffer as the next frame. Specifically, we&rsquo;re going to loop through all of the tiles from bottom to top (because sand falls) then left to right. For each particle (non-<code>0</code> space), there are five possibilities:</p><ul><li>50% chance of trying to move directly down</li><li>20% chance of trying to move down and left, 20% down and right</li><li>5% chance each of moving directly left or right</li></ul><p>Sounds pretty good. It&rsquo;s the same sort of code I&rsquo;ve written rather a lot of times&mldr; This time around, we&rsquo;re not going to do any optimizations. We&rsquo;ll deal with that later if we have time.</p><p>Next, we have to deal with the <code>tick</code> function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tick</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Debug: Add a pixel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>][<span style=color:#a6e22e>height</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>frameIndex</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update from data to buffer; swap the arrays for the next iteration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>buffer</span>, <span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>temp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>buffer</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>temp</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Detect overlapping buffers, if so swap randomly
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Render to the image data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So we start with pixels dumping in from the ceiling and we update the world. We have space for two more functions: copying between worlds (pretty much the core idea of the game &#x1f604;) and rendering. Let&rsquo;s look at the latter first.</p><p>In order to render quickly, I&rsquo;m going to use the <code>canvas</code> element&rsquo;s context&rsquo;s <code>createImageData</code> and <code>putImageData</code> to write data directly into the image. That will be a lot faster than setting pixels individually, especially since we&rsquo;re going to be changing rather a lot of pixels at the indiviual level. So&mldr; rendering:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Render to the image data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>height</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>width</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>height</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>y</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>width</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>x</span>][<span style=color:#a6e22e>y</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>g</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>imageData</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>r</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>imageData</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>imageData</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>imageData</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Copy back to the GUI
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>frame_ctx</span>.<span style=color:#a6e22e>putImageData</span>(<span style=color:#a6e22e>imageData</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span></code></pre></div><p>We&rsquo;ve previously set up <code>imageData</code> using <code>createImageData</code> (we only have to do this once and then can reuse that same memory) and the <code>frame_ctx</code> as the context object of the canvas.</p><p>One interesting part that I changed right before this writeup was the transparency of empty cells. That way the page will shine through. I&rsquo;m not entirely sure that&rsquo;s what I want, but it&rsquo;s an interesting effect, so I&rsquo;ll leave it for the time being.</p><p>And then last but not least, the combination function. This one is honestly kind of weird:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Detect overlapping buffers, if so swap randomly
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;canvas&#39;</span>).<span style=color:#a6e22e>each</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>otherIndex</span>, <span style=color:#a6e22e>other</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If we&#39;re comparing to ourself, we&#39;ll always overlap, skip
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>frame</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>other</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If the two canvases don&#39;t overlap, don&#39;t look at them
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>frameBounds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>frame</span>.<span style=color:#a6e22e>getBoundingClientRect</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>otherBounds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>other</span>.<span style=color:#a6e22e>getBoundingClientRect</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>frameBounds</span>.<span style=color:#a6e22e>right</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>otherBounds</span>.<span style=color:#a6e22e>left</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>frameBounds</span>.<span style=color:#a6e22e>left</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>otherBounds</span>.<span style=color:#a6e22e>right</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>frameBounds</span>.<span style=color:#a6e22e>bottom</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>otherBounds</span>.<span style=color:#a6e22e>top</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>frameBounds</span>.<span style=color:#a6e22e>top</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>otherBounds</span>.<span style=color:#a6e22e>bottom</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// We only want this once, so give priority to whichever frame is &#39;lower&#39; on the screen
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>frameBounds</span>.<span style=color:#a6e22e>top</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>otherBounds</span>.<span style=color:#a6e22e>top</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// TODO: Find the actual offset rather than looping over an entire image
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>otherX</span>, <span style=color:#a6e22e>otherY</span>, <span style=color:#a6e22e>temp</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>frameY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>frameY</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>height</span>; <span style=color:#a6e22e>frameY</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>frameX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>frameX</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>width</span>; <span style=color:#a6e22e>frameX</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>otherX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>frameBounds</span>.<span style=color:#a6e22e>left</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>otherBounds</span>.<span style=color:#a6e22e>left</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>frameX</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>otherY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>otherBounds</span>.<span style=color:#a6e22e>top</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>frameBounds</span>.<span style=color:#a6e22e>top</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>frameY</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>0</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>otherX</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>otherX</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>width</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>otherY</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>otherY</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>height</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>allData</span>[<span style=color:#a6e22e>frameIndex</span>][<span style=color:#a6e22e>frameX</span>][<span style=color:#a6e22e>frameY</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> ) {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>temp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>allData</span>[<span style=color:#a6e22e>frameIndex</span>][<span style=color:#a6e22e>frameX</span>][<span style=color:#a6e22e>frameY</span>];
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>allData</span>[<span style=color:#a6e22e>frameIndex</span>][<span style=color:#a6e22e>frameX</span>][<span style=color:#a6e22e>frameY</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>allData</span>[<span style=color:#a6e22e>otherIndex</span>][<span style=color:#a6e22e>otherX</span>][<span style=color:#a6e22e>otherY</span>];
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>allData</span>[<span style=color:#a6e22e>otherIndex</span>][<span style=color:#a6e22e>otherX</span>][<span style=color:#a6e22e>otherY</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>temp</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Theoretically the comments should be enough, but if not, the basic idea is to first find if we have two overlapping regions (the <code>frameIndex</code> and <code>otherIndex</code> will make more sense if you look at the full code). If you have one, then loop over the shared region and copy pixels to the lower of the two boxes. I&rsquo;m going to have to figure out a better rule for that. I tried using z-index, but that didn&rsquo;t work much better&mldr; Essentially, we need to be able to move particles from one box to another, but we need to be careful to neither lose nor duplicate particles. There are a number of weird edges cases (as I&rsquo;m sure you&rsquo;ve found if you played with the simulation).</p><p>And, that&rsquo;s it. I have until 5pm Pacific on Sunday. I&rsquo;m actually feeling pretty good about this. The best plan is to have a playable game after 24 hours and to spend the second day on polish. I&rsquo;m not sure if I&rsquo;ll quite hit that&mldr; but maybe!</p><p>If you&rsquo;d like to see the entire source (warning: ugly) and potentially spoilers, check it out here: <a href=https://github.com/jpverkamp/sandbox-battle>jpverkamp/sandbox-battle</a></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>