<!doctype html><html><head><title>Ludum Dare 30: Hints of a game â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.30448892aa1f91e9c4cb5494e5c5e5abc13b7778de7786e5256cdc7d2424813a.js integrity="sha256-MESIkqofkenEy1SU5cXlq8E7d3jed4blJWzcfSQkgTo=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.6ba037466db9f8843b66c38c32fe5a353344e7fd68ecda97efb63a84c881f828.js integrity="sha256-a6A3Rm25+IQ7ZsOMMv5aNTNE5/1o7NqX77Y6hMiB+Cg=" defer></script>
<script src=/katex_12008035502722260518.min.3cc3a080c0368785179e37b0cd0a71c6cf60c4fc5a8dce503f5a542ec0a25043.js integrity="sha256-PMOggMA2h4UXnjewzQpxxs9gxPxajc5QP1pULsCiUEM=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.e8f19283a632077085b9ad74aecad54abe84429c69789fd29ffa3a254d86abdd.js integrity="sha256-6PGSg6YyB3CFua10rsrVSr6EQpxpeJ/Sn/o6JU2Gq90=" defer></script>
<script src=/main.min.982c2d7bb434b4cf8b19c2cf38ef7e7f7162ddbed610e5bdddbb937001e26574.js integrity="sha256-mCwte7Q0tM+LGcLPOO9+f3Fi3b7WEOW93buTcAHiZXQ=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.1a5fbab1ecff843d4ee6e936243fb06066197cd8c9357883d791333ce6001f3b.css integrity="sha256-Gl+6sez/hD1O5uk2JD+wYGYZfNjJNXiD15EzPOYAHzs="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=//www.google.com/search method=get onsubmit='(function(e){e.q.value="site:blog.jverkamp.com "+e.qfront.value})(this)' class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=hidden>
<input name=qfront type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article><header><h1 class=entry-title>Ludum Dare 30: Hints of a game</h1><div class=entry-meta><span class=entry-date>2014-08-23</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/html>HTML</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/javascript>JavaScript</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/ludum-dare>Ludum Dare</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/cellular-automata>Cellular Automata</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/falling-sand>Falling Sand</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/games>Games</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link></a><a class=taxonomy-value href=/series/ludum-dare-30>Ludum Dare 30</a><a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/08/23/ludum-dare-30-24-hours/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>We&rsquo;re getting there. 18 hours in and I have the first hints of what might actually be a game&mldr;</p><figure><img src=/embeds/2014/screenshot.png></figure><p>(I&rsquo;ll include a demo at the bottom of the post)</p><p>Basically, I went with allowing each box to be controlled individually by the keyboard. There will be some problems with having that many people on the keyboard at once, but we&rsquo;ll deal with that later (if we can).</p><p>One additional thing I wanted (and mostly figured out) is somewhat &rsquo;loose&rsquo; controls. Basically, rather than explicitly dealing with moving only when a key is down, we&rsquo;ll accelerate when the key is down, preserving velocity even after keys are raised. There will be some small amount of friction as well, to make sure that eventually pieces will slow down.</p><p>It&rsquo;s actually not too hard to implement a system like this:</p><p>First, load in the keybindings from the interface you can see in the screenshot above:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Load key bindings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>loadKeyBindings</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>keys</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Loading key bindings...&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;#controls table&#39;</span>).<span style=color:#a6e22e>each</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>eli</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>player</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>$</span>(<span style=color:#a6e22e>eli</span>).<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;data-player&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;loading controls for player &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>player</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>$</span>(<span style=color:#a6e22e>eli</span>).<span style=color:#a6e22e>find</span>(<span style=color:#e6db74>&#39;input&#39;</span>).<span style=color:#a6e22e>each</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>j</span>, <span style=color:#a6e22e>elj</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$</span>(<span style=color:#a6e22e>elj</span>).<span style=color:#a6e22e>attr</span>(<span style=color:#e6db74>&#39;name&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$</span>(<span style=color:#a6e22e>elj</span>).<span style=color:#a6e22e>val</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>keys</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> [<span style=color:#a6e22e>player</span>, <span style=color:#a6e22e>command</span>, <span style=color:#66d9ef>false</span>];
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>This will put everything into the <code>key</code> array, indexed by key name and storing the player it refers to, the direction you are going (one of <code>left</code>, <code>right</code>, <code>up</code>, or <code>down</code>), and if that key is currently active (pressed down). If I can, I may add additional key bindings (such as rotation or powerups), otherwise, that&rsquo;s pretty good for the moment.</p><p>Next, we&rsquo;ll add a function to tell when keys are active:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>onkey</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>event</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>keyCode</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span>  <span style=color:#ae81ff>37</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;LEFT&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span>  <span style=color:#ae81ff>38</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UP&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span>  <span style=color:#ae81ff>39</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;RIGHT&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span>  <span style=color:#ae81ff>40</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DOWN&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span>  <span style=color:#ae81ff>97</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM1&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span>  <span style=color:#ae81ff>98</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM2&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span>  <span style=color:#ae81ff>99</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM3&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>100</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM4&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>101</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM5&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>102</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM6&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>103</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM7&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>104</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM8&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>105</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NUM9&#39;</span>; <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> String.<span style=color:#a6e22e>fromCharCode</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>keyCode</span>).<span style=color:#a6e22e>toUpperCase</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>keys</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;keydown&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>keys</span>[<span style=color:#a6e22e>key</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;keyup&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>keys</span>[<span style=color:#a6e22e>key</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Longer than I wanted, but it correctly deals with both the numpad and arrow keys, which is kind of necessary if you want to support 4 human players all at the same time. Perhaps I&rsquo;ll implement AIs, but until I do, we&rsquo;re going to have to allow for a bunch of players&mldr;</p><p>Okay, so what do we do with all of this information? Well, just like before, we have a <code>tick</code> function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tick</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>event</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>each</span>(<span style=color:#a6e22e>keys</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>el</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>player</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>el</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>el</span>[<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>active</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>el</span>[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>$game</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;#tiles&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>$tile</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;#tiles *[data-player=&#34;&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>player</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;&#34;]&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update velocity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Use friction to slow each box down over time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Cap velocity so we don&#39;t go too fast
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update the current position based on velocity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Bounce off the edges of the screen
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Finally, update the position
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>$tile</span>.<span style=color:#a6e22e>css</span>({<span style=color:#e6db74>&#39;top&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>top</span>, <span style=color:#e6db74>&#39;left&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>left</span>});
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>running</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setTimeout</span>(<span style=color:#a6e22e>tick</span>, <span style=color:#ae81ff>1000</span><span style=color:#f92672>/</span><span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>Oof. That&rsquo;s a heck of a function. Luckily, the individual parts aren&rsquo;t <em>that</em> bad. First, we want to update the velocity. This is where the <code>active</code> parameter (the third in each key definition) comes into play:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Update velocity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>active</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>command</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;up&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>-=</span> <span style=color:#a6e22e>PER_TICK_ACCELERATION</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>command</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;down&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+=</span> <span style=color:#a6e22e>PER_TICK_ACCELERATION</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>command</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;left&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>-=</span> <span style=color:#a6e22e>PER_TICK_ACCELERATION</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>command</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;right&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+=</span> <span style=color:#a6e22e>PER_TICK_ACCELERATION</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>That&rsquo;s simple enough. As before, we have to decide that <code>up</code> and <code>down</code> are inverted (they almost always are when it comes to computers), but once you&rsquo;ve decided that&rsquo;s easy enough.</p><p>Now, outside of that black, the next thing we&rsquo;ll do is apply friction. This way the boxes will slow down over time, forcing players both to pay attention and to let them bounce around like madmen.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Use friction to slow each box down over time
</span></span></span><span style=display:flex><span><span style=color:#75715e>// If we&#39;re close enough to zero that friction will accelerate us, just stop
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>PER_TICK_FRICTION</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>PER_TICK_FRICTION</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>PER_TICK_FRICTION</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>]) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>PER_TICK_FRICTION</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>PER_TICK_FRICTION</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>PER_TICK_FRICTION</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Cap velcity so we don&#39;t go too fast
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>VELOCITY_CAP</span>, Math.<span style=color:#a6e22e>max</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>VELOCITY_CAP</span>, <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>]));
</span></span><span style=display:flex><span><span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>VELOCITY_CAP</span>, Math.<span style=color:#a6e22e>max</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>VELOCITY_CAP</span>, <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>]));
</span></span></code></pre></div><p>Also at the end there, we make sure we don&rsquo;t keep accelerating indefinitely. That both helps keep the game a little easier to play and prevents edge cases (such as moving further in one tick than we&rsquo;re allowed).</p><p>Next, we can finally update the position:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Update the current position based on velocity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>left</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$tile</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>offsetLeft</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>top</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$tile</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>offsetTop</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Bounce off the edges of the screen
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>left</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>left</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>left</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>$game</span>.<span style=color:#a6e22e>width</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>$tile</span>.<span style=color:#a6e22e>width</span>()) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>left</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$game</span>.<span style=color:#a6e22e>width</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>$tile</span>.<span style=color:#a6e22e>width</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>top</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>top</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>top</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>$game</span>.<span style=color:#a6e22e>height</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>$tile</span>.<span style=color:#a6e22e>height</span>()) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>top</span> <span style=color:#f92672>=</span>  <span style=color:#a6e22e>$game</span>.<span style=color:#a6e22e>height</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>$tile</span>.<span style=color:#a6e22e>height</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>vel</span>[<span style=color:#a6e22e>player</span>][<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Once again, we want to clip the positions. This time though, we&rsquo;re actually going to use the velocities we have rather than zeroing them out. Instead: bounce! It&rsquo;s nice, because it makes the game feel more &lsquo;realistic&rsquo; (for some definitions of the word).</p><p>And that&rsquo;s about it. With that, we can have the boxes moving around and interacting as they did last night. We&rsquo;re actually starting to get a game going here. One other tweak is the control code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tiles</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Tiles</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>controls</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Controls</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>MS_PER_GAME</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1000</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>startTime</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>getTime</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>running</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>$</span>(<span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>controls</span>.<span style=color:#a6e22e>run</span>();
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>tick</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>soFar</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>getTime</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>startTime</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>remainingSec</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>((<span style=color:#a6e22e>MS_PER_GAME</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>soFar</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>remainingSec</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;#tiles #countdown&#39;</span>).<span style=color:#a6e22e>text</span>(<span style=color:#a6e22e>remainingSec</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; sec remaining&#39;</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>stop</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>running</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setTimeout</span>(<span style=color:#a6e22e>tick</span>, <span style=color:#ae81ff>1000</span><span style=color:#f92672>/</span><span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>run</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tiles</span>.<span style=color:#a6e22e>run</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>controls</span>.<span style=color:#a6e22e>run</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>startTime</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>getTime</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>running</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tick</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>stop</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tiles</span>.<span style=color:#a6e22e>stop</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>controls</span>.<span style=color:#a6e22e>stop</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>startTime</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>getTime</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>MS_PER_GAME</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>running</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>$</span>(<span style=color:#e6db74>&#39;#tiles #countdown&#39;</span>).<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;game over&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Technically, it&rsquo;s not a gameloop, since everything is done asynchronously via <code>setTimeout</code> (and make <strong>absolutely sure</strong> that you don&rsquo;t use <code>setInterval</code>&mldr;), but it&rsquo;s close enough. What this does give us though is a strict time before the game ends. Otherwise, the boxes will eventually fill up, and where&rsquo;s the fun in that? (Although that might be an interesting alternative end condition).</p><p>After that, all I have to figure out is scoring. And I have another 6 hours until the one day mark. If I can make it by then, I&rsquo;ll feel pretty good&ndash;and can use all of the rest of the time for polish. I&rsquo;m thinking some simple music, sound effects, a title screen (initial letters in sand?). Of course, I still have to figure out the scoring algorithm..</p><p>Same as yesterday, the entire source (warning: still ugly) if available on GitHub: <a href=https://github.com/jpverkamp/sandbox-battle>jpverkamp/sandbox-battle</a></p><hr><p>Demo:</p><style>#controls table{border:1px solid #000;display:inline-block;margin:1em;padding:.5em;border-radius:.5em}#controls table td{padding:.1em}#controls table td:first-child{text-align:right}#controls table input{width:50px;text-align:center}#tiles{position:relative;width:600px;height:400px;background:#000;border:1px solid #000}#tiles canvas{position:absolute;border:1px solid #000}#tiles canvas[data-player="0"]{border:1px solid blue}#tiles canvas[data-player="1"]{border:1px solid red}#tiles canvas[data-player="2"]{border:1px solid green}#tiles canvas[data-player="3"]{border:1px solid hotPink}#tiles #countdown{color:#fff}</style><script>function Tiles(){var s,o,i,n=!1,e={},t=[];$("canvas").each(function(e,t){$(t).attr("data-index",e)}),$("canvas").each(function(e){t.push(e)}),$("canvas").draggable({stack:"*",drag:function(){},stop:function(e){var s=parseInt($(e.target).attr("data-index")),o=t.indexOf(s);t.splice(o,1),t.unshift(s)}}),s=function(e,t,n){for(var o,i=new Array(e),s=0;s<e;s++){i[s]=new Array(t);for(o=0;o<t;o++)i[s][o]=n}return i},o=function(e,t,n,s){for(o=0;o<n;o++)for(i=0;i<s;i++)t[o][i]=0;for(var o,c=0,a=0,r=0,i=s-1;i>=0;i--)for(o=0;o<n;o++){if(e[o][i]==0)continue;a=o,r=i,c=Math.random(),c<.5?i>0&&t[o][i-1]==0&&(a=o,r=i-1):c<.7?o>0&&i>0&&t[o-1][i-1]==0&&(a=o-1,r=i-1):c<.9?o<n-1&&i>1&&t[o+1][i-1]==0&&(a=o+1,r=i-1):c<.95?o>0&&t[o-1][i]==0&&(a=o-1,r=i):o<n-1&&t[o+1][i]==0&&(a=o+1,r=i),e[a][r]!=0&&(a=o,r=i),t[a][r]=e[o][i]}},i=function(t,i){j=(new Date).getTime(),f=i.getContext("2d"),f.imageSmoothingEnabled=!1;var l,f,v,b,j,r=i.width,c=i.height,a=s(r,c,0),p=s(r,c,0),d=0,h=0,u=0,m=0,g=0;e[t]=a,l=f.createImageData(r,c),v=function(){a[r/2][c-1]=t+1,o(a,p,r,c),b=a,a=p,p=b,$("canvas").each(function(n,s){if(i==s)return;var l,d,u,h,m,o=i.getBoundingClientRect(),a=s.getBoundingClientRect();if(o.right<a.left||o.left>a.right||o.bottom<a.top||o.top>a.bottom)return;if(o.top<a.top)return;if(!(t in e&&n in e))return;for(l=0;l<c;l++)for(d=0;d<r;d++)u=Math.floor(o.left-a.left+d),h=Math.floor(a.top-o.top+l),0<=u&&u<r&&0<=h&&h<c&&e[t][d][l]==0&&(m=e[t][d][l],e[t][d][l]=e[n][u][h],e[n][u][h]=m)});for(var s,j=0;j<c;j++)for(s=0;s<r;s++)d=s+(c-j)*r,h=u=m=0,g=255,a[s][j]==0?g=0:a[s][j]==1?m=255:a[s][j]==2?h=255:a[s][j]==3?u=255:a[s][j]==4&&(h=246,u=96,m=171),l.data[d*4+0]=h,l.data[d*4+1]=u,l.data[d*4+2]=m,l.data[d*4+3]=g;f.putImageData(l,0,0),n&&setTimeout(v,1e3/60)},v()},this.run=function(){n=!0,$("canvas").each(i)},this.stop=function(){n=!1}}function Controls(){var t={},i=!1,s=.1,n=.01,o=10,e={},c=function(){t={},console.log("Loading key bindings..."),$("#controls table").each(function(e,n){var s=parseInt($(n).attr("data-player"));console.log("loading controls for player "+s),$(n).find("input").each(function(e,n){var o=$(n).attr("name"),i=$(n).val();t[i]=[s,o,!1]})})},a=function(e){switch(e.keyCode){case 37:key="LEFT";break;case 38:key="UP";break;case 39:key="RIGHT";break;case 40:key="DOWN";break;case 97:key="NUM1";break;case 98:key="NUM2";break;case 99:key="NUM3";break;case 100:key="NUM4";break;case 101:key="NUM5";break;case 102:key="NUM6";break;case 103:key="NUM7";break;case 104:key="NUM8";break;case 105:key="NUM9";break;default:key=String.fromCharCode(e.keyCode).toUpperCase()}key in t&&(e.type=="keydown"?t[key][2]=!0:e.type=="keyup"&&(t[key][2]=!1))},r=function(){$.each(t,function(t,i){var r,c,a=i[0],l=i[1],d=i[2];$game=$("#tiles"),$tile=$('#tiles *[data-player="'+a+'"]'),d&&(l=="up"?e[a][1]-=s:l=="down"?e[a][1]+=s:l=="left"?e[a][0]-=s:l=="right"&&(e[a][0]+=s)),Math.abs(e[a][0])<n?e[a][0]=0:e[a][0]+=e[a][0]>0?-n:n,Math.abs(e[a][1])<n?e[a][1]=0:e[a][1]+=e[a][1]>0?-n:n,e[a][0]=Math.min(o,Math.max(-o,e[a][0])),e[a][1]=Math.min(o,Math.max(-o,e[a][1])),r=$tile[0].offsetLeft+e[a][0],c=$tile[0].offsetTop+e[a][1],r<0?(r=0,e[a][0]=Math.abs(e[a][0])):r>$game.width()-$tile.width()&&(r=$game.width()-$tile.width(),e[a][0]=-1*Math.abs(e[a][0])),c<0?(c=0,e[a][1]=Math.abs(e[a][1])):c>$game.height()-$tile.height()&&(c=$game.height()-$tile.height(),e[a][1]=-1*Math.abs(e[a][1])),$tile.css({top:c,left:r})}),i&&setTimeout(r,1e3/30)};this.run=function(){c(),$game=$("#tiles"),$("#tiles canvas").each(function(t,n){e[t]=[0,0],$(n).css({top:Math.random()*($game.height()-$(n).height()),left:Math.random()*($game.width()-$(n).width())})}),$(document).unbind("keydown").bind("keydown",a),$(document).unbind("keyup").bind("keyup",a),i=!0,r()},this.stop=function(){i=!1,$(document).unbind("keydown"),$(document).unbind("keyup")}}var tiles=new Tiles,controls=new Controls,MS_PER_GAME=60*1e3,startTime=(new Date).getTime(),running=!0;$(function(){controls.run()});function tick(){var t=(new Date).getTime()-startTime,e=Math.floor((MS_PER_GAME-t)/1e3);e>0?$("#tiles #countdown").text(e+" sec remaining"):stop(),running&&setTimeout(tick,1e3/30)}function run(){return tiles.run(),controls.run(),startTime=(new Date).getTime(),running=!0,tick(),!1}function stop(){return tiles.stop(),controls.stop(),startTime=(new Date).getTime()-MS_PER_GAME,running=!1,$("#tiles #countdown").text("game over"),!1}</script><table><thead><tr><th>Player 1 - Blue</th><th></th></tr></thead><tbody><tr><td>Up</td><td></td></tr><tr><td>Left</td><td></td></tr><tr><td>Right</td><td></td></tr><tr><td>Down</td><td></td></tr></tbody></table><table><thead><tr><th>Player 2 - Red</th><th></th></tr></thead><tbody><tr><td>Up</td><td></td></tr><tr><td>Left</td><td></td></tr><tr><td>Right</td><td></td></tr><tr><td>Down</td><td></td></tr></tbody></table><table><thead><tr><th>Player 3 - Green</th><th></th></tr></thead><tbody><tr><td>Up</td><td></td></tr><tr><td>Left</td><td></td></tr><tr><td>Right</td><td></td></tr><tr><td>Down</td><td></td></tr></tbody></table><table><thead><tr><th>Player 4 - Pink</th><th></th></tr></thead><tbody><tr><td>Up</td><td></td></tr><tr><td>Left</td><td></td></tr><tr><td>Right</td><td></td></tr><tr><td>Down</td><td></td></tr></tbody></table><p>[ <a href=javascript:run()>Run!</a> ]
[ <a href=javascript:stop()>Stop!</a> ]</p><div id=tiles><p id=countdown></p><canvas data-player=0 width=100 height=100></canvas>
<canvas data-player=1 width=100 height=100></canvas>
<canvas data-player=2 width=100 height=100></canvas>
<canvas data-player=3 width=100 height=100></canvas></div><hr><p>I&rsquo;m sure there are bugs&mldr; And I&rsquo;m working on it right at the moment. If you have any questions or comments though, feel free to drop me a line below.</p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>