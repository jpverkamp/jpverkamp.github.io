<!DOCTYPE html>
<html onclick >
<head>
    <title>Chess Puzzles 1: Get moving! â€“ jverkamp.com</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"><link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css" integrity="sha256-s0KLB0LnI5oqhHF8gkgfmxU4usUFEHlWJTxT8q72Tq4=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous" />

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper"><header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a> *
            <a href="/resume">Resume</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>
    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation"><li><a href="https://blog.jverkamp.com/programming/">Programming</a></li><li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li><li><a href="https://blog.jverkamp.com/photography/">Photography</a></li><li><a href="https://blog.jverkamp.com/writing/">Writing</a></li><li><a href="https://blog.jverkamp.com/research/">Research</a></li><li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>
<div id="page-content-wrapper">
            <div id="page-content"><article>
	<header>
		<h1 class="entry-title">Chess Puzzles 1: Get moving!</h1>

        <div class="entry-meta"><span class="entry-date">2014-08-21</span>
            </div>

        <div class="entry-taxonomies"><div class="entry-tags"><ul class="taxonomy-keys"><li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2014/08/13/minimal-palindromic-base/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/racket">Racket</a><a href="https://blog.jverkamp.com/2014/08/28/chess-puzzles-2-board/" class="next-link"></a></li><li><a href="https://blog.jverkamp.com/2014/08/13/minimal-palindromic-base/" class="previous-link"></a><a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a><a href="https://blog.jverkamp.com/2014/08/28/chess-puzzles-2-board/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values"><li><a href="https://blog.jverkamp.com/2013/03/11/knight-moves/" class="previous-link"></a><a class="taxonomy-value" href="/programming/topics/chess">Chess</a><a href="https://blog.jverkamp.com/2014/08/28/chess-puzzles-2-board/" class="next-link"></a></li></ul>
        </li><li>
            <a class="taxonomy-key" href="/series/">Series</a>
            <ul class="taxonomy-values"><li><a class="taxonomy-value" href="/series/chess-puzzles">Chess Puzzles</a><a href="https://blog.jverkamp.com/2014/08/28/chess-puzzles-2-board/" class="next-link"></a></li></ul>
        </li><li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2014/08/13/minimal-palindromic-base/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/" class="next-link">Next</a></ul>
        </li><li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li><a href="https://blog.jverkamp.com/2014/08/13/minimal-palindromic-base/" class="previous-link">Prev</a>
                <a href="https://blog.jverkamp.com/2014/08/22/ludum-dare-30-sandbox-battle/" class="next-link">Next</a></ul>
        </li></ul>
</div>
</div>
    </header>

	<div class="entry-content"><p>Here&rsquo;s something I haven&rsquo;t done much<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>: chess puzzles! I&rsquo;m still not sure entirely what I think about the game in general. There is certainly quite a lot of strategy, which I like, but to really get good at chess, there&rsquo;s also some amount of memorizing openings and closings. That&rsquo;s something I&rsquo;m a little less thrilled with.</p>

<p>Still, it&rsquo;s the perfect sort of came to work out programming exercises with. It&rsquo;s a game of <a href="https://en.wikipedia.org/wiki/perfect%20information">perfect information</a>, so you don&rsquo;t have to deal with what a player knows and doesn&rsquo;t. The pieces have well defined, regular moves<sup class="footnote-ref" id="fnref:2"><a href="#fn:2">2</a></sup> There&rsquo;s a fairly intense branching factor, but not insurmountable&ndash;<a href="https://en.wikipedia.org/wiki/Deep%20Blue">Deep Blue (chess computer)</a> proved that.</p>

<p>Anyways, enough chatter. Let&rsquo;s play some chess!</p>

<p>Okay, first things first, we&rsquo;re going to have to lay some ground work. Despite how straight forward chess pieces are, it will still take a bit of effort to turn that into something that a computer can deal with. So first, let&rsquo;s work out a way of defining chess piece movement.</p>

<p>Here, I&rsquo;m going a little ambitious. I want to be able to support arbitrary <a href="https://en.wikipedia.org/wiki/fairy%20chess%20pieces">fairy chess pieces</a>. In addition to the more standard pieces, we have  strictly more powerful pieces like the Princess (Knight + Bishop) or the Empress (Knight + Rook). Or we have alternatives, like the Camel (like the Knight, only 3:1 instead of 2:1). Or the Nightrider, which moves like the Knight, but keeps on going. I want to be able to support all of these&hellip;</p>

<p>Okay, first things first. A basic struct for points and another to use for a <code>move-sequence</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Points, with associated methods; can also be used as offsets</span>
(struct pt (x y) <span style="color:#f92672">#</span>:transparent)

<span style="color:#75715e">; Move sequences for a piece; used for special flags (eg initial, capturing)</span>
(struct move-sequence (tag moves) <span style="color:#f92672">#</span>:transparent)</code></pre></div>
<p>The tags are mostly used for Pawns or the like, since they move one way when capturing and another when not. The rest is going to be a list of moves. So for something like the Rook, we&rsquo;ll have something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(list
 (move-sequence (set) (list (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">3</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">4</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">5</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">6</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">7</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">8</span>)))
 (move-sequence (set) (list (pt <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">-2</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">-3</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">-4</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">-5</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">-6</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">-7</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">-8</span> <span style="color:#ae81ff">0</span>)))
 (move-sequence (set) (list (pt <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">7</span> <span style="color:#ae81ff">0</span>) (pt <span style="color:#ae81ff">8</span> <span style="color:#ae81ff">0</span>)))
 (move-sequence (set) (list (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-1</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-2</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-3</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-4</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-5</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-6</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-7</span>) (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-8</span>))))</code></pre></div>
<p>When we get around to it, the idea is we can run down any of these lists until we run into something. If we run into an enemy piece, we&rsquo;ll allow the move; if not, we won&rsquo;t. Similarly, the Pawn:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(list
 (move-sequence (set <span style="color:#e6db74">&#39;initial-only</span> <span style="color:#e6db74">&#39;non-capture</span>) (list (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>)))
 (move-sequence (set <span style="color:#e6db74">&#39;non-capture</span>) (list (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>)))
 (move-sequence (set <span style="color:#e6db74">&#39;capture-only</span>) (list (pt <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>)))
 (move-sequence (set <span style="color:#e6db74">&#39;capture-only</span>) (list (pt <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>))))</code></pre></div>
<p>On the other hand though, these are kind of a pain to type in by hand. Let&rsquo;s make some helper functions. First, basic movement:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; A sequence of moves along a specific direction</span>
<span style="color:#75715e">; Distance is either not specified (exactly 1)</span>
<span style="color:#75715e">;   a number (exactly that number), n (unlimited)</span>
<span style="color:#75715e">;   or a range (min/max inclusive)</span>
<span style="color:#75715e">; Direction is either from the list &#39;(* + &gt; &lt; &lt;&gt; = &gt;= &lt;= X X&gt; X&lt;)</span>
<span style="color:#75715e">;   or a list of possible single offsets</span>
(<span style="color:#66d9ef">define </span>move
  (case-lambda
    [(direction)
     (move <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> direction)]
    [(distance direction)
     (<span style="color:#66d9ef">if </span>(eq? distance <span style="color:#e6db74">&#39;n</span>)
         (move <span style="color:#ae81ff">1</span>        +inf<span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>   direction)
         (move distance distance direction))]
    [(minimum-distance maximum-distance direction)
     (for/list ([offset (in-list (offsets-by-direction direction))])
       (move-sequence
        (set)
        (for*/list ([distance (in-range minimum-distance (+ maximum-distance <span style="color:#ae81ff">1</span>))]
                    [p (in-value (pt* distance offset))])
                    <span style="color:#f92672">#</span>:break (<span style="color:#66d9ef">or </span>(&gt; (abs (pt-x p)) (current-board-size))
                                (&gt; (abs (pt-y p)) (current-board-size)))
          p)))]))</code></pre></div>
<p>Basically, we have three different ways of specifying moves:</p>

<ul>
<li><code>(move direction)</code> - moves one square in a given direction (like a pawn)</li>
<li><code>(move distance direction)</code> - moves either exactly a specific number of tiles or an unlimited number (if <code>distance</code> is <code>n</code>)</li>
<li><code>(move minimum-distance maximum-distance direction)</code> - a range of movement, so you can move between the minimum and maximum inclusive but no more or less</li>
</ul>

<p>But what does direction mean? If it&rsquo;s specified as a point, that&rsquo;s straight forward enough, but still, we want to be able to specify these things more simply. Let&rsquo;s take a page out of <a href="https://en.wikipedia.org/wiki/Parlett%27s%20movement%20notation">Fairy_chess_piece#Parlett.27s_movement_notation</a>. Specifically the direction specifications:</p>

<ul>
<li><code>*</code> â€“ orthogonally or diagonally (all eight possible directions)</li>
<li><code>+</code> â€“ orthogonally (four possible directions)</li>
<li><code>&gt;</code> â€“ orthogonally forwards</li>
<li><code>&lt;</code> â€“ orthogonally backwards</li>
<li><code>&lt;&gt;</code> â€“ orthogonally forwards and backwards</li>
<li><code>=</code> â€“ orthogonally sideways (used here instead of Parlett&rsquo;s divide symbol.)</li>
<li><code>&gt;=</code> â€“ orthogonally forwards or sideways</li>
<li><code>&lt;=</code> â€“ orthogonally backwards or sideways</li>
<li><code>X</code> â€“ diagonally (four possible directions)</li>
<li><code>X&gt;</code> â€“ diagonally forwards</li>
<li><code>X&lt;</code> â€“ diagonally backwards</li>
</ul>

<p>Turn it into code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Return a sequence of all possible offsets for a given direction</span>
<span style="color:#75715e">; Order specified front to back, left to right</span>
(<span style="color:#66d9ef">define </span>(offsets-by-direction direction)
  <span style="color:#f92672">`</span>(<span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(member direction <span style="color:#f92672">&#39;</span>(*                  X X&gt;   )) (list (pt <span style="color:#ae81ff">-1</span>  <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(member direction <span style="color:#f92672">&#39;</span>(* + &gt;   &lt;&gt;   &gt;=           )) (list (pt  <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(member direction <span style="color:#f92672">&#39;</span>(*                  X X&gt;   )) (list (pt  <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(member direction <span style="color:#f92672">&#39;</span>(* +        = &gt;= &lt;=        )) (list (pt <span style="color:#ae81ff">-1</span>  <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(member direction <span style="color:#f92672">&#39;</span>(* +        = &gt;= &lt;=        )) (list (pt  <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(member direction <span style="color:#f92672">&#39;</span>(*                  X    X&lt;)) (list (pt <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>)) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(member direction <span style="color:#f92672">&#39;</span>(* +   &lt; &lt;&gt;      &lt;=        )) (list (pt  <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-1</span>)) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(member direction <span style="color:#f92672">&#39;</span>(*                  X    X&lt;)) (list (pt  <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>)) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(pt? direction)   (list direction) <span style="color:#f92672">&#39;</span>())
    <span style="color:#f92672">,@</span>(<span style="color:#66d9ef">if </span>(list? direction) direction        <span style="color:#f92672">&#39;</span>())))</code></pre></div>
<p>We&rsquo;re going to set it out now: <code>pt</code> is specified as <code>x, y</code>, not <code>row, column</code>. That&rsquo;s something that will bite you if you don&rsquo;t pay attention, so make sure to be consistent.</p>

<p>That&rsquo;s enough to define most of the pieces we want.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>King   (move  <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;*</span>))
(<span style="color:#66d9ef">define </span>Queen  (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;*</span>))
(<span style="color:#66d9ef">define </span>Rook   (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;+</span>))
(<span style="color:#66d9ef">define </span>Bishop (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;X</span>))</code></pre></div>
<p>Two are still left: the Knight and the Pawn. For the Knight, we need to specify something that will let us jump in arbitrary directions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Make a leaper from a given offset</span>
(<span style="color:#66d9ef">define </span>(leaper xÎ” yÎ”)
  (set-&gt;list
   (list-&gt;set
    <span style="color:#f92672">`</span>(<span style="color:#f92672">,</span>(pt    xÎ”     yÎ” )
      <span style="color:#f92672">,</span>(pt (- xÎ”)    yÎ” )
      <span style="color:#f92672">,</span>(pt    xÎ”  (- yÎ”))
      <span style="color:#f92672">,</span>(pt (- xÎ”) (- yÎ”))
      <span style="color:#f92672">,</span>(pt    yÎ”     xÎ” )
      <span style="color:#f92672">,</span>(pt (- yÎ”)    xÎ” )
      <span style="color:#f92672">,</span>(pt    yÎ”  (- xÎ”))
      <span style="color:#f92672">,</span>(pt (- yÎ”) (- xÎ”))))))</code></pre></div>
<p>The <code>list-&amp;gt;set</code> and set-&gt;list` calls are to avoid duplicates. Otherwise, it&rsquo;s every combination of leaps in a given ratio. So if you want to define a Knight:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>Knight (move <span style="color:#ae81ff">1</span> (leaper <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span>)))</code></pre></div>
<p>If you want to define the Nightrider though, it&rsquo;s just as simple:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>Nightrider (move <span style="color:#e6db74">&#39;n</span> (leaper <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span>)))</code></pre></div>
<p>And&hellip; that leaves us the Pawn. It&rsquo;s funny how perhaps the simplest of the pieces is the most complicated to define. But if you think about it, the behavior is also the longest to describe. You can move two spaces on the first move, one space any other move, but only capture diagonally. Something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>Pawn
  (alternatives
   (on-non-capture (on-initial (move <span style="color:#ae81ff">2</span> <span style="color:#e6db74">&#39;&gt;</span>)))
   (on-non-capture             (move <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;&gt;</span>))
   (on-capture                 (move <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;X&gt;</span>))))</code></pre></div>
<p>What&rsquo;s that? We don&rsquo;t have <code>on-non-capture</code> / <code>on-capture</code> functions defined? Well, all we have to do is set the <code>tag</code> field we defined earlier. Something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Set special flags for move lists</span>
(<span style="color:#66d9ef">define </span>(set-flag flag movelist*)
  (for/list ([movelist (in-list movelist*)])
    (match-define (move-sequence flags moves) movelist)
    (move-sequence (set-add flags flag) moves)))

(<span style="color:#66d9ef">define </span>(on-initial     movelist*) (set-flag <span style="color:#e6db74">&#39;initial-only</span> movelist*))
(<span style="color:#66d9ef">define </span>(on-capture     movelist*) (set-flag <span style="color:#e6db74">&#39;capture-only</span> movelist*))
(<span style="color:#66d9ef">define </span>(on-non-capture movelist*) (set-flag <span style="color:#e6db74">&#39;non-capture</span>  movelist*))
(<span style="color:#66d9ef">define </span>(as-locust      movelist*) (set-flag <span style="color:#e6db74">&#39;locust</span>       movelist*))</code></pre></div>
<p>Locusts are something we&rsquo;ll get to eventually. Those are pieces that move like checkers: they capture by jumping. Other than that, we just need the <code>alternatives</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Merge multiple move lists by allowing any of them</span>
(<span style="color:#66d9ef">define </span>(alternatives <span style="color:#f92672">.</span> list*)
  (apply append list*))</code></pre></div>
<p>Feels like cheating. And there we have the pawn:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; Pawn
(list
 (move-sequence (set <span style="color:#e6db74">&#39;initial-only</span> <span style="color:#e6db74">&#39;non-capture</span>) (list (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>)))
 (move-sequence (set <span style="color:#e6db74">&#39;non-capture</span>) (list (pt <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>)))
 (move-sequence (set <span style="color:#e6db74">&#39;capture-only</span>) (list (pt <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>)))
 (move-sequence (set <span style="color:#e6db74">&#39;capture-only</span>) (list (pt <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>))))</code></pre></div>
<p>Sweet.</p>

<p>Okay, what about other kinds of pieces. Say&hellip; the Aanca. That&rsquo;s a piece that moves one square orthogonally than diagonally outwards. It&rsquo;s a bit complicated by the fact that we don&rsquo;t want to double back with the diagonals and we need one more function. A sequencer:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Merge multiple move lists by doing one and then the next, each relative to the previous endpoint</span>
(<span style="color:#66d9ef">define </span>(and-then first* rest*)
  (for*/list ([first (in-list first*)]
              [rest  (in-list rest*)])
    (match-define (move-sequence first-flags first-moves) first)
    (match-define (move-sequence rest-flags  rest-moves)  rest)
    (<span style="color:#66d9ef">define </span>offset (last first-moves))
    (move-sequence
     (set-union first-flags rest-flags)
     (append first-moves (map (Î» (each) (pt+ offset each)) rest-moves)))))</code></pre></div>
<p>Now we can have the Aanca:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Move one square like a rook, followed by any number of spaces diagonally outwards</span>
(<span style="color:#66d9ef">define </span>Aanca
  (alternatives
   (and-then (move <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;&gt;</span>) (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;X&gt;</span>))
   (and-then (move <span style="color:#ae81ff">1</span> (pt <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>))  (alternatives (move <span style="color:#e6db74">&#39;n</span> (pt  <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>))
                                              (move <span style="color:#e6db74">&#39;n</span> (pt  <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">1</span>))))
   (and-then (move <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;&lt;</span>) (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;X&lt;</span>))
   (and-then (move <span style="color:#ae81ff">1</span> (pt <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">0</span>)) (alternatives (move <span style="color:#e6db74">&#39;n</span> (pt <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>))
                                              (move <span style="color:#e6db74">&#39;n</span> (pt <span style="color:#ae81ff">-1</span>  <span style="color:#ae81ff">1</span>))))))</code></pre></div>
<p>And that&rsquo;s it. We can define a whole pile of the other <a href="https://en.wikipedia.org/wiki/Fairy%20chess%20pieces">Fairy chess pieces</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>Adjutant     (move  <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;&lt;&gt;</span>))
(<span style="color:#66d9ef">define </span>Advisor      (move  <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;X</span>))
(<span style="color:#66d9ef">define </span>Alfil        (move  <span style="color:#ae81ff">1</span> (leaper <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span>)))
(<span style="color:#66d9ef">define </span>Afilrider    (move <span style="color:#e6db74">&#39;n</span> (leaper <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span>)))
(<span style="color:#66d9ef">define </span>Alibaba      (alternatives (move <span style="color:#e6db74">&#39;n</span> (leaper <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span>)) (move <span style="color:#e6db74">&#39;n</span> (leaper <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>))))
(<span style="color:#66d9ef">define </span>Amazon       (alternatives (move <span style="color:#ae81ff">1</span> (leaper <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span>)) (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;*</span>)))
(<span style="color:#66d9ef">define </span>Antelope     (move  <span style="color:#ae81ff">1</span> (leaper <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span>)))
(<span style="color:#66d9ef">define </span>Archbishop   (alternatives (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;X</span>) (move <span style="color:#ae81ff">1</span> (leaper <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span>))))
(<span style="color:#66d9ef">define </span>ArrowPawn    (alternatives (on-non-capture (move <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;+</span>))
                                   (on-capture (move <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;X</span>))))
(<span style="color:#66d9ef">define </span>Backslider   (move  <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;&lt;</span>))
(<span style="color:#66d9ef">define </span>Banshee      (alternatives (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;X</span>) (move <span style="color:#e6db74">&#39;n</span> (leaper <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span>))))
(<span style="color:#66d9ef">define </span>Bede         (alternatives (move <span style="color:#e6db74">&#39;n</span> <span style="color:#e6db74">&#39;X</span>) (move <span style="color:#e6db74">&#39;n</span> (leaper <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>))))
(<span style="color:#66d9ef">define </span>BerolinaPawn (alternatives (on-non-capture (on-initial (move <span style="color:#ae81ff">2</span> <span style="color:#e6db74">&#39;X&gt;</span>)))
                                   (on-non-capture (move <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;X&gt;</span>))
                                   (on-capture (move <span style="color:#ae81ff">1</span> <span style="color:#e6db74">&#39;&gt;</span>))))
<span style="color:#f92672">...</span></code></pre></div>
<p>(Feel free to submit a <a href="https://github.com/jpverkamp/chess-puzzles/pulls">pull request</a> if you want to add more. ðŸ˜„)</p>

<p>Oof. That&rsquo;s a lot of code. I think that&rsquo;s about enough for today.</p>

<p>You can see the full code on GitHub: <a href="https://github.com/jpverkamp/chess-puzzles">jpverkamp/chess-puzzles</a>. Warning though: I&rsquo;m a bit further ahead code-wise than blog-wise. That way lies spoilers&hellip;</p>

<p>Speaking of which:</p>

<figure>
    <img src="/embeds/2014/chessboard.png"/> 
</figure>


<p>ðŸ˜„</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">Okay, <a href="https://blog.jverkamp.com/2013/02/01/#1gam-chesslike-1.0-did-it/">a little</a>.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">For the moment, we&rsquo;ll ignore castling and <a href="https://en.wikipedia.org/wiki/en%20passant">en passant</a>.
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div></div>
</article></div>
        </div><footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li><li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li></ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js" integrity="sha256-yDarFEUo87Z0i7SaC6b70xGAKCghhWYAZ/3p+89o4lE=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js" integrity="sha256-2ylggML6rCJMc817KbE8Cx+cuxYIM+6bjG2Gpq2g7iU=" crossorigin="anonymous"></script>

<script src="/custom.js"></script>
</body>
</html>
