<!doctype html><html><head><title>Tile Puzzle â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_5823201688106629450.min.8c7d803d89ebdecf2416d468f4ecb981a3acf645154a7a336f2e5d0190ea8163.js integrity="sha256-jH2APYnr3s8kFtRo9Oy5gaOs9kUVSnozby5dAZDqgWM=" defer></script>
<script src=/jquery.fancybox_6181813213021922412.min.921ca906a32e718ab61ac0b4da24e0eaa6bdd41912654a33b44bd3fc2f0c2a4d.js integrity="sha256-khypBqMucYq2GsC02iTg6qa91BkSZUoztEvT/C8MKk0=" defer></script>
<script src=/katex_12008035502722260518.min.1c3dce03daaf56a7d2fe0d0ec49bf35256837226f835adaf52c09502ef9bc5d1.js integrity="sha256-HD3OA9qvVqfS/g0OxJvzUlaDcib4Na2vUsCVAu+bxdE=" defer></script>
<script src=/bigfoot_8444447145154709333.min.5e80bd85ebaeb95607834d6777bfe7013d1d161f0f02a31b845e4bd765898316.js integrity="sha256-XoC9heuuuVYHg01nd7/nAT0dFh8PAqMbhF5L12WJgxY=" defer></script>
<script src=/mermaid_12365941879912544862.min.973b5415b3fa1835d620c0e58236f859d5f80891f447e240cbbb9eb825251ff0.js integrity="sha256-lztUFbP6GDXWIMDlgjb4WdX4CJH0R+JAy7ueuCUlH/A=" defer></script>
<script src=/main.min.982c2d7bb434b4cf8b19c2cf38ef7e7f7162ddbed610e5bdddbb937001e26574.js integrity="sha256-mCwte7Q0tM+LGcLPOO9+f3Fi3b7WEOW93buTcAHiZXQ=" defer></script>
<link rel=stylesheet href=/katex_14163593549783030822.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_16482899066638414220.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_16222217791602823071.min.e28b5d7d9d89efacb5f708ac30cbd76b1b9a0f816dfd9da96631d1d09cbbdd76.css integrity="sha256-4otdfZ2J76y19wisMMvXaxuaD4Ft/Z2pZjHR0Jy73XY="><link rel=stylesheet href=/css_4780214198035419921.min.246b6f8e7620eeb717bca5e7b121037906e5dfaa05805f427fcc5a09b6c99f5c.css integrity="sha256-JGtvjnYg7rcXvKXnsSEDeQbl36oFgF9Cf8xaCbbJn1w="><link rel=stylesheet href=/main.min.e0e68b86dea32185ab89b0b9cc01649107cc6b0be3290c8c7b13c716bc0dabfa.css integrity="sha256-4OaLht6jIYWribC5zAFkkQfMawvjKQyMexPHFrwNq/o="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li><a href=https://blog.jverkamp.com/search/>Search</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Tile Puzzle</h1><div class=entry-meta><span class=entry-date>2014-10-28</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/racket>Racket</a><a href=https://blog.jverkamp.com/2014/11/04/clockception/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/ class=previous-link></a><a class=taxonomy-value href=/programming/languages/scheme>Scheme</a><a href=https://blog.jverkamp.com/2014/11/04/clockception/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/sources/>Sources</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/ class=previous-link></a><a class=taxonomy-value href=/programming/sources/daily-programmer>Daily Programmer</a><a href=https://blog.jverkamp.com/2015/08/24/adjacency-matrix-generator/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/backtracking>Backtracking</a><a href=https://blog.jverkamp.com/2015/10/29/takuzu-solver/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/graphics>Graphics</a><a href=https://blog.jverkamp.com/2014/11/04/clockception/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/11/04/clockception/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2014/10/28/edge-of-tomorrow-dvd/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><p>It&rsquo;s been a while<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, but I&rsquo;m back. Today&rsquo;s post is inspired by a post from /r/dailyprogrammer almost a month ago now: <a href=https://www.reddit.com/r/dailyprogrammer/comments/2ip1gj/10082014_challenge_183_intermediate_edge_matching/>Challenge #183 [Intermediate] Edge Matching Tile Puzzle</a>. Basically, we&rsquo;re going to solve puzzles like this:</p><p><figure><img src=/embeds/2014/unsolved-3x3.png></figure><figure><img src=/embeds/2014/solved-3x3.png></figure></p><p>If you look carefully, the tiles are the same between the two, although they might be rotated.</p><p>Okay, let&rsquo;s start at the beginning. How are we going to represent a puzzle? Well, let&rsquo;s go with the same basic idea that was described in the original post: sets of four letters (in the order north, east, south, west), one for each tile. Furthermore, the letters represent color. Originally CMYK for cyan, magenta, yellow, and black, but we&rsquo;ll also add RGB for red, green, and blue (it&rsquo;s easy enough to add colors). Next, we&rsquo;ll use upper case and lower case letters in order to represent the two halves of a matching image.</p><p>So take the unsolved image above:</p><figure><img src=/embeds/2014/unsolved-3x3.png></figure><p>The first tile would be described as <code>cymK</code> for three circles and one rectangle. Continuing on, the entire puzzle would be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;cymK&#34;</span> <span style=color:#e6db74>&#34;KyCy&#34;</span> <span style=color:#e6db74>&#34;ymkc&#34;</span> <span style=color:#e6db74>&#34;mkYc&#34;</span> <span style=color:#e6db74>&#34;MycK&#34;</span> <span style=color:#e6db74>&#34;mCkY&#34;</span> <span style=color:#e6db74>&#34;cmKY&#34;</span> <span style=color:#e6db74>&#34;KYmC&#34;</span> <span style=color:#e6db74>&#34;McMk&#34;</span>)
</span></span></code></pre></div><p>Now we&rsquo;ll want two helper functions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Insert an item into the given location in a list</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>insert-at</span> ls item x)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>for/list</span> ([i (<span style=color:#a6e22e>in-naturals</span>)]
</span></span><span style=display:flex><span>             [el (<span style=color:#a6e22e>in-list</span> ls)])
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>if </span>(= x i) item el)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Return a list of all rotated versions of a string</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>rotations</span> str)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>for/list</span> ([i (<span style=color:#a6e22e>in-range</span> (string-length str))])
</span></span><span style=display:flex><span>    (string-append (substring str i) (substring str <span style=color:#ae81ff>0</span> i))))
</span></span></code></pre></div><p>Specifically, the first function allows us to insert a tile into a specified location in a list, while the second returns all possible rotations of our four character string. All around, things are going to be a little inefficient because we&rsquo;re working with lists rather than directly accessing something like a vector, but since the size of the puzzle is so small, the cost for these functions will be relatively cheap (especially compared to the crazy number of possible orderings of the tiles).</p><p>Okay, with that, we actually have enough of a framework to work out our solution. The basic plan of attack will be very much the same as when we worked on the <a href=https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/>N Queens Puzzle</a>. Place each piece in order, backtracking as soon as we see a valid solution. This way we can cut out huge swaths of the potential solution space.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Solve a puzzle by ordering pieces so that they match</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>solve</span> puzzle)
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Start with an empty solution space (all null) and a list of pieces to place</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>loop ([solution (<span style=color:#a6e22e>make-list</span> (length puzzle) <span style=color:#e6db74>&#34;\0\0\0\0&#34;</span>)]
</span></span><span style=display:flex><span>             [to-place puzzle]
</span></span><span style=display:flex><span>             [index    <span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; If we&#39;ve filled in all of the pieces, we have a solution</span>
</span></span><span style=display:flex><span>      [(= index (length puzzle))
</span></span><span style=display:flex><span>       solution]
</span></span><span style=display:flex><span>      <span style=color:#75715e>; Otherwise, try each piece, only recurring for those that fit</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; Return the first that solves the puzzle from here,</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>; by recursion this will be a full solution</span>
</span></span><span style=display:flex><span>      [else
</span></span><span style=display:flex><span>       (<span style=color:#a6e22e>for*/first</span> ([next-item (<span style=color:#a6e22e>in-list</span> to-place)]
</span></span><span style=display:flex><span>                    [next-item-rotated (<span style=color:#a6e22e>in-list</span> (<span style=color:#a6e22e>rotations</span> next-item))]
</span></span><span style=display:flex><span>                    [next-puzzle (<span style=color:#a6e22e>in-value</span> (<span style=color:#a6e22e>insert-at</span> solution
</span></span><span style=display:flex><span>                                                      next-item-rotated
</span></span><span style=display:flex><span>                                                      index))]
</span></span><span style=display:flex><span>                    <span style=color:#f92672>#</span>:when (<span style=color:#a6e22e>valid?</span> next-puzzle)
</span></span><span style=display:flex><span>                    [recur (<span style=color:#a6e22e>in-value</span> (<span style=color:#a6e22e>loop</span> next-puzzle
</span></span><span style=display:flex><span>                                           (<span style=color:#a6e22e>remove</span> next-item to-place)
</span></span><span style=display:flex><span>                                           (+ index <span style=color:#ae81ff>1</span>)))]
</span></span><span style=display:flex><span>                    <span style=color:#f92672>#</span>:when recur)
</span></span><span style=display:flex><span>         recur)])))
</span></span></code></pre></div><p>Basically there are two interesting parts: the <code>let loop</code> and the <code>for*/first</code> block. The main <code>loop</code> is the primary bit of the recursion. At any particular step, we have the solution that we&rsquo;ve built thus far. We&rsquo;ll start with all <code>\0</code> strings (which we&rsquo;ll special case in <code>valid?</code>) and then fill in puzzle pieces one at a time. <code>to-place</code> will hold the pieces we&rsquo;ve yet to place. The <code>index</code> is used primarily to insert new pieces at the proper location.</p><p>Next, we have the <code>for*/first</code> loop. This is designed to clean up the search, basically by returning the first recursion that makes it through all of the lists and conditionals. Specifically, we&rsquo;re going to do all of the following:</p><ul><li>Loop through all remaining pieces to place as <code>next-item</code></li><li>For each piece, try each rotation in turn</li><li>Generate the <code>next-puzzle</code> by inserting that piece</li><li>Check that the new insertion is <code>valid?</code></li><li>Recur with the newly placed piece removed</li><li>If there&rsquo;s a valid solution, continue to the body of the loop (and thus return, since we&rsquo;re looking for the <code>first</code>)</li></ul><p>All that combines (with the power of recursion!) to solve the puzzle:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>solve</span> <span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;cymK&#34;</span> <span style=color:#e6db74>&#34;KyCy&#34;</span> <span style=color:#e6db74>&#34;ymkc&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#e6db74>&#34;mkYc&#34;</span> <span style=color:#e6db74>&#34;MycK&#34;</span> <span style=color:#e6db74>&#34;mCkY&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#e6db74>&#34;cmKY&#34;</span> <span style=color:#e6db74>&#34;KYmC&#34;</span> <span style=color:#e6db74>&#34;McMk&#34;</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;cymK&#34;</span> <span style=color:#e6db74>&#34;mCkY&#34;</span> <span style=color:#e6db74>&#34;ymkc&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;McMk&#34;</span> <span style=color:#e6db74>&#34;KYmC&#34;</span> <span style=color:#e6db74>&#34;KyCy&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;mkYc&#34;</span> <span style=color:#e6db74>&#34;MycK&#34;</span> <span style=color:#e6db74>&#34;cmKY&#34;</span>)
</span></span></code></pre></div><p>Of course that&rsquo;s a little hard to see what in the world is going on. Let&rsquo;s write a few functions using Racket&rsquo;s <code><a href="http://docs.racket-lang.org/search/index.html?q=pict">pict</a></code>
library. First, a <code><a href="http://docs.racket-lang.org/search/index.html?q=parameter">parameter</a></code>
to control how large each tile will be and a pair of functions to decode the letters into colors / shapes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>(<span style=color:#66d9ef>define </span>current-tile-size (<span style=color:#a6e22e>make-parameter</span> <span style=color:#ae81ff>50</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>char-&gt;color</span> c)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>case </span>c
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\R</span> <span style=color:#e6db74>#\r</span>) <span style=color:#e6db74>&#34;red&#34;</span>]
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\G</span> <span style=color:#e6db74>#\g</span>) <span style=color:#e6db74>&#34;green&#34;</span>]
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\B</span> <span style=color:#e6db74>#\b</span>) <span style=color:#e6db74>&#34;blue&#34;</span>]
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\C</span> <span style=color:#e6db74>#\c</span>) <span style=color:#e6db74>&#34;cyan&#34;</span>]
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\M</span> <span style=color:#e6db74>#\m</span>) <span style=color:#e6db74>&#34;magenta&#34;</span>]
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\Y</span> <span style=color:#e6db74>#\y</span>) <span style=color:#e6db74>&#34;yellow&#34;</span>]
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\K</span> <span style=color:#e6db74>#\k</span>) <span style=color:#e6db74>&#34;black&#34;</span>]
</span></span><span style=display:flex><span>    [<span style=color:#66d9ef>else </span>     <span style=color:#e6db74>&#34;white&#34;</span>]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>char-&gt;shape</span> c)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>case </span>c
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\R</span> <span style=color:#e6db74>#\G</span> <span style=color:#e6db74>#\B</span> <span style=color:#e6db74>#\C</span> <span style=color:#e6db74>#\M</span> <span style=color:#e6db74>#\Y</span> <span style=color:#e6db74>#\K</span>) filled-rectangle]
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\r</span> <span style=color:#e6db74>#\g</span> <span style=color:#e6db74>#\b</span> <span style=color:#e6db74>#\c</span> <span style=color:#e6db74>#\m</span> <span style=color:#e6db74>#\y</span> <span style=color:#e6db74>#\k</span>) filled-ellipse]
</span></span><span style=display:flex><span>    [(<span style=color:#e6db74>#\n</span>ull)                      (<span style=color:#a6e22e>Î»</span> _ (<span style=color:#a6e22e>filled-rectangle</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>))]))
</span></span></code></pre></div><p>With those, we can render an individual tile:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Render a single tile given a four character specifier</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Order is top, right, bottom, left</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Colors are cyan, magenta, yellow, red, green, blue, black (k for black)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Uppercase are square, lowercase are circular</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>render-tile</span> tile)
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>match-define</span> (list top right bottom left) (string-&gt;list tile))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Size of the individual images</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>quad-size (quotient (<span style=color:#a6e22e>current-tile-size</span>) <span style=color:#ae81ff>3</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Offsets for pinning, zero/half/full size adjusted for quad size</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>zs (- (quotient quad-size <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>hs (- (quotient (<span style=color:#a6e22e>current-tile-size</span>) <span style=color:#ae81ff>2</span>) (quotient quad-size <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>fs (- (<span style=color:#a6e22e>current-tile-size</span>) (quotient quad-size <span style=color:#ae81ff>2</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Helper function to render a specific shape of the specific color</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>shape</span> c)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>colorize</span> ((<span style=color:#a6e22e>char-&gt;shape</span> c) quad-size quad-size)
</span></span><span style=display:flex><span>              (<span style=color:#a6e22e>char-&gt;color</span> c)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Construct the image by layering each of the four sides on the base</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let* </span>([pict (<span style=color:#a6e22e>rectangle</span> (<span style=color:#a6e22e>current-tile-size</span>) (<span style=color:#a6e22e>current-tile-size</span>))]
</span></span><span style=display:flex><span>         [pict (<span style=color:#a6e22e>pin-under</span> pict hs zs (<span style=color:#a6e22e>shape</span> top))]
</span></span><span style=display:flex><span>         [pict (<span style=color:#a6e22e>pin-under</span> pict fs hs (<span style=color:#a6e22e>shape</span> right))]
</span></span><span style=display:flex><span>         [pict (<span style=color:#a6e22e>pin-under</span> pict hs fs (<span style=color:#a6e22e>shape</span> bottom))]
</span></span><span style=display:flex><span>         [pict [pin-under pict zs hs (<span style=color:#a6e22e>shape</span> left)]])
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>clip</span> pict)))
</span></span></code></pre></div><p>One part that took a bit here was getting the <code>zs</code>, <code>hs</code>, and <code>fs</code> functions correct. Since coordinates are based on the top left corner of each subimage, we need to correctly offset by half of the image sizes for each of the halfway points. Also, make sure you use the <code><a href="http://docs.racket-lang.org/search/index.html?q=clip">clip</a></code>
function. It will look fine with just a single tile if you do not use it, but once you start merging them&mldr; Strange things happen.</p><p>Demo time:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>render-tile</span> <span style=color:#e6db74>&#34;cymK&#34;</span>)
</span></span></code></pre></div><figure><img src=/embeds/2014/single-tile-cymK.png></figure><p>Nice!</p><p>Next, we can combine the <code>picts</code> into a single larger <code>pict</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Render a puzzle of multiple tiles</span>
</span></span><span style=display:flex><span><span style=color:#75715e>; Puzzles are assumed to be square</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>render</span> puzzle)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>width (<span style=color:#a6e22e>integer-sqrt</span> (length puzzle)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>tiles
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>for/list</span> ([y (<span style=color:#a6e22e>in-range</span> width)])
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>for/list</span> ([x (<span style=color:#a6e22e>in-range</span> width)])
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>render-tile</span> (list-ref puzzle (+ x (* y width)))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>rows
</span></span><span style=display:flex><span>    (map (<span style=color:#a6e22e>Î»</span> (<span style=color:#a6e22e>row</span>) (apply (<span style=color:#a6e22e>curry</span> hc-append <span style=color:#ae81ff>-1</span>) row)) tiles))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (apply (<span style=color:#a6e22e>curry</span> vc-append <span style=color:#ae81ff>-1</span>) rows))
</span></span></code></pre></div><p>Bam:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#a6e22e>render</span> (<span style=color:#a6e22e>solve</span> <span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;cymK&#34;</span> <span style=color:#e6db74>&#34;KyCy&#34;</span> <span style=color:#e6db74>&#34;ymkc&#34;</span>
</span></span><span style=display:flex><span>                   <span style=color:#e6db74>&#34;mkYc&#34;</span> <span style=color:#e6db74>&#34;MycK&#34;</span> <span style=color:#e6db74>&#34;mCkY&#34;</span>
</span></span><span style=display:flex><span>                   <span style=color:#e6db74>&#34;cmKY&#34;</span> <span style=color:#e6db74>&#34;KYmC&#34;</span> <span style=color:#e6db74>&#34;McMk&#34;</span>)))
</span></span></code></pre></div><figure><img src=/embeds/2014/solved-3x3.png></figure><p>Neat! We can try it on larger puzzles as well:</p><p>&mldr;</p><p>Okay, that takes a really long time. Perhaps a 4x4 with more colors (more colors is actually easier to solve since there are less valid placements for each tile):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#66d9ef>define </span>p4x4 (<span style=color:#a6e22e>random-puzzle</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>#</span>:colors <span style=color:#ae81ff>7</span>))
</span></span><span style=display:flex><span>&gt; p4x4
</span></span><span style=display:flex><span><span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;yyMY&#34;</span> <span style=color:#e6db74>&#34;mCKM&#34;</span> <span style=color:#e6db74>&#34;Cgrr&#34;</span> <span style=color:#e6db74>&#34;BMMy&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;MrYB&#34;</span> <span style=color:#e6db74>&#34;mGYK&#34;</span> <span style=color:#e6db74>&#34;BRyG&#34;</span> <span style=color:#e6db74>&#34;gRmc&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;KCCm&#34;</span> <span style=color:#e6db74>&#34;cyby&#34;</span> <span style=color:#e6db74>&#34;mYbY&#34;</span> <span style=color:#e6db74>&#34;BMcB&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;Bmbm&#34;</span> <span style=color:#e6db74>&#34;kbrr&#34;</span> <span style=color:#e6db74>&#34;MkYc&#34;</span> <span style=color:#e6db74>&#34;ybGY&#34;</span>)
</span></span><span style=display:flex><span>&gt; (<span style=color:#a6e22e>render</span> p4x4)
</span></span></code></pre></div><figure><img src=/embeds/2014/unsolved-4x4.png></figure><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span>&gt; (<span style=color:#66d9ef>define </span>p4x4-solution (<span style=color:#a6e22e>solve</span> p4x4))
</span></span><span style=display:flex><span>&gt; p4x4-solution
</span></span><span style=display:flex><span><span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;rCgr&#34;</span> <span style=color:#e6db74>&#34;BBMc&#34;</span> <span style=color:#e6db74>&#34;YmYb&#34;</span> <span style=color:#e6db74>&#34;yBMM&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;GBRy&#34;</span> <span style=color:#e6db74>&#34;mBmb&#34;</span> <span style=color:#e6db74>&#34;ycyb&#34;</span> <span style=color:#e6db74>&#34;mKCC&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;rkbr&#34;</span> <span style=color:#e6db74>&#34;MmCK&#34;</span> <span style=color:#e6db74>&#34;YyyM&#34;</span> <span style=color:#e6db74>&#34;cMkY&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;BMrY&#34;</span> <span style=color:#e6db74>&#34;cgRm&#34;</span> <span style=color:#e6db74>&#34;YybG&#34;</span> <span style=color:#e6db74>&#34;KmGY&#34;</span>)
</span></span><span style=display:flex><span>&gt; (<span style=color:#a6e22e>render</span> p4x4-solution)
</span></span></code></pre></div><figure><img src=/embeds/2014/solved-4x4.png></figure><p>Shiny. ðŸ˜„</p><p>For those interested, here&rsquo;s how I generated random puzzles:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scheme data-lang=scheme><span style=display:flex><span><span style=color:#75715e>; Generate random puzzles</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>random-puzzle</span> size <span style=color:#f92672>#</span>:colors [colors <span style=color:#ae81ff>4</span>])
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Generate n+1 intersections (including those off the edges)</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Each value is the top left corner of a tile with the right then down edge</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>intersections
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>for/list</span> ([y (<span style=color:#a6e22e>in-range</span> (+ size <span style=color:#ae81ff>1</span>))])
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>for/list</span> ([x (<span style=color:#a6e22e>in-range</span> (+ size <span style=color:#ae81ff>1</span>))])
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>for/list</span> ([which (<span style=color:#a6e22e>in-list</span> <span style=color:#f92672>&#39;</span>(right down))])
</span></span><span style=display:flex><span>          (list (string-ref <span style=color:#e6db74>&#34;CMYKRGB&#34;</span> (<span style=color:#a6e22e>random</span> (min colors <span style=color:#ae81ff>7</span>)))
</span></span><span style=display:flex><span>                (<span style=color:#66d9ef>if </span>(= <span style=color:#ae81ff>0</span> (<span style=color:#a6e22e>random</span> <span style=color:#ae81ff>2</span>)) <span style=color:#e6db74>&#39;normal</span> <span style=color:#e6db74>&#39;inverse</span>))))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>define </span>(<span style=color:#a6e22e>@</span> x y w invert?)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>match-define</span> (list char mode)
</span></span><span style=display:flex><span>      (list-ref (list-ref (list-ref intersections y) x)
</span></span><span style=display:flex><span>                (<span style=color:#66d9ef>if </span>(eq? w <span style=color:#e6db74>&#39;right</span>) <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ((<span style=color:#66d9ef>if </span>(<span style=color:#a6e22e>xor</span> invert? (eq? mode <span style=color:#e6db74>&#39;inverse</span>))
</span></span><span style=display:flex><span>         char-downcase
</span></span><span style=display:flex><span>         identity)
</span></span><span style=display:flex><span>     char))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>; Fill out the tiles</span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>shuffle</span>
</span></span><span style=display:flex><span>   (<span style=color:#a6e22e>for*/list</span> ([y (<span style=color:#a6e22e>in-range</span> size)]
</span></span><span style=display:flex><span>               [x (<span style=color:#a6e22e>in-range</span> size)])
</span></span><span style=display:flex><span>     (string (<span style=color:#a6e22e>@</span> x       y       <span style=color:#e6db74>&#39;right</span> <span style=color:#66d9ef>#f</span>)
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>@</span> (+ x <span style=color:#ae81ff>1</span>) y       <span style=color:#e6db74>&#39;down</span>  <span style=color:#66d9ef>#f</span>)
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>@</span> x       (+ y <span style=color:#ae81ff>1</span>) <span style=color:#e6db74>&#39;right</span> <span style=color:#66d9ef>#t</span>)
</span></span><span style=display:flex><span>             (<span style=color:#a6e22e>@</span> x       y       <span style=color:#e6db74>&#39;down</span>  <span style=color:#66d9ef>#t</span>)))))
</span></span></code></pre></div><p>And that&rsquo;s it. Surprisingly simple<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> to solve, a little more to render. I love problems like this. ðŸ˜„</p><p>If you really want to go off the deep end though and, go download the full source from GitHub (<a href=https://github.com/jpverkamp/small-projects/blob/master/blog/tile-puzzles.rkt>tile-puzzles.rkt</a>). Therein lies solutions for using <a href=https://en.wikipedia.org/wiki/simulated%20annealing>simulated annealing</a> or <a href=https://en.wikipedia.org/wiki/genetic%20algorithms>genetic algorithms</a> in an effort to solve the problem more <a href=https://en.wikipedia.org/wiki/heurisitically>heurisitically</a>, but neither is working particularly well as of yet. If you want to take one of those and finish it up, I&rsquo;d love to see it.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Having a baby will do that to you&mldr;&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>I really do still get surprised after all this time&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>