<!DOCTYPE html>
<html>
<head>
    <title>
    Tile Puzzle â€“ jverkamp.com
</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

    <link rel="alternate" type="application/atom+xml" title="jverkamp.com (Atom 2.0)" href="//blog.jverkamp.com/feed/">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/css/themes/light/nanogallery_light.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot-default.min.css">

<link href="https://fonts.googleapis.com/css?family=Spectral+SC|Lato|Share+Tech+Mono" rel="stylesheet">

<link rel="stylesheet" href="/custom.css" defer />


    
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<body>
    <div id="wrapper">
        <header id="page-header" role="banner">
    <h1><a href="/">JP's Blog</a></h1>

    <ul id="page-header-links">
        <li>
            <a href="https://twitter.com/jpverkamp">Twitter</a> *
            <a href="https://github.com/jpverkamp">GitHub</a> *
            <a href="https://www.flickr.com/photos/jpverkamp">Flickr</a>
        </li>
        <li>
            <form action="//www.google.com/search" method="get" onsubmit="(function(obj){obj.q.value='site:blog.jverkamp.com '+obj.qfront.value;})(this)" class="navbar-form navbar-right" role="search" _lpchecked="1">
                <div class="form-group">
                    <input name="q" type="hidden">
                    <input name="qfront" type="text" class="form-control" placeholder="Search">
                    <button type="submit" class="btn btn-default" value="Search">Search</button>
                </div>
            </form>
        </li>

    </ul>

    <nav id="header-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
        
            
        
            
            <li><a href="https://blog.jverkamp.com/photography/">Photography</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/programming/">Programming</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/research/">Research</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/reviews/">Reviews</a></li>
            
        
            
            <li><a href="https://blog.jverkamp.com/writing/">Writing</a></li>
            
        
            <li class="subscription" data-subscription="rss"><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
        </ul>
    </nav>
</header>


        <div id="page-content-wrapper">
            <div id="page-content">
            
<article>
	<header>
		<h1 class="entry-title">Tile Puzzle</h1>

        <div class="entry-meta">
            
            <span class="entry-date">2014-10-28</span>
            
            
        </div>

        <div class="entry-tags">
    
    

    <ul class="taxonomy-keys">
    
        
        

        
        

        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/languages/">Languages</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/racket">Racket</a>
                        <a href="https://blog.jverkamp.com/2014/11/04/clockception/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/languages/scheme">Scheme</a>
                        <a href="https://blog.jverkamp.com/2014/11/04/clockception/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/sources/">Sources</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/sources/daily-programmer">Daily Programmer</a>
                        <a href="https://blog.jverkamp.com/2015/08/24/adjacency-matrix-generator/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
        <li>
            <a class="taxonomy-key" href="/programming/topics/">Topics</a>
            <ul class="taxonomy-values">
            
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/09/04/chess-puzzles-knights-tour/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/backtracking">Backtracking</a>
                        <a href="https://blog.jverkamp.com/2015/10/29/takuzu-solver/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    

                    
                    

                    <li>
                        <a href="https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/" class="previous-link"></a>
                        <a class="taxonomy-value" href="/programming/topics/graphics">Graphics</a>
                        <a href="https://blog.jverkamp.com/2014/11/04/clockception/" class="next-link"></a>
                    </li>
                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
                

                
                

                
            
            
            </ul>
        </li>
        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    
        
        

        
        

        
    

    
        
        <li><a class="taxonomy-key" href="/programming">programming</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2014/11/04/clockception/" class="next-link">Next</a>
                
            </ul>
        </li>
        

        
        <li><a class="taxonomy-key" href="/">All Posts</a>
            <ul>
                <li>
                
                <a href="https://blog.jverkamp.com/2014/10/05/regular-expression-fractals/" class="previous-link">Prev</a>
                

                
                <a href="https://blog.jverkamp.com/2014/10/28/edge-of-tomorrow-dvd/" class="next-link">Next</a>
                
            </ul>
        </li>
        
    
    </ul>
</div>

    </header>

	<div class="entry-content">
		<p>It&rsquo;s been a while<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>, but I&rsquo;m back. Today&rsquo;s post is inspired by a post from /r/dailyprogrammer almost a month ago now: <a href="https://www.reddit.com/r/dailyprogrammer/comments/2ip1gj/10082014_challenge_183_intermediate_edge_matching/">Challenge #183 [Intermediate] Edge Matching Tile Puzzle</a>. Basically, we&rsquo;re going to solve puzzles like this:</p>

<p>
<figure >
    
        <img src="/embeds/2014/unsolved-3x3.png" />
    
    
</figure>


<figure >
    
        <img src="/embeds/2014/solved-3x3.png" />
    
    
</figure>
</p>

<p>If you look carefully, the tiles are the same between the two, although they might be rotated.</p>

<p></p>

<p>Okay, let&rsquo;s start at the beginning. How are we going to represent a puzzle? Well, let&rsquo;s go with the same basic idea that was described in the original post: sets of four letters (in the order north, east, south, west), one for each tile. Furthermore, the letters represent color. Originally CMYK for cyan, magenta, yellow, and black, but we&rsquo;ll also add RGB for red, green, and blue (it&rsquo;s easy enough to add colors). Next, we&rsquo;ll use upper case and lower case letters in order to represent the two halves of a matching image.</p>

<p>So take the unsolved image above:</p>


<figure >
    
        <img src="/embeds/2014/unsolved-3x3.png" />
    
    
</figure>


<p>The first tile would be described as <code>cymK</code> for three circles and one rectangle. Continuing on, the entire puzzle would be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;cymK&#34;</span> <span style="color:#e6db74">&#34;KyCy&#34;</span> <span style="color:#e6db74">&#34;ymkc&#34;</span> <span style="color:#e6db74">&#34;mkYc&#34;</span> <span style="color:#e6db74">&#34;MycK&#34;</span> <span style="color:#e6db74">&#34;mCkY&#34;</span> <span style="color:#e6db74">&#34;cmKY&#34;</span> <span style="color:#e6db74">&#34;KYmC&#34;</span> <span style="color:#e6db74">&#34;McMk&#34;</span>)</code></pre></div>
<p>Now we&rsquo;ll want two helper functions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Insert an item into the given location in a list</span>
(<span style="color:#66d9ef">define </span>(insert-at ls item x)
  (for/list ([i (in-naturals)]
             [el (in-list ls)])
    (<span style="color:#66d9ef">if </span>(= x i) item el)))

<span style="color:#75715e">; Return a list of all rotated versions of a string</span>
(<span style="color:#66d9ef">define </span>(rotations str)
  (for/list ([i (in-range (string-length str))])
    (string-append (substring str i) (substring str <span style="color:#ae81ff">0</span> i))))</code></pre></div>
<p>Specifically, the first function allows us to insert a tile into a specified location in a list, while the second returns all possible rotations of our four character string. All around, things are going to be a little inefficient because we&rsquo;re working with lists rather than directly accessing something like a vector, but since the size of the puzzle is so small, the cost for these functions will be relatively cheap (especially compared to the crazy number of possible orderings of the tiles).</p>

<p>Okay, with that, we actually have enough of a framework to work out our solution. The basic plan of attack will be very much the same as when we worked on the <a href="https://blog.jverkamp.com/2014/09/03/chess-puzzles-n-queens/">N Queens Puzzle</a>. Place each piece in order, backtracking as soon as we see a valid solution. This way we can cut out huge swaths of the potential solution space.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Solve a puzzle by ordering pieces so that they match</span>
(<span style="color:#66d9ef">define </span>(solve puzzle)
  <span style="color:#75715e">; Start with an empty solution space (all null) and a list of pieces to place</span>
  (<span style="color:#66d9ef">let </span>loop ([solution (make-list (length puzzle) <span style="color:#e6db74">&#34;\0\0\0\0&#34;</span>)]
             [to-place puzzle]
             [index    <span style="color:#ae81ff">0</span>])
    (cond
      <span style="color:#75715e">; If we&#39;ve filled in all of the pieces, we have a solution</span>
      [(= index (length puzzle))
       solution]
      <span style="color:#75715e">; Otherwise, try each piece, only recurring for those that fit</span>
      <span style="color:#75715e">; Return the first that solves the puzzle from here,</span>
      <span style="color:#75715e">; by recursion this will be a full solution</span>
      [else
       (for*/first ([next-item (in-list to-place)]
                    [next-item-rotated (in-list (rotations next-item))]
                    [next-puzzle (in-value (insert-at solution
                                                      next-item-rotated
                                                      index))]
                    <span style="color:#f92672">#</span>:when (valid? next-puzzle)
                    [recur (in-value (loop next-puzzle
                                           (remove next-item to-place)
                                           (+ index <span style="color:#ae81ff">1</span>)))]
                    <span style="color:#f92672">#</span>:when recur)
         recur)])))</code></pre></div>
<p>Basically there are two interesting parts: the <code>let loop</code> and the <code>for*/first</code> block. The main <code>loop</code> is the primary bit of the recursion. At any particular step, we have the solution that we&rsquo;ve built thus far. We&rsquo;ll start with all <code>\0</code> strings (which we&rsquo;ll special case in <code>valid?</code>) and then fill in puzzle pieces one at a time. <code>to-place</code> will hold the pieces we&rsquo;ve yet to place. The <code>index</code> is used primarily to insert new pieces at the proper location.</p>

<p>Next, we have the <code>for*/first</code> loop. This is designed to clean up the search, basically by returning the first recursion that makes it through all of the lists and conditionals. Specifically, we&rsquo;re going to do all of the following:</p>

<ul>
<li>Loop through all remaining pieces to place as <code>next-item</code></li>
<li>For each piece, try each rotation in turn</li>
<li>Generate the <code>next-puzzle</code> by inserting that piece</li>
<li>Check that the new insertion is <code>valid?</code></li>
<li>Recur with the newly placed piece removed</li>
<li>If there&rsquo;s a valid solution, continue to the body of the loop (and thus return, since we&rsquo;re looking for the <code>first</code>)</li>
</ul>

<p>All that combines (with the power of recursion!) to solve the puzzle:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (solve <span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;cymK&#34;</span> <span style="color:#e6db74">&#34;KyCy&#34;</span> <span style="color:#e6db74">&#34;ymkc&#34;</span>
           <span style="color:#e6db74">&#34;mkYc&#34;</span> <span style="color:#e6db74">&#34;MycK&#34;</span> <span style="color:#e6db74">&#34;mCkY&#34;</span>
           <span style="color:#e6db74">&#34;cmKY&#34;</span> <span style="color:#e6db74">&#34;KYmC&#34;</span> <span style="color:#e6db74">&#34;McMk&#34;</span>))
<span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;cymK&#34;</span> <span style="color:#e6db74">&#34;mCkY&#34;</span> <span style="color:#e6db74">&#34;ymkc&#34;</span>
  <span style="color:#e6db74">&#34;McMk&#34;</span> <span style="color:#e6db74">&#34;KYmC&#34;</span> <span style="color:#e6db74">&#34;KyCy&#34;</span>
  <span style="color:#e6db74">&#34;mkYc&#34;</span> <span style="color:#e6db74">&#34;MycK&#34;</span> <span style="color:#e6db74">&#34;cmKY&#34;</span>)</code></pre></div>
<p>Of course that&rsquo;s a little hard to see what in the world is going on. Let&rsquo;s write a few functions using Racket&rsquo;s <code><a href="http://docs.racket-lang.org/search/index.html?q=pict">pict</a></code>
 library. First, a <code><a href="http://docs.racket-lang.org/search/index.html?q=parameter">parameter</a></code>
 to control how large each tile will be and a pair of functions to decode the letters into colors / shapes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>current-tile-size (make-parameter <span style="color:#ae81ff">50</span>))

(<span style="color:#66d9ef">define </span>(char-&gt;color c)
  (<span style="color:#66d9ef">case </span>c
    [(<span style="color:#e6db74">#\R</span> <span style="color:#e6db74">#\r</span>) <span style="color:#e6db74">&#34;red&#34;</span>]
    [(<span style="color:#e6db74">#\G</span> <span style="color:#e6db74">#\g</span>) <span style="color:#e6db74">&#34;green&#34;</span>]
    [(<span style="color:#e6db74">#\B</span> <span style="color:#e6db74">#\b</span>) <span style="color:#e6db74">&#34;blue&#34;</span>]
    [(<span style="color:#e6db74">#\C</span> <span style="color:#e6db74">#\c</span>) <span style="color:#e6db74">&#34;cyan&#34;</span>]
    [(<span style="color:#e6db74">#\M</span> <span style="color:#e6db74">#\m</span>) <span style="color:#e6db74">&#34;magenta&#34;</span>]
    [(<span style="color:#e6db74">#\Y</span> <span style="color:#e6db74">#\y</span>) <span style="color:#e6db74">&#34;yellow&#34;</span>]
    [(<span style="color:#e6db74">#\K</span> <span style="color:#e6db74">#\k</span>) <span style="color:#e6db74">&#34;black&#34;</span>]
    [<span style="color:#66d9ef">else </span>     <span style="color:#e6db74">&#34;white&#34;</span>]))

(<span style="color:#66d9ef">define </span>(char-&gt;shape c)
  (<span style="color:#66d9ef">case </span>c
    [(<span style="color:#e6db74">#\R</span> <span style="color:#e6db74">#\G</span> <span style="color:#e6db74">#\B</span> <span style="color:#e6db74">#\C</span> <span style="color:#e6db74">#\M</span> <span style="color:#e6db74">#\Y</span> <span style="color:#e6db74">#\K</span>) filled-rectangle]
    [(<span style="color:#e6db74">#\r</span> <span style="color:#e6db74">#\g</span> <span style="color:#e6db74">#\b</span> <span style="color:#e6db74">#\c</span> <span style="color:#e6db74">#\m</span> <span style="color:#e6db74">#\y</span> <span style="color:#e6db74">#\k</span>) filled-ellipse]
    [(<span style="color:#e6db74">#\null</span>)                      (Î» _ (filled-rectangle <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>))]))</code></pre></div>
<p>With those, we can render an individual tile:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Render a single tile given a four character specifier</span>
<span style="color:#75715e">; Order is top, right, bottom, left</span>
<span style="color:#75715e">; Colors are cyan, magenta, yellow, red, green, blue, black (k for black)</span>
<span style="color:#75715e">; Uppercase are square, lowercase are circular</span>
(<span style="color:#66d9ef">define </span>(render-tile tile)
  (match-define (list top right bottom left) (string-&gt;list tile))

  <span style="color:#75715e">; Size of the individual images</span>
  (<span style="color:#66d9ef">define </span>quad-size (quotient (current-tile-size) <span style="color:#ae81ff">3</span>))

  <span style="color:#75715e">; Offsets for pinning, zero/half/full size adjusted for quad size</span>
  (<span style="color:#66d9ef">define </span>zs (- (quotient quad-size <span style="color:#ae81ff">2</span>)))
  (<span style="color:#66d9ef">define </span>hs (- (quotient (current-tile-size) <span style="color:#ae81ff">2</span>) (quotient quad-size <span style="color:#ae81ff">2</span>)))
  (<span style="color:#66d9ef">define </span>fs (- (current-tile-size) (quotient quad-size <span style="color:#ae81ff">2</span>)))

  <span style="color:#75715e">; Helper function to render a specific shape of the specific color</span>
  (<span style="color:#66d9ef">define </span>(shape c)
    (colorize ((char-&gt;shape c) quad-size quad-size)
              (char-&gt;color c)))

  <span style="color:#75715e">; Construct the image by layering each of the four sides on the base</span>
  (<span style="color:#66d9ef">let* </span>([pict (rectangle (current-tile-size) (current-tile-size))]
         [pict (pin-under pict hs zs (shape top))]
         [pict (pin-under pict fs hs (shape right))]
         [pict (pin-under pict hs fs (shape bottom))]
         [pict [pin-under pict zs hs (shape left)]])
    (clip pict)))</code></pre></div>
<p>One part that took a bit here was getting the <code>zs</code>, <code>hs</code>, and <code>fs</code> functions correct. Since coordinates are based on the top left corner of each subimage, we need to correctly offset by half of the image sizes for each of the halfway points. Also, make sure you use the <code><a href="http://docs.racket-lang.org/search/index.html?q=clip">clip</a></code>
 function. It will look fine with just a single tile if you do not use it, but once you start merging them&hellip; Strange things happen.</p>

<p>Demo time:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (render-tile <span style="color:#e6db74">&#34;cymK&#34;</span>)</code></pre></div>

<figure >
    
        <img src="/embeds/2014/single-tile-cymK.png" />
    
    
</figure>


<p>Nice!</p>

<p>Next, we can combine the <code>picts</code> into a single larger <code>pict</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Render a puzzle of multiple tiles</span>
<span style="color:#75715e">; Puzzles are assumed to be square</span>
(<span style="color:#66d9ef">define </span>(render puzzle)
  (<span style="color:#66d9ef">define </span>width (integer-sqrt (length puzzle)))

  (<span style="color:#66d9ef">define </span>tiles
    (for/list ([y (in-range width)])
      (for/list ([x (in-range width)])
        (render-tile (list-ref puzzle (+ x (* y width)))))))

  (<span style="color:#66d9ef">define </span>rows
    (map (Î» (row) (apply (curry hc-append <span style="color:#ae81ff">-1</span>) row)) tiles))

  (apply (curry vc-append <span style="color:#ae81ff">-1</span>) rows))</code></pre></div>
<p>Bam:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (render (solve <span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;cymK&#34;</span> <span style="color:#e6db74">&#34;KyCy&#34;</span> <span style="color:#e6db74">&#34;ymkc&#34;</span>
                   <span style="color:#e6db74">&#34;mkYc&#34;</span> <span style="color:#e6db74">&#34;MycK&#34;</span> <span style="color:#e6db74">&#34;mCkY&#34;</span>
                   <span style="color:#e6db74">&#34;cmKY&#34;</span> <span style="color:#e6db74">&#34;KYmC&#34;</span> <span style="color:#e6db74">&#34;McMk&#34;</span>)))</code></pre></div>

<figure >
    
        <img src="/embeds/2014/solved-3x3.png" />
    
    
</figure>


<p>Neat! We can try it on larger puzzles as well:</p>

<p>&hellip;</p>

<p>Okay, that takes a really long time. Perhaps a 4x4 with more colors (more colors is actually easier to solve since there are less valid placements for each tile):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#66d9ef">define </span>p4x4 (random-puzzle <span style="color:#ae81ff">4</span> <span style="color:#f92672">#</span>:colors <span style="color:#ae81ff">7</span>))
&gt; p4x4
<span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;yyMY&#34;</span> <span style="color:#e6db74">&#34;mCKM&#34;</span> <span style="color:#e6db74">&#34;Cgrr&#34;</span> <span style="color:#e6db74">&#34;BMMy&#34;</span>
  <span style="color:#e6db74">&#34;MrYB&#34;</span> <span style="color:#e6db74">&#34;mGYK&#34;</span> <span style="color:#e6db74">&#34;BRyG&#34;</span> <span style="color:#e6db74">&#34;gRmc&#34;</span>
  <span style="color:#e6db74">&#34;KCCm&#34;</span> <span style="color:#e6db74">&#34;cyby&#34;</span> <span style="color:#e6db74">&#34;mYbY&#34;</span> <span style="color:#e6db74">&#34;BMcB&#34;</span>
  <span style="color:#e6db74">&#34;Bmbm&#34;</span> <span style="color:#e6db74">&#34;kbrr&#34;</span> <span style="color:#e6db74">&#34;MkYc&#34;</span> <span style="color:#e6db74">&#34;ybGY&#34;</span>)
&gt; (render p4x4)</code></pre></div>

<figure >
    
        <img src="/embeds/2014/unsolved-4x4.png" />
    
    
</figure>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">&gt; (<span style="color:#66d9ef">define </span>p4x4-solution (solve p4x4))
&gt; p4x4-solution
<span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;rCgr&#34;</span> <span style="color:#e6db74">&#34;BBMc&#34;</span> <span style="color:#e6db74">&#34;YmYb&#34;</span> <span style="color:#e6db74">&#34;yBMM&#34;</span>
  <span style="color:#e6db74">&#34;GBRy&#34;</span> <span style="color:#e6db74">&#34;mBmb&#34;</span> <span style="color:#e6db74">&#34;ycyb&#34;</span> <span style="color:#e6db74">&#34;mKCC&#34;</span>
  <span style="color:#e6db74">&#34;rkbr&#34;</span> <span style="color:#e6db74">&#34;MmCK&#34;</span> <span style="color:#e6db74">&#34;YyyM&#34;</span> <span style="color:#e6db74">&#34;cMkY&#34;</span>
  <span style="color:#e6db74">&#34;BMrY&#34;</span> <span style="color:#e6db74">&#34;cgRm&#34;</span> <span style="color:#e6db74">&#34;YybG&#34;</span> <span style="color:#e6db74">&#34;KmGY&#34;</span>)
&gt; (render p4x4-solution)</code></pre></div>

<figure >
    
        <img src="/embeds/2014/solved-4x4.png" />
    
    
</figure>


<p>Shiny. ðŸ˜„</p>

<p>For those interested, here&rsquo;s how I generated random puzzles:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme"><span style="color:#75715e">; Generate random puzzles</span>
(<span style="color:#66d9ef">define </span>(random-puzzle size <span style="color:#f92672">#</span>:colors [colors <span style="color:#ae81ff">4</span>])
  <span style="color:#75715e">; Generate n+1 intersections (including those off the edges)</span>
  <span style="color:#75715e">; Each value is the top left corner of a tile with the right then down edge</span>
  (<span style="color:#66d9ef">define </span>intersections
    (for/list ([y (in-range (+ size <span style="color:#ae81ff">1</span>))])
      (for/list ([x (in-range (+ size <span style="color:#ae81ff">1</span>))])
        (for/list ([which (in-list <span style="color:#f92672">&#39;</span>(right down))])
          (list (string-ref <span style="color:#e6db74">&#34;CMYKRGB&#34;</span> (random (min colors <span style="color:#ae81ff">7</span>)))
                (<span style="color:#66d9ef">if </span>(= <span style="color:#ae81ff">0</span> (random <span style="color:#ae81ff">2</span>)) <span style="color:#e6db74">&#39;normal</span> <span style="color:#e6db74">&#39;inverse</span>))))))

  (<span style="color:#66d9ef">define </span>(@ x y w invert?)
    (match-define (list char mode)
      (list-ref (list-ref (list-ref intersections y) x)
                (<span style="color:#66d9ef">if </span>(eq? w <span style="color:#e6db74">&#39;right</span>) <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>)))

    ((<span style="color:#66d9ef">if </span>(xor invert? (eq? mode <span style="color:#e6db74">&#39;inverse</span>))
         char-downcase
         identity)
     char))

  <span style="color:#75715e">; Fill out the tiles</span>
  (shuffle
   (for*/list ([y (in-range size)]
               [x (in-range size)])
     (string (@ x       y       <span style="color:#e6db74">&#39;right</span> <span style="color:#66d9ef">#f</span>)
             (@ (+ x <span style="color:#ae81ff">1</span>) y       <span style="color:#e6db74">&#39;down</span>  <span style="color:#66d9ef">#f</span>)
             (@ x       (+ y <span style="color:#ae81ff">1</span>) <span style="color:#e6db74">&#39;right</span> <span style="color:#66d9ef">#t</span>)
             (@ x       y       <span style="color:#e6db74">&#39;down</span>  <span style="color:#66d9ef">#t</span>)))))</code></pre></div>
<p>And that&rsquo;s it. Surprisingly simple<sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup> to solve, a little more to render. I love problems like this. ðŸ˜„</p>

<p>If you really want to go off the deep end though and, go download the full source from GitHub (<a href="https://github.com/jpverkamp/small-projects/blob/master/blog/tile-puzzles.rkt">tile-puzzles.rkt</a>). Therein lies solutions for using <a href="https://en.wikipedia.org/wiki/simulated%20annealing">simulated annealing</a> or <a href="https://en.wikipedia.org/wiki/genetic%20algorithms">genetic algorithms</a> in an effort to solve the problem more <a href="https://en.wikipedia.org/wiki/heurisitically">heurisitically</a>, but neither is working particularly well as of yet. If you want to take one of those and finish it up, I&rsquo;d love to see it.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">Having a baby will do that to you&hellip;
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">I really do still get surprised after all this time
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>
	</div>

    
<div class="entry-comments">
    <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = "jverkamp";
            var disqus_title = "Tile Puzzle";
            var disqus_url = "https:\/\/blog.jverkamp.com\/2014\/10\/28\/tile-puzzle\/";

             
            (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>


</article>

            </div>
        </div>

        <footer id="page-footer" role="contentinfo">
    <nav id="footer-navigation" role="navigation" class="ribbon">
        <ul class="main-navigation">
            <li><a href="/archive-by-date/">All posts: By Date</a></li>
            <li><a href="/archive-by-tag/">All posts: By Tag</a></li>

            <li>
                <a href="/atom.xml">
                    RSS: All <sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>

            
            <li>
                <a href="/programming/atom.xml">
                    RSS: programming<sup>

<svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 24 24">
    <path fill="white" d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
</svg>
</sup>
                </a>
            </li>
            
        </ul>
    </nav>

    <div id="page-footer-content">
        <div class="legal">
            <p>
                All posts unless otherwise mentioned are licensed under
                <a rel="license" href="//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">
                    <img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png">
                </a>
            </p>

            <p>
                Any source code unless otherwise mentioned is licensed under the <a href="//directory.fsf.org/wiki/License:BSD_3Clause">3 clause BSD license</a>
            </p>
        </div>
    </div>
</footer>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/nanogallery/4.4.2/jquery.nanogallery.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/bigfoot/2.1.4/bigfoot.min.js"></script>

<script type="text/javascript" src="/custom.js" defer></script>

</body>
</html>
