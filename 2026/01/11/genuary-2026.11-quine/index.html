<!doctype html><html><head><title>Genuary 2026.11: Quine â€“ jverkamp.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><link rel=alternate type=application/atom+xml title="jverkamp.com (Atom 2.0)" href=//blog.jverkamp.com/feed/><script src=/jquery_17422284542669262002.min.834c1e2313951f0c25b90152fe8b62250eab4a2e8cbd2560fa1a1cdc91c71733.js integrity="sha256-g0weIxOVHwwluQFS/otiJQ6rSi6MvSVg+hoc3JHHFzM=" defer></script><script src=/jquery.fancybox_16245765822111608191.min.a8e11addf4349ee2ca5045f7f3cbf1febbf2c3a2840be2143ea69539c10f8c7f.js integrity="sha256-qOEa3fQ0nuLKUEX388vx/rvyw6KEC+IUPqaVOcEPjH8=" defer></script><script src=/katex_17296078054267651618.min.4a06464d8d6f8358d8896de62b53b5a89205d335dfd8c5b6b27edd7c039ae9d8.js integrity="sha256-SgZGTY1vg1jYiW3mK1O1qJIF0zXf2MW2sn7dfAOa6dg=" defer></script><script src=/auto-render_14944144240389301023.min.e694d9d5eae2917984179683ead27b998784a81398e8836c369373d2c67fc32a.js integrity="sha256-5pTZ1erikXmEF5aD6tJ7mYeEqBOY6INsNpNz0sZ/wyo=" defer></script><script src=/bigfoot_28293813221957978.min.af671f08986f0a2267c5a0cb2748b005489e47fa25f55479b200e2a563d23022.js integrity="sha256-r2cfCJhvCiJnxaDLJ0iwBUieR/ol9VR5sgDipWPSMCI=" defer></script><script src=/mermaid_9520146763733687737.min.a17078917a4403310cd19178939257b706fb5e1da76167c9f4a6d2123c9d59c4.js integrity="sha256-oXB4kXpEAzEM0ZF4k5JXtwb7Xh2nYWfJ9KbSEjydWcQ=" defer></script><script src=/main.min.d60298c89fc4f1e938aceb45c60926efee8b03efc8b50683082e669a100da643.js integrity="sha256-1gKYyJ/E8ek4rOtFxgkm7+6LA+/ItQaDCC5mmhANpkM=" defer></script><link rel=stylesheet href=/katex_13658330645258633971.min.16bacd59fb224ae6c97a749ab0ac1e708cb5e0c9ce5c9a08d7fd73dc8e69429f.css integrity="sha256-FrrNWfsiSubJenSasKwecIy14MnOXJoI1/1z3I5pQp8="><link rel=stylesheet href=/bigfoot-default_8781527669040159104.min.f15d4faa4519addb976f9d69b42bd9eb491b3596b6b2eda83aa3e9e1f48b8f14.css integrity="sha256-8V1PqkUZrduXb51ptCvZ60kbNZa2su2oOqPp4fSLjxQ="><link rel=stylesheet href=/jquery.fancybox_5330465509389191777.min.7420a1602c62a85d4b50881c1d8ce42f72c049dc2b097d440696425d6e54bb1e.css integrity="sha256-dCChYCxiqF1LUIgcHYzkL3LASdwrCX1EBpZCXW5Uux4="><link rel=stylesheet href=/css_1846377409604050217.min.fffe842bc000dd1fe8661ac6427a392a08faa95e8edab1ea7fb98c5f8dac6a6f.css integrity="sha256-//6EK8AA3R/oZhrGQno5Kgj6qV6O2rHqf7mMX42sam8="><link rel=stylesheet href=/main.min.5ff4b87c40715a96119d8b5f34d971604fc65ab18f4870fd8da6ede9fd1e6188.css integrity="sha256-X/S4fEBxWpYRnYtfNNlxYE/GWrGPSHD9jabt6f0eYYg="></head><body><div id=wrapper><header id=page-header role=banner><h1><a href=/>JP's Blog</a></h1><ul id=page-header-links><li><a href=https://github.com/jpverkamp>GitHub</a> *
<a href=https://www.flickr.com/photos/jpverkamp>Flickr</a> *
<a href=/resume>Resume</a></li><li><form action=/search/ method=get class="navbar-form navbar-right" role=search _lpchecked=1><div class=form-group><input name=q type=text class=form-control placeholder=Search>
<button type=submit class="btn btn-default" value=Search>Search</button></div></form></li></ul><nav id=header-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=https://blog.jverkamp.com/programming/>Programming</a></li><li><a href=https://blog.jverkamp.com/reviews/>Reviews</a></li><li><a href=https://blog.jverkamp.com/maker/>Maker</a></li><li><a href=https://blog.jverkamp.com/photography/>Photography</a></li><li><a href=https://blog.jverkamp.com/home-automation/>Automation</a></li><li><a href=https://blog.jverkamp.com/writing/>Writing</a></li><li><a href=https://blog.jverkamp.com/research/>Research</a></li><li class=subscription data-subscription=rss><a href=/atom.xml rel=subscribe-rss title="subscribe via RSS">RSS</a></li></ul></nav></header><div id=page-content-wrapper><div id=page-content><article data-pagefind-body><header><h1 class=entry-title data-pagefind-meta=title>Genuary 2026.11: Quine</h1><div class=entry-meta><span class=entry-date>2026-01-11</span></div><div class=entry-taxonomies><div class=entry-tags><ul class=taxonomy-keys><li><a class=taxonomy-key href=/programming/languages/>Languages</a><ul class=taxonomy-values></ul></li><li><a class=taxonomy-key href=/programming/topics/>Topics</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2026/01/10/genuary-2026.10-polar-coordinates/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/generative-art>Generative Art</a><a href=https://blog.jverkamp.com/2026/01/12/genuary-2026.12-boxes/ class=next-link></a></li><li><a href=https://blog.jverkamp.com/2026/01/10/genuary-2026.10-polar-coordinates/ class=previous-link></a><a class=taxonomy-value href=/programming/topics/procedural-content>Procedural Content</a><a href=https://blog.jverkamp.com/2026/01/12/genuary-2026.12-boxes/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/series/>Series</a><ul class=taxonomy-values><li><a href=https://blog.jverkamp.com/2026/01/10/genuary-2026.10-polar-coordinates/ class=previous-link></a><a class=taxonomy-value href=/series/genuary-2026>Genuary 2026</a><a href=https://blog.jverkamp.com/2026/01/12/genuary-2026.12-boxes/ class=next-link></a></li></ul></li><li><a class=taxonomy-key href=/programming>programming</a><ul><li><a href=https://blog.jverkamp.com/2026/01/10/genuary-2026.10-polar-coordinates/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2026/01/12/genuary-2026.12-boxes/ class=next-link>Next</a></ul></li><li><a class=taxonomy-key href=/>All Posts</a><ul><li><a href=https://blog.jverkamp.com/2026/01/11/lost-season-5/ class=previous-link>Prev</a>
<a href=https://blog.jverkamp.com/2026/01/12/genuary-2026.12-boxes/ class=next-link>Next</a></ul></li></ul></div></div></header><div class=entry-content><figure class=cover-image><img src=gen26.11.png></figure><h2 id=11-quine>11) Quine</h2><p>Making a genart <a href=https://en.wikipedia.org/wiki/quine>quine</a>? That&rsquo;s&mldr; certainly a thing!</p><p>So basically I made a very simple stack based virtual machine. You can check the source code below for what commands it can actually run. It will then run until it outputs enough code to match the input length (or times out). If it happens to output a quine? Woot!</p><p>If not, it will randomly mutate and try again.</p><ul><li><code>cellSize</code> - Change how big the program is (default is 10, theoretically with <code>semi quines</code> size shouldn&rsquo;t matter)</li><li><code>ticksPerFrame</code> - How fast the simulation will run</li><li><code>asFastAsPossible</code> - Ignore the above and run an entire simulation per frame (it could <em>technically</em> go even faster &#x1f604;)</li><li><code>pauseAfter</code> - Pause to see what happened after output is done or a break</li><li><code>stopAfter</code> - When a single program has run, stop the main loop (mostly useful for debugging)</li><li><code>randomizePercent</code> - How much of the input to randomly change for the next iteration</li><li><code>runOutput</code> - Run the output as the next program (otherwise, randomize the input)</li><li><code>highlightActive</code> - Highlight the parts of the program that actually ran (brighter colors)</li><li><code>allowSemiQuine</code> - Ignore non-active parts of the program when considering a quine (if you copied the output to the program in these parts, they&rsquo;d be a quine, so I think it counts)</li><li><code>allowReadingCode</code> - Allow (new) commands that allow reading our own source code</li><li><code>allowWritingCode</code> - Allow (new) commands that can modify the code you were originally running</li><li><code>debugPrint</code> - Print each command run/output to console.log for debugging</li><li><code>debugSlow</code> - Drops the framerate to 1 fps for debugging</li><li><code>debugStepButton</code> - Add a &lsquo;step&rsquo; button that runs one step at a time (<code>noLoop</code>) for debugging (reload the page)</li></ul><p>In addition, you can put in code in the box and &rsquo;load&rsquo; it to run. This will be helpful to verify quines! I have some interesting code <a href=#interesting-examples>below</a> (including a hand written quine! That uses the self reading instructions).</p><p>If you manage to find a quine organically (or write one), I&rsquo;d <em>love</em> to hear what it was!</p><div class=tab><button id=iframedemo class="tablinks default" data-tabset=650e onclick='changeTab(event,"650e","iframedemo")'>Demo</button>
<button id=defaultscript class=tablinks data-tabset=650e onclick='changeTab(event,"650e","defaultscript")'>Script</button></div><div class=tabcontent data-tabset=650e id=iframedemo><iframe marginwidth=0 width=660 height=682 frameborder=0 srcdoc="
            
<html>
<head>
<script src=&#34;https://blog.jverkamp.com/p5.min_5364076176882696478.min.03e58eac22b37cd98b545eab49e3c890d99eecac6d1cbe8a3880fade45bb09ff.js&#34;></script><script src=&#34;https://blog.jverkamp.com/quicksettings_5902975354937418934.min.dbab3b4814bc1161ccdfe3780ee5adc04c40a6ecbb9c4f081c437d4cca0fe56a.js&#34;></script><script src=&#34;https://blog.jverkamp.com/p5.gui_266292142240667823.min.5aca091ab81f7b1e9d8c792eeff5e79f6d36cdbe86e6b7d7256271bfebbce865.js&#34;></script>

    <style>canvas { border: 1px solid black; border-radius: 1em; }</style>
</head>
<body>

            <script>

            
                
let gui;
let params = {
  cellSize: 10, cellSizeMin: 2, cellSizeMax: 40,
  ticksPerFrame: 10, ticksPerFrameMin: 0, ticksPerFrameMax: 1000,
  asFastAsPossible: false,
  pauseAfter: false,
  stopAfter: false,
  randomizePercent: 0.1, randomizePercentMin: 0.01, randomizePercentMax: 1.0, randomizePercentStep: 0.01,
  runOutput: true,
  highlightActive: true,
  allowSemiQuine: true,
  allowReadingCode: true,
  allowWritingCode: false,
  debugPrint: false,
  debugSlow: false,
  debugStepButton: false,
};

const OPS = [
  // Do nothing
  {name: 'nop', f: (m) => {}},
  
  // Push the next value onto the stack
  {name: 'push', f: (m) => m.push(m.next()), nargs: 1},
  
  // Pop a value off the stack without doing anything with it
  {name: 'pop', f: (m) => m.pop()},
  
  // Duplicate the top of the stack
  {name: 'dup', f: (m) => { 
    let v = m.pop();
    m.push(v);
    m.push(v); 
  }},
  
  // Read d off the stack, rotate them c times and push them back
  {name: 'roll', f: (m) => {
    let d = m.pop();
    let c = m.pop();
    
    let temp = [];
    for (let i = 0; i < d; i++) {
      if (m.stack.length > 0) {
        temp.push(m.pop());
      }
    }
    
    for (let i = 0; i < c; i++) {
      temp.push(temp.shift());
    }
    
    for (let v in temp) {
      m.push(v);
    }
  }},
  
  // Write the top value on the stack to output (pops)
  {name: 'out', f: (m) => {
    let v = m.pop();
    if (params.debugPrint) {
      if (v < OPS.length) {
        let name = OPS[v].name;
        console.log(`OUTPUT: ${v} (${name})`);
      } else {
        console.log(`OUTPUT: ${v}`);
      }
    }
    m.out(v);
  }},
  
  // Basic math
  // Everything is unsigned byte arithmetic 
  {name: 'add', f: (m) => m.push(m.pop() + m.pop())},
  {name: 'sub', f: (m) => m.push(m.pop() - m.pop())},
  {name: 'mul', f: (m) => m.push(m.pop() * m.pop())},
  {name: 'div', f: (m) => m.push(m.pop() / (m.pop() || 1))},
  
  // Anything != 0 -> 0, 0 -> 1
  {name: 'not', f: (m) => m.push(m.pop() == 1 ? 0 : 1)},  
  
  // Pop two values, push 1 if the first is greater
  {name: 'greater', f: (m) => m.push(m.pop() > m.pop() ? 1 : 0)},
  
  // Skip the next command if the top of the stack is non-zero
  {name: 'skip', f: (m) => { 
    if (m.pop()) m.pc += 1; 
  }},
  
  // Jump forward/backward based on next arg
  {name: 'jump', f: (m) => m.pc += m.pop() - 1},
  {name: 'jumpback', f: (m) => m.pc -= m.pop() + 1},
  
  // And catch fire
  {name: 'halt', f: (m) => {
    while (m.output.length < m.code.length) {
      m.out(0);
    }
  }},
  
  // Read data about the current state of the machine
  {name: 'peek', f: (m) => m.push(m.code[m.pc + m.pop() - 1]), requireAllowRead: true},
  {name: 'peekback', f: (m) => m.push(m.code[m.pc - m.pop() + 1]), requireAllowRead: true},
  {name: 'pc', f: (m) => m.push(m.pc), requireAllowRead: true},
  
  // Allow self modifying code
  {name: 'poke', f: (m) => m.code[m.pc + m.pop() - 1] = m.pop(), requireAllowWrite: true},
  {name: 'pokeback', f: (m) => m.code[m.pc - m.pop() + 1] = m.pop(), requireAllowWrite: true},
];

// Represents our virtual machine
class VM {
  // Initialize a machine with no code but a given memory layout/size
  constructor(w, h) {
    this.w = w;
    this.h = h;
    this.reset();
  }
  
  // Reset everything in this VM that could change
  reset() {
    this.message = &#34;&#34;;  // Debugging message
    this.code = [];    // The code to run 
    this.output = [];  // Output generated so far
    this.stack = [];   // Current stack
    this.pc = 0;       // Program counter
    
    // How long it's been since last output (used to detect infinitish loops)
    this.ticksSinceOutput = 0;
    
    // Highlight which parts of memory are actually used when running the program
    // You can get a 'free' quine by setting anything in the non active set to the output
    // Since it's not run anyways
    this.activeMemory = new Set();
    
    // Track how many times we've done this...
    evaluations += 1;
  }
  
  push(v) {
    v = floor(v);
    while (v < 0) v += 256;
    this.stack.push(v % 256);
  }
  
  pop() {
    if (this.stack.length == 0) {
      return 0;
    } else {
      return this.stack.pop();
    }
  }
  
  next() {
    let v = this.code[this.pc % this.code.length];
    this.activeMemory.add(this.pc);
    this.pc += 1;
    return v;
  }
  
  out(v) {
    this.ticksSinceOutput = 0;
    this.output.push(v);
  }
  
  randomize() {
    let previousCode = this.code || [];
    
    this.reset();
    
    for (let i = 0; i < this.w * this.h; i++) {
      if (i < previousCode.length && random() > params.randomizePercent) {
        this.code.push(previousCode[i]);
      } else {
        // My valid solution requires a `push 22` and we only have 21 opcodes :smile:
        this.code.push(floor(random() * Math.max(OPS.length, 32)));
      }      
    }
  }
  
  step() {
    this.ticksSinceOutput += 1;
    
    let debug_pc = this.pc;
    
    let v = this.next();
    let op = OPS[v];
    
    let debug_name = op == undefined ? `[${v}]` : op.name;
    if (params.debugPrint && debug_name != 'nop') {
      if (op.nargs) {
        let args = [];
        for (let i = 0; i < op.nargs; i++) {
          args.push(this.code[this.pc + i]);
        }
        console.log(`${debug_pc}: ${debug_name} ${args}`);
      } else {
        console.log(`${debug_pc}: ${debug_name}`);
      }
    }
    
    let canRun = true;
    if (op == undefined) {
      // nop invalid commands (can happen if we poke funny things into memory)
    } else if (!params.allowReadingCode && op.requireAllowRead) {
      // reading your own code could be considered quine-cheating :)
    } else if (!params.allowWritingCode && op.requireAllowWrite) {
      // writing self modifying code is generally a bad idea
      // but oh, it can do some wacky things
    } else {
      // hey, those all passed! we can actually do something!
      op.f(this);
    }
    
    // Force PC back into bounds
    while (this.pc < 0) this.pc += this.code.length;
    this.pc = this.pc % this.code.length;
  }
  
  draw() {
    background(&#34;white&#34;);
    
    // My program
    let draw = (data, xOffset) => {
      for (let cellX = 0; cellX < this.w; cellX++) {
        for (let cellY = 0; cellY < this.h; cellY++) {
          let i = cellX + cellY * this.w
          if (i >= data.length) {
            break;
          }
          
          let v = data[i];
          let hue = 360 * ((v - 1) % OPS.length) / OPS.length;
          
          noStroke();

          if (v == 0) {
            fill(0, 100, 0);
          } else if (!params.highlightActive || this.activeMemory.has(i)) {
            fill(hue, 100, 100);
          } else {
            fill(hue, 50, 100);
          }
          
          rect(
            xOffset + cellX * params.cellSize,
            cellY * params.cellSize,
            params.cellSize,
            params.cellSize,
          );
        }
      }
    }
    
    draw(this.code, 0, true);
    draw(this.output, this.w * params.cellSize);
    
    // PC
    stroke(&#34;black&#34;);
    noFill();
    rect(
      this.pc % this.w * params.cellSize,
      floor(this.pc / this.w) * params.cellSize,
      params.cellSize,
      params.cellSize,
    );

    // Debug
    fill(&#34;black&#34;);
    if (this.message) {
      text(`[${evaluations}] ${this.message}`, 8, this.h * params.cellSize + 16);
    } else {
      text(`[${evaluations}] ${this.stack}`, 8, this.h * params.cellSize + 16);
    }
    
    // Borders
    stroke(&#34;black&#34;);
    strokeWeight(1);
    noFill();
    rect(
      0,
      0,
      this.w * params.cellSize,
      this.h * params.cellSize
    );
    
    rect(
      this.w * params.cellSize,
      0,
      this.w * params.cellSize,
      this.h * params.cellSize
    );
  }
}

function oldSetup() {
  createCanvas(400, 400);
  noStroke();
  colorMode(HSB, 360, 100, 100, 100);

  gui = createGuiPanel(&#34;params&#34;);
  gui.addObject(params);
  gui.setPosition(420, 0);
  
  inputBox = createElement('textarea');
  inputBox.elt.style.width = '380px';
  inputBox.elt.style.height = '200px';
  
  createElement('br')
  let loadSource = createButton(&#34;Load source&#34;);
  loadSource.mousePressed(() => {
    params.stopAfter = true;
    noLoop();

    currentVM.reset();
    while (currentVM.code.length < currentVM.w * currentVM.h) {
      currentVM.code.push(0);
    }
    
    let address = 0;
    for (let line of inputBox.elt.value.split(&#34;\n&#34;)) {
      if (line.trim() == &#34;&#34; || line[0] == '#') {
        continue;
      }
      
      // If we have an address, update it
      let hasAddress = line.split(&#34; &#34;)[0].endsWith(':');
      if (hasAddress) {
        address = parseInt(line.slice(0, 4));
      }
      
      for (let arg of line.split(&#34; &#34;).slice(hasAddress ? 1 : 0)) {
        if (arg == &#34;&#34; || arg[0] == '#' || arg[0] == ';') {
          break;
        }
        
        let asNumber = parseInt(arg);
        if (isNaN(asNumber)) {
          // Opcode (I hope)
          let found = false;
          for (let i = 0; i < OPS.length; i++) {
            if (OPS[i].name == arg) {
              currentVM.code[address] = i;
              found = true;
              break;
            }
          }
          
          if (!found) {
            console.warn(&#34;Undefine op: &#34; + arg);
          }
        } else {
          currentVM.code[address] = asNumber;
        }
        
        address += 1;
      }
    }
    
    if (params.debugPrint) {
      console.log(&#34;Loaded source:&#34;, currentVM.code);
    }
    
    currentVM.draw();
  
    if (!params.debugStepButton) {
      loop();
    }
  });
  
  if (params.debugStepButton) {
    let step = createButton(&#34;Step&#34;);
    step.mousePressed(() => {
      noLoop();
      currentVM.step();
      currentVM.draw();
    });
    noLoop();
  }

  createElement('br')
}

let inputBox;
let lastCellSize;
let currentVM; 
let evaluations = 0;

function draw() {
  // If we don't have a machine, initialize it
  // If we do, but the size changed, re-initialize it
  if (currentVM == undefined || lastCellSize != params.cellSize) {
    lastCellSize = params.cellSize;
    currentVM = new VM(
      width / params.cellSize / 2,
      height / params.cellSize - 2,
    );
    
    currentVM.code = [];
    for (let i = 0; i < currentVM.w * currentVM.h; i++) {
      currentVM.code.push(0);
    }
  }
  
  // Iterate the VM
  for (let i = 0; i < params.ticksPerFrame; i++) {
    if (params.asFastAsPossible) {
      i = 0; // lol
    }
    currentVM.step();
    
    // If we have (at least) enough output, halt 
    // Check for a quine (code == output)
    if (currentVM.output.length >= currentVM.code.length) {
      let previousCode = currentVM.code;
      let newCode = currentVM.output.slice(0, currentVM.code.length);
      
      let isQuine = true;
      let isSemiQuine = true;

      for (let i = 0; i < previousCode.length; i++) {
        if (previousCode[i] != newCode[i]) {
          isQuine = false;
          if (currentVM.activeMemory.has(i)) {
            isSemiQuine = false;
          }
          
          if (params.allowSemiQuine && !currentVM.activeMemory.has(i)) {
            continue;
          } else {
            break;
          }
        }
      }
      
      if (isQuine || isSemiQuine) {
        if (!isQuine) {
          currentVM.message = &#34;(SEMI) QUINE FOUND!&#34;;
        } else {
          currentVM.message = &#34;QUINE FOUND!&#34;;
        }
        
        let source = '';
        for (let i = 0; i < previousCode.length; i++) {
          let op = OPS[previousCode[i]];
          if (op == undefined || op.name == 'nop') {
            continue;
          }
      
          let index = i.toString().padStart(4, '0');
          source += `${index}: ${op.name}`;
          
          if (op.nargs) {
            for (let j = 0; j < op.nargs; j++) {
              source += ` ${previousCode[++i]}`;
            }
          }
          source += '\n';
        }
        inputBox.elt.value = source;
        
        currentVM.draw();
        
        noLoop();
        return;
      }
     
      // If we made it this far, we don't have a quine so update to next output
      // And let's do it again
      currentVM.message = &#34;output complete&#34;;
      currentVM.draw();
      
      currentVM.reset();
      if (params.runOutput) {
        currentVM.code = newCode;
      } else {
        currentVM.code = previousCode;
        currentVM.randomize();
      }
      
      if (params.pauseAfter || params.stopAfter) {
        noLoop();
        if (!params.stopAfter) {
          setTimeout(loop, 1000);  
        }
      }
      
      return;
    }
    
    // Possible infinite loop
    // Or at least taking annoyingly long, so kill it
    if (currentVM.ticksSinceOutput >= currentVM.w * currentVM.h) {
      currentVM.message = &#34;timed out&#34;;
      while (currentVM.output.length < currentVM.code.length) {
        currentVM.out(0);
      }
      currentVM.draw();
      
      currentVM.randomize();
      
      if (params.pauseAfter || params.stopAfter) {
        noLoop();
        if (!params.stopAfter) {
          setTimeout(loop, 1000);  
        }
      }
      
      return;
    }    
  }
  
  currentVM.draw();
  if (params.debugSlow) {
    frameRate(1);
  }
}

            

            const START_PAUSED = false;

            
function setup() {
    // Store a copy of the original params
    const defaultParams = typeof params !== &#34;undefined&#34; ? { ...params } : {};

    // Load saved settings from the browser hash fragment
    if (parent.location.hash && typeof params !== &#34;undefined&#34;) {
        try {
            var settings = JSON.parse(atob(parent.location.hash.substring(1)));
            Object.keys(params).forEach((key) => params[key] = key in settings ? settings[key] : params[key]);
        } catch(ex) {
        }
    }

    oldSetup();
    if (START_PAUSED) {
        noLoop();
    }

    createButton(&#34;play/pause&#34;).mousePressed(() => {
        if (isLooping()) {
            noLoop();
        } else {
            loop();
        }
    });

    createButton(&#34;save&#34;).mousePressed(() => {
        saveCanvas('photo', 'png')
    });

    createButton(&#34;clear&#34;).mousePressed(() => {
        if (typeof reset !== 'undefined') {
            reset();
        } else {
            clear();
        }
    });

    createButton(&#34;reload&#34;).mousePressed(() => {
        window.location.reload();
    });

    /*
    if (typeof params !== &#34;undefined&#34;) {
        createButton(&#34;default&#34;).mousePressed(() => {
            for (const key in defaultParams) {
                params[key] = defaultParams[key];
            }
            parent.location.hash = btoa(JSON.stringify(params));
            window.location.reload();
        });

        createButton(&#34;randomize&#34;).mousePressed(() => {
            // Grab all inputs inside the GUI container
            const guiContainer = document.querySelector('.qs_main'); 
            if (!guiContainer) return;

            const inputs = guiContainer.querySelectorAll('input');
            let i = 0;

            for (const key in params) {
                const el = inputs[i++];
                if (!el) continue;

                if (el.type === &#34;checkbox&#34;) {
                    el.checked = Math.random() < 0.5;
                    params[key] = el.checked;
                } else if (el.type === &#34;range&#34;) {
                    const min = parseFloat(el.min);
                    const max = parseFloat(el.max);
                    const step = parseFloat(el.step) || 1;
                    const rangeSteps = Math.floor((max - min) / step);
                    const randomStep = Math.floor(Math.random() * (rangeSteps + 1));
                    const value = min + randomStep * step;
                    el.value = value;
                    params[key] = value;
                } else if (el.tagName.toLowerCase() === &#34;select&#34;) {
                    const options = el.options;
                    const randomIndex = Math.floor(Math.random() * options.length);
                    el.selectedIndex = randomIndex;
                    params[key] = options[randomIndex].value;
                } else {
                    console.warn(&#34;Unsupported input type for randomization: &#34; + el.type);
                }

                // Trigger input event to update the GUI and callbacks
                el.dispatchEvent(new Event('input', { bubbles: true }));
            }

            // Save the random state to hash
            parent.location.hash = btoa(JSON.stringify(params));
        });
    }
    */

    if (typeof params !== &#34;undefined&#34;) {
        for (var el of document.querySelectorAll('input')) {
            if (el.id && el.id.startsWith('qs_')) {
                el.addEventListener('change', () => {
                    parent.location.hash = btoa(JSON.stringify(params));
                });
            }
        }
    }
}

            </script>
            
<noscript>To display this p5.js sketch, JavaScript must be enabled.</noscript>
</body>
</html>

        "></iframe></div><div class=tabcontent data-tabset=650e id=defaultscript><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gui</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cellSize</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>cellSizeMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>cellSizeMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>40</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ticksPerFrame</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>ticksPerFrameMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>ticksPerFrameMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1000</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>asFastAsPossible</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pauseAfter</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>stopAfter</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>randomizePercent</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.1</span>, <span style=color:#a6e22e>randomizePercentMin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.01</span>, <span style=color:#a6e22e>randomizePercentMax</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1.0</span>, <span style=color:#a6e22e>randomizePercentStep</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.01</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>runOutput</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>highlightActive</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>allowSemiQuine</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>allowReadingCode</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>allowWritingCode</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>debugPrint</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>debugSlow</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>debugStepButton</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>OPS</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Do nothing
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;nop&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; {}},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Push the next value onto the stack
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;push&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>next</span>()), <span style=color:#a6e22e>nargs</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Pop a value off the stack without doing anything with it
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;pop&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>()},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Duplicate the top of the stack
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;dup&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; { 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>v</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>v</span>); 
</span></span><span style=display:flex><span>  }},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Read d off the stack, rotate them c times and push them back
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;roll&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>d</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>temp</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>d</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>temp</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>());
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>c</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>temp</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>temp</span>.<span style=color:#a6e22e>shift</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>v</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>temp</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>v</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Write the top value on the stack to output (pops)
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;out&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>debugPrint</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>v</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>OPS</span>.<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>OPS</span>[<span style=color:#a6e22e>v</span>].<span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`OUTPUT: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>v</span><span style=color:#e6db74>}</span><span style=color:#e6db74> (</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>)`</span>);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`OUTPUT: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>v</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>out</span>(<span style=color:#a6e22e>v</span>);
</span></span><span style=display:flex><span>  }},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Basic math
</span></span></span><span style=display:flex><span>  <span style=color:#75715e>// Everything is unsigned byte arithmetic 
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;add&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>+</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>())},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;sub&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>())},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;mul&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>())},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;div&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>/</span> (<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>||</span> <span style=color:#ae81ff>1</span>))},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Anything != 0 -&gt; 0, 0 -&gt; 1
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;not&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>)},  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Pop two values, push 1 if the first is greater
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;greater&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>)},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Skip the next command if the top of the stack is non-zero
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;skip&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; { 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>()) <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>; 
</span></span><span style=display:flex><span>  }},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Jump forward/backward based on next arg
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;jump&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;jumpback&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>-=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// And catch fire
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;halt&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>out</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Read data about the current state of the machine
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;peek&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>code</span>[<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>]), <span style=color:#a6e22e>requireAllowRead</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;peekback&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>code</span>[<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]), <span style=color:#a6e22e>requireAllowRead</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;pc&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pc</span>), <span style=color:#a6e22e>requireAllowRead</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Allow self modifying code
</span></span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;poke&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>code</span>[<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>(), <span style=color:#a6e22e>requireAllowWrite</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>},
</span></span><span style=display:flex><span>  {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;pokeback&#39;</span>, <span style=color:#a6e22e>f</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>m</span>) =&gt; <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>code</span>[<span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span>.<span style=color:#a6e22e>pop</span>(), <span style=color:#a6e22e>requireAllowWrite</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>},
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Represents our virtual machine
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>VM</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Initialize a machine with no code but a given memory layout/size
</span></span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>h</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>w</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>h</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>h</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Reset everything in this VM that could change
</span></span></span><span style=display:flex><span>  <span style=color:#a6e22e>reset</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;  <span style=color:#75715e>// Debugging message
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> [];    <span style=color:#75715e>// The code to run 
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>output</span> <span style=color:#f92672>=</span> [];  <span style=color:#75715e>// Output generated so far
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stack</span> <span style=color:#f92672>=</span> [];   <span style=color:#75715e>// Current stack
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;       <span style=color:#75715e>// Program counter
</span></span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// How long it&#39;s been since last output (used to detect infinitish loops)
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ticksSinceOutput</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Highlight which parts of memory are actually used when running the program
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// You can get a &#39;free&#39; quine by setting anything in the non active set to the output
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// Since it&#39;s not run anyways
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>activeMemory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Set</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Track how many times we&#39;ve done this...
</span></span></span><span style=display:flex><span>    <span style=color:#a6e22e>evaluations</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>v</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>v</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>v</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#a6e22e>v</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>256</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>v</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>256</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pop</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>next</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span>[<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>%</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>length</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>activeMemory</span>.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>v</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>out</span>(<span style=color:#a6e22e>v</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ticksSinceOutput</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>v</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>randomize</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>previousCode</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span> <span style=color:#f92672>||</span> [];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>h</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>previousCode</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>random</span>() <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>randomizePercent</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>previousCode</span>[<span style=color:#a6e22e>i</span>]);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// My valid solution requires a `push 22` and we only have 21 opcodes :smile:
</span></span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>OPS</span>.<span style=color:#a6e22e>length</span>, <span style=color:#ae81ff>32</span>)));
</span></span><span style=display:flex><span>      }      
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>step</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ticksSinceOutput</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>debug_pc</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>op</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>OPS</span>[<span style=color:#a6e22e>v</span>];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>debug_name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>op</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>undefined</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>`[</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>v</span><span style=color:#e6db74>}</span><span style=color:#e6db74>]`</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>debugPrint</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>debug_name</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;nop&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>nargs</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>args</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>nargs</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>push</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span>[<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span>]);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>debug_pc</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>debug_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>args</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>debug_pc</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>debug_name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>canRun</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>op</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// nop invalid commands (can happen if we poke funny things into memory)
</span></span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>allowReadingCode</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>requireAllowRead</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// reading your own code could be considered quine-cheating :)
</span></span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>allowWritingCode</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>requireAllowWrite</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// writing self modifying code is generally a bad idea
</span></span></span><span style=display:flex><span>      <span style=color:#75715e>// but oh, it can do some wacky things
</span></span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// hey, those all passed! we can actually do something!
</span></span></span><span style=display:flex><span>      <span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>f</span>(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Force PC back into bounds
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>+=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>%</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>background</span>(<span style=color:#e6db74>&#34;white&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// My program
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>draw</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>xOffset</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cellX</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>cellX</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span>; <span style=color:#a6e22e>cellX</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cellY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>cellY</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>h</span>; <span style=color:#a6e22e>cellY</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cellX</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>cellY</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hue</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>360</span> <span style=color:#f92672>*</span> ((<span style=color:#a6e22e>v</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> <span style=color:#a6e22e>OPS</span>.<span style=color:#a6e22e>length</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>OPS</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>v</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>          } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>highlightActive</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>activeMemory</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>i</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>hue</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>          } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fill</span>(<span style=color:#a6e22e>hue</span>, <span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>rect</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>xOffset</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>cellX</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>cellY</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>          );
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>draw</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>code</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>draw</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>output</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// PC
</span></span></span><span style=display:flex><span>    <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;black&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>noFill</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rect</span>(
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>%</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>floor</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pc</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Debug
</span></span></span><span style=display:flex><span>    <span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#34;black&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>text</span>(<span style=color:#e6db74>`[</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>evaluations</span><span style=color:#e6db74>}</span><span style=color:#e6db74>] </span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#ae81ff>8</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>16</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>text</span>(<span style=color:#e6db74>`[</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>evaluations</span><span style=color:#e6db74>}</span><span style=color:#e6db74>] </span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stack</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, <span style=color:#ae81ff>8</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>16</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Borders
</span></span></span><span style=display:flex><span>    <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;black&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>noFill</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rect</span>(
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rect</span>(
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>colorMode</span>(<span style=color:#a6e22e>HSB</span>, <span style=color:#ae81ff>360</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGuiPanel</span>(<span style=color:#e6db74>&#34;params&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span>.<span style=color:#a6e22e>addObject</span>(<span style=color:#a6e22e>params</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gui</span>.<span style=color:#a6e22e>setPosition</span>(<span style=color:#ae81ff>420</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>inputBox</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;textarea&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>inputBox</span>.<span style=color:#a6e22e>elt</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;380px&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>inputBox</span>.<span style=color:#a6e22e>elt</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;200px&#39;</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;br&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>loadSource</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;Load source&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>loadSource</span>.<span style=color:#a6e22e>mousePressed</span>(() =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>stopAfter</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>noLoop</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>h</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>push</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>address</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>line</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>inputBox</span>.<span style=color:#a6e22e>elt</span>.<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34;\n&#34;</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>line</span>.<span style=color:#a6e22e>trim</span>() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>line</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;#&#39;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// If we have an address, update it
</span></span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hasAddress</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>line</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34; &#34;</span>)[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>endsWith</span>(<span style=color:#e6db74>&#39;:&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>hasAddress</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>address</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>line</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>4</span>));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>arg</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>line</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#34; &#34;</span>).<span style=color:#a6e22e>slice</span>(<span style=color:#a6e22e>hasAddress</span> <span style=color:#f92672>?</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>arg</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>arg</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;#&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>arg</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;;&#39;</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>asNumber</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>arg</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (isNaN(<span style=color:#a6e22e>asNumber</span>)) {
</span></span><span style=display:flex><span>          <span style=color:#75715e>// Opcode (I hope)
</span></span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>found</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>OPS</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>OPS</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>name</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>arg</span>) {
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>[<span style=color:#a6e22e>address</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span>;
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>found</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>found</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>warn</span>(<span style=color:#e6db74>&#34;Undefine op: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>arg</span>);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>[<span style=color:#a6e22e>address</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>asNumber</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>address</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>debugPrint</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Loaded source:&#34;</span>, <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>debugStepButton</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>loop</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>debugStepButton</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>step</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;Step&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>step</span>.<span style=color:#a6e22e>mousePressed</span>(() =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>noLoop</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>step</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>noLoop</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;br&#39;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>inputBox</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lastCellSize</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>currentVM</span>; 
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>evaluations</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// If we don&#39;t have a machine, initialize it
</span></span></span><span style=display:flex><span>  <span style=color:#75715e>// If we do, but the size changed, re-initialize it
</span></span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>currentVM</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>undefined</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>lastCellSize</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>lastCellSize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>currentVM</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>VM</span>(
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>cellSize</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>h</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>push</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Iterate the VM
</span></span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>ticksPerFrame</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>asFastAsPossible</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>// lol
</span></span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>step</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// If we have (at least) enough output, halt 
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// Check for a quine (code == output)
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>previousCode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>newCode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>length</span>);
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isQuine</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isSemiQuine</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>previousCode</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>previousCode</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>!=</span> <span style=color:#a6e22e>newCode</span>[<span style=color:#a6e22e>i</span>]) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>isQuine</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>activeMemory</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>i</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>isSemiQuine</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>allowSemiQuine</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>activeMemory</span>.<span style=color:#a6e22e>has</span>(<span style=color:#a6e22e>i</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>          } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isQuine</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>isSemiQuine</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isQuine</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(SEMI) QUINE FOUND!&#34;</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;QUINE FOUND!&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>source</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>previousCode</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>op</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>OPS</span>[<span style=color:#a6e22e>previousCode</span>[<span style=color:#a6e22e>i</span>]];
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>op</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>undefined</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;nop&#39;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>toString</span>().<span style=color:#a6e22e>padStart</span>(<span style=color:#ae81ff>4</span>, <span style=color:#e6db74>&#39;0&#39;</span>);
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>source</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>index</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>nargs</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>op</span>.<span style=color:#a6e22e>nargs</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>              <span style=color:#a6e22e>source</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>` </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>previousCode</span>[<span style=color:#f92672>++</span><span style=color:#a6e22e>i</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>source</span> <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;\n&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>inputBox</span>.<span style=color:#a6e22e>elt</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>source</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>noLoop</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>      <span style=color:#75715e>// If we made it this far, we don&#39;t have a quine so update to next output
</span></span></span><span style=display:flex><span>      <span style=color:#75715e>// And let&#39;s do it again
</span></span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;output complete&#34;</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>runOutput</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newCode</span>;
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>previousCode</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>randomize</span>();
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>pauseAfter</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>stopAfter</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>noLoop</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>stopAfter</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>setTimeout</span>(<span style=color:#a6e22e>loop</span>, <span style=color:#ae81ff>1000</span>);  
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Possible infinite loop
</span></span></span><span style=display:flex><span>    <span style=color:#75715e>// Or at least taking annoyingly long, so kill it
</span></span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>ticksSinceOutput</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>w</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>h</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;timed out&#34;</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>output</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>code</span>.<span style=color:#a6e22e>length</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>out</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>randomize</span>();
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>pauseAfter</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>stopAfter</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>noLoop</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>stopAfter</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>setTimeout</span>(<span style=color:#a6e22e>loop</span>, <span style=color:#ae81ff>1000</span>);  
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }    
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>currentVM</span>.<span style=color:#a6e22e>draw</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>debugSlow</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>frameRate</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><div class=ranking><h3 class=title>Posts in <a href=/series/genuary-2026/>Genuary 2026</a>:</h3><div class=content><ul><li><a href=https://blog.jverkamp.com/2026/01/15/genuary-2026.15-invisible-object/>Genuary 2026.15: Invisible Object</a></li><li><a href=https://blog.jverkamp.com/2026/01/14/genuary-2026.14-fits-perfectly/>Genuary 2026.14: Fits Perfectly</a></li><li><a href=https://blog.jverkamp.com/2026/01/13/genuary-2026.13-self-portrait/>Genuary 2026.13: Self Portrait</a></li><li><a href=https://blog.jverkamp.com/2026/01/12/genuary-2026.12-boxes/>Genuary 2026.12: Boxes</a></li><li><a href=https://blog.jverkamp.com/2026/01/11/genuary-2026.11-quine/>Genuary 2026.11: Quine</a></li><li><a href=https://blog.jverkamp.com/2026/01/10/genuary-2026.10-polar-coordinates/>Genuary 2026.10: Polar coordinates</a></li><li><a href=https://blog.jverkamp.com/2026/01/09/genuary-2026.09-cellular-automata/>Genuary 2026.09: Cellular automata</a></li><li><a href=https://blog.jverkamp.com/2026/01/08/genuary-2026.08-a-city/>Genuary 2026.08: A city</a></li><li><a href=https://blog.jverkamp.com/2026/01/07/genuary-2026.07-boolean-algebra/>Genuary 2026.07: Boolean algebra</a></li><li><a href=https://blog.jverkamp.com/2026/01/06/genuary-2026.06-lights-on/off/>Genuary 2026.06: Lights on/off</a></li><li><a href=https://blog.jverkamp.com/2026/01/05/genuary-2026.05-write-genuary/>Genuary 2026.05: Write 'genuary'</a></li><li><a href=https://blog.jverkamp.com/2026/01/04/genuary-2026.04-lowres/>Genuary 2026.04: lowres</a></li><li><a href=https://blog.jverkamp.com/2026/01/03/genuary-2026.03-fibonacci-forever/>Genuary 2026.03: Fibonacci forever</a></li><li><a href=https://blog.jverkamp.com/2026/01/02/genuary-2026.02-twelve-principles-of-animation/>Genuary 2026.02: Twelve principles of animation</a></li><li><a href=https://blog.jverkamp.com/2026/01/01/genuary-2026.01-one-color-one-shape/>Genuary 2026.01: One color, one shape</a></li></ul></div></div><h2 id=language-specification>Language specification</h2><table><thead><tr><th>Name</th><th>Stack Effect</th><th>Description</th></tr></thead><tbody><tr><td><code>nop</code></td><td>â€”</td><td>No operation</td></tr><tr><td><code>push v</code></td><td>â†’ <code>v</code></td><td>Push next byte in code</td></tr><tr><td><code>pop</code></td><td><code>a</code> â†’</td><td>Discard top of stack</td></tr><tr><td><code>dup</code></td><td><code>a</code> â†’ <code>a a</code></td><td>Duplicate top value</td></tr><tr><td><code>roll</code></td><td><code>c d â€¦</code> â†’ rotated</td><td>Pop <code>c</code> (count) and <code>d</code> (depth), rotate top <code>d</code> stack values <code>c</code> times</td></tr><tr><td><code>out</code></td><td><code>a</code> â†’</td><td>Emit byte to output</td></tr><tr><td><code>add</code></td><td><code>a b</code> â†’ <code>a+b</code></td><td>Addition</td></tr><tr><td><code>sub</code></td><td><code>a b</code> â†’ <code>a-b</code></td><td>Subtraction</td></tr><tr><td><code>mul</code></td><td><code>a b</code> â†’ <code>a*b</code></td><td>Multiplication</td></tr><tr><td><code>div</code></td><td><code>a b</code> â†’ <code>a/b</code></td><td>Division (divide by zero yields divisor = 1)</td></tr><tr><td><code>not</code></td><td><code>a</code> â†’ <code>!a</code></td><td><code>0 â†’ 1</code>, anything else â†’ <code>0</code></td></tr><tr><td><code>greater</code></td><td><code>a b</code> â†’ <code>(a > b)</code></td><td>Push <code>1</code> if true, else <code>0</code></td></tr><tr><td><code>skip</code></td><td><code>a</code> â†’</td><td>Skip next instruction if <code>a â‰  0</code></td></tr><tr><td><code>jump</code></td><td><code>n</code> â†’</td><td><code>PC += n</code> (from the addr of the <code>jump</code>)</td></tr><tr><td><code>jumpback</code></td><td><code>n</code> â†’</td><td><code>PC -= n</code> (ditto)</td></tr><tr><td><code>halt</code></td><td>â€”</td><td>Fill output with zeroes until output length == code length</td></tr><tr><td><code>peek</code></td><td><code>n</code> â†’ byte</td><td>Read <code>code[PC + n]</code></td></tr><tr><td><code>peekback</code></td><td><code>n</code> â†’ byte</td><td>Read <code>code[PC - n]</code></td></tr><tr><td><code>pc</code></td><td>â†’ byte</td><td>Push current PC</td></tr><tr><td><code>poke</code></td><td><code>v n</code> â†’</td><td>Write <code>v</code> to <code>code[PC + n]</code></td></tr><tr><td><code>pokeback</code></td><td><code>v n</code> â†’</td><td>Write <code>v</code> to <code>code[PC - n]</code></td></tr></tbody></table><p>Assembly can be written with an opcodes and (in the case of <code>push</code>) a literal number after it.</p><p>Lines starting with <code>\d+:</code> will be treated as labels, so any code after that will be written starting at that location in memory. You definitely can use this to overwrite previous code.</p><p>Anything after <code>;</code> or <code>#</code> is a comment.</p><h2 id=interesting-examples>Interesting examples</h2><h3 id=writing-a-rainbow>Writing a rainbow</h3><p>Originally, I required writing out each instruction address by hand. So here is initial code to just output an ever increasing value:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>0000: dup
</span></span><span style=display:flex><span>0001: out
</span></span><span style=display:flex><span>0002: push 1
</span></span><span style=display:flex><span>0004: add
</span></span><span style=display:flex><span>0005: push 7
</span></span><span style=display:flex><span>0007: jumpback
</span></span></code></pre></div><p>But eventually, I realized that was silly. &#x1f604; So this is the same thing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>dup
</span></span><span style=display:flex><span>out
</span></span><span style=display:flex><span>push 1
</span></span><span style=display:flex><span>add
</span></span><span style=display:flex><span>push 7
</span></span><span style=display:flex><span>jumpback
</span></span></code></pre></div><h3 id=the-protoquine>The protoquine</h3><p>With that, I could read and output my own code. This is before I stopped manually writing all addresses:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>0000: push 0   ; index into code
</span></span><span style=display:flex><span>0002: dup
</span></span><span style=display:flex><span>0003: peek     ; code at 3 + index
</span></span><span style=display:flex><span>0004: out
</span></span><span style=display:flex><span>0005: push 1
</span></span><span style=display:flex><span>0007: add      ; increment index
</span></span><span style=display:flex><span>0008: dup
</span></span><span style=display:flex><span>0009: push 14  ; maximum offset
</span></span><span style=display:flex><span>0011: greater
</span></span><span style=display:flex><span>0012: skip     ; if maximum &gt; index don&#39;t
</span></span><span style=display:flex><span>0013: halt
</span></span><span style=display:flex><span>0014: push 14
</span></span><span style=display:flex><span>0016: jumpback ; go back to 3
</span></span></code></pre></div><p>It&rsquo;s <em>so</em> close! It&rsquo;s just missing the first three bytes.</p><h3 id=an-actual-quine>An actual quine</h3><p>Basically, with <code>peek</code>, we can read the code from that peek through to the end of the code. We could have two loops (with a peekback first), but instead, I opted to:</p><ul><li>start by jumping to the end of the code (where peek can see)</li><li>writing out the instructions to do that jump + the <code>dup</code> I need</li><li>jumping back to the main loop to write it all out</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>; jump to prefix output
</span></span><span style=display:flex><span>push 38
</span></span><span style=display:flex><span>jump
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; index into code
</span></span><span style=display:flex><span>dup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; read the code this peek + the index
</span></span><span style=display:flex><span>peek
</span></span><span style=display:flex><span>out
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; increment index
</span></span><span style=display:flex><span>push 1
</span></span><span style=display:flex><span>add
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; text if index &gt; 100 bytes
</span></span><span style=display:flex><span>; if so, halt
</span></span><span style=display:flex><span>dup
</span></span><span style=display:flex><span>push 100
</span></span><span style=display:flex><span>greater
</span></span><span style=display:flex><span>skip
</span></span><span style=display:flex><span>halt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; jump back to read next byte
</span></span><span style=display:flex><span>push 14
</span></span><span style=display:flex><span>jumpback
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; manually write out any bytes through peek
</span></span><span style=display:flex><span>0040:
</span></span><span style=display:flex><span>push 1 out  ; push
</span></span><span style=display:flex><span>push 38 out ; 38
</span></span><span style=display:flex><span>push 13 out ; jump
</span></span><span style=display:flex><span>push 3 out  ; dup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; jump back to the main loop (after the jump)
</span></span><span style=display:flex><span>0080:
</span></span><span style=display:flex><span>push 79  
</span></span><span style=display:flex><span>jumpback
</span></span></code></pre></div><p>This was fun to get working!</p><p>Here it is at <code>cellSize = 20</code>:</p><p><img src=quine.png alt="Hand written quine at cell size 20"></p><p>When it runs, it will automatically output the &lsquo;un-assembled&rsquo; version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>0000: push 38
</span></span><span style=display:flex><span>0002: jump
</span></span><span style=display:flex><span>0003: dup
</span></span><span style=display:flex><span>0004: peek
</span></span><span style=display:flex><span>0005: out
</span></span><span style=display:flex><span>0006: push 1
</span></span><span style=display:flex><span>0008: add
</span></span><span style=display:flex><span>0009: dup
</span></span><span style=display:flex><span>0010: push 100
</span></span><span style=display:flex><span>0012: greater
</span></span><span style=display:flex><span>0013: skip
</span></span><span style=display:flex><span>0014: halt
</span></span><span style=display:flex><span>0015: push 14
</span></span><span style=display:flex><span>0017: jumpback
</span></span><span style=display:flex><span>0040: push 1
</span></span><span style=display:flex><span>0042: out
</span></span><span style=display:flex><span>0043: push 38
</span></span><span style=display:flex><span>0045: out
</span></span><span style=display:flex><span>0046: push 13
</span></span><span style=display:flex><span>0048: out
</span></span><span style=display:flex><span>0049: push 3
</span></span><span style=display:flex><span>0051: out
</span></span><span style=display:flex><span>0080: push 79
</span></span><span style=display:flex><span>0082: jumpback
</span></span></code></pre></div><p>(Which is itself a quine. Duh :p)</p><h2 id=ascii-art>ASCII art?</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>0000: 0 0 0 0 0 4 4 4 4 4 4 4 0 0 0 0 0
</span></span><span style=display:flex><span>0020: 0 0 0 4 4 4 4 4 4 4 4 4 4 4 0 0 0
</span></span><span style=display:flex><span>0040: 0 0 4 4 4 4 0 0 0 0 0 0 4 4 4 4 0
</span></span><span style=display:flex><span>0060: 0 4 4 4 4 0 0 0 0 0 0 0 0 4 4 4 4
</span></span><span style=display:flex><span>0080: 0 4 4 4 0 0 4 4 0 4 4 0 0 4 4 4 4
</span></span><span style=display:flex><span>0100: 4 4 4 0 0 4 4 4 0 4 4 4 0 0 4 4 4
</span></span><span style=display:flex><span>0120: 4 4 4 0 0 4 4 4 0 4 4 4 0 0 4 4 4
</span></span><span style=display:flex><span>0140: 4 4 4 0 0 0 0 0 0 0 0 0 0 0 4 4 4
</span></span><span style=display:flex><span>0160: 4 4 4 0 0 0 4 4 4 4 4 0 0 0 4 4 4
</span></span><span style=display:flex><span>0180: 4 4 4 0 0 0 0 4 4 4 0 0 0 0 4 4 4
</span></span><span style=display:flex><span>0200: 0 4 4 4 0 0 0 0 0 0 0 0 0 4 4 4 4
</span></span><span style=display:flex><span>0220: 0 4 4 4 4 0 0 0 0 0 0 0 0 4 4 4 4
</span></span><span style=display:flex><span>0240: 0 0 4 4 4 4 0 0 0 0 0 0 4 4 4 4 0
</span></span><span style=display:flex><span>0260: 0 0 0 4 4 4 4 4 4 4 4 4 4 4 0 0 0
</span></span><span style=display:flex><span>0280: 0 0 0 0 0 4 4 4 4 4 4 4 0 0 0 0 0
</span></span></code></pre></div><p>You can&rsquo;t <em>quite</em> quine that, since you can&rsquo;t <code>peek</code> more than 256 characters ahead.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>; jump to prefix output
</span></span><span style=display:flex><span>push 38
</span></span><span style=display:flex><span>jump
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; index into code
</span></span><span style=display:flex><span>dup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; read the code this peek + the index
</span></span><span style=display:flex><span>peek
</span></span><span style=display:flex><span>out
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; increment index
</span></span><span style=display:flex><span>push 1
</span></span><span style=display:flex><span>add
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; jump back to read next byte
</span></span><span style=display:flex><span>push 8
</span></span><span style=display:flex><span>jumpback
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; manually write out any bytes through peek
</span></span><span style=display:flex><span>0040:
</span></span><span style=display:flex><span>push 1 out  ; push
</span></span><span style=display:flex><span>push 38 out ; 38
</span></span><span style=display:flex><span>push 13 out ; jump
</span></span><span style=display:flex><span>push 3 out  ; dup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>; jump back to the main loop (after the jump)
</span></span><span style=display:flex><span>0080:
</span></span><span style=display:flex><span>push 79  
</span></span><span style=display:flex><span>jumpback
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>;D
</span></span><span style=display:flex><span>0100: 0 0 0 0 0 4 4 4 4 4 4 4 0 0 0 0 0
</span></span><span style=display:flex><span>0120: 0 0 0 4 4 4 4 4 4 4 4 4 4 4 0 0 0
</span></span><span style=display:flex><span>0140: 0 0 4 4 4 4 0 0 0 0 0 0 4 4 4 4 0
</span></span><span style=display:flex><span>0160: 0 4 4 4 4 0 0 0 0 0 0 0 0 4 4 4 4
</span></span><span style=display:flex><span>0180: 0 4 4 4 0 0 4 4 0 4 4 0 0 4 4 4 4
</span></span><span style=display:flex><span>0200: 4 4 4 0 0 4 4 4 0 4 4 4 0 0 4 4 4
</span></span><span style=display:flex><span>0220: 4 4 4 0 0 4 4 4 0 4 4 4 0 0 4 4 4
</span></span><span style=display:flex><span>0240: 4 4 4 0 0 0 0 0 0 0 0 0 0 0 4 4 4
</span></span><span style=display:flex><span>0260: 4 4 4 0 0 0 4 4 4 4 4 0 0 0 4 4 4
</span></span><span style=display:flex><span>0280: 4 4 4 0 0 0 0 4 4 4 0 0 0 0 4 4 4
</span></span><span style=display:flex><span>0300: 0 4 4 4 0 0 0 0 0 0 0 0 0 4 4 4 4
</span></span><span style=display:flex><span>0320: 0 4 4 4 4 0 0 0 0 0 0 0 0 4 4 4 4
</span></span><span style=display:flex><span>0340: 0 0 4 4 4 4 0 0 0 0 0 0 4 4 4 4 0
</span></span><span style=display:flex><span>0360: 0 0 0 4 4 4 4 4 4 4 4 4 4 4 0 0 0
</span></span><span style=display:flex><span>0380: 0 0 0 0 0 4 4 4 4 4 4 4 0 0 0 0 0
</span></span></code></pre></div><p>But it&rsquo;s fun looking &#x1f604;</p><p>Also, it does as a &lsquo;semi quine&rsquo; but not an actual quine, since it does output exactly the code that <em>was actually run</em>, what it writes to the rest of the image doesn&rsquo;t matter. Try it!</p><h2 id=minimal-quine>Minimal quine</h2><p>Here&rsquo;s as small as I&rsquo;ve gotten it (same idea):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>push 10     ; jump to prefix
</span></span><span style=display:flex><span>jump
</span></span><span style=display:flex><span>dup         ; main loop
</span></span><span style=display:flex><span>peek
</span></span><span style=display:flex><span>out
</span></span><span style=display:flex><span>push 1
</span></span><span style=display:flex><span>add
</span></span><span style=display:flex><span>push 8
</span></span><span style=display:flex><span>jumpback
</span></span><span style=display:flex><span>push 1 out  ; write prefix
</span></span><span style=display:flex><span>push 10 out 
</span></span><span style=display:flex><span>push 13 out 
</span></span><span style=display:flex><span>push 3 out  
</span></span><span style=display:flex><span>push 22     ; return to main loop
</span></span><span style=display:flex><span>jumpback
</span></span></code></pre></div><p>That one is small enough to even run at size 40 with room to spare! (27 of 40 bytes).</p><p><img src=minimal-quine.png alt="Image of my minimal quine"></p></div></article></div></div><footer id=page-footer role=contentinfo><nav id=footer-navigation role=navigation class=ribbon><ul class=main-navigation><li><a href=/archive-by-date/>All posts: By Date</a></li><li><a href=/archive-by-tag/>All posts: By Tag</a></li><li><a href=/atom.xml>RSS: All <sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li><li><a href=/programming/atom.xml>RSS: programming<sup><svg width="8" height="8" viewBox="0 0 24 24"><path fill="#fff" d="M6.503 20.752C6.503 22.546 5.047 24 3.252 24c-1.796.0-3.252-1.454-3.252-3.248s1.456-3.248 3.252-3.248c1.795.001 3.251 1.454 3.251 3.248zM0 8.18v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817C15.777 15.29 8.721 8.242.0 8.18zm0-3.368C10.58 4.858 19.152 13.406 19.183 24H24c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg></sup></a></li></ul></nav><div id=page-footer-content data-pagefind-ignore=all><div class=legal><p>All posts unless otherwise mentioned are licensed under
<a rel=license href=//creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US><img alt="Creative Commons License" style=border-width:0 src=//i.creativecommons.org/l/by-nc-sa/3.0/80x15.png></a></p><p>Any source code unless otherwise mentioned is licensed under the <a href=//directory.fsf.org/wiki/License:BSD_3Clause>3 clause BSD license</a></p></div></div></footer></div></body></html>