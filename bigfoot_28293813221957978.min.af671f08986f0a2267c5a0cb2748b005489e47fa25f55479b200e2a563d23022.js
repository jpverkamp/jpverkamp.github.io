(function(){(function(e){return e.bigfoot=function(t){var s,o,d,u,m,f,p,g,v,b,j,y,r=0[0],k={actionOriginalFN:"hide",activateCallback:function(){},activateOnHover:!1,allowMultipleFN:!1,anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,anchorParentTagname:"sup",breakpoints:{},deleteOnUnhover:!1,footnoteParentClass:"footnote",footnoteTagname:"li",hoverDelay:250,numberResetSelector:0[0],popoverDeleteDelay:300,popoverCreateDelay:100,positionContent:!0,preventPageScroll:!0,scope:!1,useFootnoteOnlyOnce:!0,contentMarkup:"<aside class='bigfoot-footnote is-positioned-bottom' data-footnote-number='{{FOOTNOTENUM}}' data-footnote-identifier='{{FOOTNOTEID}}' alt='Footnote {{FOOTNOTENUM}}'> <div class='bigfoot-footnote__wrapper'> <div class='bigfoot-footnote__content'> {{FOOTNOTECONTENT}} </div></div> <div class='bigfoot-footnote__tooltip'></div> </aside>",buttonMarkup:"<div class='bigfoot-footnote__container'> <button class='bigfoot-footnote__button' id='{{SUP:data-footnote-backlink-ref}}' data-footnote-number='{{FOOTNOTENUM}}' data-footnote-identifier='{{FOOTNOTEID}}' alt='See Footnote {{FOOTNOTENUM}}' rel='footnote' data-bigfoot-footnote='{{FOOTNOTECONTENT}}'> <svg class='bigfoot-footnote__button__circle' viewbox='0 0 6 6' preserveAspectRatio='xMinYMin'><circle r='3' cx='3' cy='3' fill='white'></circle></svg> <svg class='bigfoot-footnote__button__circle' viewbox='0 0 6 6' preserveAspectRatio='xMinYMin'><circle r='3' cx='3' cy='3' fill='white'></circle></svg> <svg class='bigfoot-footnote__button__circle' viewbox='0 0 6 6' preserveAspectRatio='xMinYMin'><circle r='3' cx='3' cy='3' fill='white'></circle></svg> </button></div>"},n=e.extend(k,t),i={},A=function(){var t,s,o,i,r,c,d,u,m,f,p,v,b,y,x,w=n.scope?""+n.scope+" a[href*='#']":"a[href*='#']",C=e(w).filter(function(){var s=e(this),t=s.attr("rel");return(t==="null"||t==null)&&(t=""),(""+s.attr("href")+t).match(n.anchorPattern)&&s.closest("[class*="+n.footnoteParentClass+"]:not(a):not("+n.anchorParentTagname+")").length<1}),h=[],j=[],g=[];_(C,j),e(j).each(function(){var t,s=e(this).data("footnote-ref").replace(/[:.+~*\][]/g,"\\$&");if(n.useFootnoteOnlyOnce&&(s=""+s+":not(.footnote-processed)"),t=e(s).closest(n.footnoteTagname),t.length>0)return h.push(t.first().addClass("footnote-processed")),g.push(this)}),b=e("[data-footnote-identifier]:last"),f=b.length<1?0:+b.data("footnote-identifier"),r=[];for(i=d=0,c=h.length;0<=c?d<c:d>c;i=0<=c?++d:--d)switch(t=O(e(h[i]).html().trim(),e(g[i]).data("footnote-backlink-ref")),t=t.replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;").replace(/'/g,"&apos;"),f+=1,o="",s=e(g[i]),u=e(h[i]),n.numberResetSelector!=null?(v=s.closest(n.numberResetSelector),v.is(y)?m+=1:m=1,y=v):m=f,t.indexOf("<")!==0&&(t="<p>"+t+"</p>"),o=n.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,m).replace(/\{\{FOOTNOTEID\}\}/g,f).replace(/\{\{FOOTNOTECONTENT\}\}/g,t),o=l(o,"SUP",s),o=l(o,"FN",u),x=e(o).insertBefore(s),p=u.parent(),n.actionOriginalFN.toLowerCase()){case"hide":s.addClass("footnote-print-only"),u.addClass("footnote-print-only"),r.push(a(p));break;case"delete":s.remove(),u.remove(),r.push(a(p));break;default:r.push(s.addClass("footnote-print-only"))}return r},_=function(t,s){var o,i,a,r;s==null&&(s=[]),i=0[0],r=0[0],a=0[0],o=0[0],t.each(function(){var r,t=e(this);return a="#"+t.attr("href").split("#")[1],i=t.closest(n.anchorParentTagname),r=t.find(n.anchorParentTagname),i.length>0?(o=(i.attr("id")||"")+(t.attr("id")||""),s.push(i.attr({"data-footnote-backlink-ref":o,"data-footnote-ref":a}))):r.length>0?(o=(r.attr("id")||"")+(t.attr("id")||""),s.push(t.attr({"data-footnote-backlink-ref":o,"data-footnote-ref":a}))):(o=t.attr("id")||"",s.push(t.attr({"data-footnote-backlink-ref":o,"data-footnote-ref":a})))})},a=function(e){var t=0[0];if(e.is(":empty")||e.children(":not(.footnote-print-only)").length===0)return t=e.parent(),n.actionOriginalFN.toLowerCase()==="delete"?e.remove():e.addClass("footnote-print-only"),a(t);if(e.children(":not(.footnote-print-only)").length===e.children("hr:not(.footnote-print-only)").length)return t=e.parent(),n.actionOriginalFN.toLowerCase()==="delete"?e.remove():(e.children("hr").addClass("footnote-print-only"),e.addClass("footnote-print-only")),a(t)},O=function(e,t){var n;return t.indexOf(" ")>=0&&(t=t.trim().replace(/\s+/g,"|").replace(/(.*)/g,"($1)")),n=new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+t+"[^>]*>(.*?)<\\s*/\\s*a>","g"),e.replace(n,"").replace("[]","")},l=function(e,t,n){for(var o=new RegExp("\\{\\{"+t+":([^\\}]*)\\}\\}","g"),s=0[0],i=0[0],a=0[0],s=o.exec(e);s;)s[1]&&(i=n.attr(s[1])||"",e=e.replace("{{"+t+":"+s[1]+"}}",i)),s=o.exec(e);return e},w=function(t){var o,i,a;if(n.activateOnHover){if(o=e(t.target).closest(".bigfoot-footnote__button"),i="[data-footnote-identifier='"+o.attr("data-footnote-identifier")+"']",o.hasClass("is-active"))return;o.addClass("is-hover-instantiated"),n.allowMultipleFN||(a=".bigfoot-footnote:not("+i+")",s(a)),c(".bigfoot-footnote__button"+i).addClass("is-hover-instantiated")}},C=function(t){var o=e(t.target),n=o.closest(".bigfoot-footnote__button"),i=o.closest(".bigfoot-footnote");n.length>0?(t.preventDefault(),E(n)):i.length<1&&e(".bigfoot-footnote").length>0&&s()},E=function(e){var t;if(e.blur(),t="data-footnote-identifier='"+e.attr("data-footnote-identifier")+"'",e.hasClass("changing"))return;e.hasClass("is-active")?n.allowMultipleFN?s(".bigfoot-footnote["+t+"]"):s():(e.addClass("changing"),setTimeout(function(){return e.removeClass("changing")},n.popoverCreateDelay),c(".bigfoot-footnote__button["+t+"]"),e.addClass("is-click-instantiated"),n.allowMultipleFN||s(".bigfoot-footnote:not(["+t+"])"))},c=function(t){var a,s=0[0];return typeof t!="string"&&n.allowMultipleFN?s=t:typeof t!="string"?s=t.first():n.allowMultipleFN?s=e(t).closest(".bigfoot-footnote__button"):s=e(t+":first").closest(".bigfoot-footnote__button"),a=e(),s.each(function(){var t,d,r=e(this),c=0[0];try{return c=n.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,r.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g,r.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,r.attr("data-bigfoot-footnote")).replace(/&gtsym;/g,"&gt;").replace(/&ltsym;/g,"&lt;"),c=l(c,"BUTTON",r)}finally{t=e(c);try{n.activateCallback(t,r)}catch{}t.insertAfter(s),i[r.attr("data-footnote-identifier")]="init",t.attr("bigfoot-max-width",h(t.css("max-width"),t)),t.css("max-width",1e4),d=t.find(".bigfoot-footnote__content"),t.attr("data-bigfoot-max-height",h(d.css("max-height"),d)),o(),r.addClass("is-active"),t.find(".bigfoot-footnote__content").bindScrollHandler(),a=a.add(t)}}),setTimeout(function(){return a.addClass("is-active")},n.popoverCreateDelay),a},x=function(){var t,e=document.createElement("div");return e.style.cssText="display:inline-block;padding:0;line-height:1;position:absolute;visibility:hidden;font-size:1em;",e.appendChild(document.createElement("M")),document.body.appendChild(e),t=e.offsetHeight,document.body.removeChild(e),t},h=function(e,t){return e==="none"?e=1e4:e.indexOf("rem")>=0?e=parseFloat(e)*x():e.indexOf("em")>=0?e=parseFloat(e)*parseFloat(t.css("font-size")):e.indexOf("px")>=0?(e=parseFloat(e),e<=60&&(e=e/parseFloat(t.parent().css("width")))):e.indexOf("%")>=0&&(e=parseFloat(e)/100),e};return e.fn.bindScrollHandler=function(){return n.preventPageScroll?(e(this).on("DOMMouseScroll mousewheel",function(t){var o,i,a,n=e(this),c=n.scrollTop(),r=n[0].scrollHeight,l=parseInt(n.css("height")),s=n.closest(".bigfoot-footnote");if(n.scrollTop()>0&&n.scrollTop()<10&&s.addClass("is-scrollable"),!s.hasClass("is-scrollable"))return;return o=t.type==="DOMMouseScroll"?t.originalEvent.detail*-40:t.originalEvent.wheelDelta,a=o>0,i=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1},!a&&-o>r-l-c?(n.scrollTop(r),s.addClass("is-fully-scrolled"),i()):a&&o>c?(n.scrollTop(0),s.removeClass("is-fully-scrolled"),i()):s.removeClass("is-fully-scrolled")}),e(this)):e(this)},g=function(t){if(n.deleteOnUnhover&&n.activateOnHover)return setTimeout(function(){var n=e(t.target).closest(".bigfoot-footnote, .bigfoot-footnote__button");if(e(".bigfoot-footnote__button:hover, .bigfoot-footnote:hover").length<1)return s()},n.hoverDelay)},y=function(e){if(e.keyCode===27)return s()},s=function(t,s){var o,a,r,c;return t==null&&(t=".bigfoot-footnote"),s==null&&(s=n.popoverDeleteDelay),r=e(),c=0[0],o=0[0],a=0[0],e(t).each(function(){if(a=e(this),c=a.attr("data-footnote-identifier"),o=e(".bigfoot-footnote__button[data-footnote-identifier='"+c+"']"),!o.hasClass("changing"))return r=r.add(o),o.removeClass("is-active is-hover-instantiated is-click-instantiated").addClass("changing"),a.removeClass("is-active").addClass("disapearing"),setTimeout(function(){return a.remove(),delete i[c],o.removeClass("changing")},s)}),r},o=function(t){var s;n.positionContent&&(s=t?t.type:"resize",e(".bigfoot-footnote").each(function(){var a,r,m,f,t=e(this),c=t.attr("data-footnote-identifier"),y="data-footnote-identifier='"+c+"'",_=t.find(".bigfoot-footnote__content"),u=t.siblings(".bigfoot-footnote__button"),o=b(u),d=parseFloat(t.css("margin-top")),g=+t.attr("data-bigfoot-max-height"),j=2*d+t.outerHeight(),h=1e4,p=o.bottomRoom<j&&o.topRoom>o.bottomRoom,l=i[c];if(p?(l!=="top"&&(i[c]="top",t.addClass("is-positioned-top").removeClass("is-positioned-bottom"),t.css("transform-origin",o.leftRelative*100+"% 100%")),h=o.topRoom-d-15):((l!=="bottom"||l==="init")&&(i[c]="bottom",t.removeClass("is-positioned-top").addClass("is-positioned-bottom"),t.css("transform-origin",o.leftRelative*100+"% 0%")),h=o.bottomRoom-d-15),t.find(".bigfoot-footnote__content").css({"max-height":Math.min(h,g)+"px"}),s==="resize"&&(r=parseFloat(t.attr("bigfoot-max-width")),m=t.find(".bigfoot-footnote__wrapper"),a=r,r<=1&&(f=function(){var t,s=1e4;return n.maxWidthRelativeTo&&(t=e(n.maxWidthRelativeTo),t.length>0&&(s=t.outerWidth())),Math.min(window.innerWidth,s)}(),a=f*r),a=Math.min(a,t.find(".bigfoot-footnote__content").outerWidth()+1),m.css("max-width",a+"px"),t.css({left:-o.leftRelative*a+parseFloat(u.css("margin-left"))+u.outerWidth()/2+"px"}),v(t,o.leftRelative)),parseInt(t.outerHeight())<t.find(".bigfoot-footnote__content")[0].scrollHeight)return t.addClass("is-scrollable")}))},v=function(e,t){var n;t==null&&(t=.5),n=e.find(".bigfoot-footnote__tooltip"),n.length>0&&n.css("left",""+t*100+"%")},b=function(e){var i=parseFloat(e.css("margin-left")),a=parseFloat(e.outerWidth())-i,o=parseFloat(e.outerHeight()),t=m(),s=e.offset().top-t.scrollY+o/2,n=e.offset().left-t.scrollX+a/2;return{topRoom:s,bottomRoom:t.height-s,leftRoom:n,rightRoom:t.width-n,leftRelative:n/t.width,topRelative:s/t.height}},m=function(){var t=e(window);return{width:window.innerWidth,height:window.innerHeight,scrollX:t.scrollLeft(),scrollY:t.scrollTop()}},f=function(e,t,s,o,i){var a,c,l,u,h,m,f;return o==null&&(o=n.popoverDeleteDelay),i==null&&(i=!0),a=0[0],c=0[0],l=0[0],typeof e=="string"?(l=e.toLowerCase()==="iphone"?"<320px":e.toLowerCase()==="ipad"?"<768px":e,c=l.charAt(0)===">"?"min":l.charAt(0)==="<"?"max":null,m=c?"("+c+"-width: "+l.substring(1)+")":l,a=window.matchMedia(m)):a=e,a.media&&a.media==="invalid"?{added:!1,mq:a,listener:null}:(f=c==="min",h=c==="max",t=t||d(i,o,f,function(e){return e.addClass("is-bottom-fixed")}),s=s||d(i,o,h,function(){}),u=function(e){e.matches?t(i,r):s(i,r)},a.addListener(u),u(a),n.breakpoints[e]={added:!0,mq:a,listener:u},n.breakpoints[e])},d=function(e,t,n,s){return function(e,o){var i=0[0];return e&&(i=o.close(),o.updateSetting("activateCallback",s)),setTimeout(function(){if(o.updateSetting("positionContent",n),e)return o.activate(i)},t)}},j=function(e,t){var o,a=null,s=0[0],i=!1;if(typeof e=="string")i=n.breakpoints[e]!==0[0];else for(s in n.breakpoints)n.breakpoints.hasOwnProperty(s)&&n.breakpoints[s].mq===e&&(i=!0);return i&&(o=n.breakpoints[s||e],t?t({matches:!1}):o.listener({matches:!1}),o.mq.removeListener(o.listener),delete n.breakpoints[s||e]),i},p=function(e,t){var s,o=0[0];if(typeof e=="string")o=n[e],n[e]=t;else{o={};for(s in e)e.hasOwnProperty(s)&&(o[s]=n[s],n[s]=e[s])}return o},u=function(e){return n[e]},e(document).ready(function(){return A(),e(document).on("mouseenter",".bigfoot-footnote__button",w),e(document).on("touchend click",C),e(document).on("mouseout",".is-hover-instantiated",g),e(document).on("keyup",y),e(window).on("scroll resize",o),e(document).on("gestureend",function(){return o()})}),r={removePopovers:s,close:s,createPopover:c,activate:c,repositionFeet:o,reposition:o,addBreakpoint:f,removeBreakpoint:j,getSetting:u,updateSetting:p},r}})(jQuery)}).call(this)